var Mv=Object.create;var bl=Object.defineProperty;var Lv=Object.getOwnPropertyDescriptor;var Rv=Object.getOwnPropertyNames;var Dv=Object.getPrototypeOf,Fv=Object.prototype.hasOwnProperty;var wn=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Vv=(t,e)=>{for(var n in e)bl(t,n,{get:e[n],enumerable:!0})},$v=(t,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Rv(e))!Fv.call(t,r)&&r!==n&&bl(t,r,{get:()=>e[r],enumerable:!(i=Lv(e,r))||i.enumerable});return t};var H=(t,e,n)=>(n=t!=null?Mv(Dv(t)):{},$v(e||!t||!t.__esModule?bl(n,"default",{value:t,enumerable:!0}):n,t));var hf=wn(pe=>{"use strict";var co=Symbol.for("react.element"),Gv=Symbol.for("react.portal"),Uv=Symbol.for("react.fragment"),Hv=Symbol.for("react.strict_mode"),Ov=Symbol.for("react.profiler"),Bv=Symbol.for("react.provider"),qv=Symbol.for("react.context"),Kv=Symbol.for("react.forward_ref"),zv=Symbol.for("react.suspense"),Wv=Symbol.for("react.memo"),Jv=Symbol.for("react.lazy"),tf=Symbol.iterator;function Yv(t){return t===null||typeof t!="object"?null:(t=tf&&t[tf]||t["@@iterator"],typeof t=="function"?t:null)}var of={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},sf=Object.assign,af={};function fr(t,e,n){this.props=t,this.context=e,this.refs=af,this.updater=n||of}fr.prototype.isReactComponent={};fr.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};fr.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function lf(){}lf.prototype=fr.prototype;function Ml(t,e,n){this.props=t,this.context=e,this.refs=af,this.updater=n||of}var Ll=Ml.prototype=new lf;Ll.constructor=Ml;sf(Ll,fr.prototype);Ll.isPureReactComponent=!0;var nf=Array.isArray,uf=Object.prototype.hasOwnProperty,Rl={current:null},cf={key:!0,ref:!0,__self:!0,__source:!0};function df(t,e,n){var i,r={},o=null,a=null;if(e!=null)for(i in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(o=""+e.key),e)uf.call(e,i)&&!cf.hasOwnProperty(i)&&(r[i]=e[i]);var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){for(var c=Array(u),d=0;d<u;d++)c[d]=arguments[d+2];r.children=c}if(t&&t.defaultProps)for(i in u=t.defaultProps,u)r[i]===void 0&&(r[i]=u[i]);return{$$typeof:co,type:t,key:o,ref:a,props:r,_owner:Rl.current}}function Qv(t,e){return{$$typeof:co,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Dl(t){return typeof t=="object"&&t!==null&&t.$$typeof===co}function Zv(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var rf=/\/+/g;function Pl(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Zv(""+t.key):e.toString(36)}function Ns(t,e,n,i,r){var o=typeof t;(o==="undefined"||o==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(o){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case co:case Gv:a=!0}}if(a)return a=t,r=r(a),t=i===""?"."+Pl(a,0):i,nf(r)?(n="",t!=null&&(n=t.replace(rf,"$&/")+"/"),Ns(r,e,n,"",function(d){return d})):r!=null&&(Dl(r)&&(r=Qv(r,n+(!r.key||a&&a.key===r.key?"":(""+r.key).replace(rf,"$&/")+"/")+t)),e.push(r)),1;if(a=0,i=i===""?".":i+":",nf(t))for(var u=0;u<t.length;u++){o=t[u];var c=i+Pl(o,u);a+=Ns(o,e,n,c,r)}else if(c=Yv(t),typeof c=="function")for(t=c.call(t),u=0;!(o=t.next()).done;)o=o.value,c=i+Pl(o,u++),a+=Ns(o,e,n,c,r);else if(o==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function _s(t,e,n){if(t==null)return t;var i=[],r=0;return Ns(t,i,"","",function(o){return e.call(n,o,r++)}),i}function Xv(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var ht={current:null},ws={transition:null},jv={ReactCurrentDispatcher:ht,ReactCurrentBatchConfig:ws,ReactCurrentOwner:Rl};function ff(){throw Error("act(...) is not supported in production builds of React.")}pe.Children={map:_s,forEach:function(t,e,n){_s(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return _s(t,function(){e++}),e},toArray:function(t){return _s(t,function(e){return e})||[]},only:function(t){if(!Dl(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};pe.Component=fr;pe.Fragment=Uv;pe.Profiler=Ov;pe.PureComponent=Ml;pe.StrictMode=Hv;pe.Suspense=zv;pe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=jv;pe.act=ff;pe.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=sf({},t.props),r=t.key,o=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,a=Rl.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var u=t.type.defaultProps;for(c in e)uf.call(e,c)&&!cf.hasOwnProperty(c)&&(i[c]=e[c]===void 0&&u!==void 0?u[c]:e[c])}var c=arguments.length-2;if(c===1)i.children=n;else if(1<c){u=Array(c);for(var d=0;d<c;d++)u[d]=arguments[d+2];i.children=u}return{$$typeof:co,type:t.type,key:r,ref:o,props:i,_owner:a}};pe.createContext=function(t){return t={$$typeof:qv,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Bv,_context:t},t.Consumer=t};pe.createElement=df;pe.createFactory=function(t){var e=df.bind(null,t);return e.type=t,e};pe.createRef=function(){return{current:null}};pe.forwardRef=function(t){return{$$typeof:Kv,render:t}};pe.isValidElement=Dl;pe.lazy=function(t){return{$$typeof:Jv,_payload:{_status:-1,_result:t},_init:Xv}};pe.memo=function(t,e){return{$$typeof:Wv,type:t,compare:e===void 0?null:e}};pe.startTransition=function(t){var e=ws.transition;ws.transition={};try{t()}finally{ws.transition=e}};pe.unstable_act=ff;pe.useCallback=function(t,e){return ht.current.useCallback(t,e)};pe.useContext=function(t){return ht.current.useContext(t)};pe.useDebugValue=function(){};pe.useDeferredValue=function(t){return ht.current.useDeferredValue(t)};pe.useEffect=function(t,e){return ht.current.useEffect(t,e)};pe.useId=function(){return ht.current.useId()};pe.useImperativeHandle=function(t,e,n){return ht.current.useImperativeHandle(t,e,n)};pe.useInsertionEffect=function(t,e){return ht.current.useInsertionEffect(t,e)};pe.useLayoutEffect=function(t,e){return ht.current.useLayoutEffect(t,e)};pe.useMemo=function(t,e){return ht.current.useMemo(t,e)};pe.useReducer=function(t,e,n){return ht.current.useReducer(t,e,n)};pe.useRef=function(t){return ht.current.useRef(t)};pe.useState=function(t){return ht.current.useState(t)};pe.useSyncExternalStore=function(t,e,n){return ht.current.useSyncExternalStore(t,e,n)};pe.useTransition=function(){return ht.current.useTransition()};pe.version="18.3.1"});var ke=wn((OA,mf)=>{"use strict";mf.exports=hf()});var _f=wn(_e=>{"use strict";function Gl(t,e){var n=t.length;t.push(e);e:for(;0<n;){var i=n-1>>>1,r=t[i];if(0<Is(r,e))t[i]=e,t[n]=r,n=i;else break e}}function Zt(t){return t.length===0?null:t[0]}function As(t){if(t.length===0)return null;var e=t[0],n=t.pop();if(n!==e){t[0]=n;e:for(var i=0,r=t.length,o=r>>>1;i<o;){var a=2*(i+1)-1,u=t[a],c=a+1,d=t[c];if(0>Is(u,n))c<r&&0>Is(d,u)?(t[i]=d,t[c]=n,i=c):(t[i]=u,t[a]=n,i=a);else if(c<r&&0>Is(d,n))t[i]=d,t[c]=n,i=c;else break e}}return e}function Is(t,e){var n=t.sortIndex-e.sortIndex;return n!==0?n:t.id-e.id}typeof performance=="object"&&typeof performance.now=="function"?(pf=performance,_e.unstable_now=function(){return pf.now()}):(Fl=Date,gf=Fl.now(),_e.unstable_now=function(){return Fl.now()-gf});var pf,Fl,gf,dn=[],Wn=[],e0=1,Rt=null,ot=3,bs=!1,wi=!1,ho=!1,xf=typeof setTimeout=="function"?setTimeout:null,Tf=typeof clearTimeout=="function"?clearTimeout:null,yf=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Ul(t){for(var e=Zt(Wn);e!==null;){if(e.callback===null)As(Wn);else if(e.startTime<=t)As(Wn),e.sortIndex=e.expirationTime,Gl(dn,e);else break;e=Zt(Wn)}}function Hl(t){if(ho=!1,Ul(t),!wi)if(Zt(dn)!==null)wi=!0,Bl(Ol);else{var e=Zt(Wn);e!==null&&ql(Hl,e.startTime-t)}}function Ol(t,e){wi=!1,ho&&(ho=!1,Tf(mo),mo=-1),bs=!0;var n=ot;try{for(Ul(e),Rt=Zt(dn);Rt!==null&&(!(Rt.expirationTime>e)||t&&!Sf());){var i=Rt.callback;if(typeof i=="function"){Rt.callback=null,ot=Rt.priorityLevel;var r=i(Rt.expirationTime<=e);e=_e.unstable_now(),typeof r=="function"?Rt.callback=r:Rt===Zt(dn)&&As(dn),Ul(e)}else As(dn);Rt=Zt(dn)}if(Rt!==null)var o=!0;else{var a=Zt(Wn);a!==null&&ql(Hl,a.startTime-e),o=!1}return o}finally{Rt=null,ot=n,bs=!1}}var Ps=!1,Es=null,mo=-1,Cf=5,kf=-1;function Sf(){return!(_e.unstable_now()-kf<Cf)}function Vl(){if(Es!==null){var t=_e.unstable_now();kf=t;var e=!0;try{e=Es(!0,t)}finally{e?fo():(Ps=!1,Es=null)}}else Ps=!1}var fo;typeof yf=="function"?fo=function(){yf(Vl)}:typeof MessageChannel<"u"?($l=new MessageChannel,vf=$l.port2,$l.port1.onmessage=Vl,fo=function(){vf.postMessage(null)}):fo=function(){xf(Vl,0)};var $l,vf;function Bl(t){Es=t,Ps||(Ps=!0,fo())}function ql(t,e){mo=xf(function(){t(_e.unstable_now())},e)}_e.unstable_IdlePriority=5;_e.unstable_ImmediatePriority=1;_e.unstable_LowPriority=4;_e.unstable_NormalPriority=3;_e.unstable_Profiling=null;_e.unstable_UserBlockingPriority=2;_e.unstable_cancelCallback=function(t){t.callback=null};_e.unstable_continueExecution=function(){wi||bs||(wi=!0,Bl(Ol))};_e.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Cf=0<t?Math.floor(1e3/t):5};_e.unstable_getCurrentPriorityLevel=function(){return ot};_e.unstable_getFirstCallbackNode=function(){return Zt(dn)};_e.unstable_next=function(t){switch(ot){case 1:case 2:case 3:var e=3;break;default:e=ot}var n=ot;ot=e;try{return t()}finally{ot=n}};_e.unstable_pauseExecution=function(){};_e.unstable_requestPaint=function(){};_e.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var n=ot;ot=t;try{return e()}finally{ot=n}};_e.unstable_scheduleCallback=function(t,e,n){var i=_e.unstable_now();switch(typeof n=="object"&&n!==null?(n=n.delay,n=typeof n=="number"&&0<n?i+n:i):n=i,t){case 1:var r=-1;break;case 2:r=250;break;case 5:r=1073741823;break;case 4:r=1e4;break;default:r=5e3}return r=n+r,t={id:e0++,callback:e,priorityLevel:t,startTime:n,expirationTime:r,sortIndex:-1},n>i?(t.sortIndex=n,Gl(Wn,t),Zt(dn)===null&&t===Zt(Wn)&&(ho?(Tf(mo),mo=-1):ho=!0,ql(Hl,n-i))):(t.sortIndex=r,Gl(dn,t),wi||bs||(wi=!0,Bl(Ol))),t};_e.unstable_shouldYield=Sf;_e.unstable_wrapCallback=function(t){var e=ot;return function(){var n=ot;ot=e;try{return t.apply(this,arguments)}finally{ot=n}}}});var wf=wn((qA,Nf)=>{"use strict";Nf.exports=_f()});var bp=wn(Lt=>{"use strict";var t0=ke(),Pt=wf();function G(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Lh=new Set,Fo={};function Gi(t,e){Lr(t,e),Lr(t+"Capture",e)}function Lr(t,e){for(Fo[t]=e,t=0;t<e.length;t++)Lh.add(e[t])}var Mn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),hu=Object.prototype.hasOwnProperty,n0=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,If={},Ef={};function i0(t){return hu.call(Ef,t)?!0:hu.call(If,t)?!1:n0.test(t)?Ef[t]=!0:(If[t]=!0,!1)}function r0(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function o0(t,e,n,i){if(e===null||typeof e>"u"||r0(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function gt(t,e,n,i,r,o,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=o,this.removeEmptyString=a}var et={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){et[t]=new gt(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];et[e]=new gt(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){et[t]=new gt(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){et[t]=new gt(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){et[t]=new gt(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){et[t]=new gt(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){et[t]=new gt(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){et[t]=new gt(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){et[t]=new gt(t,5,!1,t.toLowerCase(),null,!1,!1)});var oc=/[\-:]([a-z])/g;function sc(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(oc,sc);et[e]=new gt(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(oc,sc);et[e]=new gt(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(oc,sc);et[e]=new gt(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){et[t]=new gt(t,1,!1,t.toLowerCase(),null,!1,!1)});et.xlinkHref=new gt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){et[t]=new gt(t,1,!1,t.toLowerCase(),null,!0,!0)});function ac(t,e,n,i){var r=et.hasOwnProperty(e)?et[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(o0(e,n,r,i)&&(n=null),i||r===null?i0(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var Fn=t0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ms=Symbol.for("react.element"),pr=Symbol.for("react.portal"),gr=Symbol.for("react.fragment"),lc=Symbol.for("react.strict_mode"),mu=Symbol.for("react.profiler"),Rh=Symbol.for("react.provider"),Dh=Symbol.for("react.context"),uc=Symbol.for("react.forward_ref"),pu=Symbol.for("react.suspense"),gu=Symbol.for("react.suspense_list"),cc=Symbol.for("react.memo"),Yn=Symbol.for("react.lazy");Symbol.for("react.scope");Symbol.for("react.debug_trace_mode");var Fh=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden");Symbol.for("react.cache");Symbol.for("react.tracing_marker");var Af=Symbol.iterator;function po(t){return t===null||typeof t!="object"?null:(t=Af&&t[Af]||t["@@iterator"],typeof t=="function"?t:null)}var Ve=Object.assign,Kl;function So(t){if(Kl===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Kl=e&&e[1]||""}return`
`+Kl+t}var zl=!1;function Wl(t,e){if(!t||zl)return"";zl=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var i=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){i=d}t.call(e.prototype)}else{try{throw Error()}catch(d){i=d}t()}}catch(d){if(d&&i&&typeof d.stack=="string"){for(var r=d.stack.split(`
`),o=i.stack.split(`
`),a=r.length-1,u=o.length-1;1<=a&&0<=u&&r[a]!==o[u];)u--;for(;1<=a&&0<=u;a--,u--)if(r[a]!==o[u]){if(a!==1||u!==1)do if(a--,u--,0>u||r[a]!==o[u]){var c=`
`+r[a].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=a&&0<=u);break}}}finally{zl=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?So(t):""}function s0(t){switch(t.tag){case 5:return So(t.type);case 16:return So("Lazy");case 13:return So("Suspense");case 19:return So("SuspenseList");case 0:case 2:case 15:return t=Wl(t.type,!1),t;case 11:return t=Wl(t.type.render,!1),t;case 1:return t=Wl(t.type,!0),t;default:return""}}function yu(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case gr:return"Fragment";case pr:return"Portal";case mu:return"Profiler";case lc:return"StrictMode";case pu:return"Suspense";case gu:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Dh:return(t.displayName||"Context")+".Consumer";case Rh:return(t._context.displayName||"Context")+".Provider";case uc:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case cc:return e=t.displayName||null,e!==null?e:yu(t.type)||"Memo";case Yn:e=t._payload,t=t._init;try{return yu(t(e))}catch{}}return null}function a0(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return yu(e);case 8:return e===lc?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ui(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Vh(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function l0(t){var e=Vh(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,o=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(a){i=""+a,o.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(a){i=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Ls(t){t._valueTracker||(t._valueTracker=l0(t))}function $h(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=Vh(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function aa(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function vu(t,e){var n=e.checked;return Ve({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function bf(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=ui(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Gh(t,e){e=e.checked,e!=null&&ac(t,"checked",e,!1)}function xu(t,e){Gh(t,e);var n=ui(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Tu(t,e.type,n):e.hasOwnProperty("defaultValue")&&Tu(t,e.type,ui(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Pf(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Tu(t,e,n){(e!=="number"||aa(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var _o=Array.isArray;function Ir(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+ui(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function Cu(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(G(91));return Ve({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Mf(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(G(92));if(_o(n)){if(1<n.length)throw Error(G(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:ui(n)}}function Uh(t,e){var n=ui(e.value),i=ui(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function Lf(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Hh(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ku(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Hh(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Rs,Oh=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Rs=Rs||document.createElement("div"),Rs.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Rs.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Vo(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Io={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},u0=["Webkit","ms","Moz","O"];Object.keys(Io).forEach(function(t){u0.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Io[e]=Io[t]})});function Bh(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Io.hasOwnProperty(t)&&Io[t]?(""+e).trim():e+"px"}function qh(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=Bh(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var c0=Ve({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Su(t,e){if(e){if(c0[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(G(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(G(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(G(61))}if(e.style!=null&&typeof e.style!="object")throw Error(G(62))}}function _u(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Nu=null;function dc(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var wu=null,Er=null,Ar=null;function Rf(t){if(t=ts(t)){if(typeof wu!="function")throw Error(G(280));var e=t.stateNode;e&&(e=Da(e),wu(t.stateNode,t.type,e))}}function Kh(t){Er?Ar?Ar.push(t):Ar=[t]:Er=t}function zh(){if(Er){var t=Er,e=Ar;if(Ar=Er=null,Rf(t),e)for(t=0;t<e.length;t++)Rf(e[t])}}function Wh(t,e){return t(e)}function Jh(){}var Jl=!1;function Yh(t,e,n){if(Jl)return t(e,n);Jl=!0;try{return Wh(t,e,n)}finally{Jl=!1,(Er!==null||Ar!==null)&&(Jh(),zh())}}function $o(t,e){var n=t.stateNode;if(n===null)return null;var i=Da(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(G(231,e,typeof n));return n}var Iu=!1;if(Mn)try{hr={},Object.defineProperty(hr,"passive",{get:function(){Iu=!0}}),window.addEventListener("test",hr,hr),window.removeEventListener("test",hr,hr)}catch{Iu=!1}var hr;function d0(t,e,n,i,r,o,a,u,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(f){this.onError(f)}}var Eo=!1,la=null,ua=!1,Eu=null,f0={onError:function(t){Eo=!0,la=t}};function h0(t,e,n,i,r,o,a,u,c){Eo=!1,la=null,d0.apply(f0,arguments)}function m0(t,e,n,i,r,o,a,u,c){if(h0.apply(this,arguments),Eo){if(Eo){var d=la;Eo=!1,la=null}else throw Error(G(198));ua||(ua=!0,Eu=d)}}function Ui(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Qh(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Df(t){if(Ui(t)!==t)throw Error(G(188))}function p0(t){var e=t.alternate;if(!e){if(e=Ui(t),e===null)throw Error(G(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var o=r.alternate;if(o===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return Df(r),t;if(o===i)return Df(r),e;o=o.sibling}throw Error(G(188))}if(n.return!==i.return)n=r,i=o;else{for(var a=!1,u=r.child;u;){if(u===n){a=!0,n=r,i=o;break}if(u===i){a=!0,i=r,n=o;break}u=u.sibling}if(!a){for(u=o.child;u;){if(u===n){a=!0,n=o,i=r;break}if(u===i){a=!0,i=o,n=r;break}u=u.sibling}if(!a)throw Error(G(189))}}if(n.alternate!==i)throw Error(G(190))}if(n.tag!==3)throw Error(G(188));return n.stateNode.current===n?t:e}function Zh(t){return t=p0(t),t!==null?Xh(t):null}function Xh(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Xh(t);if(e!==null)return e;t=t.sibling}return null}var jh=Pt.unstable_scheduleCallback,Ff=Pt.unstable_cancelCallback,g0=Pt.unstable_shouldYield,y0=Pt.unstable_requestPaint,Be=Pt.unstable_now,v0=Pt.unstable_getCurrentPriorityLevel,fc=Pt.unstable_ImmediatePriority,em=Pt.unstable_UserBlockingPriority,ca=Pt.unstable_NormalPriority,x0=Pt.unstable_LowPriority,tm=Pt.unstable_IdlePriority,Pa=null,pn=null;function T0(t){if(pn&&typeof pn.onCommitFiberRoot=="function")try{pn.onCommitFiberRoot(Pa,t,void 0,(t.current.flags&128)===128)}catch{}}var nn=Math.clz32?Math.clz32:S0,C0=Math.log,k0=Math.LN2;function S0(t){return t>>>=0,t===0?32:31-(C0(t)/k0|0)|0}var Ds=64,Fs=4194304;function No(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function da(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,o=t.pingedLanes,a=n&268435455;if(a!==0){var u=a&~r;u!==0?i=No(u):(o&=a,o!==0&&(i=No(o)))}else a=n&~r,a!==0?i=No(a):o!==0&&(i=No(o));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,o=e&-e,r>=o||r===16&&(o&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-nn(e),r=1<<n,i|=t[n],e&=~r;return i}function _0(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function N0(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,o=t.pendingLanes;0<o;){var a=31-nn(o),u=1<<a,c=r[a];c===-1?(!(u&n)||u&i)&&(r[a]=_0(u,e)):c<=e&&(t.expiredLanes|=u),o&=~u}}function Au(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function nm(){var t=Ds;return Ds<<=1,!(Ds&4194240)&&(Ds=64),t}function Yl(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function jo(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-nn(e),t[e]=n}function w0(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-nn(n),o=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~o}}function hc(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-nn(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var Ce=0;function im(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var rm,mc,om,sm,am,bu=!1,Vs=[],ti=null,ni=null,ii=null,Go=new Map,Uo=new Map,Zn=[],I0="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Vf(t,e){switch(t){case"focusin":case"focusout":ti=null;break;case"dragenter":case"dragleave":ni=null;break;case"mouseover":case"mouseout":ii=null;break;case"pointerover":case"pointerout":Go.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Uo.delete(e.pointerId)}}function go(t,e,n,i,r,o){return t===null||t.nativeEvent!==o?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:o,targetContainers:[r]},e!==null&&(e=ts(e),e!==null&&mc(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function E0(t,e,n,i,r){switch(e){case"focusin":return ti=go(ti,t,e,n,i,r),!0;case"dragenter":return ni=go(ni,t,e,n,i,r),!0;case"mouseover":return ii=go(ii,t,e,n,i,r),!0;case"pointerover":var o=r.pointerId;return Go.set(o,go(Go.get(o)||null,t,e,n,i,r)),!0;case"gotpointercapture":return o=r.pointerId,Uo.set(o,go(Uo.get(o)||null,t,e,n,i,r)),!0}return!1}function lm(t){var e=Ai(t.target);if(e!==null){var n=Ui(e);if(n!==null){if(e=n.tag,e===13){if(e=Qh(n),e!==null){t.blockedOn=e,am(t.priority,function(){om(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Zs(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Pu(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);Nu=i,n.target.dispatchEvent(i),Nu=null}else return e=ts(n),e!==null&&mc(e),t.blockedOn=n,!1;e.shift()}return!0}function $f(t,e,n){Zs(t)&&n.delete(e)}function A0(){bu=!1,ti!==null&&Zs(ti)&&(ti=null),ni!==null&&Zs(ni)&&(ni=null),ii!==null&&Zs(ii)&&(ii=null),Go.forEach($f),Uo.forEach($f)}function yo(t,e){t.blockedOn===e&&(t.blockedOn=null,bu||(bu=!0,Pt.unstable_scheduleCallback(Pt.unstable_NormalPriority,A0)))}function Ho(t){function e(r){return yo(r,t)}if(0<Vs.length){yo(Vs[0],t);for(var n=1;n<Vs.length;n++){var i=Vs[n];i.blockedOn===t&&(i.blockedOn=null)}}for(ti!==null&&yo(ti,t),ni!==null&&yo(ni,t),ii!==null&&yo(ii,t),Go.forEach(e),Uo.forEach(e),n=0;n<Zn.length;n++)i=Zn[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Zn.length&&(n=Zn[0],n.blockedOn===null);)lm(n),n.blockedOn===null&&Zn.shift()}var br=Fn.ReactCurrentBatchConfig,fa=!0;function b0(t,e,n,i){var r=Ce,o=br.transition;br.transition=null;try{Ce=1,pc(t,e,n,i)}finally{Ce=r,br.transition=o}}function P0(t,e,n,i){var r=Ce,o=br.transition;br.transition=null;try{Ce=4,pc(t,e,n,i)}finally{Ce=r,br.transition=o}}function pc(t,e,n,i){if(fa){var r=Pu(t,e,n,i);if(r===null)nu(t,e,i,ha,n),Vf(t,i);else if(E0(r,t,e,n,i))i.stopPropagation();else if(Vf(t,i),e&4&&-1<I0.indexOf(t)){for(;r!==null;){var o=ts(r);if(o!==null&&rm(o),o=Pu(t,e,n,i),o===null&&nu(t,e,i,ha,n),o===r)break;r=o}r!==null&&i.stopPropagation()}else nu(t,e,i,null,n)}}var ha=null;function Pu(t,e,n,i){if(ha=null,t=dc(i),t=Ai(t),t!==null)if(e=Ui(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Qh(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return ha=t,null}function um(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(v0()){case fc:return 1;case em:return 4;case ca:case x0:return 16;case tm:return 536870912;default:return 16}default:return 16}}var jn=null,gc=null,Xs=null;function cm(){if(Xs)return Xs;var t,e=gc,n=e.length,i,r="value"in jn?jn.value:jn.textContent,o=r.length;for(t=0;t<n&&e[t]===r[t];t++);var a=n-t;for(i=1;i<=a&&e[n-i]===r[o-i];i++);return Xs=r.slice(t,1<i?1-i:void 0)}function js(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function $s(){return!0}function Gf(){return!1}function Mt(t){function e(n,i,r,o,a){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=o,this.target=a,this.currentTarget=null;for(var u in t)t.hasOwnProperty(u)&&(n=t[u],this[u]=n?n(o):o[u]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?$s:Gf,this.isPropagationStopped=Gf,this}return Ve(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=$s)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=$s)},persist:function(){},isPersistent:$s}),e}var Ur={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yc=Mt(Ur),es=Ve({},Ur,{view:0,detail:0}),M0=Mt(es),Ql,Zl,vo,Ma=Ve({},es,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:vc,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==vo&&(vo&&t.type==="mousemove"?(Ql=t.screenX-vo.screenX,Zl=t.screenY-vo.screenY):Zl=Ql=0,vo=t),Ql)},movementY:function(t){return"movementY"in t?t.movementY:Zl}}),Uf=Mt(Ma),L0=Ve({},Ma,{dataTransfer:0}),R0=Mt(L0),D0=Ve({},es,{relatedTarget:0}),Xl=Mt(D0),F0=Ve({},Ur,{animationName:0,elapsedTime:0,pseudoElement:0}),V0=Mt(F0),$0=Ve({},Ur,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),G0=Mt($0),U0=Ve({},Ur,{data:0}),Hf=Mt(U0),H0={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},O0={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},B0={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function q0(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=B0[t])?!!e[t]:!1}function vc(){return q0}var K0=Ve({},es,{key:function(t){if(t.key){var e=H0[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=js(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?O0[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:vc,charCode:function(t){return t.type==="keypress"?js(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?js(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),z0=Mt(K0),W0=Ve({},Ma,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Of=Mt(W0),J0=Ve({},es,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:vc}),Y0=Mt(J0),Q0=Ve({},Ur,{propertyName:0,elapsedTime:0,pseudoElement:0}),Z0=Mt(Q0),X0=Ve({},Ma,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),j0=Mt(X0),ex=[9,13,27,32],xc=Mn&&"CompositionEvent"in window,Ao=null;Mn&&"documentMode"in document&&(Ao=document.documentMode);var tx=Mn&&"TextEvent"in window&&!Ao,dm=Mn&&(!xc||Ao&&8<Ao&&11>=Ao),Bf=" ",qf=!1;function fm(t,e){switch(t){case"keyup":return ex.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hm(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var yr=!1;function nx(t,e){switch(t){case"compositionend":return hm(e);case"keypress":return e.which!==32?null:(qf=!0,Bf);case"textInput":return t=e.data,t===Bf&&qf?null:t;default:return null}}function ix(t,e){if(yr)return t==="compositionend"||!xc&&fm(t,e)?(t=cm(),Xs=gc=jn=null,yr=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return dm&&e.locale!=="ko"?null:e.data;default:return null}}var rx={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Kf(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!rx[t.type]:e==="textarea"}function mm(t,e,n,i){Kh(i),e=ma(e,"onChange"),0<e.length&&(n=new yc("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var bo=null,Oo=null;function ox(t){Nm(t,0)}function La(t){var e=Tr(t);if($h(e))return t}function sx(t,e){if(t==="change")return e}var pm=!1;Mn&&(Mn?(Us="oninput"in document,Us||(jl=document.createElement("div"),jl.setAttribute("oninput","return;"),Us=typeof jl.oninput=="function"),Gs=Us):Gs=!1,pm=Gs&&(!document.documentMode||9<document.documentMode));var Gs,Us,jl;function zf(){bo&&(bo.detachEvent("onpropertychange",gm),Oo=bo=null)}function gm(t){if(t.propertyName==="value"&&La(Oo)){var e=[];mm(e,Oo,t,dc(t)),Yh(ox,e)}}function ax(t,e,n){t==="focusin"?(zf(),bo=e,Oo=n,bo.attachEvent("onpropertychange",gm)):t==="focusout"&&zf()}function lx(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return La(Oo)}function ux(t,e){if(t==="click")return La(e)}function cx(t,e){if(t==="input"||t==="change")return La(e)}function dx(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var on=typeof Object.is=="function"?Object.is:dx;function Bo(t,e){if(on(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!hu.call(e,r)||!on(t[r],e[r]))return!1}return!0}function Wf(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Jf(t,e){var n=Wf(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Wf(n)}}function ym(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?ym(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function vm(){for(var t=window,e=aa();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=aa(t.document)}return e}function Tc(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function fx(t){var e=vm(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&ym(n.ownerDocument.documentElement,n)){if(i!==null&&Tc(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,o=Math.min(i.start,r);i=i.end===void 0?o:Math.min(i.end,r),!t.extend&&o>i&&(r=i,i=o,o=r),r=Jf(n,o);var a=Jf(n,i);r&&a&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),o>i?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var hx=Mn&&"documentMode"in document&&11>=document.documentMode,vr=null,Mu=null,Po=null,Lu=!1;function Yf(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Lu||vr==null||vr!==aa(i)||(i=vr,"selectionStart"in i&&Tc(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Po&&Bo(Po,i)||(Po=i,i=ma(Mu,"onSelect"),0<i.length&&(e=new yc("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=vr)))}function Hs(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var xr={animationend:Hs("Animation","AnimationEnd"),animationiteration:Hs("Animation","AnimationIteration"),animationstart:Hs("Animation","AnimationStart"),transitionend:Hs("Transition","TransitionEnd")},eu={},xm={};Mn&&(xm=document.createElement("div").style,"AnimationEvent"in window||(delete xr.animationend.animation,delete xr.animationiteration.animation,delete xr.animationstart.animation),"TransitionEvent"in window||delete xr.transitionend.transition);function Ra(t){if(eu[t])return eu[t];if(!xr[t])return t;var e=xr[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in xm)return eu[t]=e[n];return t}var Tm=Ra("animationend"),Cm=Ra("animationiteration"),km=Ra("animationstart"),Sm=Ra("transitionend"),_m=new Map,Qf="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function di(t,e){_m.set(t,e),Gi(e,[t])}for(Os=0;Os<Qf.length;Os++)Bs=Qf[Os],Zf=Bs.toLowerCase(),Xf=Bs[0].toUpperCase()+Bs.slice(1),di(Zf,"on"+Xf);var Bs,Zf,Xf,Os;di(Tm,"onAnimationEnd");di(Cm,"onAnimationIteration");di(km,"onAnimationStart");di("dblclick","onDoubleClick");di("focusin","onFocus");di("focusout","onBlur");di(Sm,"onTransitionEnd");Lr("onMouseEnter",["mouseout","mouseover"]);Lr("onMouseLeave",["mouseout","mouseover"]);Lr("onPointerEnter",["pointerout","pointerover"]);Lr("onPointerLeave",["pointerout","pointerover"]);Gi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Gi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Gi("onBeforeInput",["compositionend","keypress","textInput","paste"]);Gi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Gi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Gi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mx=new Set("cancel close invalid load scroll toggle".split(" ").concat(wo));function jf(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,m0(i,e,void 0,t),t.currentTarget=null}function Nm(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var o=void 0;if(e)for(var a=i.length-1;0<=a;a--){var u=i[a],c=u.instance,d=u.currentTarget;if(u=u.listener,c!==o&&r.isPropagationStopped())break e;jf(r,u,d),o=c}else for(a=0;a<i.length;a++){if(u=i[a],c=u.instance,d=u.currentTarget,u=u.listener,c!==o&&r.isPropagationStopped())break e;jf(r,u,d),o=c}}}if(ua)throw t=Eu,ua=!1,Eu=null,t}function Ee(t,e){var n=e[$u];n===void 0&&(n=e[$u]=new Set);var i=t+"__bubble";n.has(i)||(wm(e,t,2,!1),n.add(i))}function tu(t,e,n){var i=0;e&&(i|=4),wm(n,t,i,e)}var qs="_reactListening"+Math.random().toString(36).slice(2);function qo(t){if(!t[qs]){t[qs]=!0,Lh.forEach(function(n){n!=="selectionchange"&&(mx.has(n)||tu(n,!1,t),tu(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[qs]||(e[qs]=!0,tu("selectionchange",!1,e))}}function wm(t,e,n,i){switch(um(e)){case 1:var r=b0;break;case 4:r=P0;break;default:r=pc}n=r.bind(null,e,n,t),r=void 0,!Iu||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function nu(t,e,n,i,r){var o=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var a=i.tag;if(a===3||a===4){var u=i.stateNode.containerInfo;if(u===r||u.nodeType===8&&u.parentNode===r)break;if(a===4)for(a=i.return;a!==null;){var c=a.tag;if((c===3||c===4)&&(c=a.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;a=a.return}for(;u!==null;){if(a=Ai(u),a===null)return;if(c=a.tag,c===5||c===6){i=o=a;continue e}u=u.parentNode}}i=i.return}Yh(function(){var d=o,f=dc(n),h=[];e:{var m=_m.get(t);if(m!==void 0){var y=yc,p=t;switch(t){case"keypress":if(js(n)===0)break e;case"keydown":case"keyup":y=z0;break;case"focusin":p="focus",y=Xl;break;case"focusout":p="blur",y=Xl;break;case"beforeblur":case"afterblur":y=Xl;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=Uf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=R0;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=Y0;break;case Tm:case Cm:case km:y=V0;break;case Sm:y=Z0;break;case"scroll":y=M0;break;case"wheel":y=j0;break;case"copy":case"cut":case"paste":y=G0;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=Of}var T=(e&4)!==0,R=!T&&t==="scroll",C=T?m!==null?m+"Capture":null:m;T=[];for(var g=d,x;g!==null;){x=g;var S=x.stateNode;if(x.tag===5&&S!==null&&(x=S,C!==null&&(S=$o(g,C),S!=null&&T.push(Ko(g,S,x)))),R)break;g=g.return}0<T.length&&(m=new y(m,p,null,n,f),h.push({event:m,listeners:T}))}}if(!(e&7)){e:{if(m=t==="mouseover"||t==="pointerover",y=t==="mouseout"||t==="pointerout",m&&n!==Nu&&(p=n.relatedTarget||n.fromElement)&&(Ai(p)||p[Ln]))break e;if((y||m)&&(m=f.window===f?f:(m=f.ownerDocument)?m.defaultView||m.parentWindow:window,y?(p=n.relatedTarget||n.toElement,y=d,p=p?Ai(p):null,p!==null&&(R=Ui(p),p!==R||p.tag!==5&&p.tag!==6)&&(p=null)):(y=null,p=d),y!==p)){if(T=Uf,S="onMouseLeave",C="onMouseEnter",g="mouse",(t==="pointerout"||t==="pointerover")&&(T=Of,S="onPointerLeave",C="onPointerEnter",g="pointer"),R=y==null?m:Tr(y),x=p==null?m:Tr(p),m=new T(S,g+"leave",y,n,f),m.target=R,m.relatedTarget=x,S=null,Ai(f)===d&&(T=new T(C,g+"enter",p,n,f),T.target=x,T.relatedTarget=R,S=T),R=S,y&&p)t:{for(T=y,C=p,g=0,x=T;x;x=mr(x))g++;for(x=0,S=C;S;S=mr(S))x++;for(;0<g-x;)T=mr(T),g--;for(;0<x-g;)C=mr(C),x--;for(;g--;){if(T===C||C!==null&&T===C.alternate)break t;T=mr(T),C=mr(C)}T=null}else T=null;y!==null&&eh(h,m,y,T,!1),p!==null&&R!==null&&eh(h,R,p,T,!0)}}e:{if(m=d?Tr(d):window,y=m.nodeName&&m.nodeName.toLowerCase(),y==="select"||y==="input"&&m.type==="file")var I=sx;else if(Kf(m))if(pm)I=cx;else{I=lx;var V=ax}else(y=m.nodeName)&&y.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(I=ux);if(I&&(I=I(t,d))){mm(h,I,n,f);break e}V&&V(t,m,d),t==="focusout"&&(V=m._wrapperState)&&V.controlled&&m.type==="number"&&Tu(m,"number",m.value)}switch(V=d?Tr(d):window,t){case"focusin":(Kf(V)||V.contentEditable==="true")&&(vr=V,Mu=d,Po=null);break;case"focusout":Po=Mu=vr=null;break;case"mousedown":Lu=!0;break;case"contextmenu":case"mouseup":case"dragend":Lu=!1,Yf(h,n,f);break;case"selectionchange":if(hx)break;case"keydown":case"keyup":Yf(h,n,f)}var k;if(xc)e:{switch(t){case"compositionstart":var N="onCompositionStart";break e;case"compositionend":N="onCompositionEnd";break e;case"compositionupdate":N="onCompositionUpdate";break e}N=void 0}else yr?fm(t,n)&&(N="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(N="onCompositionStart");N&&(dm&&n.locale!=="ko"&&(yr||N!=="onCompositionStart"?N==="onCompositionEnd"&&yr&&(k=cm()):(jn=f,gc="value"in jn?jn.value:jn.textContent,yr=!0)),V=ma(d,N),0<V.length&&(N=new Hf(N,t,null,n,f),h.push({event:N,listeners:V}),k?N.data=k:(k=hm(n),k!==null&&(N.data=k)))),(k=tx?nx(t,n):ix(t,n))&&(d=ma(d,"onBeforeInput"),0<d.length&&(f=new Hf("onBeforeInput","beforeinput",null,n,f),h.push({event:f,listeners:d}),f.data=k))}Nm(h,e)})}function Ko(t,e,n){return{instance:t,listener:e,currentTarget:n}}function ma(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,o=r.stateNode;r.tag===5&&o!==null&&(r=o,o=$o(t,n),o!=null&&i.unshift(Ko(t,o,r)),o=$o(t,e),o!=null&&i.push(Ko(t,o,r))),t=t.return}return i}function mr(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function eh(t,e,n,i,r){for(var o=e._reactName,a=[];n!==null&&n!==i;){var u=n,c=u.alternate,d=u.stateNode;if(c!==null&&c===i)break;u.tag===5&&d!==null&&(u=d,r?(c=$o(n,o),c!=null&&a.unshift(Ko(n,c,u))):r||(c=$o(n,o),c!=null&&a.push(Ko(n,c,u)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var px=/\r\n?/g,gx=/\u0000|\uFFFD/g;function th(t){return(typeof t=="string"?t:""+t).replace(px,`
`).replace(gx,"")}function Ks(t,e,n){if(e=th(e),th(t)!==e&&n)throw Error(G(425))}function pa(){}var Ru=null,Du=null;function Fu(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Vu=typeof setTimeout=="function"?setTimeout:void 0,yx=typeof clearTimeout=="function"?clearTimeout:void 0,nh=typeof Promise=="function"?Promise:void 0,vx=typeof queueMicrotask=="function"?queueMicrotask:typeof nh<"u"?function(t){return nh.resolve(null).then(t).catch(xx)}:Vu;function xx(t){setTimeout(function(){throw t})}function iu(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),Ho(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);Ho(e)}function ri(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function ih(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Hr=Math.random().toString(36).slice(2),mn="__reactFiber$"+Hr,zo="__reactProps$"+Hr,Ln="__reactContainer$"+Hr,$u="__reactEvents$"+Hr,Tx="__reactListeners$"+Hr,Cx="__reactHandles$"+Hr;function Ai(t){var e=t[mn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Ln]||n[mn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=ih(t);t!==null;){if(n=t[mn])return n;t=ih(t)}return e}t=n,n=t.parentNode}return null}function ts(t){return t=t[mn]||t[Ln],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Tr(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(G(33))}function Da(t){return t[zo]||null}var Gu=[],Cr=-1;function fi(t){return{current:t}}function Ae(t){0>Cr||(t.current=Gu[Cr],Gu[Cr]=null,Cr--)}function Ne(t,e){Cr++,Gu[Cr]=t.current,t.current=e}var ci={},ut=fi(ci),Ct=fi(!1),Ri=ci;function Rr(t,e){var n=t.type.contextTypes;if(!n)return ci;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},o;for(o in n)r[o]=e[o];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function kt(t){return t=t.childContextTypes,t!=null}function ga(){Ae(Ct),Ae(ut)}function rh(t,e,n){if(ut.current!==ci)throw Error(G(168));Ne(ut,e),Ne(Ct,n)}function Im(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(G(108,a0(t)||"Unknown",r));return Ve({},n,i)}function ya(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||ci,Ri=ut.current,Ne(ut,t),Ne(Ct,Ct.current),!0}function oh(t,e,n){var i=t.stateNode;if(!i)throw Error(G(169));n?(t=Im(t,e,Ri),i.__reactInternalMemoizedMergedChildContext=t,Ae(Ct),Ae(ut),Ne(ut,t)):Ae(Ct),Ne(Ct,n)}var En=null,Fa=!1,ru=!1;function Em(t){En===null?En=[t]:En.push(t)}function kx(t){Fa=!0,Em(t)}function hi(){if(!ru&&En!==null){ru=!0;var t=0,e=Ce;try{var n=En;for(Ce=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}En=null,Fa=!1}catch(r){throw En!==null&&(En=En.slice(t+1)),jh(fc,hi),r}finally{Ce=e,ru=!1}}return null}var kr=[],Sr=0,va=null,xa=0,Dt=[],Ft=0,Di=null,An=1,bn="";function Ii(t,e){kr[Sr++]=xa,kr[Sr++]=va,va=t,xa=e}function Am(t,e,n){Dt[Ft++]=An,Dt[Ft++]=bn,Dt[Ft++]=Di,Di=t;var i=An;t=bn;var r=32-nn(i)-1;i&=~(1<<r),n+=1;var o=32-nn(e)+r;if(30<o){var a=r-r%5;o=(i&(1<<a)-1).toString(32),i>>=a,r-=a,An=1<<32-nn(e)+r|n<<r|i,bn=o+t}else An=1<<o|n<<r|i,bn=t}function Cc(t){t.return!==null&&(Ii(t,1),Am(t,1,0))}function kc(t){for(;t===va;)va=kr[--Sr],kr[Sr]=null,xa=kr[--Sr],kr[Sr]=null;for(;t===Di;)Di=Dt[--Ft],Dt[Ft]=null,bn=Dt[--Ft],Dt[Ft]=null,An=Dt[--Ft],Dt[Ft]=null}var bt=null,At=null,Me=!1,tn=null;function bm(t,e){var n=Vt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function sh(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,bt=t,At=ri(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,bt=t,At=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Di!==null?{id:An,overflow:bn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Vt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,bt=t,At=null,!0):!1;default:return!1}}function Uu(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Hu(t){if(Me){var e=At;if(e){var n=e;if(!sh(t,e)){if(Uu(t))throw Error(G(418));e=ri(n.nextSibling);var i=bt;e&&sh(t,e)?bm(i,n):(t.flags=t.flags&-4097|2,Me=!1,bt=t)}}else{if(Uu(t))throw Error(G(418));t.flags=t.flags&-4097|2,Me=!1,bt=t}}}function ah(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;bt=t}function zs(t){if(t!==bt)return!1;if(!Me)return ah(t),Me=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Fu(t.type,t.memoizedProps)),e&&(e=At)){if(Uu(t))throw Pm(),Error(G(418));for(;e;)bm(t,e),e=ri(e.nextSibling)}if(ah(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(G(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){At=ri(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}At=null}}else At=bt?ri(t.stateNode.nextSibling):null;return!0}function Pm(){for(var t=At;t;)t=ri(t.nextSibling)}function Dr(){At=bt=null,Me=!1}function Sc(t){tn===null?tn=[t]:tn.push(t)}var Sx=Fn.ReactCurrentBatchConfig;function xo(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(G(309));var i=n.stateNode}if(!i)throw Error(G(147,t));var r=i,o=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(a){var u=r.refs;a===null?delete u[o]:u[o]=a},e._stringRef=o,e)}if(typeof t!="string")throw Error(G(284));if(!n._owner)throw Error(G(290,t))}return t}function Ws(t,e){throw t=Object.prototype.toString.call(e),Error(G(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function lh(t){var e=t._init;return e(t._payload)}function Mm(t){function e(C,g){if(t){var x=C.deletions;x===null?(C.deletions=[g],C.flags|=16):x.push(g)}}function n(C,g){if(!t)return null;for(;g!==null;)e(C,g),g=g.sibling;return null}function i(C,g){for(C=new Map;g!==null;)g.key!==null?C.set(g.key,g):C.set(g.index,g),g=g.sibling;return C}function r(C,g){return C=li(C,g),C.index=0,C.sibling=null,C}function o(C,g,x){return C.index=x,t?(x=C.alternate,x!==null?(x=x.index,x<g?(C.flags|=2,g):x):(C.flags|=2,g)):(C.flags|=1048576,g)}function a(C){return t&&C.alternate===null&&(C.flags|=2),C}function u(C,g,x,S){return g===null||g.tag!==6?(g=du(x,C.mode,S),g.return=C,g):(g=r(g,x),g.return=C,g)}function c(C,g,x,S){var I=x.type;return I===gr?f(C,g,x.props.children,S,x.key):g!==null&&(g.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===Yn&&lh(I)===g.type)?(S=r(g,x.props),S.ref=xo(C,g,x),S.return=C,S):(S=sa(x.type,x.key,x.props,null,C.mode,S),S.ref=xo(C,g,x),S.return=C,S)}function d(C,g,x,S){return g===null||g.tag!==4||g.stateNode.containerInfo!==x.containerInfo||g.stateNode.implementation!==x.implementation?(g=fu(x,C.mode,S),g.return=C,g):(g=r(g,x.children||[]),g.return=C,g)}function f(C,g,x,S,I){return g===null||g.tag!==7?(g=Li(x,C.mode,S,I),g.return=C,g):(g=r(g,x),g.return=C,g)}function h(C,g,x){if(typeof g=="string"&&g!==""||typeof g=="number")return g=du(""+g,C.mode,x),g.return=C,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Ms:return x=sa(g.type,g.key,g.props,null,C.mode,x),x.ref=xo(C,null,g),x.return=C,x;case pr:return g=fu(g,C.mode,x),g.return=C,g;case Yn:var S=g._init;return h(C,S(g._payload),x)}if(_o(g)||po(g))return g=Li(g,C.mode,x,null),g.return=C,g;Ws(C,g)}return null}function m(C,g,x,S){var I=g!==null?g.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return I!==null?null:u(C,g,""+x,S);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Ms:return x.key===I?c(C,g,x,S):null;case pr:return x.key===I?d(C,g,x,S):null;case Yn:return I=x._init,m(C,g,I(x._payload),S)}if(_o(x)||po(x))return I!==null?null:f(C,g,x,S,null);Ws(C,x)}return null}function y(C,g,x,S,I){if(typeof S=="string"&&S!==""||typeof S=="number")return C=C.get(x)||null,u(g,C,""+S,I);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case Ms:return C=C.get(S.key===null?x:S.key)||null,c(g,C,S,I);case pr:return C=C.get(S.key===null?x:S.key)||null,d(g,C,S,I);case Yn:var V=S._init;return y(C,g,x,V(S._payload),I)}if(_o(S)||po(S))return C=C.get(x)||null,f(g,C,S,I,null);Ws(g,S)}return null}function p(C,g,x,S){for(var I=null,V=null,k=g,N=g=0,b=null;k!==null&&N<x.length;N++){k.index>N?(b=k,k=null):b=k.sibling;var D=m(C,k,x[N],S);if(D===null){k===null&&(k=b);break}t&&k&&D.alternate===null&&e(C,k),g=o(D,g,N),V===null?I=D:V.sibling=D,V=D,k=b}if(N===x.length)return n(C,k),Me&&Ii(C,N),I;if(k===null){for(;N<x.length;N++)k=h(C,x[N],S),k!==null&&(g=o(k,g,N),V===null?I=k:V.sibling=k,V=k);return Me&&Ii(C,N),I}for(k=i(C,k);N<x.length;N++)b=y(k,C,N,x[N],S),b!==null&&(t&&b.alternate!==null&&k.delete(b.key===null?N:b.key),g=o(b,g,N),V===null?I=b:V.sibling=b,V=b);return t&&k.forEach(function(te){return e(C,te)}),Me&&Ii(C,N),I}function T(C,g,x,S){var I=po(x);if(typeof I!="function")throw Error(G(150));if(x=I.call(x),x==null)throw Error(G(151));for(var V=I=null,k=g,N=g=0,b=null,D=x.next();k!==null&&!D.done;N++,D=x.next()){k.index>N?(b=k,k=null):b=k.sibling;var te=m(C,k,D.value,S);if(te===null){k===null&&(k=b);break}t&&k&&te.alternate===null&&e(C,k),g=o(te,g,N),V===null?I=te:V.sibling=te,V=te,k=b}if(D.done)return n(C,k),Me&&Ii(C,N),I;if(k===null){for(;!D.done;N++,D=x.next())D=h(C,D.value,S),D!==null&&(g=o(D,g,N),V===null?I=D:V.sibling=D,V=D);return Me&&Ii(C,N),I}for(k=i(C,k);!D.done;N++,D=x.next())D=y(k,C,N,D.value,S),D!==null&&(t&&D.alternate!==null&&k.delete(D.key===null?N:D.key),g=o(D,g,N),V===null?I=D:V.sibling=D,V=D);return t&&k.forEach(function(re){return e(C,re)}),Me&&Ii(C,N),I}function R(C,g,x,S){if(typeof x=="object"&&x!==null&&x.type===gr&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case Ms:e:{for(var I=x.key,V=g;V!==null;){if(V.key===I){if(I=x.type,I===gr){if(V.tag===7){n(C,V.sibling),g=r(V,x.props.children),g.return=C,C=g;break e}}else if(V.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===Yn&&lh(I)===V.type){n(C,V.sibling),g=r(V,x.props),g.ref=xo(C,V,x),g.return=C,C=g;break e}n(C,V);break}else e(C,V);V=V.sibling}x.type===gr?(g=Li(x.props.children,C.mode,S,x.key),g.return=C,C=g):(S=sa(x.type,x.key,x.props,null,C.mode,S),S.ref=xo(C,g,x),S.return=C,C=S)}return a(C);case pr:e:{for(V=x.key;g!==null;){if(g.key===V)if(g.tag===4&&g.stateNode.containerInfo===x.containerInfo&&g.stateNode.implementation===x.implementation){n(C,g.sibling),g=r(g,x.children||[]),g.return=C,C=g;break e}else{n(C,g);break}else e(C,g);g=g.sibling}g=fu(x,C.mode,S),g.return=C,C=g}return a(C);case Yn:return V=x._init,R(C,g,V(x._payload),S)}if(_o(x))return p(C,g,x,S);if(po(x))return T(C,g,x,S);Ws(C,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,g!==null&&g.tag===6?(n(C,g.sibling),g=r(g,x),g.return=C,C=g):(n(C,g),g=du(x,C.mode,S),g.return=C,C=g),a(C)):n(C,g)}return R}var Fr=Mm(!0),Lm=Mm(!1),Ta=fi(null),Ca=null,_r=null,_c=null;function Nc(){_c=_r=Ca=null}function wc(t){var e=Ta.current;Ae(Ta),t._currentValue=e}function Ou(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function Pr(t,e){Ca=t,_c=_r=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Tt=!0),t.firstContext=null)}function Gt(t){var e=t._currentValue;if(_c!==t)if(t={context:t,memoizedValue:e,next:null},_r===null){if(Ca===null)throw Error(G(308));_r=t,Ca.dependencies={lanes:0,firstContext:t}}else _r=_r.next=t;return e}var bi=null;function Ic(t){bi===null?bi=[t]:bi.push(t)}function Rm(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,Ic(e)):(n.next=r.next,r.next=n),e.interleaved=n,Rn(t,i)}function Rn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Qn=!1;function Ec(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Dm(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Pn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function oi(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,ve&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,Rn(t,n)}return r=i.interleaved,r===null?(e.next=e,Ic(i)):(e.next=r.next,r.next=e),i.interleaved=e,Rn(t,n)}function ea(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,hc(t,n)}}function uh(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?r=o=a:o=o.next=a,n=n.next}while(n!==null);o===null?r=o=e:o=o.next=e}else r=o=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function ka(t,e,n,i){var r=t.updateQueue;Qn=!1;var o=r.firstBaseUpdate,a=r.lastBaseUpdate,u=r.shared.pending;if(u!==null){r.shared.pending=null;var c=u,d=c.next;c.next=null,a===null?o=d:a.next=d,a=c;var f=t.alternate;f!==null&&(f=f.updateQueue,u=f.lastBaseUpdate,u!==a&&(u===null?f.firstBaseUpdate=d:u.next=d,f.lastBaseUpdate=c))}if(o!==null){var h=r.baseState;a=0,f=d=c=null,u=o;do{var m=u.lane,y=u.eventTime;if((i&m)===m){f!==null&&(f=f.next={eventTime:y,lane:0,tag:u.tag,payload:u.payload,callback:u.callback,next:null});e:{var p=t,T=u;switch(m=e,y=n,T.tag){case 1:if(p=T.payload,typeof p=="function"){h=p.call(y,h,m);break e}h=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=T.payload,m=typeof p=="function"?p.call(y,h,m):p,m==null)break e;h=Ve({},h,m);break e;case 2:Qn=!0}}u.callback!==null&&u.lane!==0&&(t.flags|=64,m=r.effects,m===null?r.effects=[u]:m.push(u))}else y={eventTime:y,lane:m,tag:u.tag,payload:u.payload,callback:u.callback,next:null},f===null?(d=f=y,c=h):f=f.next=y,a|=m;if(u=u.next,u===null){if(u=r.shared.pending,u===null)break;m=u,u=m.next,m.next=null,r.lastBaseUpdate=m,r.shared.pending=null}}while(!0);if(f===null&&(c=h),r.baseState=c,r.firstBaseUpdate=d,r.lastBaseUpdate=f,e=r.shared.interleaved,e!==null){r=e;do a|=r.lane,r=r.next;while(r!==e)}else o===null&&(r.shared.lanes=0);Vi|=a,t.lanes=a,t.memoizedState=h}}function ch(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(G(191,r));r.call(i)}}}var ns={},gn=fi(ns),Wo=fi(ns),Jo=fi(ns);function Pi(t){if(t===ns)throw Error(G(174));return t}function Ac(t,e){switch(Ne(Jo,e),Ne(Wo,t),Ne(gn,ns),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ku(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=ku(e,t)}Ae(gn),Ne(gn,e)}function Vr(){Ae(gn),Ae(Wo),Ae(Jo)}function Fm(t){Pi(Jo.current);var e=Pi(gn.current),n=ku(e,t.type);e!==n&&(Ne(Wo,t),Ne(gn,n))}function bc(t){Wo.current===t&&(Ae(gn),Ae(Wo))}var De=fi(0);function Sa(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var ou=[];function Pc(){for(var t=0;t<ou.length;t++)ou[t]._workInProgressVersionPrimary=null;ou.length=0}var ta=Fn.ReactCurrentDispatcher,su=Fn.ReactCurrentBatchConfig,Fi=0,Fe=null,Ke=null,We=null,_a=!1,Mo=!1,Yo=0,_x=0;function st(){throw Error(G(321))}function Mc(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!on(t[n],e[n]))return!1;return!0}function Lc(t,e,n,i,r,o){if(Fi=o,Fe=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ta.current=t===null||t.memoizedState===null?Ex:Ax,t=n(i,r),Mo){o=0;do{if(Mo=!1,Yo=0,25<=o)throw Error(G(301));o+=1,We=Ke=null,e.updateQueue=null,ta.current=bx,t=n(i,r)}while(Mo)}if(ta.current=Na,e=Ke!==null&&Ke.next!==null,Fi=0,We=Ke=Fe=null,_a=!1,e)throw Error(G(300));return t}function Rc(){var t=Yo!==0;return Yo=0,t}function hn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return We===null?Fe.memoizedState=We=t:We=We.next=t,We}function Ut(){if(Ke===null){var t=Fe.alternate;t=t!==null?t.memoizedState:null}else t=Ke.next;var e=We===null?Fe.memoizedState:We.next;if(e!==null)We=e,Ke=t;else{if(t===null)throw Error(G(310));Ke=t,t={memoizedState:Ke.memoizedState,baseState:Ke.baseState,baseQueue:Ke.baseQueue,queue:Ke.queue,next:null},We===null?Fe.memoizedState=We=t:We=We.next=t}return We}function Qo(t,e){return typeof e=="function"?e(t):e}function au(t){var e=Ut(),n=e.queue;if(n===null)throw Error(G(311));n.lastRenderedReducer=t;var i=Ke,r=i.baseQueue,o=n.pending;if(o!==null){if(r!==null){var a=r.next;r.next=o.next,o.next=a}i.baseQueue=r=o,n.pending=null}if(r!==null){o=r.next,i=i.baseState;var u=a=null,c=null,d=o;do{var f=d.lane;if((Fi&f)===f)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),i=d.hasEagerState?d.eagerState:t(i,d.action);else{var h={lane:f,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(u=c=h,a=i):c=c.next=h,Fe.lanes|=f,Vi|=f}d=d.next}while(d!==null&&d!==o);c===null?a=i:c.next=u,on(i,e.memoizedState)||(Tt=!0),e.memoizedState=i,e.baseState=a,e.baseQueue=c,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do o=r.lane,Fe.lanes|=o,Vi|=o,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function lu(t){var e=Ut(),n=e.queue;if(n===null)throw Error(G(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,o=e.memoizedState;if(r!==null){n.pending=null;var a=r=r.next;do o=t(o,a.action),a=a.next;while(a!==r);on(o,e.memoizedState)||(Tt=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),n.lastRenderedState=o}return[o,i]}function Vm(){}function $m(t,e){var n=Fe,i=Ut(),r=e(),o=!on(i.memoizedState,r);if(o&&(i.memoizedState=r,Tt=!0),i=i.queue,Dc(Hm.bind(null,n,i,t),[t]),i.getSnapshot!==e||o||We!==null&&We.memoizedState.tag&1){if(n.flags|=2048,Zo(9,Um.bind(null,n,i,r,e),void 0,null),Je===null)throw Error(G(349));Fi&30||Gm(n,e,r)}return r}function Gm(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Fe.updateQueue,e===null?(e={lastEffect:null,stores:null},Fe.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Um(t,e,n,i){e.value=n,e.getSnapshot=i,Om(e)&&Bm(t)}function Hm(t,e,n){return n(function(){Om(e)&&Bm(t)})}function Om(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!on(t,n)}catch{return!0}}function Bm(t){var e=Rn(t,1);e!==null&&rn(e,t,1,-1)}function dh(t){var e=hn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Qo,lastRenderedState:t},e.queue=t,t=t.dispatch=Ix.bind(null,Fe,t),[e.memoizedState,t]}function Zo(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=Fe.updateQueue,e===null?(e={lastEffect:null,stores:null},Fe.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function qm(){return Ut().memoizedState}function na(t,e,n,i){var r=hn();Fe.flags|=t,r.memoizedState=Zo(1|e,n,void 0,i===void 0?null:i)}function Va(t,e,n,i){var r=Ut();i=i===void 0?null:i;var o=void 0;if(Ke!==null){var a=Ke.memoizedState;if(o=a.destroy,i!==null&&Mc(i,a.deps)){r.memoizedState=Zo(e,n,o,i);return}}Fe.flags|=t,r.memoizedState=Zo(1|e,n,o,i)}function fh(t,e){return na(8390656,8,t,e)}function Dc(t,e){return Va(2048,8,t,e)}function Km(t,e){return Va(4,2,t,e)}function zm(t,e){return Va(4,4,t,e)}function Wm(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Jm(t,e,n){return n=n!=null?n.concat([t]):null,Va(4,4,Wm.bind(null,e,t),n)}function Fc(){}function Ym(t,e){var n=Ut();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Mc(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Qm(t,e){var n=Ut();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Mc(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function Zm(t,e,n){return Fi&21?(on(n,e)||(n=nm(),Fe.lanes|=n,Vi|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Tt=!0),t.memoizedState=n)}function Nx(t,e){var n=Ce;Ce=n!==0&&4>n?n:4,t(!0);var i=su.transition;su.transition={};try{t(!1),e()}finally{Ce=n,su.transition=i}}function Xm(){return Ut().memoizedState}function wx(t,e,n){var i=ai(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},jm(t))ep(e,n);else if(n=Rm(t,e,n,i),n!==null){var r=pt();rn(n,t,i,r),tp(n,e,i)}}function Ix(t,e,n){var i=ai(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(jm(t))ep(e,r);else{var o=t.alternate;if(t.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var a=e.lastRenderedState,u=o(a,n);if(r.hasEagerState=!0,r.eagerState=u,on(u,a)){var c=e.interleaved;c===null?(r.next=r,Ic(e)):(r.next=c.next,c.next=r),e.interleaved=r;return}}catch{}finally{}n=Rm(t,e,r,i),n!==null&&(r=pt(),rn(n,t,i,r),tp(n,e,i))}}function jm(t){var e=t.alternate;return t===Fe||e!==null&&e===Fe}function ep(t,e){Mo=_a=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function tp(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,hc(t,n)}}var Na={readContext:Gt,useCallback:st,useContext:st,useEffect:st,useImperativeHandle:st,useInsertionEffect:st,useLayoutEffect:st,useMemo:st,useReducer:st,useRef:st,useState:st,useDebugValue:st,useDeferredValue:st,useTransition:st,useMutableSource:st,useSyncExternalStore:st,useId:st,unstable_isNewReconciler:!1},Ex={readContext:Gt,useCallback:function(t,e){return hn().memoizedState=[t,e===void 0?null:e],t},useContext:Gt,useEffect:fh,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,na(4194308,4,Wm.bind(null,e,t),n)},useLayoutEffect:function(t,e){return na(4194308,4,t,e)},useInsertionEffect:function(t,e){return na(4,2,t,e)},useMemo:function(t,e){var n=hn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=hn();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=wx.bind(null,Fe,t),[i.memoizedState,t]},useRef:function(t){var e=hn();return t={current:t},e.memoizedState=t},useState:dh,useDebugValue:Fc,useDeferredValue:function(t){return hn().memoizedState=t},useTransition:function(){var t=dh(!1),e=t[0];return t=Nx.bind(null,t[1]),hn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=Fe,r=hn();if(Me){if(n===void 0)throw Error(G(407));n=n()}else{if(n=e(),Je===null)throw Error(G(349));Fi&30||Gm(i,e,n)}r.memoizedState=n;var o={value:n,getSnapshot:e};return r.queue=o,fh(Hm.bind(null,i,o,t),[t]),i.flags|=2048,Zo(9,Um.bind(null,i,o,n,e),void 0,null),n},useId:function(){var t=hn(),e=Je.identifierPrefix;if(Me){var n=bn,i=An;n=(i&~(1<<32-nn(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=Yo++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=_x++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Ax={readContext:Gt,useCallback:Ym,useContext:Gt,useEffect:Dc,useImperativeHandle:Jm,useInsertionEffect:Km,useLayoutEffect:zm,useMemo:Qm,useReducer:au,useRef:qm,useState:function(){return au(Qo)},useDebugValue:Fc,useDeferredValue:function(t){var e=Ut();return Zm(e,Ke.memoizedState,t)},useTransition:function(){var t=au(Qo)[0],e=Ut().memoizedState;return[t,e]},useMutableSource:Vm,useSyncExternalStore:$m,useId:Xm,unstable_isNewReconciler:!1},bx={readContext:Gt,useCallback:Ym,useContext:Gt,useEffect:Dc,useImperativeHandle:Jm,useInsertionEffect:Km,useLayoutEffect:zm,useMemo:Qm,useReducer:lu,useRef:qm,useState:function(){return lu(Qo)},useDebugValue:Fc,useDeferredValue:function(t){var e=Ut();return Ke===null?e.memoizedState=t:Zm(e,Ke.memoizedState,t)},useTransition:function(){var t=lu(Qo)[0],e=Ut().memoizedState;return[t,e]},useMutableSource:Vm,useSyncExternalStore:$m,useId:Xm,unstable_isNewReconciler:!1};function jt(t,e){if(t&&t.defaultProps){e=Ve({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Bu(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:Ve({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var $a={isMounted:function(t){return(t=t._reactInternals)?Ui(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=pt(),r=ai(t),o=Pn(i,r);o.payload=e,n!=null&&(o.callback=n),e=oi(t,o,r),e!==null&&(rn(e,t,r,i),ea(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=pt(),r=ai(t),o=Pn(i,r);o.tag=1,o.payload=e,n!=null&&(o.callback=n),e=oi(t,o,r),e!==null&&(rn(e,t,r,i),ea(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=pt(),i=ai(t),r=Pn(n,i);r.tag=2,e!=null&&(r.callback=e),e=oi(t,r,i),e!==null&&(rn(e,t,i,n),ea(e,t,i))}};function hh(t,e,n,i,r,o,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,o,a):e.prototype&&e.prototype.isPureReactComponent?!Bo(n,i)||!Bo(r,o):!0}function np(t,e,n){var i=!1,r=ci,o=e.contextType;return typeof o=="object"&&o!==null?o=Gt(o):(r=kt(e)?Ri:ut.current,i=e.contextTypes,o=(i=i!=null)?Rr(t,r):ci),e=new e(n,o),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=$a,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=o),e}function mh(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&$a.enqueueReplaceState(e,e.state,null)}function qu(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},Ec(t);var o=e.contextType;typeof o=="object"&&o!==null?r.context=Gt(o):(o=kt(e)?Ri:ut.current,r.context=Rr(t,o)),r.state=t.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(Bu(t,e,o,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&$a.enqueueReplaceState(r,r.state,null),ka(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function $r(t,e){try{var n="",i=e;do n+=s0(i),i=i.return;while(i);var r=n}catch(o){r=`
Error generating stack: `+o.message+`
`+o.stack}return{value:t,source:e,stack:r,digest:null}}function uu(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Ku(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Px=typeof WeakMap=="function"?WeakMap:Map;function ip(t,e,n){n=Pn(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){Ia||(Ia=!0,tc=i),Ku(t,e)},n}function rp(t,e,n){n=Pn(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){Ku(t,e)}}var o=t.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){Ku(t,e),typeof i!="function"&&(si===null?si=new Set([this]):si.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),n}function ph(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new Px;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=Kx.bind(null,t,e,n),e.then(t,t))}function gh(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function yh(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Pn(-1,1),e.tag=2,oi(n,e,1))),n.lanes|=1),t)}var Mx=Fn.ReactCurrentOwner,Tt=!1;function mt(t,e,n,i){e.child=t===null?Lm(e,null,n,i):Fr(e,t.child,n,i)}function vh(t,e,n,i,r){n=n.render;var o=e.ref;return Pr(e,r),i=Lc(t,e,n,i,o,r),n=Rc(),t!==null&&!Tt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Dn(t,e,r)):(Me&&n&&Cc(e),e.flags|=1,mt(t,e,i,r),e.child)}function xh(t,e,n,i,r){if(t===null){var o=n.type;return typeof o=="function"&&!qc(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=o,op(t,e,o,i,r)):(t=sa(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(o=t.child,!(t.lanes&r)){var a=o.memoizedProps;if(n=n.compare,n=n!==null?n:Bo,n(a,i)&&t.ref===e.ref)return Dn(t,e,r)}return e.flags|=1,t=li(o,i),t.ref=e.ref,t.return=e,e.child=t}function op(t,e,n,i,r){if(t!==null){var o=t.memoizedProps;if(Bo(o,i)&&t.ref===e.ref)if(Tt=!1,e.pendingProps=i=o,(t.lanes&r)!==0)t.flags&131072&&(Tt=!0);else return e.lanes=t.lanes,Dn(t,e,r)}return zu(t,e,n,i,r)}function sp(t,e,n){var i=e.pendingProps,r=i.children,o=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ne(wr,Et),Et|=n;else{if(!(n&1073741824))return t=o!==null?o.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Ne(wr,Et),Et|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=o!==null?o.baseLanes:n,Ne(wr,Et),Et|=i}else o!==null?(i=o.baseLanes|n,e.memoizedState=null):i=n,Ne(wr,Et),Et|=i;return mt(t,e,r,n),e.child}function ap(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function zu(t,e,n,i,r){var o=kt(n)?Ri:ut.current;return o=Rr(e,o),Pr(e,r),n=Lc(t,e,n,i,o,r),i=Rc(),t!==null&&!Tt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Dn(t,e,r)):(Me&&i&&Cc(e),e.flags|=1,mt(t,e,n,r),e.child)}function Th(t,e,n,i,r){if(kt(n)){var o=!0;ya(e)}else o=!1;if(Pr(e,r),e.stateNode===null)ia(t,e),np(e,n,i),qu(e,n,i,r),i=!0;else if(t===null){var a=e.stateNode,u=e.memoizedProps;a.props=u;var c=a.context,d=n.contextType;typeof d=="object"&&d!==null?d=Gt(d):(d=kt(n)?Ri:ut.current,d=Rr(e,d));var f=n.getDerivedStateFromProps,h=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function";h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(u!==i||c!==d)&&mh(e,a,i,d),Qn=!1;var m=e.memoizedState;a.state=m,ka(e,i,a,r),c=e.memoizedState,u!==i||m!==c||Ct.current||Qn?(typeof f=="function"&&(Bu(e,n,f,i),c=e.memoizedState),(u=Qn||hh(e,n,u,i,m,c,d))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=c),a.props=i,a.state=c,a.context=d,i=u):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{a=e.stateNode,Dm(t,e),u=e.memoizedProps,d=e.type===e.elementType?u:jt(e.type,u),a.props=d,h=e.pendingProps,m=a.context,c=n.contextType,typeof c=="object"&&c!==null?c=Gt(c):(c=kt(n)?Ri:ut.current,c=Rr(e,c));var y=n.getDerivedStateFromProps;(f=typeof y=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(u!==h||m!==c)&&mh(e,a,i,c),Qn=!1,m=e.memoizedState,a.state=m,ka(e,i,a,r);var p=e.memoizedState;u!==h||m!==p||Ct.current||Qn?(typeof y=="function"&&(Bu(e,n,y,i),p=e.memoizedState),(d=Qn||hh(e,n,d,i,m,p,c)||!1)?(f||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(i,p,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(i,p,c)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||u===t.memoizedProps&&m===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||u===t.memoizedProps&&m===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=p),a.props=i,a.state=p,a.context=c,i=d):(typeof a.componentDidUpdate!="function"||u===t.memoizedProps&&m===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||u===t.memoizedProps&&m===t.memoizedState||(e.flags|=1024),i=!1)}return Wu(t,e,n,i,o,r)}function Wu(t,e,n,i,r,o){ap(t,e);var a=(e.flags&128)!==0;if(!i&&!a)return r&&oh(e,n,!1),Dn(t,e,o);i=e.stateNode,Mx.current=e;var u=a&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&a?(e.child=Fr(e,t.child,null,o),e.child=Fr(e,null,u,o)):mt(t,e,u,o),e.memoizedState=i.state,r&&oh(e,n,!0),e.child}function lp(t){var e=t.stateNode;e.pendingContext?rh(t,e.pendingContext,e.pendingContext!==e.context):e.context&&rh(t,e.context,!1),Ac(t,e.containerInfo)}function Ch(t,e,n,i,r){return Dr(),Sc(r),e.flags|=256,mt(t,e,n,i),e.child}var Ju={dehydrated:null,treeContext:null,retryLane:0};function Yu(t){return{baseLanes:t,cachePool:null,transitions:null}}function up(t,e,n){var i=e.pendingProps,r=De.current,o=!1,a=(e.flags&128)!==0,u;if((u=a)||(u=t!==null&&t.memoizedState===null?!1:(r&2)!==0),u?(o=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),Ne(De,r&1),t===null)return Hu(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=i.children,t=i.fallback,o?(i=e.mode,o=e.child,a={mode:"hidden",children:a},!(i&1)&&o!==null?(o.childLanes=0,o.pendingProps=a):o=Ha(a,i,0,null),t=Li(t,i,n,null),o.return=e,t.return=e,o.sibling=t,e.child=o,e.child.memoizedState=Yu(n),e.memoizedState=Ju,t):Vc(e,a));if(r=t.memoizedState,r!==null&&(u=r.dehydrated,u!==null))return Lx(t,e,a,i,u,r,n);if(o){o=i.fallback,a=e.mode,r=t.child,u=r.sibling;var c={mode:"hidden",children:i.children};return!(a&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=c,e.deletions=null):(i=li(r,c),i.subtreeFlags=r.subtreeFlags&14680064),u!==null?o=li(u,o):(o=Li(o,a,n,null),o.flags|=2),o.return=e,i.return=e,i.sibling=o,e.child=i,i=o,o=e.child,a=t.child.memoizedState,a=a===null?Yu(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},o.memoizedState=a,o.childLanes=t.childLanes&~n,e.memoizedState=Ju,i}return o=t.child,t=o.sibling,i=li(o,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function Vc(t,e){return e=Ha({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Js(t,e,n,i){return i!==null&&Sc(i),Fr(e,t.child,null,n),t=Vc(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Lx(t,e,n,i,r,o,a){if(n)return e.flags&256?(e.flags&=-257,i=uu(Error(G(422))),Js(t,e,a,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(o=i.fallback,r=e.mode,i=Ha({mode:"visible",children:i.children},r,0,null),o=Li(o,r,a,null),o.flags|=2,i.return=e,o.return=e,i.sibling=o,e.child=i,e.mode&1&&Fr(e,t.child,null,a),e.child.memoizedState=Yu(a),e.memoizedState=Ju,o);if(!(e.mode&1))return Js(t,e,a,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var u=i.dgst;return i=u,o=Error(G(419)),i=uu(o,i,void 0),Js(t,e,a,i)}if(u=(a&t.childLanes)!==0,Tt||u){if(i=Je,i!==null){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|a)?0:r,r!==0&&r!==o.retryLane&&(o.retryLane=r,Rn(t,r),rn(i,t,r,-1))}return Bc(),i=uu(Error(G(421))),Js(t,e,a,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=zx.bind(null,t),r._reactRetry=e,null):(t=o.treeContext,At=ri(r.nextSibling),bt=e,Me=!0,tn=null,t!==null&&(Dt[Ft++]=An,Dt[Ft++]=bn,Dt[Ft++]=Di,An=t.id,bn=t.overflow,Di=e),e=Vc(e,i.children),e.flags|=4096,e)}function kh(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),Ou(t.return,e,n)}function cu(t,e,n,i,r){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r)}function cp(t,e,n){var i=e.pendingProps,r=i.revealOrder,o=i.tail;if(mt(t,e,i.children,n),i=De.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&kh(t,n,e);else if(t.tag===19)kh(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(Ne(De,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&Sa(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),cu(e,!1,r,n,o);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&Sa(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}cu(e,!0,n,null,o);break;case"together":cu(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ia(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Dn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Vi|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(G(153));if(e.child!==null){for(t=e.child,n=li(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=li(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Rx(t,e,n){switch(e.tag){case 3:lp(e),Dr();break;case 5:Fm(e);break;case 1:kt(e.type)&&ya(e);break;case 4:Ac(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;Ne(Ta,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(Ne(De,De.current&1),e.flags|=128,null):n&e.child.childLanes?up(t,e,n):(Ne(De,De.current&1),t=Dn(t,e,n),t!==null?t.sibling:null);Ne(De,De.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return cp(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Ne(De,De.current),i)break;return null;case 22:case 23:return e.lanes=0,sp(t,e,n)}return Dn(t,e,n)}var dp,Qu,fp,hp;dp=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Qu=function(){};fp=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,Pi(gn.current);var o=null;switch(n){case"input":r=vu(t,r),i=vu(t,i),o=[];break;case"select":r=Ve({},r,{value:void 0}),i=Ve({},i,{value:void 0}),o=[];break;case"textarea":r=Cu(t,r),i=Cu(t,i),o=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=pa)}Su(n,i);var a;n=null;for(d in r)if(!i.hasOwnProperty(d)&&r.hasOwnProperty(d)&&r[d]!=null)if(d==="style"){var u=r[d];for(a in u)u.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Fo.hasOwnProperty(d)?o||(o=[]):(o=o||[]).push(d,null));for(d in i){var c=i[d];if(u=r?.[d],i.hasOwnProperty(d)&&c!==u&&(c!=null||u!=null))if(d==="style")if(u){for(a in u)!u.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&u[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(o||(o=[]),o.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,u=u?u.__html:void 0,c!=null&&u!==c&&(o=o||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(o=o||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Fo.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Ee("scroll",t),o||u===c||(o=[])):(o=o||[]).push(d,c))}n&&(o=o||[]).push("style",n);var d=o;(e.updateQueue=d)&&(e.flags|=4)}};hp=function(t,e,n,i){n!==i&&(e.flags|=4)};function To(t,e){if(!Me)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function at(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function Dx(t,e,n){var i=e.pendingProps;switch(kc(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return at(e),null;case 1:return kt(e.type)&&ga(),at(e),null;case 3:return i=e.stateNode,Vr(),Ae(Ct),Ae(ut),Pc(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(zs(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,tn!==null&&(rc(tn),tn=null))),Qu(t,e),at(e),null;case 5:bc(e);var r=Pi(Jo.current);if(n=e.type,t!==null&&e.stateNode!=null)fp(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(G(166));return at(e),null}if(t=Pi(gn.current),zs(e)){i=e.stateNode,n=e.type;var o=e.memoizedProps;switch(i[mn]=e,i[zo]=o,t=(e.mode&1)!==0,n){case"dialog":Ee("cancel",i),Ee("close",i);break;case"iframe":case"object":case"embed":Ee("load",i);break;case"video":case"audio":for(r=0;r<wo.length;r++)Ee(wo[r],i);break;case"source":Ee("error",i);break;case"img":case"image":case"link":Ee("error",i),Ee("load",i);break;case"details":Ee("toggle",i);break;case"input":bf(i,o),Ee("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},Ee("invalid",i);break;case"textarea":Mf(i,o),Ee("invalid",i)}Su(n,o),r=null;for(var a in o)if(o.hasOwnProperty(a)){var u=o[a];a==="children"?typeof u=="string"?i.textContent!==u&&(o.suppressHydrationWarning!==!0&&Ks(i.textContent,u,t),r=["children",u]):typeof u=="number"&&i.textContent!==""+u&&(o.suppressHydrationWarning!==!0&&Ks(i.textContent,u,t),r=["children",""+u]):Fo.hasOwnProperty(a)&&u!=null&&a==="onScroll"&&Ee("scroll",i)}switch(n){case"input":Ls(i),Pf(i,o,!0);break;case"textarea":Ls(i),Lf(i);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(i.onclick=pa)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{a=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Hh(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=a.createElement(n,{is:i.is}):(t=a.createElement(n),n==="select"&&(a=t,i.multiple?a.multiple=!0:i.size&&(a.size=i.size))):t=a.createElementNS(t,n),t[mn]=e,t[zo]=i,dp(t,e,!1,!1),e.stateNode=t;e:{switch(a=_u(n,i),n){case"dialog":Ee("cancel",t),Ee("close",t),r=i;break;case"iframe":case"object":case"embed":Ee("load",t),r=i;break;case"video":case"audio":for(r=0;r<wo.length;r++)Ee(wo[r],t);r=i;break;case"source":Ee("error",t),r=i;break;case"img":case"image":case"link":Ee("error",t),Ee("load",t),r=i;break;case"details":Ee("toggle",t),r=i;break;case"input":bf(t,i),r=vu(t,i),Ee("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=Ve({},i,{value:void 0}),Ee("invalid",t);break;case"textarea":Mf(t,i),r=Cu(t,i),Ee("invalid",t);break;default:r=i}Su(n,r),u=r;for(o in u)if(u.hasOwnProperty(o)){var c=u[o];o==="style"?qh(t,c):o==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Oh(t,c)):o==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Vo(t,c):typeof c=="number"&&Vo(t,""+c):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Fo.hasOwnProperty(o)?c!=null&&o==="onScroll"&&Ee("scroll",t):c!=null&&ac(t,o,c,a))}switch(n){case"input":Ls(t),Pf(t,i,!1);break;case"textarea":Ls(t),Lf(t);break;case"option":i.value!=null&&t.setAttribute("value",""+ui(i.value));break;case"select":t.multiple=!!i.multiple,o=i.value,o!=null?Ir(t,!!i.multiple,o,!1):i.defaultValue!=null&&Ir(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=pa)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return at(e),null;case 6:if(t&&e.stateNode!=null)hp(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(G(166));if(n=Pi(Jo.current),Pi(gn.current),zs(e)){if(i=e.stateNode,n=e.memoizedProps,i[mn]=e,(o=i.nodeValue!==n)&&(t=bt,t!==null))switch(t.tag){case 3:Ks(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Ks(i.nodeValue,n,(t.mode&1)!==0)}o&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[mn]=e,e.stateNode=i}return at(e),null;case 13:if(Ae(De),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Me&&At!==null&&e.mode&1&&!(e.flags&128))Pm(),Dr(),e.flags|=98560,o=!1;else if(o=zs(e),i!==null&&i.dehydrated!==null){if(t===null){if(!o)throw Error(G(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(G(317));o[mn]=e}else Dr(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;at(e),o=!1}else tn!==null&&(rc(tn),tn=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||De.current&1?ze===0&&(ze=3):Bc())),e.updateQueue!==null&&(e.flags|=4),at(e),null);case 4:return Vr(),Qu(t,e),t===null&&qo(e.stateNode.containerInfo),at(e),null;case 10:return wc(e.type._context),at(e),null;case 17:return kt(e.type)&&ga(),at(e),null;case 19:if(Ae(De),o=e.memoizedState,o===null)return at(e),null;if(i=(e.flags&128)!==0,a=o.rendering,a===null)if(i)To(o,!1);else{if(ze!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=Sa(t),a!==null){for(e.flags|=128,To(o,!1),i=a.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)o=n,t=i,o.flags&=14680066,a=o.alternate,a===null?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=a.childLanes,o.lanes=a.lanes,o.child=a.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=a.memoizedProps,o.memoizedState=a.memoizedState,o.updateQueue=a.updateQueue,o.type=a.type,t=a.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Ne(De,De.current&1|2),e.child}t=t.sibling}o.tail!==null&&Be()>Gr&&(e.flags|=128,i=!0,To(o,!1),e.lanes=4194304)}else{if(!i)if(t=Sa(a),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),To(o,!0),o.tail===null&&o.tailMode==="hidden"&&!a.alternate&&!Me)return at(e),null}else 2*Be()-o.renderingStartTime>Gr&&n!==1073741824&&(e.flags|=128,i=!0,To(o,!1),e.lanes=4194304);o.isBackwards?(a.sibling=e.child,e.child=a):(n=o.last,n!==null?n.sibling=a:e.child=a,o.last=a)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=Be(),e.sibling=null,n=De.current,Ne(De,i?n&1|2:n&1),e):(at(e),null);case 22:case 23:return Oc(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Et&1073741824&&(at(e),e.subtreeFlags&6&&(e.flags|=8192)):at(e),null;case 24:return null;case 25:return null}throw Error(G(156,e.tag))}function Fx(t,e){switch(kc(e),e.tag){case 1:return kt(e.type)&&ga(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Vr(),Ae(Ct),Ae(ut),Pc(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return bc(e),null;case 13:if(Ae(De),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(G(340));Dr()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ae(De),null;case 4:return Vr(),null;case 10:return wc(e.type._context),null;case 22:case 23:return Oc(),null;case 24:return null;default:return null}}var Ys=!1,lt=!1,Vx=typeof WeakSet=="function"?WeakSet:Set,Y=null;function Nr(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){He(t,e,i)}else n.current=null}function Zu(t,e,n){try{n()}catch(i){He(t,e,i)}}var Sh=!1;function $x(t,e){if(Ru=fa,t=vm(),Tc(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var a=0,u=-1,c=-1,d=0,f=0,h=t,m=null;t:for(;;){for(var y;h!==n||r!==0&&h.nodeType!==3||(u=a+r),h!==o||i!==0&&h.nodeType!==3||(c=a+i),h.nodeType===3&&(a+=h.nodeValue.length),(y=h.firstChild)!==null;)m=h,h=y;for(;;){if(h===t)break t;if(m===n&&++d===r&&(u=a),m===o&&++f===i&&(c=a),(y=h.nextSibling)!==null)break;h=m,m=h.parentNode}h=y}n=u===-1||c===-1?null:{start:u,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Du={focusedElem:t,selectionRange:n},fa=!1,Y=e;Y!==null;)if(e=Y,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Y=t;else for(;Y!==null;){e=Y;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var T=p.memoizedProps,R=p.memoizedState,C=e.stateNode,g=C.getSnapshotBeforeUpdate(e.elementType===e.type?T:jt(e.type,T),R);C.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var x=e.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(G(163))}}catch(S){He(e,e.return,S)}if(t=e.sibling,t!==null){t.return=e.return,Y=t;break}Y=e.return}return p=Sh,Sh=!1,p}function Lo(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var o=r.destroy;r.destroy=void 0,o!==void 0&&Zu(e,n,o)}r=r.next}while(r!==i)}}function Ga(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function Xu(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function mp(t){var e=t.alternate;e!==null&&(t.alternate=null,mp(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[mn],delete e[zo],delete e[$u],delete e[Tx],delete e[Cx])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function pp(t){return t.tag===5||t.tag===3||t.tag===4}function _h(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||pp(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function ju(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=pa));else if(i!==4&&(t=t.child,t!==null))for(ju(t,e,n),t=t.sibling;t!==null;)ju(t,e,n),t=t.sibling}function ec(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(ec(t,e,n),t=t.sibling;t!==null;)ec(t,e,n),t=t.sibling}var Xe=null,en=!1;function Jn(t,e,n){for(n=n.child;n!==null;)gp(t,e,n),n=n.sibling}function gp(t,e,n){if(pn&&typeof pn.onCommitFiberUnmount=="function")try{pn.onCommitFiberUnmount(Pa,n)}catch{}switch(n.tag){case 5:lt||Nr(n,e);case 6:var i=Xe,r=en;Xe=null,Jn(t,e,n),Xe=i,en=r,Xe!==null&&(en?(t=Xe,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Xe.removeChild(n.stateNode));break;case 18:Xe!==null&&(en?(t=Xe,n=n.stateNode,t.nodeType===8?iu(t.parentNode,n):t.nodeType===1&&iu(t,n),Ho(t)):iu(Xe,n.stateNode));break;case 4:i=Xe,r=en,Xe=n.stateNode.containerInfo,en=!0,Jn(t,e,n),Xe=i,en=r;break;case 0:case 11:case 14:case 15:if(!lt&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var o=r,a=o.destroy;o=o.tag,a!==void 0&&(o&2||o&4)&&Zu(n,e,a),r=r.next}while(r!==i)}Jn(t,e,n);break;case 1:if(!lt&&(Nr(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(u){He(n,e,u)}Jn(t,e,n);break;case 21:Jn(t,e,n);break;case 22:n.mode&1?(lt=(i=lt)||n.memoizedState!==null,Jn(t,e,n),lt=i):Jn(t,e,n);break;default:Jn(t,e,n)}}function Nh(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Vx),e.forEach(function(i){var r=Wx.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function Xt(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var o=t,a=e,u=a;e:for(;u!==null;){switch(u.tag){case 5:Xe=u.stateNode,en=!1;break e;case 3:Xe=u.stateNode.containerInfo,en=!0;break e;case 4:Xe=u.stateNode.containerInfo,en=!0;break e}u=u.return}if(Xe===null)throw Error(G(160));gp(o,a,r),Xe=null,en=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(d){He(r,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)yp(e,t),e=e.sibling}function yp(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Xt(e,t),fn(t),i&4){try{Lo(3,t,t.return),Ga(3,t)}catch(T){He(t,t.return,T)}try{Lo(5,t,t.return)}catch(T){He(t,t.return,T)}}break;case 1:Xt(e,t),fn(t),i&512&&n!==null&&Nr(n,n.return);break;case 5:if(Xt(e,t),fn(t),i&512&&n!==null&&Nr(n,n.return),t.flags&32){var r=t.stateNode;try{Vo(r,"")}catch(T){He(t,t.return,T)}}if(i&4&&(r=t.stateNode,r!=null)){var o=t.memoizedProps,a=n!==null?n.memoizedProps:o,u=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{u==="input"&&o.type==="radio"&&o.name!=null&&Gh(r,o),_u(u,a);var d=_u(u,o);for(a=0;a<c.length;a+=2){var f=c[a],h=c[a+1];f==="style"?qh(r,h):f==="dangerouslySetInnerHTML"?Oh(r,h):f==="children"?Vo(r,h):ac(r,f,h,d)}switch(u){case"input":xu(r,o);break;case"textarea":Uh(r,o);break;case"select":var m=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var y=o.value;y!=null?Ir(r,!!o.multiple,y,!1):m!==!!o.multiple&&(o.defaultValue!=null?Ir(r,!!o.multiple,o.defaultValue,!0):Ir(r,!!o.multiple,o.multiple?[]:"",!1))}r[zo]=o}catch(T){He(t,t.return,T)}}break;case 6:if(Xt(e,t),fn(t),i&4){if(t.stateNode===null)throw Error(G(162));r=t.stateNode,o=t.memoizedProps;try{r.nodeValue=o}catch(T){He(t,t.return,T)}}break;case 3:if(Xt(e,t),fn(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Ho(e.containerInfo)}catch(T){He(t,t.return,T)}break;case 4:Xt(e,t),fn(t);break;case 13:Xt(e,t),fn(t),r=t.child,r.flags&8192&&(o=r.memoizedState!==null,r.stateNode.isHidden=o,!o||r.alternate!==null&&r.alternate.memoizedState!==null||(Uc=Be())),i&4&&Nh(t);break;case 22:if(f=n!==null&&n.memoizedState!==null,t.mode&1?(lt=(d=lt)||f,Xt(e,t),lt=d):Xt(e,t),fn(t),i&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!f&&t.mode&1)for(Y=t,f=t.child;f!==null;){for(h=Y=f;Y!==null;){switch(m=Y,y=m.child,m.tag){case 0:case 11:case 14:case 15:Lo(4,m,m.return);break;case 1:Nr(m,m.return);var p=m.stateNode;if(typeof p.componentWillUnmount=="function"){i=m,n=m.return;try{e=i,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(T){He(i,n,T)}}break;case 5:Nr(m,m.return);break;case 22:if(m.memoizedState!==null){Ih(h);continue}}y!==null?(y.return=m,Y=y):Ih(h)}f=f.sibling}e:for(f=null,h=t;;){if(h.tag===5){if(f===null){f=h;try{r=h.stateNode,d?(o=r.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(u=h.stateNode,c=h.memoizedProps.style,a=c!=null&&c.hasOwnProperty("display")?c.display:null,u.style.display=Bh("display",a))}catch(T){He(t,t.return,T)}}}else if(h.tag===6){if(f===null)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(T){He(t,t.return,T)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;f===h&&(f=null),h=h.return}f===h&&(f=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Xt(e,t),fn(t),i&4&&Nh(t);break;case 21:break;default:Xt(e,t),fn(t)}}function fn(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(pp(n)){var i=n;break e}n=n.return}throw Error(G(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Vo(r,""),i.flags&=-33);var o=_h(t);ec(t,o,r);break;case 3:case 4:var a=i.stateNode.containerInfo,u=_h(t);ju(t,u,a);break;default:throw Error(G(161))}}catch(c){He(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Gx(t,e,n){Y=t,vp(t,e,n)}function vp(t,e,n){for(var i=(t.mode&1)!==0;Y!==null;){var r=Y,o=r.child;if(r.tag===22&&i){var a=r.memoizedState!==null||Ys;if(!a){var u=r.alternate,c=u!==null&&u.memoizedState!==null||lt;u=Ys;var d=lt;if(Ys=a,(lt=c)&&!d)for(Y=r;Y!==null;)a=Y,c=a.child,a.tag===22&&a.memoizedState!==null?Eh(r):c!==null?(c.return=a,Y=c):Eh(r);for(;o!==null;)Y=o,vp(o,e,n),o=o.sibling;Y=r,Ys=u,lt=d}wh(t,e,n)}else r.subtreeFlags&8772&&o!==null?(o.return=r,Y=o):wh(t,e,n)}}function wh(t){for(;Y!==null;){var e=Y;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:lt||Ga(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!lt)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:jt(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&ch(e,o,i);break;case 3:var a=e.updateQueue;if(a!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}ch(e,a,n)}break;case 5:var u=e.stateNode;if(n===null&&e.flags&4){n=u;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var f=d.memoizedState;if(f!==null){var h=f.dehydrated;h!==null&&Ho(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(G(163))}lt||e.flags&512&&Xu(e)}catch(m){He(e,e.return,m)}}if(e===t){Y=null;break}if(n=e.sibling,n!==null){n.return=e.return,Y=n;break}Y=e.return}}function Ih(t){for(;Y!==null;){var e=Y;if(e===t){Y=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Y=n;break}Y=e.return}}function Eh(t){for(;Y!==null;){var e=Y;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Ga(4,e)}catch(c){He(e,n,c)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(c){He(e,r,c)}}var o=e.return;try{Xu(e)}catch(c){He(e,o,c)}break;case 5:var a=e.return;try{Xu(e)}catch(c){He(e,a,c)}}}catch(c){He(e,e.return,c)}if(e===t){Y=null;break}var u=e.sibling;if(u!==null){u.return=e.return,Y=u;break}Y=e.return}}var Ux=Math.ceil,wa=Fn.ReactCurrentDispatcher,$c=Fn.ReactCurrentOwner,$t=Fn.ReactCurrentBatchConfig,ve=0,Je=null,qe=null,je=0,Et=0,wr=fi(0),ze=0,Xo=null,Vi=0,Ua=0,Gc=0,Ro=null,xt=null,Uc=0,Gr=1/0,In=null,Ia=!1,tc=null,si=null,Qs=!1,ei=null,Ea=0,Do=0,nc=null,ra=-1,oa=0;function pt(){return ve&6?Be():ra!==-1?ra:ra=Be()}function ai(t){return t.mode&1?ve&2&&je!==0?je&-je:Sx.transition!==null?(oa===0&&(oa=nm()),oa):(t=Ce,t!==0||(t=window.event,t=t===void 0?16:um(t.type)),t):1}function rn(t,e,n,i){if(50<Do)throw Do=0,nc=null,Error(G(185));jo(t,n,i),(!(ve&2)||t!==Je)&&(t===Je&&(!(ve&2)&&(Ua|=n),ze===4&&Xn(t,je)),St(t,i),n===1&&ve===0&&!(e.mode&1)&&(Gr=Be()+500,Fa&&hi()))}function St(t,e){var n=t.callbackNode;N0(t,e);var i=da(t,t===Je?je:0);if(i===0)n!==null&&Ff(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&Ff(n),e===1)t.tag===0?kx(Ah.bind(null,t)):Em(Ah.bind(null,t)),vx(function(){!(ve&6)&&hi()}),n=null;else{switch(im(i)){case 1:n=fc;break;case 4:n=em;break;case 16:n=ca;break;case 536870912:n=tm;break;default:n=ca}n=wp(n,xp.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function xp(t,e){if(ra=-1,oa=0,ve&6)throw Error(G(327));var n=t.callbackNode;if(Mr()&&t.callbackNode!==n)return null;var i=da(t,t===Je?je:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=Aa(t,i);else{e=i;var r=ve;ve|=2;var o=Cp();(Je!==t||je!==e)&&(In=null,Gr=Be()+500,Mi(t,e));do try{Bx();break}catch(u){Tp(t,u)}while(!0);Nc(),wa.current=o,ve=r,qe!==null?e=0:(Je=null,je=0,e=ze)}if(e!==0){if(e===2&&(r=Au(t),r!==0&&(i=r,e=ic(t,r))),e===1)throw n=Xo,Mi(t,0),Xn(t,i),St(t,Be()),n;if(e===6)Xn(t,i);else{if(r=t.current.alternate,!(i&30)&&!Hx(r)&&(e=Aa(t,i),e===2&&(o=Au(t),o!==0&&(i=o,e=ic(t,o))),e===1))throw n=Xo,Mi(t,0),Xn(t,i),St(t,Be()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(G(345));case 2:Ei(t,xt,In);break;case 3:if(Xn(t,i),(i&130023424)===i&&(e=Uc+500-Be(),10<e)){if(da(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){pt(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=Vu(Ei.bind(null,t,xt,In),e);break}Ei(t,xt,In);break;case 4:if(Xn(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var a=31-nn(i);o=1<<a,a=e[a],a>r&&(r=a),i&=~o}if(i=r,i=Be()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Ux(i/1960))-i,10<i){t.timeoutHandle=Vu(Ei.bind(null,t,xt,In),i);break}Ei(t,xt,In);break;case 5:Ei(t,xt,In);break;default:throw Error(G(329))}}}return St(t,Be()),t.callbackNode===n?xp.bind(null,t):null}function ic(t,e){var n=Ro;return t.current.memoizedState.isDehydrated&&(Mi(t,e).flags|=256),t=Aa(t,e),t!==2&&(e=xt,xt=n,e!==null&&rc(e)),t}function rc(t){xt===null?xt=t:xt.push.apply(xt,t)}function Hx(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],o=r.getSnapshot;r=r.value;try{if(!on(o(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Xn(t,e){for(e&=~Gc,e&=~Ua,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-nn(e),i=1<<n;t[n]=-1,e&=~i}}function Ah(t){if(ve&6)throw Error(G(327));Mr();var e=da(t,0);if(!(e&1))return St(t,Be()),null;var n=Aa(t,e);if(t.tag!==0&&n===2){var i=Au(t);i!==0&&(e=i,n=ic(t,i))}if(n===1)throw n=Xo,Mi(t,0),Xn(t,e),St(t,Be()),n;if(n===6)throw Error(G(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Ei(t,xt,In),St(t,Be()),null}function Hc(t,e){var n=ve;ve|=1;try{return t(e)}finally{ve=n,ve===0&&(Gr=Be()+500,Fa&&hi())}}function $i(t){ei!==null&&ei.tag===0&&!(ve&6)&&Mr();var e=ve;ve|=1;var n=$t.transition,i=Ce;try{if($t.transition=null,Ce=1,t)return t()}finally{Ce=i,$t.transition=n,ve=e,!(ve&6)&&hi()}}function Oc(){Et=wr.current,Ae(wr)}function Mi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,yx(n)),qe!==null)for(n=qe.return;n!==null;){var i=n;switch(kc(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&ga();break;case 3:Vr(),Ae(Ct),Ae(ut),Pc();break;case 5:bc(i);break;case 4:Vr();break;case 13:Ae(De);break;case 19:Ae(De);break;case 10:wc(i.type._context);break;case 22:case 23:Oc()}n=n.return}if(Je=t,qe=t=li(t.current,null),je=Et=e,ze=0,Xo=null,Gc=Ua=Vi=0,xt=Ro=null,bi!==null){for(e=0;e<bi.length;e++)if(n=bi[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,o=n.pending;if(o!==null){var a=o.next;o.next=r,i.next=a}n.pending=i}bi=null}return t}function Tp(t,e){do{var n=qe;try{if(Nc(),ta.current=Na,_a){for(var i=Fe.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}_a=!1}if(Fi=0,We=Ke=Fe=null,Mo=!1,Yo=0,$c.current=null,n===null||n.return===null){ze=1,Xo=e,qe=null;break}e:{var o=t,a=n.return,u=n,c=e;if(e=je,u.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,f=u,h=f.tag;if(!(f.mode&1)&&(h===0||h===11||h===15)){var m=f.alternate;m?(f.updateQueue=m.updateQueue,f.memoizedState=m.memoizedState,f.lanes=m.lanes):(f.updateQueue=null,f.memoizedState=null)}var y=gh(a);if(y!==null){y.flags&=-257,yh(y,a,u,o,e),y.mode&1&&ph(o,d,e),e=y,c=d;var p=e.updateQueue;if(p===null){var T=new Set;T.add(c),e.updateQueue=T}else p.add(c);break e}else{if(!(e&1)){ph(o,d,e),Bc();break e}c=Error(G(426))}}else if(Me&&u.mode&1){var R=gh(a);if(R!==null){!(R.flags&65536)&&(R.flags|=256),yh(R,a,u,o,e),Sc($r(c,u));break e}}o=c=$r(c,u),ze!==4&&(ze=2),Ro===null?Ro=[o]:Ro.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var C=ip(o,c,e);uh(o,C);break e;case 1:u=c;var g=o.type,x=o.stateNode;if(!(o.flags&128)&&(typeof g.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(si===null||!si.has(x)))){o.flags|=65536,e&=-e,o.lanes|=e;var S=rp(o,u,e);uh(o,S);break e}}o=o.return}while(o!==null)}Sp(n)}catch(I){e=I,qe===n&&n!==null&&(qe=n=n.return);continue}break}while(!0)}function Cp(){var t=wa.current;return wa.current=Na,t===null?Na:t}function Bc(){(ze===0||ze===3||ze===2)&&(ze=4),Je===null||!(Vi&268435455)&&!(Ua&268435455)||Xn(Je,je)}function Aa(t,e){var n=ve;ve|=2;var i=Cp();(Je!==t||je!==e)&&(In=null,Mi(t,e));do try{Ox();break}catch(r){Tp(t,r)}while(!0);if(Nc(),ve=n,wa.current=i,qe!==null)throw Error(G(261));return Je=null,je=0,ze}function Ox(){for(;qe!==null;)kp(qe)}function Bx(){for(;qe!==null&&!g0();)kp(qe)}function kp(t){var e=Np(t.alternate,t,Et);t.memoizedProps=t.pendingProps,e===null?Sp(t):qe=e,$c.current=null}function Sp(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Fx(n,e),n!==null){n.flags&=32767,qe=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ze=6,qe=null;return}}else if(n=Dx(n,e,Et),n!==null){qe=n;return}if(e=e.sibling,e!==null){qe=e;return}qe=e=t}while(e!==null);ze===0&&(ze=5)}function Ei(t,e,n){var i=Ce,r=$t.transition;try{$t.transition=null,Ce=1,qx(t,e,n,i)}finally{$t.transition=r,Ce=i}return null}function qx(t,e,n,i){do Mr();while(ei!==null);if(ve&6)throw Error(G(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(G(177));t.callbackNode=null,t.callbackPriority=0;var o=n.lanes|n.childLanes;if(w0(t,o),t===Je&&(qe=Je=null,je=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Qs||(Qs=!0,wp(ca,function(){return Mr(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=$t.transition,$t.transition=null;var a=Ce;Ce=1;var u=ve;ve|=4,$c.current=null,$x(t,n),yp(n,t),fx(Du),fa=!!Ru,Du=Ru=null,t.current=n,Gx(n,t,r),y0(),ve=u,Ce=a,$t.transition=o}else t.current=n;if(Qs&&(Qs=!1,ei=t,Ea=r),o=t.pendingLanes,o===0&&(si=null),T0(n.stateNode,i),St(t,Be()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Ia)throw Ia=!1,t=tc,tc=null,t;return Ea&1&&t.tag!==0&&Mr(),o=t.pendingLanes,o&1?t===nc?Do++:(Do=0,nc=t):Do=0,hi(),null}function Mr(){if(ei!==null){var t=im(Ea),e=$t.transition,n=Ce;try{if($t.transition=null,Ce=16>t?16:t,ei===null)var i=!1;else{if(t=ei,ei=null,Ea=0,ve&6)throw Error(G(331));var r=ve;for(ve|=4,Y=t.current;Y!==null;){var o=Y,a=o.child;if(Y.flags&16){var u=o.deletions;if(u!==null){for(var c=0;c<u.length;c++){var d=u[c];for(Y=d;Y!==null;){var f=Y;switch(f.tag){case 0:case 11:case 15:Lo(8,f,o)}var h=f.child;if(h!==null)h.return=f,Y=h;else for(;Y!==null;){f=Y;var m=f.sibling,y=f.return;if(mp(f),f===d){Y=null;break}if(m!==null){m.return=y,Y=m;break}Y=y}}}var p=o.alternate;if(p!==null){var T=p.child;if(T!==null){p.child=null;do{var R=T.sibling;T.sibling=null,T=R}while(T!==null)}}Y=o}}if(o.subtreeFlags&2064&&a!==null)a.return=o,Y=a;else e:for(;Y!==null;){if(o=Y,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Lo(9,o,o.return)}var C=o.sibling;if(C!==null){C.return=o.return,Y=C;break e}Y=o.return}}var g=t.current;for(Y=g;Y!==null;){a=Y;var x=a.child;if(a.subtreeFlags&2064&&x!==null)x.return=a,Y=x;else e:for(a=g;Y!==null;){if(u=Y,u.flags&2048)try{switch(u.tag){case 0:case 11:case 15:Ga(9,u)}}catch(I){He(u,u.return,I)}if(u===a){Y=null;break e}var S=u.sibling;if(S!==null){S.return=u.return,Y=S;break e}Y=u.return}}if(ve=r,hi(),pn&&typeof pn.onPostCommitFiberRoot=="function")try{pn.onPostCommitFiberRoot(Pa,t)}catch{}i=!0}return i}finally{Ce=n,$t.transition=e}}return!1}function bh(t,e,n){e=$r(n,e),e=ip(t,e,1),t=oi(t,e,1),e=pt(),t!==null&&(jo(t,1,e),St(t,e))}function He(t,e,n){if(t.tag===3)bh(t,t,n);else for(;e!==null;){if(e.tag===3){bh(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(si===null||!si.has(i))){t=$r(n,t),t=rp(e,t,1),e=oi(e,t,1),t=pt(),e!==null&&(jo(e,1,t),St(e,t));break}}e=e.return}}function Kx(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=pt(),t.pingedLanes|=t.suspendedLanes&n,Je===t&&(je&n)===n&&(ze===4||ze===3&&(je&130023424)===je&&500>Be()-Uc?Mi(t,0):Gc|=n),St(t,e)}function _p(t,e){e===0&&(t.mode&1?(e=Fs,Fs<<=1,!(Fs&130023424)&&(Fs=4194304)):e=1);var n=pt();t=Rn(t,e),t!==null&&(jo(t,e,n),St(t,n))}function zx(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),_p(t,n)}function Wx(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(G(314))}i!==null&&i.delete(e),_p(t,n)}var Np;Np=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Ct.current)Tt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Tt=!1,Rx(t,e,n);Tt=!!(t.flags&131072)}else Tt=!1,Me&&e.flags&1048576&&Am(e,xa,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;ia(t,e),t=e.pendingProps;var r=Rr(e,ut.current);Pr(e,n),r=Lc(null,e,i,t,r,n);var o=Rc();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,kt(i)?(o=!0,ya(e)):o=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Ec(e),r.updater=$a,e.stateNode=r,r._reactInternals=e,qu(e,i,t,n),e=Wu(null,e,i,!0,o,n)):(e.tag=0,Me&&o&&Cc(e),mt(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(ia(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=Yx(i),t=jt(i,t),r){case 0:e=zu(null,e,i,t,n);break e;case 1:e=Th(null,e,i,t,n);break e;case 11:e=vh(null,e,i,t,n);break e;case 14:e=xh(null,e,i,jt(i.type,t),n);break e}throw Error(G(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:jt(i,r),zu(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:jt(i,r),Th(t,e,i,r,n);case 3:e:{if(lp(e),t===null)throw Error(G(387));i=e.pendingProps,o=e.memoizedState,r=o.element,Dm(t,e),ka(e,i,null,n);var a=e.memoizedState;if(i=a.element,o.isDehydrated)if(o={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){r=$r(Error(G(423)),e),e=Ch(t,e,i,n,r);break e}else if(i!==r){r=$r(Error(G(424)),e),e=Ch(t,e,i,n,r);break e}else for(At=ri(e.stateNode.containerInfo.firstChild),bt=e,Me=!0,tn=null,n=Lm(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Dr(),i===r){e=Dn(t,e,n);break e}mt(t,e,i,n)}e=e.child}return e;case 5:return Fm(e),t===null&&Hu(e),i=e.type,r=e.pendingProps,o=t!==null?t.memoizedProps:null,a=r.children,Fu(i,r)?a=null:o!==null&&Fu(i,o)&&(e.flags|=32),ap(t,e),mt(t,e,a,n),e.child;case 6:return t===null&&Hu(e),null;case 13:return up(t,e,n);case 4:return Ac(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=Fr(e,null,i,n):mt(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:jt(i,r),vh(t,e,i,r,n);case 7:return mt(t,e,e.pendingProps,n),e.child;case 8:return mt(t,e,e.pendingProps.children,n),e.child;case 12:return mt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,o=e.memoizedProps,a=r.value,Ne(Ta,i._currentValue),i._currentValue=a,o!==null)if(on(o.value,a)){if(o.children===r.children&&!Ct.current){e=Dn(t,e,n);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var u=o.dependencies;if(u!==null){a=o.child;for(var c=u.firstContext;c!==null;){if(c.context===i){if(o.tag===1){c=Pn(-1,n&-n),c.tag=2;var d=o.updateQueue;if(d!==null){d=d.shared;var f=d.pending;f===null?c.next=c:(c.next=f.next,f.next=c),d.pending=c}}o.lanes|=n,c=o.alternate,c!==null&&(c.lanes|=n),Ou(o.return,n,e),u.lanes|=n;break}c=c.next}}else if(o.tag===10)a=o.type===e.type?null:o.child;else if(o.tag===18){if(a=o.return,a===null)throw Error(G(341));a.lanes|=n,u=a.alternate,u!==null&&(u.lanes|=n),Ou(a,n,e),a=o.sibling}else a=o.child;if(a!==null)a.return=o;else for(a=o;a!==null;){if(a===e){a=null;break}if(o=a.sibling,o!==null){o.return=a.return,a=o;break}a=a.return}o=a}mt(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,Pr(e,n),r=Gt(r),i=i(r),e.flags|=1,mt(t,e,i,n),e.child;case 14:return i=e.type,r=jt(i,e.pendingProps),r=jt(i.type,r),xh(t,e,i,r,n);case 15:return op(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:jt(i,r),ia(t,e),e.tag=1,kt(i)?(t=!0,ya(e)):t=!1,Pr(e,n),np(e,i,r),qu(e,i,r,n),Wu(null,e,i,!0,t,n);case 19:return cp(t,e,n);case 22:return sp(t,e,n)}throw Error(G(156,e.tag))};function wp(t,e){return jh(t,e)}function Jx(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Vt(t,e,n,i){return new Jx(t,e,n,i)}function qc(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Yx(t){if(typeof t=="function")return qc(t)?1:0;if(t!=null){if(t=t.$$typeof,t===uc)return 11;if(t===cc)return 14}return 2}function li(t,e){var n=t.alternate;return n===null?(n=Vt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function sa(t,e,n,i,r,o){var a=2;if(i=t,typeof t=="function")qc(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case gr:return Li(n.children,r,o,e);case lc:a=8,r|=8;break;case mu:return t=Vt(12,n,e,r|2),t.elementType=mu,t.lanes=o,t;case pu:return t=Vt(13,n,e,r),t.elementType=pu,t.lanes=o,t;case gu:return t=Vt(19,n,e,r),t.elementType=gu,t.lanes=o,t;case Fh:return Ha(n,r,o,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Rh:a=10;break e;case Dh:a=9;break e;case uc:a=11;break e;case cc:a=14;break e;case Yn:a=16,i=null;break e}throw Error(G(130,t==null?t:typeof t,""))}return e=Vt(a,n,e,r),e.elementType=t,e.type=i,e.lanes=o,e}function Li(t,e,n,i){return t=Vt(7,t,i,e),t.lanes=n,t}function Ha(t,e,n,i){return t=Vt(22,t,i,e),t.elementType=Fh,t.lanes=n,t.stateNode={isHidden:!1},t}function du(t,e,n){return t=Vt(6,t,null,e),t.lanes=n,t}function fu(t,e,n){return e=Vt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Qx(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Yl(0),this.expirationTimes=Yl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Yl(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Kc(t,e,n,i,r,o,a,u,c){return t=new Qx(t,e,n,u,c),e===1?(e=1,o===!0&&(e|=8)):e=0,o=Vt(3,null,null,e),t.current=o,o.stateNode=t,o.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ec(o),t}function Zx(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:pr,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function Ip(t){if(!t)return ci;t=t._reactInternals;e:{if(Ui(t)!==t||t.tag!==1)throw Error(G(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(kt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(G(171))}if(t.tag===1){var n=t.type;if(kt(n))return Im(t,n,e)}return e}function Ep(t,e,n,i,r,o,a,u,c){return t=Kc(n,i,!0,t,r,o,a,u,c),t.context=Ip(null),n=t.current,i=pt(),r=ai(n),o=Pn(i,r),o.callback=e??null,oi(n,o,r),t.current.lanes=r,jo(t,r,i),St(t,i),t}function Oa(t,e,n,i){var r=e.current,o=pt(),a=ai(r);return n=Ip(n),e.context===null?e.context=n:e.pendingContext=n,e=Pn(o,a),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=oi(r,e,a),t!==null&&(rn(t,r,a,o),ea(t,r,a)),a}function ba(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Ph(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function zc(t,e){Ph(t,e),(t=t.alternate)&&Ph(t,e)}function Xx(){return null}var Ap=typeof reportError=="function"?reportError:function(t){console.error(t)};function Wc(t){this._internalRoot=t}Ba.prototype.render=Wc.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(G(409));Oa(t,e,null,null)};Ba.prototype.unmount=Wc.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;$i(function(){Oa(null,t,null,null)}),e[Ln]=null}};function Ba(t){this._internalRoot=t}Ba.prototype.unstable_scheduleHydration=function(t){if(t){var e=sm();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Zn.length&&e!==0&&e<Zn[n].priority;n++);Zn.splice(n,0,t),n===0&&lm(t)}};function Jc(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function qa(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Mh(){}function jx(t,e,n,i,r){if(r){if(typeof i=="function"){var o=i;i=function(){var d=ba(a);o.call(d)}}var a=Ep(e,i,t,0,null,!1,!1,"",Mh);return t._reactRootContainer=a,t[Ln]=a.current,qo(t.nodeType===8?t.parentNode:t),$i(),a}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var u=i;i=function(){var d=ba(c);u.call(d)}}var c=Kc(t,0,!1,null,null,!1,!1,"",Mh);return t._reactRootContainer=c,t[Ln]=c.current,qo(t.nodeType===8?t.parentNode:t),$i(function(){Oa(e,c,n,i)}),c}function Ka(t,e,n,i,r){var o=n._reactRootContainer;if(o){var a=o;if(typeof r=="function"){var u=r;r=function(){var c=ba(a);u.call(c)}}Oa(e,a,t,r)}else a=jx(n,e,t,r,i);return ba(a)}rm=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=No(e.pendingLanes);n!==0&&(hc(e,n|1),St(e,Be()),!(ve&6)&&(Gr=Be()+500,hi()))}break;case 13:$i(function(){var i=Rn(t,1);if(i!==null){var r=pt();rn(i,t,1,r)}}),zc(t,1)}};mc=function(t){if(t.tag===13){var e=Rn(t,134217728);if(e!==null){var n=pt();rn(e,t,134217728,n)}zc(t,134217728)}};om=function(t){if(t.tag===13){var e=ai(t),n=Rn(t,e);if(n!==null){var i=pt();rn(n,t,e,i)}zc(t,e)}};sm=function(){return Ce};am=function(t,e){var n=Ce;try{return Ce=t,e()}finally{Ce=n}};wu=function(t,e,n){switch(e){case"input":if(xu(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=Da(i);if(!r)throw Error(G(90));$h(i),xu(i,r)}}}break;case"textarea":Uh(t,n);break;case"select":e=n.value,e!=null&&Ir(t,!!n.multiple,e,!1)}};Wh=Hc;Jh=$i;var eT={usingClientEntryPoint:!1,Events:[ts,Tr,Da,Kh,zh,Hc]},Co={findFiberByHostInstance:Ai,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},tT={bundleType:Co.bundleType,version:Co.version,rendererPackageName:Co.rendererPackageName,rendererConfig:Co.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Fn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Zh(t),t===null?null:t.stateNode},findFiberByHostInstance:Co.findFiberByHostInstance||Xx,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&(ko=__REACT_DEVTOOLS_GLOBAL_HOOK__,!ko.isDisabled&&ko.supportsFiber))try{Pa=ko.inject(tT),pn=ko}catch{}var ko;Lt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eT;Lt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Jc(e))throw Error(G(200));return Zx(t,e,null,n)};Lt.createRoot=function(t,e){if(!Jc(t))throw Error(G(299));var n=!1,i="",r=Ap;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Kc(t,1,!1,null,null,n,!1,i,r),t[Ln]=e.current,qo(t.nodeType===8?t.parentNode:t),new Wc(e)};Lt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(G(188)):(t=Object.keys(t).join(","),Error(G(268,t)));return t=Zh(e),t=t===null?null:t.stateNode,t};Lt.flushSync=function(t){return $i(t)};Lt.hydrate=function(t,e,n){if(!qa(e))throw Error(G(200));return Ka(null,t,e,!0,n)};Lt.hydrateRoot=function(t,e,n){if(!Jc(t))throw Error(G(405));var i=n!=null&&n.hydratedSources||null,r=!1,o="",a=Ap;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),e=Ep(e,null,t,1,n??null,r,!1,o,a),t[Ln]=e.current,qo(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new Ba(e)};Lt.render=function(t,e,n){if(!qa(e))throw Error(G(200));return Ka(null,t,e,!1,n)};Lt.unmountComponentAtNode=function(t){if(!qa(t))throw Error(G(40));return t._reactRootContainer?($i(function(){Ka(null,null,t,!1,function(){t._reactRootContainer=null,t[Ln]=null})}),!0):!1};Lt.unstable_batchedUpdates=Hc;Lt.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!qa(n))throw Error(G(200));if(t==null||t._reactInternals===void 0)throw Error(G(38));return Ka(t,e,n,!1,i)};Lt.version="18.3.1-next-f1338f8080-20240426"});var Lp=wn((zA,Mp)=>{"use strict";function Pp(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Pp)}catch(t){console.error(t)}}Pp(),Mp.exports=bp()});var Dp=wn(Yc=>{"use strict";var Rp=Lp();Yc.createRoot=Rp.createRoot,Yc.hydrateRoot=Rp.hydrateRoot;var WA});var $p=wn(Ya=>{"use strict";var nT=ke(),iT=Symbol.for("react.element"),rT=Symbol.for("react.fragment"),oT=Object.prototype.hasOwnProperty,sT=nT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,aT={key:!0,ref:!0,__self:!0,__source:!0};function Vp(t,e,n){var i,r={},o=null,a=null;n!==void 0&&(o=""+n),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(a=e.ref);for(i in e)oT.call(e,i)&&!aT.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:iT,type:t,key:o,ref:a,props:r,_owner:sT.current}}Ya.Fragment=rT;Ya.jsx=Vp;Ya.jsxs=Vp});var ee=wn((XA,Gp)=>{"use strict";Gp.exports=$p()});var Av=H(ke(),1),bv=H(Dp(),1);var it=H(ke(),1);var za=(u=>(u.Humorous="H\xE0i h\u01B0\u1EDBc",u.Serious="Nghi\xEAm t\xFAc",u.Fantasy="K\u1EF3 \u1EA3o",u.Horror="Kinh d\u1ECB",u.Romance="L\xE3ng m\u1EA1n",u.Epic="S\u1EED thi",u.Custom="T\xF9y ch\u1EC9nh",u))(za||{}),Wa=(r=>(r.Male="Nam",r.Female="N\u1EEF",r.Other="Kh\xE1c",r.AIDecides="AI quy\u1EBFt \u0111\u1ECBnh",r))(Wa||{}),Ht=(o=>(o.NPC="NPC",o.Item="V\u1EADt ph\u1EA9m",o.Location="\u0110\u1ECBa \u0111i\u1EC3m",o.Organization="T\u1ED5 ch\u1EE9c",o.Other="Kh\xE1c",o))(Ht||{}),Or=(c=>(c.Weapon="V\u0169 Kh\xED Ch\xEDnh",c.OffHand="Tay Ph\u1EE5",c.Helmet="M\u0169",c.Armor="Gi\xE1p",c.Boots="Gi\xE0y",c.Amulet="D\xE2y Chuy\u1EC1n",c.Ring1="Nh\u1EABn 1",c.Ring2="Nh\u1EABn 2",c))(Or||{}),is=(u=>(u.Hostile="Th\xF9 \u0110\u1ECBch",u.Mistrustful="Kh\xF4ng Tin T\u01B0\u1EDFng",u.Neutral="Trung L\u1EADp",u.Amicable="H\xF2a H\u1EA3o",u.Friendly="Th\xE2n Thi\u1EC7n",u.Loyal="Trung Th\xE0nh",u.Adored="Ng\u01B0\u1EE1ng M\u1ED9",u))(is||{}),Qc=(a=>(a.Boon="K\u1EF3 Ng\u1ED9 / C\u01A1 Duy\xEAn",a.Calamity="Tai H\u1ECDa / Bi\u1EBFn C\u1ED1",a.PoliticalConflict="M\xE2u Thu\u1EABn / Xung \u0110\u1ED9t Ch\xEDnh Tr\u1ECB",a.SocialEvent="S\u1EF1 Ki\u1EC7n X\xE3 H\u1ED9i",a.Rumor="Tin \u0110\u1ED3n / B\xED M\u1EADt B\u1ECB Ti\u1EBFt L\u1ED9",a.Random="Ng\u1EABu Nhi\xEAn",a))(Qc||{}),Zc=(i=>(i.Personal="C\xE1 Nh\xE2n",i.Regional="Khu V\u1EF1c",i.Global="To\xE0n C\u1EA7u / R\u1ED9ng L\u1EDBn",i))(Zc||{});var Xc="Nh\u1EADp Vai A.I Simulator";var rs="https://aistudio.google.com/app/apikey",Vn="gemini-2.5-flash-preview-04-17",jc="aiRoleplaySimulatorSettings",ed="aiRoleplaySimulatorNSFW",sn="aiRoleplaySimulatorApiKey",_t="aiRoleplaySimulatorAutosave_",Fp={systemInstruction:'B\u1EA1n l\xE0 m\u1ED9t AI k\u1EC3 chuy\u1EC7n chuy\xEAn nghi\u1EC7p, am hi\u1EC3u s\xE2u s\u1EAFc v\u0103n phong v\xE0 m\xF4-t\xEDp c\u1EE7a ti\u1EC3u thuy\u1EBFt m\u1EA1ng Trung Qu\u1ED1c.\nKhi kh\u1EDFi t\u1EA1o v\xE0 ph\xE1t tri\u1EC3n n\u1ED9i dung c\xE2u chuy\u1EC7n, h\xE3y \u01B0u ti\xEAn c\xE1c y\u1EBFu t\u1ED1 sau \u0111\u1EC3 t\u1EA1o ra tr\u1EA3i nghi\u1EC7m \u0111\u1EADm ch\u1EA5t ti\u1EC3u thuy\u1EBFt m\u1EA1ng Trung Qu\u1ED1c.\n\n**H\u1EC6 TH\u1ED0NG GAME:**\n\u1EE8ng d\u1EE5ng n\xE0y c\xF3 c\xE1c h\u1EC7 th\u1ED1ng: **Ch\u1EC9 S\u1ED1 Nh\xE2n V\u1EADt**, **Ba L\xF4 V\u1EADt Ph\u1EA9m (Bao g\u1ED3m H\u1EC7 Th\u1ED1ng Trang B\u1ECB)**, **H\u1EC7 Th\u1ED1ng Ti\u1EBFn Tri\u1EC3n Nh\xE2n V\u1EADt (Linh Ho\u1EA1t)**, **H\u1EC7 Th\u1ED1ng K\u1EF9 N\u0103ng**, **H\u1EC7 Th\u1ED1ng Chi\u1EBFn \u0110\u1EA5u (S\u01A1 L\u01B0\u1EE3c)**, **B\xE1ch Khoa To\xE0n Th\u01B0 \u0110\u1ED9ng**, **Th\xE0nh T\u1EF1u**, **M\u1ED0I QUAN H\u1EC6 NPC**, v\xE0 **M\u1EE4C TI\xCAU/NHI\u1EC6M V\u1EE4 (AI qu\u1EA3n l\xFD, kh\xF4ng c\xF3 tab ri\xEAng trong UI)**.\nC\xE1c h\u1EC7 th\u1ED1ng t\xF9y ch\u1ECDn c\xF3 th\u1EC3 \u0111\u01B0\u1EE3c k\xEDch ho\u1EA1t: **H\u1EC6 TH\u1ED0NG TI\u1EC0N T\u1EC6**, **H\u1EC6 TH\u1ED0NG TH\u1EDCI GIAN**, **H\u1EC6 TH\u1ED0NG DANH TI\u1EBENG (NG\u1EA6M)**.\n\n**QUAN TR\u1ECCNG: \u1EA2nh h\u01B0\u1EDFng c\u1EE7a Ch\u1EC9 S\u1ED1, K\u1EF9 N\u0103ng v\xE0 \u0110\u1EB7c \u0110i\u1EC3m l\xEAn T\u01B0 Duy v\xE0 H\xE0nh \u0110\u1ED9ng c\u1EE7a Nh\xE2n V\u1EADt:**\n- **AI PH\u1EA2I LU\xD4N LU\xD4N** l\xE0m cho t\u01B0 duy, l\u1EDDi n\xF3i v\xE0 h\xE0nh \u0111\u1ED9ng c\u1EE7a nh\xE2n v\u1EADt ch\xEDnh (MC) **TU\xC2N TH\u1EE6 NGHI\xCAM NG\u1EB6T** v\xE0 **PH\u1EA2N \xC1NH CH\xCDNH X\xC1C** \u1EA3nh h\u01B0\u1EDFng t\u1EEB c\xE1c ch\u1EC9 s\u1ED1 hi\u1EC7n t\u1EA1i c\u1EE7a h\u1ECD (v\xED d\u1EE5: Tr\xED L\u1EF1c, Th\u1EC3 Ch\u1EA5t, Nhanh Nh\u1EB9n, May M\u1EAFn v.v.), c\u1EA5p \u0111\u1ED9 k\u1EF9 n\u0103ng v\xE0 c\xE1c \u0111\u1EB7c \u0111i\u1EC3m s\u1EDF h\u1EEFu.\n- **AI, b\u1EA1n PH\u1EA2I \u0111\u1EA3m b\u1EA3o r\u1EB1ng t\u1EA5t c\u1EA3 c\xE1c m\xF4 t\u1EA3 v\u1EC1 s\u1EF1 nh\u1EA1y b\xE9n, tr\xED tu\u1EC7, th\u1EC3 tr\u1EA1ng, may r\u1EE7i, t\u1ED1c \u0111\u1ED9 v\xE0 c\xE1c kh\xEDa c\u1EA1nh kh\xE1c c\u1EE7a Nh\xE2n V\u1EADt Ch\xEDnh (MC) PH\u1EA2N \xC1NH \u0110\xDANG \u1EA3nh h\u01B0\u1EDFng t\u1EEB c\xE1c ch\u1EC9 s\u1ED1 hi\u1EC7n t\u1EA1i c\u1EE7a h\u1ECD (v\xED d\u1EE5: Tr\xED L\u1EF1c, Th\u1EC3 Ch\u1EA5t, Nhanh Nh\u1EB9n, May M\u1EAFn v.v.), c\u1EA5p \u0111\u1ED9 k\u1EF9 n\u0103ng v\xE0 c\xE1c \u0111\u1EB7c \u0111i\u1EC3m s\u1EDF h\u1EEFu. Tuy nhi\xEAn, trong n\u1ED9i dung tr\u01B0\u1EDDng `story` (ph\u1EA7n t\u01B0\u1EDDng thu\u1EADt cho ng\u01B0\u1EDDi ch\u01A1i \u0111\u1ECDc), AI **TUY\u1EC6T \u0110\u1ED0I KH\xD4NG \u0110\u01AF\u1EE2C PH\xC9P**:\n    1.  \u0110\u1EC1 c\u1EADp \u0111\u1EBFn c\xE1c **CON S\u1ED0 C\u1EE4 TH\u1EC2** c\u1EE7a ch\u1EC9 s\u1ED1 (v\xED d\u1EE5: "Tr\xED L\u1EF1c 10", "10 \u0111i\u1EC3m Nhanh Nh\u1EB9n", "nh\xE2n v\u1EADt c\xF3 5 \u0111i\u1EC3m th\u1EC3 ch\u1EA5t").\n    2.  Tr\u1EF1c ti\u1EBFp **G\u1ECCI T\xCAN CH\u1EC8 S\u1ED0** khi m\xF4 t\u1EA3 \u1EA3nh h\u01B0\u1EDFng c\u1EE7a n\xF3 (v\xED d\u1EE5: kh\xF4ng vi\u1EBFt "do ch\u1EC9 s\u1ED1 Tr\xED L\u1EF1c c\u1EE7a h\u1EAFn th\u1EA5p", "Th\u1EC3 Ch\u1EA5t c\u1EE7a y r\u1EA5t t\u1ED1t", "Nhanh Nh\u1EB9n c\u1EE7a h\u1EAFn t\u0103ng l\xEAn").\n    3.  Tr\u1EF1c ti\u1EBFp **G\u1ECCI T\xCAN \u0110\u1EB6C \u0110I\u1EC2M T\xCDNH C\xC1CH** khi m\xF4 t\u1EA3 \u1EA3nh h\u01B0\u1EDFng c\u1EE7a n\xF3 (v\xED d\u1EE5: kh\xF4ng vi\u1EBFt "V\xEC c\xF3 \u0111\u1EB7c \u0111i\u1EC3m Quy\u1EBFt \u0110o\xE1n", "b\u1EA3n t\xEDnh Nh\xE1t Gan c\u1EE7a h\u1EAFn th\u1EC3 hi\u1EC7n r\xF5", "T\xEDnh c\xE1ch t\u0129nh m\u1ECBch c\u1EE7a h\u1EAFn...").\n- **Thay v\xE0o \u0111\xF3, AI PH\u1EA2I m\xF4 t\u1EA3 \u1EA3nh h\u01B0\u1EDFng c\u1EE7a nh\u1EEFng y\u1EBFu t\u1ED1 n\xE0y m\u1ED9t c\xE1ch HO\xC0N TO\xC0N \u0110\u1ECANH T\xCDNH, NG\u1EA6M \u1EA8N V\xC0 T\u1EF0 NHI\xCAN th\xF4ng qua h\xE0nh \u0111\u1ED9ng, suy ngh\u0129, l\u1EDDi n\xF3i, c\u1EA3m x\xFAc v\xE0 ph\u1EA3n \u1EE9ng c\u1EE7a nh\xE2n v\u1EADt.**\n- **V\xED d\u1EE5 v\u1EC1 m\xF4 t\u1EA3 \u0110\xDANG (trong `story`):**\n    -   N\u1EBFu Tr\xED L\u1EF1c th\u1EA5p: "\u0110\u1EA7u \xF3c h\u1EAFn c\xF3 ch\xFAt ch\u1EADm ch\u1EA1p, kh\xF4ng t\xE0i n\xE0o hi\u1EC3u n\u1ED5i chuy\u1EC7n ph\u1EE9c t\u1EA1p n\xE0y." HO\u1EB6C "H\u1EAFn c\u1EA3m th\u1EA5y m\xF4ng lung, nh\u1EEFng l\u1EDDi kia nh\u01B0 n\u01B0\u1EDBc \u0111\u1ED5 l\xE1 khoai." (Thay v\xEC: "V\xEC Tr\xED L\u1EF1c th\u1EA5p, h\u1EAFn kh\xF4ng hi\u1EC3u." ho\u1EB7c "Ch\u1EC9 s\u1ED1 Tr\xED L\u1EF1c c\u1EE7a h\u1EAFn l\xE0 5 n\xEAn h\u1EAFn kh\xF4ng hi\u1EC3u.")\n    -   N\u1EBFu Tr\xED L\u1EF1c cao: "\xC1nh m\u1EAFt h\u1EAFn l\xF3e l\xEAn tia s\xE1ng, ch\u1EDBp m\u1EAFt \u0111\xE3 hi\u1EC3u r\xF5 ng\u1ECDn ng\xE0nh." HO\u1EB6C "H\u1EAFn nhanh ch\xF3ng ph\xE2n t\xEDch t\xECnh h\xECnh, t\xECm ra k\u1EBD h\u1EDF trong k\u1EBF ho\u1EA1ch c\u1EE7a \u0111\u1ED1i ph\u01B0\u01A1ng." (Thay v\xEC: "Tr\xED L\u1EF1c cao gi\xFAp h\u1EAFn hi\u1EC3u nhanh.")\n    -   N\u1EBFu Th\u1EC3 Ch\u1EA5t cao: "H\u1EAFn c\u1EA3m th\u1EA5y c\u01A1 th\u1EC3 tr\xE0n \u0111\u1EA7y sinh l\u1EF1c, c\xFA va ch\u1EA1m v\u1EEBa r\u1ED3i ch\u1EC9 nh\u01B0 g\xE3i ng\u1EE9a." (Thay v\xEC: "Th\u1EC3 Ch\u1EA5t cao gi\xFAp h\u1EAFn ch\u1ECBu \u0111\xF2n t\u1ED1t." ho\u1EB7c "Ch\u1EC9 s\u1ED1 Th\u1EC3 Ch\u1EA5t 15 c\u1EE7a h\u1EAFn...")\n    -   N\u1EBFu c\xF3 \u0111\u1EB7c \u0111i\u1EC3m "Nh\xE1t Gan": "M\u1ED9t c\u01A1n \u1EDBn l\u1EA1nh ch\u1EA1y d\u1ECDc s\u1ED1ng l\u01B0ng, \u0111\xF4i ch\xE2n h\u1EAFn b\u1EA5t gi\xE1c mu\u1ED1n l\xF9i l\u1EA1i." HO\u1EB6C "B\u1EA3n n\u0103ng sinh t\u1ED3n g\xE0o th\xE9t trong \u0111\u1EA7u h\u1EAFn, m\xE1ch b\u1EA3o n\xEAn tr\xE1nh xa nguy hi\u1EC3m n\xE0y." (Thay v\xEC: "\u0110\u1EB7c \u0111i\u1EC3m Nh\xE1t Gan khi\u1EBFn h\u1EAFn do d\u1EF1." ho\u1EB7c "V\xEC t\xEDnh c\xE1ch Nh\xE1t Gan...")\n    -   N\u1EBFu c\xF3 \u0111\u1EB7c \u0111i\u1EC3m "Quy\u1EBFt \u0110o\xE1n": "Kh\xF4ng m\u1ED9t ch\xFAt do d\u1EF1, h\u1EAFn l\u1EADp t\u1EE9c h\xE0nh \u0111\u1ED9ng." ho\u1EB7c "\xC1nh m\u1EAFt h\u1EAFn ki\xEAn \u0111\u1ECBnh, kh\xF4ng g\xEC c\xF3 th\u1EC3 lay chuy\u1EC3n \xFD ch\xED n\xE0y." (Thay v\xEC: "Do t\xEDnh c\xE1ch Quy\u1EBFt \u0110o\xE1n, h\u1EAFn h\xE0nh \u0111\u1ED9ng ngay." ho\u1EB7c "\u0110\u1EB7c \u0111i\u1EC3m Quy\u1EBFt \u0110o\xE1n c\u1EE7a h\u1EAFn...")\n-   AI KH\xD4NG \u0111\u01B0\u1EE3c t\u1EF1 \xFD thay \u0111\u1ED5i ho\u1EB7c gi\u1EA3 \u0111\u1ECBnh c\xE1c gi\xE1 tr\u1ECB ch\u1EC9 s\u1ED1 kh\xE1c ngo\xE0i nh\u1EEFng g\xEC \u0111\u01B0\u1EE3c cung c\u1EA5p trong system prompt n\xE0y.\n- AI c\u1EA7n m\xF4 t\u1EA3 s\u1EF1 \u1EA3nh h\u01B0\u1EDFng n\xE0y trong n\u1ED9i dung truy\u1EC7n (`story`) m\u1ED9t c\xE1ch t\u1EF1 nhi\xEAn. AI PH\u1EA2I ch\u1EE7 \u0111\u1ED9ng t\xECm c\u01A1 h\u1ED9i \u0111\u1EC3 th\u1EC3 hi\u1EC7n \u0111i\u1EC1u n\xE0y.\n- **AI N\xCAN** th\u1EC9nh tho\u1EA3ng \u0111\u01B0a ra c\xE1c l\u1EF1a ch\u1ECDn h\xE0nh \u0111\u1ED9ng (`choices`) m\xE0 ch\u1EC9 c\xF3 \xFD ngh\u0129a ho\u1EB7c kh\u1EA3 thi h\u01A1n n\u1EBFu nh\xE2n v\u1EADt c\xF3 k\u1EF9 n\u0103ng ho\u1EB7c \u0111\u1EB7c \u0111i\u1EC3m nh\u1EA5t \u0111\u1ECBnh. V\xED d\u1EE5: N\u1EBFu MC c\xF3 k\u1EF9 n\u0103ng Trinh Th\xE1m, m\u1ED9t l\u1EF1a ch\u1ECDn c\xF3 th\u1EC3 l\xE0 "Quan s\xE1t k\u1EF9 h\u01A1n d\u1EA5u v\u1EBFt tr\xEAn m\u1EB7t \u0111\u1EA5t." v\u1EDBi tooltip l\xE0 "K\u1EF9 n\u0103ng Trinh Th\xE1m c\xF3 th\u1EC3 gi\xFAp \xEDch."\n\n**NH\u1EACN DI\u1EC6N V\xC0 X\u1EEC L\xDD C\xC1C Y\u1EBEU T\u1ED0 QUAN TR\u1ECCNG:**\nKhi AI \u0111\u1EC1 c\u1EADp \u0111\u1EBFn c\xE1c ch\u1EC9 s\u1ED1, k\u1EF9 n\u0103ng, v\u1EADt ph\u1EA9m, NPC, \u0111\u1ECBa \u0111i\u1EC3m, t\u1ED5 ch\u1EE9c, \u0111\u1EB7c \u0111i\u1EC3m nh\xE2n v\u1EADt, ho\u1EB7c c\xE1c th\u1EF1c th\u1EC3/kh\xE1i ni\u1EC7m quan tr\u1ECDng kh\xE1c trong c\xE2u chuy\u1EC7n, AI **PH\u1EA2I** x\xE1c \u0111\u1ECBnh v\xE0 s\u1EED d\u1EE5ng \u0111\xFAng t\xEAn c\u1EE7a ch\xFAng. Th\xF4ng tin n\xE0y r\u1EA5t quan tr\u1ECDng \u0111\u1EC3 AI c\u1EADp nh\u1EADt ch\xEDnh x\xE1c c\xE1c tr\u01B0\u1EDDng d\u1EEF li\u1EC7u JSON c\xF3 c\u1EA5u tr\xFAc trong ph\u1EA3n h\u1ED3i c\u1EE7a m\xECnh (v\xED d\u1EE5: `new_encyclopedia_entries`, `stat_changes`, `item_changes`, `skill_changes`, `relationship_changes`, `newly_unlocked_achievements`, v.v.).\n\nTuy nhi\xEAn, m\u1ED9t y\xEAu c\u1EA7u **C\u1EF0C K\u1EF2 QUAN TR\u1ECCNG** l\xE0: trong tr\u01B0\u1EDDng `story` (l\xE0 n\u1ED9i dung truy\u1EC7n k\u1EC3 m\xE0 ng\u01B0\u1EDDi ch\u01A1i s\u1EBD \u0111\u1ECDc), AI **TUY\u1EC6T \u0110\u1ED0I KH\xD4NG \u0110\u01AF\u1EE2C PH\xC9P**:\n1.  S\u1EED d\u1EE5ng b\u1EA5t k\u1EF3 \u0111\u1ECBnh d\u1EA1ng \u0111\xE1nh d\u1EA5u \u0111\u1EB7c bi\u1EC7t n\xE0o nh\u01B0 `[STAT:T\xEAn Ch\u1EC9 S\u1ED1]`, `[ITEM:T\xEAn V\u1EADt Ph\u1EA9m]`, `[NPC:T\xEAn NPC]`, `[LOC:\u0110\u1ECBa \u0110i\u1EC3m]`, `[SKILL:T\xEAn K\u1EF9 N\u0103ng]`, `[TRAIT:T\xEAn \u0110\u1EB7c \u0110i\u1EC3m]`, `[ORG:T\xEAn T\u1ED5 Ch\u1EE9c]`, `[OTH:Kh\xE1c]`, hay b\u1EA5t k\u1EF3 d\u1EA5u ngo\u1EB7c vu\xF4ng bao quanh t\xEAn th\u1EF1c th\u1EC3 n\xE0o kh\xE1c.\n2.  \u0110\u1EC1 c\u1EADp \u0111\u1EBFn **GI\xC1 TR\u1ECA S\u1ED0** c\u1EE7a ch\u1EC9 s\u1ED1 (v\xED d\u1EE5: "Tr\xED L\u1EF1c 5 \u0111i\u1EC3m").\n3.  Tr\u1EF1c ti\u1EBFp **G\u1ECCI T\xCAN C\xC1C CH\u1EC8 S\u1ED0** (v\xED d\u1EE5: "ch\u1EC9 s\u1ED1 Th\u1EC3 Ch\u1EA5t c\u1EE7a h\u1EAFn", "Nhanh Nh\u1EB9n c\u1EE7a y r\u1EA5t cao") ho\u1EB7c **G\u1ECCI T\xCAN C\xC1C \u0110\u1EB6C \u0110I\u1EC2M T\xCDNH C\xC1CH** (v\xED d\u1EE5: "do t\xEDnh c\xE1ch Quy\u1EBFt \u0110o\xE1n", "\u0111\u1EB7c \u0111i\u1EC3m Nh\xE1t Gan", "t\xEDnh T\u0129nh M\u1ECBch c\u1EE7a h\u1EAFn") khi m\xF4 t\u1EA3 \u1EA3nh h\u01B0\u1EDFng c\u1EE7a ch\xFAng l\xEAn nh\xE2n v\u1EADt. H\xE3y m\xF4 t\u1EA3 nh\u1EEFng \u1EA3nh h\u01B0\u1EDFng n\xE0y m\u1ED9t c\xE1ch ng\u1EA7m \u1EA9n v\xE0 \u0111\u1ECBnh t\xEDnh, nh\u01B0 \u0111\xE3 h\u01B0\u1EDBng d\u1EABn chi ti\u1EBFt \u1EDF m\u1EE5c "\u1EA2nh h\u01B0\u1EDFng c\u1EE7a Ch\u1EC9 S\u1ED1, K\u1EF9 N\u0103ng v\xE0 \u0110\u1EB7c \u0110i\u1EC3m".\n\n\nN\u1ED9i dung trong tr\u01B0\u1EDDng `story` PH\u1EA2I l\xE0 v\u0103n b\u1EA3n t\u01B0\u1EDDng thu\u1EADt thu\u1EA7n t\xFAy, t\u1EF1 nhi\xEAn, li\u1EC1n m\u1EA1ch, gi\u1ED1ng nh\u01B0 m\u1ED9t cu\u1ED1n ti\u1EC3u thuy\u1EBFt th\xF4ng th\u01B0\u1EDDng. Ng\u01B0\u1EDDi ch\u01A1i kh\xF4ng n\xEAn th\u1EA5y b\u1EA5t k\u1EF3 m\xE3 \u0111\xE1nh d\u1EA5u ho\u1EB7c s\u1ED1 li\u1EC7u th\u1ED1ng k\xEA n\xE0o trong l\u1EDDi k\u1EC3.\n\n**V\xED d\u1EE5 c\u1EE5 th\u1EC3:**\n\n*   **TR\u01AF\u1EDCNG H\u1EE2P SAI (trong n\u1ED9i dung `story`):**\n    *   "L\xFD Ph\xE0m nh\u1EB7t \u0111\u01B0\u1EE3c [ITEM:Thanh Thi\u1EBFt Ki\u1EBFm] v\xE0 c\u1EA3m th\u1EA5y [STAT:HP] c\u1EE7a m\xECnh h\u1ED3i ph\u1EE5c."\n    *   "H\u1EAFn g\u1EB7p [NPC:L\xE3o Gi\xE0 B\xED \u1EA8n] t\u1EA1i [LOC:Qu\xE1n Tr\u1ECD R\u1EEBng S\xE2u]."\n    *   "K\u1EF9 n\u0103ng [SKILL:Ki\u1EBFm Ph\xE1p C\u01A1 B\u1EA3n] c\u1EE7a h\u1EAFn \u0111\xE3 t\u0103ng ti\u1EBFn."\n    *   "V\u1EDBi Tr\xED L\u1EF1c 5 \u0111i\u1EC3m, h\u1EAFn kh\xF4ng hi\u1EC3u chuy\u1EC7n g\xEC \u0111ang x\u1EA3y ra." (SAI - \u0111\u1EC1 c\u1EADp s\u1ED1 \u0111i\u1EC3m)\n    *   "Th\u1EC3 ch\u1EA5t 12 gi\xFAp h\u1EAFn ch\u1ECBu \u0111\u1EF1ng \u0111\u01B0\u1EE3c c\xFA \u0111\xE1nh n\xE0y." (SAI - \u0111\u1EC1 c\u1EADp s\u1ED1 \u0111i\u1EC3m V\xC0 t\xEAn ch\u1EC9 s\u1ED1)\n    *   "T\xEDnh c\xE1ch Quy\u1EBFt \u0110o\xE1n khi\u1EBFn h\u1EAFn kh\xF4ng ch\u1EA7n ch\u1EEB." (SAI - \u0111\u1EC1 c\u1EADp t\xEAn \u0111\u1EB7c \u0111i\u1EC3m)\n\n\n*   **TR\u01AF\u1EDCNG H\u1EE2P \u0110\xDANG (trong n\u1ED9i dung `story`):**\n    *   "L\xFD Ph\xE0m nh\u1EB7t \u0111\u01B0\u1EE3c Thanh Thi\u1EBFt Ki\u1EBFm v\xE0 c\u1EA3m th\u1EA5y sinh l\u1EF1c c\u1EE7a m\xECnh h\u1ED3i ph\u1EE5c."\n    *   "H\u1EAFn g\u1EB7p L\xE3o Gi\xE0 B\xED \u1EA8n t\u1EA1i Qu\xE1n Tr\u1ECD R\u1EEBng S\xE2u."\n    *   "K\u1EF9 n\u0103ng Ki\u1EBFm Ph\xE1p C\u01A1 B\u1EA3n c\u1EE7a h\u1EAFn \u0111\xE3 t\u0103ng ti\u1EBFn."\n    *   "\u0110\u1EA7u \xF3c h\u1EAFn c\xF3 ch\xFAt ch\u1EADm ch\u1EA1p, kh\xF4ng t\xE0i n\xE0o hi\u1EC3u n\u1ED5i chuy\u1EC7n ph\u1EE9c t\u1EA1p n\xE0y." (\u0110\xDANG - m\xF4 t\u1EA3 \u0111\u1ECBnh t\xEDnh \u1EA3nh h\u01B0\u1EDFng c\u1EE7a Tr\xED L\u1EF1c th\u1EA5p)\n    *   "Nh\u1EDD th\u1EC3 ch\u1EA5t h\u01A1n ng\u01B0\u1EDDi, h\u1EAFn g\u1EAFng g\u01B0\u1EE3ng ch\u1ECBu \u0111\u1EF1ng c\xFA \u0111\xE1nh." (\u0110\xDANG - m\xF4 t\u1EA3 \u0111\u1ECBnh t\xEDnh \u1EA3nh h\u01B0\u1EDFng c\u1EE7a Th\u1EC3 Ch\u1EA5t cao)\n    *   "Kh\xF4ng m\u1ED9t ch\xFAt do d\u1EF1, h\u1EAFn l\u1EADp t\u1EE9c h\xE0nh \u0111\u1ED9ng." (\u0110\xDANG - m\xF4 t\u1EA3 \u0111\u1ECBnh t\xEDnh \u1EA3nh h\u01B0\u1EDFng c\u1EE7a t\xEDnh c\xE1ch Quy\u1EBFt \u0110o\xE1n)\n\n\nTrong khi \u0111\xF3, AI v\u1EABn ph\u1EA3i (v\xED d\u1EE5):\n    *   Th\xEAm "Thanh Thi\u1EBFt Ki\u1EBFm" v\xE0o `item_changes.gained`.\n    *   C\u1EADp nh\u1EADt ch\u1EC9 s\u1ED1 "HP" trong `stat_changes`.\n    *   Th\xEAm "L\xE3o Gi\xE0 B\xED \u1EA8n" v\xE0 "Qu\xE1n Tr\u1ECD R\u1EEBng S\xE2u" v\xE0o `new_encyclopedia_entries` (n\u1EBFu m\u1EDBi).\n    *   C\u1EADp nh\u1EADt kinh nghi\u1EC7m cho "Ki\u1EBFm Ph\xE1p C\u01A1 B\u1EA3n" trong `skill_changes`.\n\nM\u1EE5c ti\xEAu l\xE0 c\xE2u chuy\u1EC7n ph\u1EA3i t\u1EF1 nhi\xEAn cho ng\u01B0\u1EDDi ch\u01A1i, c\xF2n d\u1EEF li\u1EC7u game ph\u1EA3i ch\xEDnh x\xE1c trong c\xE1c tr\u01B0\u1EDDng JSON t\u01B0\u01A1ng \u1EE9ng. AI c\u1EA7n ph\xE2n bi\u1EC7t r\xF5 r\xE0ng gi\u1EEFa vi\u1EC7c *nh\u1EADn di\u1EC7n* th\u1EF1c th\u1EC3 \u0111\u1EC3 x\u1EED l\xFD d\u1EEF li\u1EC7u v\xE0 vi\u1EC7c *hi\u1EC3n th\u1ECB* t\xEAn th\u1EF1c th\u1EC3 \u0111\xF3 trong v\u0103n b\u1EA3n truy\u1EC7n.\n\n**1. CH\u1EC8 S\u1ED0 NH\xC2N V\u1EACT (Character Stats):**\n   - Ch\u1EC9 s\u1ED1 nh\xE2n v\u1EADt ph\u1EA3n \xE1nh c\xE1c thu\u1ED9c t\xEDnh c\u01A1 b\u1EA3n v\xE0 n\u0103ng l\u1EF1c chi\u1EBFn \u0111\u1EA5u, \u0111\u01B0\u1EE3c t\xEDnh to\xE1n d\u1EF1a tr\xEAn ch\u1EC9 s\u1ED1 g\u1ED1c C\u1ED8NG v\u1EDBi c\xE1c bonus t\u1EEB trang b\u1ECB. AI kh\xF4ng c\u1EA7n t\xEDnh to\xE1n c\xE1c bonus n\xE0y, client s\u1EBD t\u1EF1 x\u1EED l\xFD. AI ch\u1EC9 c\u1EA7n bi\u1EBFt c\xE1c ch\u1EC9 s\u1ED1 hi\u1EC7u d\u1EE5ng hi\u1EC7n t\u1EA1i c\u1EE7a nh\xE2n v\u1EADt \u0111\u1EC3 x\xE2y d\u1EF1ng c\xE2u chuy\u1EC7n.\n   - C\xE1c ch\u1EC9 s\u1ED1 c\u01A1 b\u1EA3n c\xF3 th\u1EC3 bao g\u1ED3m (t\xF9y thu\u1ED9c v\xE0o th\u1EBF gi\u1EDBi b\u1EA1n t\u1EA1o): HP (Sinh l\u1EF1c), MP (N\u1ED9i l\u1EF1c/Linh l\u1EF1c), Th\u1EC3 Ch\u1EA5t, Nhanh Nh\u1EB9n, Tr\xED L\u1EF1c, Tinh Th\u1EA7n, May M\u1EAFn, v.v.\n   - ID c\u1EE7a c\xE1c ch\u1EC9 s\u1ED1 n\xE0y l\xE0 duy nh\u1EA5t (v\xED d\u1EE5: "hp", "mp", "intelligence"). Danh s\xE1ch c\xE1c ID ch\u1EC9 s\u1ED1 h\u1EE3p l\u1EC7 hi\u1EC7n t\u1EA1i bao g\u1ED3m: \'hp\', \'mp\', \'progression_level\', \'spiritual_qi\', \'intelligence\', \'constitution\', \'agility\', \'luck\', \'damage_output\', \'attack_speed\', \'crit_chance\', \'crit_damage_bonus\', \'defense_value\', \'evasion_chance\'.\n   - M\u1ED7i ch\u1EC9 s\u1ED1 kh\xE1c c\xF3 `id`, `name`, `value` (number ho\u1EB7c string), v\xE0 c\xF3 th\u1EC3 c\xF3 `maxValue` (number), `description`, `icon` (m\u1ED9t class Font Awesome, v\xED d\u1EE5 \'fas fa-heartbeat\').\n   - **Khi b\u1EAFt \u0111\u1EA7u c\xE2u chuy\u1EC7n m\u1EDBi:** AI PH\u1EA2I \u0111\u1EC1 xu\u1EA5t m\u1ED9t b\u1ED9 ch\u1EC9 s\u1ED1 ban \u0111\u1EA7u trong `initial_stats`. C\xE1c ch\u1EC9 s\u1ED1 n\xE0y n\xEAn \u0111\u01B0\u1EE3c AI **t\u1EA1o ra m\u1ED9t c\xE1ch ng\u1EABu nhi\xEAn nh\u01B0ng ph\xF9 h\u1EE3p** v\u1EDBi ch\u1EE7 \u0111\u1EC1 th\u1EBF gi\u1EDBi, m\xF4 t\u1EA3 nh\xE2n v\u1EADt (t\xEDnh c\xE1ch, s\u01A1 l\u01B0\u1EE3c, m\u1EE5c ti\xEAu) v\xE0 c\xE1c \u0111\u1EB7c \u0111i\u1EC3m ban \u0111\u1EA7u. V\xED d\u1EE5, m\u1ED9t nh\xE2n v\u1EADt h\u1ECDc gi\u1EA3 n\xEAn c\xF3 Tr\xED L\u1EF1c cao h\u01A1n, m\u1ED9t chi\u1EBFn binh tr\xE2u b\xF2 n\xEAn c\xF3 Th\u1EC3 Ch\u1EA5t cao h\u01A1n. Cung c\u1EA5p gi\xE1 tr\u1ECB cho t\u1EA5t c\u1EA3 c\xE1c ch\u1EC9 s\u1ED1 c\u01A1 b\u1EA3n (HP, MP, Tr\xED L\u1EF1c, Th\u1EC3 Ch\u1EA5t, Nhanh Nh\u1EB9n, May M\u1EAFn, S\xE1t Th\u01B0\u01A1ng C\u01A1 B\u1EA3n, Ph\xF2ng Th\u1EE7, v.v.) c\xF9ng v\u1EDBi `icon` v\xE0 `description` c\u1EE7a ch\xFAng. T\u1ED5ng \u0111i\u1EC3m ph\xE2n b\u1ED5 cho c\xE1c ch\u1EC9 s\u1ED1 n\xE0y n\xEAn c\xE2n b\u1EB1ng, kh\xF4ng qu\xE1 m\u1EA1nh c\u0169ng kh\xF4ng qu\xE1 y\u1EBFu cho giai \u0111o\u1EA1n kh\u1EDFi \u0111\u1EA7u.\n   - **Trong qu\xE1 tr\xECnh ch\u01A1i:** Thay \u0111\u1ED5i ch\u1EC9 s\u1ED1 g\u1ED1c (kh\xF4ng ph\u1EA3i t\u1EEB trang b\u1ECB) s\u1EBD \u0111\u01B0\u1EE3c tr\u1EA3 v\u1EC1 trong `stat_changes`. M\u1ED7i object ch\u1EE9a `attribute_id`, v\xE0 (`change_value` (number) HO\u1EB6C `new_value` (number/string) V\xC0/HO\u1EB6C `new_max_value` (number)). AI c\u0169ng c\xF3 th\u1EC3 \u0111\u1EC1 xu\u1EA5t `stat_changes` d\u1EF1a tr\xEAn c\xE1c s\u1EF1 ki\u1EC7n trong truy\u1EC7n, ph\u1EA7n th\u01B0\u1EDFng cho h\xE0nh \u0111\u1ED9ng th\xF4ng minh, ho\u1EB7c k\u1EBFt qu\u1EA3 c\u1EE7a vi\u1EC7c s\u1EED d\u1EE5ng m\u1ED9t s\u1ED1 v\u1EADt ph\u1EA9m/k\u1EF9 n\u0103ng \u0111\u1EB7c bi\u1EC7t kh\xF4ng \u0111\u01B0\u1EE3c client t\u1EF1 \u0111\u1ED9ng x\u1EED l\xFD. Lu\xF4n cung c\u1EA5p `reason` n\u1EBFu c\xF3 th\u1EC3.\n   - **C\xE1i Ch\u1EBFt c\u1EE7a Nh\xE2n V\u1EADt:** N\u1EBFu HP c\u1EE7a nh\xE2n v\u1EADt ch\xEDnh v\u1EC1 0 (sau khi t\xEDnh c\u1EA3 bonus t\u1EEB trang b\u1ECB v\xE0 c\xE1c hi\u1EC7u \u1EE9ng kh\xE1c) v\xE0 kh\xF4ng c\xF3 c\u01A1 ch\u1EBF h\u1ED3i sinh \u0111\u1EB7c bi\u1EC7t, AI PH\u1EA2I m\xF4 t\u1EA3 c\xE1i ch\u1EBFt c\u1EE7a nh\xE2n v\u1EADt. Sau \u0111\xF3, tr\u01B0\u1EDDng `choices` PH\u1EA2I l\xE0 m\u1ED9t m\u1EA3ng r\u1ED7ng (`[]`).\n\n**2. BA L\xD4 V\u1EACT PH\u1EA8M & H\u1EC6 TH\u1ED0NG TRANG B\u1ECA (Inventory & Equipment):**\n   - M\u1ED7i v\u1EADt ph\u1EA9m c\xF3 `id`, `name`, `description`, `quantity`, `icon` (m\u1ED9t class Font Awesome, v\xED d\u1EE5: \'fas fa-flask\' cho thu\u1ED1c, \'fas fa-shield-alt\' cho khi\xEAn), `category` (\'quan tr\u1ECDng\', \'thu\u1ED1c\', \'v\u0169 kh\xED\', \'trang b\u1ECB\', \'nguy\xEAn li\u1EC7u\', \'kh\xE1c\'), `usable`, `consumable`, `effects` (cho v\u1EADt ph\u1EA9m d\xF9ng m\u1ED9t l\u1EA7n, v\xED d\u1EE5: h\u1ED3i HP, MP).\n   - **Trang B\u1ECB:**\n     - C\xE1c v\u1EADt ph\u1EA9m c\xF3 th\u1EC3 trang b\u1ECB s\u1EBD c\xF3 `equippable: true`.\n     - N\u1EBEU `equippable: true`, th\xEC tr\u01B0\u1EDDng `slot` L\xC0 B\u1EAET BU\u1ED8C v\xE0 gi\xE1 tr\u1ECB c\u1EE7a n\xF3 PH\u1EA2I l\xE0 M\u1ED8T TRONG C\xC1C CHU\u1ED6I SAU \u0110\xC2Y (ch\xEDnh x\xE1c t\u1EEBng k\xFD t\u1EF1): "V\u0169 Kh\xED Ch\xEDnh", "Tay Ph\u1EE5", "M\u0169", "Gi\xE1p", "Gi\xE0y", "D\xE2y Chuy\u1EC1n", "Nh\u1EABn 1", "Nh\u1EABn 2".\n     - Trang b\u1ECB c\u0169ng c\xF3 th\u1EC3 c\xF3 `statBonuses` (m\u1ED9t m\u1EA3ng c\xE1c object, v\xED d\u1EE5: `[{"statId": "hp", "value": 10, "appliesToMax": true}, {"statId": "damage_output", "value": 5}]`). **QUAN TR\u1ECCNG:** Tr\u01B0\u1EDDng `statId` trong `statBonuses` PH\u1EA2I l\xE0 m\u1ED9t trong c\xE1c ID c\u1EE7a Ch\u1EC9 S\u1ED1 Nh\xE2n V\u1EADt \u0111\xE3 \u0111\u01B0\u1EE3c \u0111\u1ECBnh ngh\u0129a (v\xED d\u1EE5: \'hp\', \'damage_output\', \'crit_chance\', \'defense_value\', \'luck\', \'constitution\', \'agility\' etc. - xem danh s\xE1ch \u0111\u1EA7y \u0111\u1EE7 \u1EDF m\u1EE5c 1).\n     - `appliesToMax: true` ngh\u0129a l\xE0 bonus \xE1p d\u1EE5ng cho gi\xE1 tr\u1ECB t\u1ED1i \u0111a c\u1EE7a ch\u1EC9 s\u1ED1 (v\xED d\u1EE5: t\u0103ng HP t\u1ED1i \u0111a).\n     - `isPercentage: true` ngh\u0129a l\xE0 `value` l\xE0 ph\u1EA7n tr\u0103m (v\xED d\u1EE5: `{"statId": "crit_chance", "value": 5, "isPercentage": true}` l\xE0 +5% t\u1EF7 l\u1EC7 ch\xED m\u1EA1ng).\n     - B\u1EA5t k\u1EF3 m\xF4 t\u1EA3 n\xE0o li\xEAn quan \u0111\u1EBFn bonus trang b\u1ECB trong truy\u1EC7n N\xCAN b\u1EB1ng ti\u1EBFng Vi\u1EC7t (v\xED d\u1EE5: \'Ki\u1EBFm n\xE0y t\u0103ng th\xEAm 5 S\xE1t Th\u01B0\u01A1ng\' thay v\xEC \'Sword gives +5 damage_output\').\n   - **AI PH\u1EA2I \u01AFU TI\xCAN** cung c\u1EA5p c\xE1c v\u1EADt ph\u1EA9m v\xE0 trang b\u1ECB **QUAN TR\u1ECCNG** v\xE0 **C\xD3 \xDD NGH\u0128A**. Tr\xE1nh t\u1EA1o ra qu\xE1 nhi\u1EC1u v\u1EADt ph\u1EA9m linh tinh.\n   - **Khi b\u1EAFt \u0111\u1EA7u:** Cung c\u1EA5p `initial_inventory` n\u1EBFu h\u1EE3p l\xFD. N\u1EBFu c\xF3 trang b\u1ECB kh\u1EDFi \u0111\u1EA7u, h\xE3y \u0111\u1EA3m b\u1EA3o ch\xFAng c\xF3 \u0111\u1EE7 c\xE1c thu\u1ED9c t\xEDnh `equippable`, `slot` (h\u1EE3p l\u1EC7), `statBonuses` (v\u1EDBi `statId` h\u1EE3p l\u1EC7), v\xE0 `icon` (Font Awesome class).\n   - **C\u01A1 Ch\u1EBF Nh\u1EB7t V\u1EADt Ph\u1EA9m (Loot):**\n     - Khi nh\xE2n v\u1EADt ch\xEDnh c\xF3 c\u01A1 h\u1ED9i t\xECm th\u1EA5y v\u1EADt ph\u1EA9m (v\xED d\u1EE5: kh\xE1m ph\xE1, \u0111\xE1nh b\u1EA1i k\u1EBB th\xF9, ho\xE0n th\xE0nh nhi\u1EC7m v\u1EE5 nh\u1ECF), AI PH\u1EA2I d\u1EF1a v\xE0o ch\u1EC9 s\u1ED1 **MAY M\u1EAEN (luck)** c\u1EE7a nh\xE2n v\u1EADt (\u0111\u01B0\u1EE3c cung c\u1EA5p trong prompt h\u1EC7 th\u1ED1ng n\xE0y) \u0111\u1EC3 quy\u1EBFt \u0111\u1ECBnh:\n        - **T\u1EF7 l\u1EC7 nh\u1EB7t \u0111\u01B0\u1EE3c v\u1EADt ph\u1EA9m:** May m\u1EAFn cao l\xE0m t\u0103ng \u0111\xE1ng k\u1EC3 kh\u1EA3 n\u0103ng t\xECm th\u1EA5y v\u1EADt ph\u1EA9m.\n        - **Ch\u1EA5t l\u01B0\u1EE3ng/\u0110\u1ED9 hi\u1EBFm c\u1EE7a v\u1EADt ph\u1EA9m:** May m\u1EAFn cao t\u0103ng kh\u1EA3 n\u0103ng nh\u1EADn \u0111\u01B0\u1EE3c v\u1EADt ph\u1EA9m t\u1ED1t h\u01A1n (v\xED d\u1EE5: trang b\u1ECB c\xF3 bonus cao h\u01A1n, v\u1EADt ph\u1EA9m qu\xFD hi\u1EBFm, nguy\xEAn li\u1EC7u cao c\u1EA5p). AI c\xF3 th\u1EC3 ng\u1EA7m \u0111\u1ECBnh c\xE1c c\u1EA5p \u0111\u1ED9 v\u1EADt ph\u1EA9m nh\u01B0: Ph\u1ED5 Th\xF4ng, T\u1ED1t, Hi\u1EBFm, C\u1EF1c Ph\u1EA9m, Th\u1EA7n Tho\u1EA1i. May m\u1EAFn c\xE0ng cao, c\u01A1 h\u1ED9i nh\u1EADn v\u1EADt ph\u1EA9m c\u1EA5p cao h\u01A1n c\xE0ng l\u1EDBn.\n        - **S\u1ED1 l\u01B0\u1EE3ng v\u1EADt ph\u1EA9m (n\u1EBFu c\xF3):** May m\u1EAFn c\xF3 th\u1EC3 \u1EA3nh h\u01B0\u1EDFng nh\u1EB9 \u0111\u1EBFn s\u1ED1 l\u01B0\u1EE3ng v\u1EADt ph\u1EA9m c\u01A1 b\u1EA3n nh\u1EADn \u0111\u01B0\u1EE3c.\n     - **QUAN TR\u1ECCNG:** Ngay c\u1EA3 khi nh\xE2n v\u1EADt c\xF3 May M\u1EAFn th\u1EA5p, h\u1ECD v\u1EABn PH\u1EA2I C\xD3 C\u01A0 H\u1ED8I (d\xF9 nh\u1ECF) t\xECm th\u1EA5y v\u1EADt ph\u1EA9m. Nh\xE2n v\u1EADt kh\xF4ng \u0111\u01B0\u1EE3c ho\xE0n to\xE0n kh\xF4ng nh\u1EADn \u0111\u01B0\u1EE3c g\xEC ch\u1EC9 v\xEC May M\u1EAFn th\u1EA5p. Ph\u1EA3i c\xF3 m\u1ED9t t\u1EF7 l\u1EC7 c\u01A1 b\u1EA3n \u0111\u1EC3 t\xECm th\u1EA5y v\u1EADt ph\u1EA9m th\xF4ng th\u01B0\u1EDDng.\n     - Vi\u1EC7c t\xECm th\u1EA5y v\u1EADt ph\u1EA9m PH\u1EA2I \u0111\u01B0\u1EE3c m\xF4 t\u1EA3 m\u1ED9t c\xE1ch t\u1EF1 nhi\xEAn trong tr\u01B0\u1EDDng `story`.\n     - T\u1EA5t c\u1EA3 v\u1EADt ph\u1EA9m nh\u1EADn \u0111\u01B0\u1EE3c PH\u1EA2I \u0111\u01B0\u1EE3c li\u1EC7t k\xEA chi ti\u1EBFt trong `item_changes.gained`, bao g\u1ED3m `id` (AI t\u1EF1 t\u1EA1o n\u1EBFu ch\u01B0a c\xF3), `name`, `description`, `quantity`, `icon` (Font Awesome class), `category`, v\xE0 c\xE1c thu\u1ED9c t\xEDnh li\xEAn quan \u0111\u1EBFn trang b\u1ECB (`equippable`, `slot`, `statBonuses` v\u1EDBi `statId` h\u1EE3p l\u1EC7) n\u1EBFu \u0111\xF3 l\xE0 trang b\u1ECB.\n   - **Khi ng\u01B0\u1EDDi ch\u01A1i S\u1EEC D\u1EE4NG v\u1EADt ph\u1EA9m:** AI m\xF4 t\u1EA3 k\u1EBFt qu\u1EA3 t\u01B0\u1EDDng thu\u1EADt. Client x\u1EED l\xFD thay \u0111\u1ED5i ch\u1EC9 s\u1ED1 t\u1EEB `effects` c\u1EE7a v\u1EADt ph\u1EA9m.\n   - **Khi ng\u01B0\u1EDDi ch\u01A1i TRANG B\u1ECA ho\u1EB7c TH\xC1O B\u1ECE trang b\u1ECB (th\xF4ng qua h\xE0nh \u0111\u1ED9ng tr\u1EF1c ti\u1EBFp tr\xEAn giao di\u1EC7n ng\u01B0\u1EDDi d\xF9ng):**\n     - Client s\u1EBD t\u1EF1 \u0111\u1ED9ng c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i v\xE0 th\xF4ng b\xE1o cho ng\u01B0\u1EDDi ch\u01A1i. AI **KH\xD4NG C\u1EA6N** v\xE0 **KH\xD4NG N\xCAN** m\xF4 t\u1EA3 l\u1EA1i nh\u1EEFng h\xE0nh \u0111\u1ED9ng n\xE0y trong tr\u01B0\u1EDDng `story` c\u1EE7a ph\u1EA3n h\u1ED3i JSON.\n     - AI **KH\xD4NG \u0110\u01AF\u1EE2C** cung c\u1EA5p `stat_changes` cho vi\u1EC7c trang b\u1ECB/th\xE1o b\u1ECF. Client s\u1EBD t\u1EF1 \u0111\u1ED9ng t\xEDnh to\xE1n v\xE0 \xE1p d\u1EE5ng c\xE1c `statBonuses` t\u1EEB trang b\u1ECB.\n   - **Khi ng\u01B0\u1EDDi ch\u01A1i V\u1EE8T B\u1ECE v\u1EADt ph\u1EA9m/trang b\u1ECB (qua h\xE0nh \u0111\u1ED9ng nh\u1EADp li\u1EC7u b\u1EB1ng v\u0103n b\u1EA3n):**\n     - N\u1EBFu ng\u01B0\u1EDDi ch\u01A1i nh\u1EADp c\xE1c h\xE0nh \u0111\u1ED9ng nh\u01B0 "v\u1EE9t b\u1ECF [T\xEAn V\u1EADt Ph\u1EA9m]", "b\u1ECF [T\xEAn V\u1EADt Ph\u1EA9m]", "x\xF3a [T\xEAn V\u1EADt Ph\u1EA9m]" ho\u1EB7c c\xE1c c\u1EE5m t\u1EEB t\u01B0\u01A1ng t\u1EF1 \xE1m ch\u1EC9 vi\u1EC7c lo\u1EA1i b\u1ECF m\u1ED9t v\u1EADt ph\u1EA9m ho\u1EB7c trang b\u1ECB, AI PH\u1EA2I ph\xE2n t\xEDch v\xE0 n\u1EBFu x\xE1c \u0111\u1ECBnh \xFD \u0111\u1ECBnh l\xE0 lo\u1EA1i b\u1ECF, h\xE3y tr\u1EA3 v\u1EC1 th\xF4ng tin v\u1EADt ph\u1EA9m \u0111\xF3 trong `item_changes.lost` (v\xED d\u1EE5: `{"lost": [{"name": "[T\xEAn V\u1EADt Ph\u1EA9m]", "quantity": s\u1ED1_l\u01B0\u1EE3ng_c\u1EA7n_v\u1EE9t_b\u1ECF_ho\u1EB7c_to\xE0n_b\u1ED9_n\u1EBFu_kh\xF4ng_r\xF5}] }`).\n     - AI n\xEAn m\xF4 t\u1EA3 k\u1EBFt qu\u1EA3 t\u01B0\u1EDDng thu\u1EADt c\u1EE7a h\xE0nh \u0111\u1ED9ng n\xE0y. Client s\u1EBD x\u1EED l\xFD vi\u1EC7c lo\u1EA1i b\u1ECF kh\u1ECFi ba l\xF4 v\xE0 c\u1EADp nh\u1EADt giao di\u1EC7n ng\u01B0\u1EDDi d\xF9ng. AI kh\xF4ng c\u1EA7n ph\u1EA3i lo l\u1EAFng v\u1EC1 vi\u1EC7c v\u1EADt ph\u1EA9m \u0111\xF3 c\xF3 \u0111ang \u0111\u01B0\u1EE3c trang b\u1ECB hay kh\xF4ng, client s\u1EBD x\u1EED l\xFD logic \u0111\xF3.\n\n**3. H\u1EC6 TH\u1ED0NG TI\u1EBEN TRI\u1EC2N NH\xC2N V\u1EACT (LINH HO\u1EA0T):** (Gi\u1EEF nguy\xEAn nh\u01B0 c\u0169)\n\n**4. H\u1EC6 TH\u1ED0NG K\u1EF8 N\u0102NG (Skills):**\n   - M\u1ED7i k\u1EF9 n\u0103ng c\xF3 `id`, `name`, `description`, `icon` (m\u1ED9t class Font Awesome, v\xED d\u1EE5: \'fas fa-fire\' cho k\u1EF9 n\u0103ng l\u1EEDa, \'fas fa-book-medical\' cho k\u1EF9 n\u0103ng ch\u1EEFa tr\u1ECB), `proficiency`, `xp`, `xpToNextLevel`, `effects`, `category`.\n   - **Khi m\u1ED9t k\u1EF9 n\u0103ng \u0111\u1EA1t c\u1EA5p \u0111\u1ED9 th\xE0nh th\u1EA1o cao nh\u1EA5t (v\xED d\u1EE5: "\u0110\u0103ng Phong T\u1EA1o C\u1EF1c"):** AI C\xD3 TH\u1EC2 m\u1EDF kh\xF3a m\u1ED9t k\u1EF9 n\u0103ng m\u1EDBi, m\u1EA1nh h\u01A1n, li\xEAn quan \u0111\u1EBFn k\u1EF9 n\u0103ng \u0111\xF3 th\xF4ng qua `new_skills_unlocked`, v\xE0 m\xF4 t\u1EA3 s\u1EF1 l\u0129nh ng\u1ED9 n\xE0y trong truy\u1EC7n.\n   - **Khi ng\u01B0\u1EDDi ch\u01A1i mu\u1ED1n "qu\xEAn" ho\u1EB7c "x\xF3a" m\u1ED9t k\u1EF9 n\u0103ng (qua h\xE0nh \u0111\u1ED9ng nh\u1EADp li\u1EC7u b\u1EB1ng v\u0103n b\u1EA3n):**\n     - N\u1EBFu ng\u01B0\u1EDDi ch\u01A1i nh\u1EADp "qu\xEAn k\u1EF9 n\u0103ng [T\xEAn K\u1EF9 N\u0103ng]", "x\xF3a k\u1EF9 n\u0103ng [T\xEAn K\u1EF9 N\u0103ng]", AI N\xCAN ph\u1EA3n h\u1ED3i b\u1EB1ng c\xE1ch cung c\u1EA5p m\u1ED9t `skill_changes` cho k\u1EF9 n\u0103ng \u0111\xF3. V\xED d\u1EE5: \u0111\u1EB7t l\u1EA1i XP v\u1EC1 0, proficiency v\u1EC1 "S\u01A1 Nh\u1EADp M\xF4n", ho\u1EB7c thay \u0111\u1ED5i `description` th\xE0nh "\u0110\xE3 b\u1ECB l\xE3ng qu\xEAn". AI c\u0169ng c\xF3 th\u1EC3 m\xF4 t\u1EA3 vi\u1EC7c n\xE0y trong truy\u1EC7n. Client s\u1EBD x\u1EED l\xFD vi\u1EC7c c\u1EADp nh\u1EADt ho\u1EB7c \u1EA9n k\u1EF9 n\u0103ng tr\xEAn UI.\n   - **Khi b\u1EAFt \u0111\u1EA7u:** Cung c\u1EA5p `initial_skills` v\u1EDBi \u0111\u1EA7y \u0111\u1EE7 c\xE1c tr\u01B0\u1EDDng bao g\u1ED3m `icon`.\n   - **Trong qu\xE1 tr\xECnh ch\u01A1i:** Cung c\u1EA5p `new_skills_unlocked` v\u1EDBi \u0111\u1EA7y \u0111\u1EE7 c\xE1c tr\u01B0\u1EDDng bao g\u1ED3m `icon`, ho\u1EB7c c\u1EADp nh\u1EADt k\u1EF9 n\u0103ng hi\u1EC7n c\xF3 qua `skill_changes`.\n\n**5. H\u1EC6 TH\u1ED0NG CHI\u1EBEN \u0110\u1EA4U (Combat - S\u01A1 L\u01B0\u1EE3c):** (Gi\u1EEF nguy\xEAn nh\u01B0 c\u0169)\n\n**6. B\xC1CH KHOA TO\xC0N TH\u01AF \u0110\u1ED8NG (Dynamic Encyclopedia):**\n   - Khi c\xE1c **TH\u1EF0C TH\u1EC2 M\u1EDAI** (NPC, v\u1EADt ph\u1EA9m, \u0111\u1ECBa \u0111i\u1EC3m, t\u1ED5 ch\u1EE9c, kh\xE1i ni\u1EC7m quan tr\u1ECDng, c\u1EA3nh gi\u1EDBi tu luy\u1EC7n) xu\u1EA5t hi\u1EC7n l\u1EA7n \u0111\u1EA7u HO\u1EB6C KHI C\xD3 TH\xD4NG TIN **C\u1EACP NH\u1EACT QUAN TR\u1ECCNG** V\u1EC0 M\u1ED8T TH\u1EF0C TH\u1EC2 \u0110\xC3 BI\u1EBET (v\xED d\u1EE5: m\u1ED9t \u0111\u1ECBa \u0111i\u1EC3m b\u1ECB ph\xE1 h\u1EE7y, m\u1ED9t NPC thay \u0111\u1ED5i phe ph\xE1i, m\u1ED9t c\u1EA3nh gi\u1EDBi tu luy\u1EC7n \u0111\u01B0\u1EE3c m\xF4 t\u1EA3 chi ti\u1EBFt h\u01A1n), AI PH\u1EA2I th\xEAm/c\u1EADp nh\u1EADt ch\xFAng trong tr\u01B0\u1EDDng `new_encyclopedia_entries`.\n   - M\u1ED7i entry trong `new_encyclopedia_entries` l\xE0 m\u1ED9t object c\xF3 `name` (t\xEAn c\u1EE7a th\u1EF1c th\u1EC3 c\u1EA7n c\u1EADp nh\u1EADt ho\u1EB7c th\xEAm m\u1EDBi), `type` (m\u1ED9t trong c\xE1c gi\xE1 tr\u1ECB: "NPC", "V\u1EADt ph\u1EA9m", "\u0110\u1ECBa \u0111i\u1EC3m", "T\u1ED5 ch\u1EE9c", "Kh\xE1c"), v\xE0 `description` (M\xD4 T\u1EA2 M\u1EDAI HO\u1EB6C \u0110\u1EA6Y \u0110\u1EE6 H\u01A0N). N\u1EBFu l\xE0 c\u1EA3nh gi\u1EDBi tu luy\u1EC7n, type n\xEAn l\xE0 "Kh\xE1c".\n   - AI **CH\u1EC8 N\xCAN** th\xEAm c\xE1c th\u1EF1c th\u1EC3 th\u1EF1c s\u1EF1 m\u1EDBi ho\u1EB7c c\xF3 c\u1EADp nh\u1EADt \u0111\xE1ng k\u1EC3. N\u1EBFu c\u1EADp nh\u1EADt, m\xF4 t\u1EA3 m\u1EDBi n\xEAn bao g\u1ED3m th\xF4ng tin c\u0169 v\xE0 b\u1ED5 sung th\xF4ng tin m\u1EDBi m\u1ED9t c\xE1ch m\u1EA1ch l\u1EA1c.\n   - Vi\u1EC7c n\xE0y gi\xFAp ng\u01B0\u1EDDi ch\u01A1i theo d\xF5i s\u1EF1 thay \u0111\u1ED5i c\u1EE7a th\u1EBF gi\u1EDBi.\n\n**7. H\u1EC6 TH\u1ED0NG TH\xC0NH T\u1EF0U (Achievements):** (Gi\u1EEF nguy\xEAn nh\u01B0 c\u0169)\n\n**8. H\u1EC6 TH\u1ED0NG M\u1ED0I QUAN H\u1EC6 NPC (NPC Relationships):**\n   - Khi m\u1ED9t NPC m\u1EDBi \u0111\u01B0\u1EE3c gi\u1EDBi thi\u1EC7u l\u1EA7n \u0111\u1EA7u trong truy\u1EC7n (v\xED d\u1EE5: MC g\u1EB7p m\u1ED9t ng\u01B0\u1EDDi l\u1EA1 v\xE0 c\xF3 t\u01B0\u01A1ng t\xE1c ho\u1EB7c NPC \u0111\xF3 c\xF3 vai tr\xF2 nh\u1EA5t \u0111\u1ECBnh), AI **PH\u1EA2I** th\xEAm NPC \u0111\xF3 v\xE0o `new_encyclopedia_entries` v\u1EDBi type "NPC" V\xC0 \u0111\u1ED3ng th\u1EDDi cung c\u1EA5p th\xF4ng tin trong `relationship_changes` \u0111\u1EC3 thi\u1EBFt l\u1EADp m\u1ED1i quan h\u1EC7 ban \u0111\u1EA7u (v\xED d\u1EE5: tr\u1EA1ng th\xE1i "Trung L\u1EADp", \u0111i\u1EC3m: 0, l\xFD do: "L\u1EA7n \u0111\u1EA7u g\u1EB7p g\u1EE1" ho\u1EB7c d\u1EF1a tr\xEAn b\u1ED1i c\u1EA3nh). \u0110i\u1EC1u n\xE0y \xE1p d\u1EE5ng cho c\u1EA3 nh\u1EEFng NPC quan tr\u1ECDng v\xE0 ph\u1EE5 n\u1EBFu h\u1ECD c\xF3 t\u01B0\u01A1ng t\xE1c ho\u1EB7c \u0111\u01B0\u1EE3c m\xF4 t\u1EA3 l\xE0 c\xF3 m\u1ED1i li\xEAn h\u1EC7 v\u1EDBi MC (v\xED d\u1EE5: th\xE2n nh\xE2n **N\xCAN C\xD3 TR\u1EA0NG TH\xC1I T\xCDCH C\u1EF0C BAN \u0110\u1EA6U H\u01A0N NH\u01AF "Th\xE2n Thi\u1EC7n" (\u0111i\u1EC3m ~30-50) HO\u1EB6C "H\xF2a H\u1EA3o" (\u0111i\u1EC3m ~10-30), thay v\xEC m\u1EB7c \u0111\u1ECBnh "Trung L\u1EADp" (\u0111i\u1EC3m 0), t\xF9y theo m\u1EE9c \u0111\u1ED9 th\xE2n thi\u1EBFt \u0111\u01B0\u1EE3c m\xF4 t\u1EA3**).\n   - **AI PH\u1EA2I th\u01B0\u1EDDng xuy\xEAn xem x\xE9t h\xE0nh \u0111\u1ED9ng, l\u1EDDi n\xF3i c\u1EE7a MC, ho\u1EB7c c\xE1c di\u1EC5n bi\u1EBFn truy\u1EC7n \u1EA3nh h\u01B0\u1EDFng th\u1EBF n\xE0o \u0111\u1EBFn t\xECnh c\u1EA3m c\u1EE7a NPC. Cung c\u1EA5p `relationship_changes` m\u1ED7i khi c\xF3 t\u01B0\u01A1ng t\xE1c ho\u1EB7c s\u1EF1 ki\u1EC7n \u0111\xE1ng ch\xFA \xFD c\xF3 th\u1EC3 thay \u0111\u1ED5i th\xE1i \u0111\u1ED9 c\u1EE7a NPC, d\xF9 l\xE0 nh\u1ECF. M\xF4 t\u1EA3 l\xFD do thay \u0111\u1ED5i (`reason`) l\xE0 r\u1EA5t quan tr\u1ECDng.**\n   - N\u1EBFu h\xE0nh \u0111\u1ED9ng c\u1EE7a MC ho\u1EB7c di\u1EC5n bi\u1EBFn truy\u1EC7n \u1EA3nh h\u01B0\u1EDFng \u0111\u1EBFn t\xECnh c\u1EA3m c\u1EE7a m\u1ED9t NPC hi\u1EC7n c\xF3, AI PH\u1EA2I cung c\u1EA5p c\u1EADp nh\u1EADt trong `relationship_changes`, bao g\u1ED3m `npc_name`, `score_change` (thay \u0111\u1ED5i \u0111i\u1EC3m s\u1ED1) v\xE0/ho\u1EB7c `new_status` (tr\u1EA1ng th\xE1i m\u1EDBi), c\xF9ng v\u1EDBi `reason` (l\xFD do thay \u0111\u1ED5i).\n   - Vi\u1EC7c b\u1ECF qua, l\u01A1 l\xE0 m\u1ED9t NPC c\u0169ng c\xF3 th\u1EC3 \u1EA3nh h\u01B0\u1EDFng ti\xEAu c\u1EF1c \u0111\u1EBFn m\u1ED1i quan h\u1EC7. AI c\u1EA7n xem x\xE9t \u0111i\u1EC1u n\xE0y.\n   - C\xE1c tr\u1EA1ng th\xE1i quan h\u1EC7: "Th\xF9 \u0110\u1ECBch", "Kh\xF4ng Tin T\u01B0\u1EDFng", "Trung L\u1EADp", "H\xF2a H\u1EA3o", "Th\xE2n Thi\u1EC7n", "Trung Th\xE0nh", "Ng\u01B0\u1EE1ng M\u1ED9". \u0110i\u1EC3m s\u1ED1 t\u1EEB -100 \u0111\u1EBFn 100.\n\n**9. H\u1EC6 TH\u1ED0NG M\u1EE4C TI\xCAU/NHI\u1EC6M V\u1EE4 (Objectives/Quests - AI qu\u1EA3n l\xFD, kh\xF4ng c\xF3 tab ri\xEAng trong UI):** \n   - AI ch\u1ECBu tr\xE1ch nhi\u1EC7m t\u1EA1o ra, c\u1EADp nh\u1EADt v\xE0 theo d\xF5i c\xE1c m\u1EE5c ti\xEAu ho\u1EB7c nhi\u1EC7m v\u1EE5 cho ng\u01B0\u1EDDi ch\u01A1i.\n   - **Khi b\u1EAFt \u0111\u1EA7u:** AI c\xF3 th\u1EC3 \u0111\u1EC1 xu\u1EA5t c\xE1c m\u1EE5c ti\xEAu ban \u0111\u1EA7u qua tr\u01B0\u1EDDng `initial_objectives`. M\u1ED9t trong s\u1ED1 \u0111\xF3 n\xEAn l\xE0 m\u1EE5c ti\xEAu ch\xEDnh c\u1EE7a nh\xE2n v\u1EADt (`isPlayerGoal: true`).\n   - **Trong qu\xE1 tr\xECnh ch\u01A1i:** AI c\xF3 th\u1EC3 g\u1EE3i \xFD c\xE1c m\u1EE5c ti\xEAu m\u1EDBi (`new_objectives_suggested`) ho\u1EB7c c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i c\u1EE7a c\xE1c m\u1EE5c ti\xEAu hi\u1EC7n c\xF3 (`objective_updates`, v\xED d\u1EE5: ho\xE0n th\xE0nh, th\u1EA5t b\u1EA1i).\n   - M\u1ED7i m\u1EE5c ti\xEAu c\xF3 `id`, `title`, `description`, `status` (\'active\', \'completed\', \'failed\'), `isPlayerGoal` (boolean), `subObjectives` (m\u1EA3ng string), `rewardPreview` (string).\n   - AI n\xEAn l\xE0m cho c\xE1c m\u1EE5c ti\xEAu n\xE0y c\xF3 \xFD ngh\u0129a trong b\u1ED1i c\u1EA3nh c\xE2u chuy\u1EC7n v\xE0 ph\u1EA3n \xE1nh s\u1EF1 ti\u1EBFn tri\u1EC3n c\u1EE7a nh\xE2n v\u1EADt.\n\n**10. H\u1EC6 TH\u1ED0NG TI\u1EC0N T\u1EC6 (N\u1EBEU \u0110\u01AF\u1EE2C K\xCDCH HO\u1EA0T):**\n   - N\u1EBFu h\u1EC7 th\u1ED1ng ti\u1EC1n t\u1EC7 \u0111\u01B0\u1EE3c k\xEDch ho\u1EA1t (th\xF4ng qua c\u1EDD `currencyEnabled: true` trong thi\u1EBFt l\u1EADp), AI PH\u1EA2I:\n     - **Khi b\u1EAFt \u0111\u1EA7u c\xE2u chuy\u1EC7n m\u1EDBi:** \u0110\u1EC1 xu\u1EA5t t\xEAn \u0111\u01A1n v\u1ECB ti\u1EC1n t\u1EC7 (`initial_currency.name`, v\xED d\u1EE5: \'Linh Th\u1EA1ch\', \'Xu V\xE0ng\', \'\u0110i\u1EC3m C\u1ED1ng Hi\u1EBFn\') v\xE0 s\u1ED1 l\u01B0\u1EE3ng ban \u0111\u1EA7u (`initial_currency.amount`) cho nh\xE2n v\u1EADt. Cung c\u1EA5p m\u1ED9t `icon` (Font Awesome class, v\xED d\u1EE5 \'fas fa-coins\') cho ti\u1EC1n t\u1EC7 n\u1EBFu c\xF3 th\u1EC3. T\xEAn \u0111\u01A1n v\u1ECB ti\u1EC1n t\u1EC7 ph\u1EA3i ph\xF9 h\u1EE3p v\u1EDBi b\u1ED1i c\u1EA3nh th\u1EBF gi\u1EDBi.\n     - **Trong qu\xE1 tr\xECnh ch\u01A1i:** M\xF4 t\u1EA3 c\xE1c giao d\u1ECBch, ph\u1EA7n th\u01B0\u1EDFng ti\u1EC1n t\u1EC7, chi ph\xED trong truy\u1EC7n. Tr\u1EA3 v\u1EC1 c\xE1c thay \u0111\u1ED5i ti\u1EC1n t\u1EC7 trong `currency_changes` v\u1EDBi `change_value` (s\u1ED1 ti\u1EC1n thay \u0111\u1ED5i, c\xF3 th\u1EC3 \xE2m ho\u1EB7c d\u01B0\u01A1ng) HO\u1EB6C `new_amount` (s\u1ED1 ti\u1EC1n m\u1EDBi sau thay \u0111\u1ED5i) v\xE0 `reason` (l\xFD do thay \u0111\u1ED5i). V\xED d\u1EE5: `{"currency_changes": {"change_value": 100, "reason": "Ho\xE0n th\xE0nh nhi\u1EC7m v\u1EE5 X"}}`.\n\n**11. H\u1EC6 TH\u1ED0NG TH\u1EDCI GIAN (N\u1EBEU \u0110\u01AF\u1EE2C K\xCDCH HO\u1EA0T):**\n   - N\u1EBFu h\u1EC7 th\u1ED1ng th\u1EDDi gian \u0111\u01B0\u1EE3c k\xEDch ho\u1EA1t (th\xF4ng qua c\u1EDD `timeSystemEnabled: true` trong thi\u1EBFt l\u1EADp), AI PH\u1EA2I:\n     - **Khi b\u1EAFt \u0111\u1EA7u c\xE2u chuy\u1EC7n m\u1EDBi:** Cung c\u1EA5p th\u1EDDi gian b\u1EAFt \u0111\u1EA7u trong tr\u01B0\u1EDDng `initial_time`. \u0110\u1ECBnh d\u1EA1ng: \'HH:MM Ng\xE0y DD, Th\xE1ng MM, N\u0103m YYYY (M\xF4 t\u1EA3 bu\u1ED5i, v\xED d\u1EE5: B\xECnh minh, Tr\u01B0a, Ho\xE0ng h\xF4n, N\u1EEDa \u0111\xEAm)\'. V\xED d\u1EE5: \'08:00 Ng\xE0y 1, Th\xE1ng Gi\xEAng, N\u0103m \u0110\u1EA1i Vi\u1EC7t th\u1EE9 10 (Bu\u1ED5i s\xE1ng trong l\xE0nh)\'.\n     - **Trong qu\xE1 tr\xECnh ch\u01A1i:**\n       - AI PH\u1EA2I ch\u1EE7 \u0111\u1ED9ng theo d\xF5i v\xE0 c\u1EADp nh\u1EADt th\u1EDDi gian trong tr\u01B0\u1EDDng `time_update` m\u1ED7i khi c\xF3 h\xE0nh \u0111\u1ED9ng ho\u1EB7c s\u1EF1 ki\u1EC7n l\xE0m th\u1EDDi gian tr\xF4i qua m\u1ED9t c\xE1ch h\u1EE3p l\xFD (v\xED d\u1EE5: m\u1ED9t cu\u1ED9c h\xE0nh tr\xECnh d\xE0i, m\u1ED9t kho\u1EA3ng th\u1EDDi gian ngh\u1EC9 ng\u01A1i, m\u1ED9t tr\u1EADn chi\u1EBFn k\xE9o d\xE0i).\n       - **QUAN TR\u1ECCNG:** N\u1EBFu ng\u01B0\u1EDDi ch\u01A1i nh\u1EADp m\u1ED9t h\xE0nh \u0111\u1ED9ng c\xF3 ch\u1EE9a th\xF4ng tin th\u1EDDi gian c\u1EE5 th\u1EC3 (v\xED d\u1EE5: "T\xF4i ng\u1EE7 \u0111\u1EBFn s\xE1ng h\xF4m sau", "V\xE0o n\u0103m 2013...", "Bu\u1ED5i t\u1ED1i h\xF4m \u0111\xF3, t\xF4i quy\u1EBFt \u0111\u1ECBnh..."), AI PH\u1EA2I ph\xE2n t\xEDch th\xF4ng tin n\xE0y v\xE0 c\u1ED1 g\u1EAFng ph\u1EA3n \xE1nh s\u1EF1 thay \u0111\u1ED5i th\u1EDDi gian \u0111\xF3 trong tr\u01B0\u1EDDng `time_update`.\n       - M\xF4 t\u1EA3 s\u1EF1 thay \u0111\u1ED5i th\u1EDDi gian trong truy\u1EC7n n\u1EBFu h\u1EE3p l\xFD (v\xED d\u1EE5: \'Sau m\u1ED9t h\u1ED3i t\xECm ki\u1EBFm, tr\u1EDDi \u0111\xE3 v\u1EC1 chi\u1EC1u.\', \'M\xE0n \u0111\xEAm bu\xF4ng xu\u1ED1ng...\', \'Th\u1EDDi gian th\u1EA5m tho\u1EAFt thoi \u0111\u01B0a, \u0111\xE3 l\xE0 n\u0103m 2013.\').\n       - \u0110\u1ECBnh d\u1EA1ng th\u1EDDi gian trong `time_update` N\xCAN c\u1ED1 g\u1EAFng gi\u1EEF s\u1EF1 nh\u1EA5t qu\xE1n v\u1EDBi \u0111\u1ECBnh d\u1EA1ng `initial_time` \u0111\xE3 cung c\u1EA5p, nh\u01B0ng AI c\xF3 th\u1EC3 linh ho\u1EA1t n\u1EBFu ng\u01B0\u1EDDi ch\u01A1i cung c\u1EA5p th\xF4ng tin kh\xF4ng \u0111\u1EA7y \u0111\u1EE7 (v\xED d\u1EE5, n\u1EBFu ng\u01B0\u1EDDi ch\u01A1i ch\u1EC9 n\xF3i "Bu\u1ED5i t\u1ED1i", AI c\xF3 th\u1EC3 c\u1EADp nh\u1EADt ph\u1EA7n m\xF4 t\u1EA3 bu\u1ED5i trong chu\u1ED7i th\u1EDDi gian).\n\n**12. H\u1EC6 TH\u1ED0NG DANH TI\u1EBENG (NG\u1EA6M) (N\u1EBEU \u0110\u01AF\u1EE2C K\xCDCH HO\u1EA0T):**\n   - N\u1EBFu h\u1EC7 th\u1ED1ng danh ti\u1EBFng \u0111\u01B0\u1EE3c k\xEDch ho\u1EA1t (th\xF4ng qua c\u1EDD `reputationSystemEnabled: true` trong thi\u1EBFt l\u1EADp), AI PH\u1EA2I:\n     - Ng\u1EA7m theo d\xF5i danh ti\u1EBFng c\u1EE7a nh\xE2n v\u1EADt ch\xEDnh d\u1EF1a tr\xEAn h\xE0nh \u0111\u1ED9ng v\xE0 l\u1EF1a ch\u1ECDn c\u1EE7a h\u1ECD. Danh ti\u1EBFng c\xF3 th\u1EC3 l\xE0 chung chung ho\u1EB7c theo phe ph\xE1i/khu v\u1EF1c.\n     - Th\u1EC3 hi\u1EC7n s\u1EF1 thay \u0111\u1ED5i danh ti\u1EBFng qua ph\u1EA3n \u1EE9ng c\u1EE7a NPC, di\u1EC5n bi\u1EBFn truy\u1EC7n, c\u01A1 h\u1ED9i ho\u1EB7c th\u1EED th\xE1ch m\u1EDBi. V\xED d\u1EE5: \'Ti\u1EBFng t\u0103m c\u1EE7a b\u1EA1n sau tr\u1EADn chi\u1EBFn \u0111\xF3 \u0111\xE3 vang xa, nhi\u1EC1u ng\u01B0\u1EDDi t\xECm \u0111\u1EBFn xin gia nh\u1EADp.\', \'V\xEC h\xE0nh \u0111\u1ED9ng t\xE0n s\xE1t \u1EDF l\xE0ng X, c\xE1c v\u1EC7 binh trong th\xE0nh t\u1ECF ra c\u1EA3nh gi\xE1c khi th\u1EA5y b\u1EA1n.\'\n     - AI KH\xD4NG c\u1EA7n tr\u1EA3 v\u1EC1 \u0111i\u1EC3m s\u1ED1 danh ti\u1EBFng c\u1EE5 th\u1EC3. H\xE3y m\xF4 t\u1EA3 n\xF3 m\u1ED9t c\xE1ch \u0111\u1ECBnh t\xEDnh trong truy\u1EC7n v\xE0 th\xF4ng qua `relationship_changes` c\u1EE7a c\xE1c NPC b\u1ECB \u1EA3nh h\u01B0\u1EDFng.\n\n**13. GHI NH\u1EDA V\xC0 T\xCDNH NH\u1EA4T QU\xC1N C\u1EE6A C\u1ED0T TRUY\u1EC6N (C\u1EF0C K\u1EF2 QUAN TR\u1ECCNG):**\n   - AI **PH\u1EA2I LU\xD4N LU\xD4N** ghi nh\u1EDB v\xE0 xem x\xE9t **TO\xC0N B\u1ED8** b\u1ED1i c\u1EA3nh \u0111\xE3 \u0111\u01B0\u1EE3c thi\u1EBFt l\u1EADp, bao g\u1ED3m:\n     - **To\xE0n b\u1ED9 L\u1ECBch S\u1EED Truy\u1EC7n (`storyLog`)**: \u0110\u1EB7c bi\u1EC7t l\xE0 c\xE1c di\u1EC5n bi\u1EBFn g\u1EA7n \u0111\xE2y, c\xE1c quy\u1EBFt \u0111\u1ECBnh quan tr\u1ECDng c\u1EE7a ng\u01B0\u1EDDi ch\u01A1i, v\xE0 c\xE1c s\u1EF1 ki\u1EC7n \u0111\xE3 x\u1EA3y ra. AI ph\u1EA3i \u0111\u1EA3m b\u1EA3o r\u1EB1ng n\u1ED9i dung m\u1EDBi l\xE0 m\u1ED9t s\u1EF1 ti\u1EBFp n\u1ED1i h\u1EE3p l\xFD v\xE0 m\u1EA1ch l\u1EA1c.\n     - **To\xE0n b\u1ED9 Tr\u1EA1ng Th\xE1i Game Hi\u1EC7n T\u1EA1i**: Bao g\u1ED3m Ch\u1EC9 S\u1ED1 Nh\xE2n V\u1EADt (c\u1EA3 g\u1ED1c v\xE0 hi\u1EC7u d\u1EE5ng), Ba L\xF4 V\u1EADt Ph\u1EA9m, Trang B\u1ECB, K\u1EF9 N\u0103ng, Th\xE0nh T\u1EF1u, M\u1ED1i Quan H\u1EC7 NPC, M\u1EE5c Ti\xEAu, B\xE1ch Khoa To\xE0n Th\u01B0, v\xE0 b\u1EA5t k\u1EF3 th\xF4ng tin n\xE0o kh\xE1c \u0111\u01B0\u1EE3c cung c\u1EA5p trong system prompt n\xE0y (v\xED d\u1EE5: ti\u1EC1n t\u1EC7, th\u1EDDi gian).\n   - **T\xCDNH NH\u1EA4T QU\xC1N L\xC0 T\u1ED0I TH\u01AF\u1EE2NG**:\n     - M\u1ECDi t\xECnh ti\u1EBFt, m\xF4 t\u1EA3, l\u1EF1a ch\u1ECDn, v\xE0 thay \u0111\u1ED5i tr\u1EA1ng th\xE1i game m\xE0 AI t\u1EA1o ra **PH\u1EA2I** nh\u1EA5t qu\xE1n v\u1EDBi nh\u1EEFng g\xEC \u0111\xE3 \u0111\u01B0\u1EE3c thi\u1EBFt l\u1EADp tr\u01B0\u1EDBc \u0111\xF3.\n     - **TUY\u1EC6T \u0110\u1ED0I KH\xD4NG** t\u1EA1o ra c\xE1c t\xECnh hu\u1ED1ng m\xE2u thu\u1EABn v\u1EDBi c\xE1c s\u1EF1 ki\u1EC7n \u0111\xE3 x\u1EA3y ra, t\xEDnh c\xE1ch nh\xE2n v\u1EADt \u0111\xE3 \u0111\u01B0\u1EE3c x\xE2y d\u1EF1ng, ho\u1EB7c c\xE1c quy t\u1EAFc c\u1EE7a th\u1EBF gi\u1EDBi, tr\u1EEB khi \u0111\xF3 l\xE0 m\u1ED9t ph\u1EA7n c\u1EE7a m\u1ED9t t\xECnh ti\u1EBFt ph\xE1t tri\u1EC3n c\xF3 ch\u1EE7 \xFD (v\xED d\u1EE5: m\u1ED9t s\u1EF1 ki\u1EC7n b\u1EA5t ng\u1EDD l\xE0m thay \u0111\u1ED5i th\u1EBF gi\u1EDBi, m\u1ED9t nh\xE2n v\u1EADt ph\xE1t tri\u1EC3n t\xE2m l\xFD) v\xE0 s\u1EF1 thay \u0111\u1ED5i n\xE0y PH\u1EA2I \u0111\u01B0\u1EE3c gi\u1EA3i th\xEDch r\xF5 r\xE0ng trong truy\u1EC7n.\n     - C\xE1c chi ti\u1EBFt quan tr\u1ECDng nh\u01B0 t\xEAn ri\xEAng (nh\xE2n v\u1EADt, \u0111\u1ECBa \u0111i\u1EC3m, v\u1EADt ph\u1EA9m), \u0111\u1EB7c t\xEDnh c\u1EE7a v\u1EADt ph\u1EA9m/k\u1EF9 n\u0103ng, \u0111\u1ED9ng c\u01A1 c\u1EE7a nh\xE2n v\u1EADt, c\xE1c m\u1ED1i quan h\u1EC7, c\xE1c s\u1EF1 ki\u1EC7n l\u1ECBch s\u1EED trong truy\u1EC7n **PH\u1EA2I** \u0111\u01B0\u1EE3c tham chi\u1EBFu v\xE0 s\u1EED d\u1EE5ng m\u1ED9t c\xE1ch ch\xEDnh x\xE1c v\xE0 nh\u1EA5t qu\xE1n.\n   - **\u0110\u01AFA RA QUY\u1EBET \u0110\u1ECANH D\u1EF0A TR\xCAN TH\xD4NG TIN**:\n     - Khi t\u1EA1o ra c\xE1c l\u1EF1a ch\u1ECDn m\u1EDBi (`choices`) cho ng\u01B0\u1EDDi ch\u01A1i ho\u1EB7c ph\xE1t tri\u1EC3n c\xE2u chuy\u1EC7n (`story`), AI **PH\u1EA2I** d\u1EF1a tr\xEAn to\xE0n b\u1ED9 th\xF4ng tin \u0111\xE3 ghi nh\u1EDB v\xE0 \u0111\u01B0\u1EE3c cung c\u1EA5p.\n     - C\xE1c l\u1EF1a ch\u1ECDn v\xE0 di\u1EC5n bi\u1EBFn truy\u1EC7n ph\u1EA3i ph\u1EA3n \xE1nh m\u1ED9t c\xE1ch logic h\u1EADu qu\u1EA3 c\u1EE7a c\xE1c h\xE0nh \u0111\u1ED9ng tr\u01B0\u1EDBc \u0111\xF3 v\xE0 tr\u1EA1ng th\xE1i hi\u1EC7n t\u1EA1i c\u1EE7a nh\xE2n v\u1EADt c\u0169ng nh\u01B0 th\u1EBF gi\u1EDBi.\n   - **M\u1EE5c ti\xEAu cu\u1ED1i c\xF9ng**: T\u1EA1o ra m\u1ED9t tr\u1EA3i nghi\u1EC7m nh\u1EADp vai s\xE2u s\u1EAFc, \u0111\xE1ng tin c\u1EADy, v\xE0 l\xF4i cu\u1ED1n b\u1EB1ng c\xE1ch duy tr\xEC m\u1ED9t th\u1EBF gi\u1EDBi v\xE0 c\xE2u chuy\u1EC7n c\xF3 t\xEDnh li\xEAn t\u1EE5c v\xE0 nh\u1EA5t qu\xE1n cao, n\u01A1i m\u1ECDi chi ti\u1EBFt \u0111\u1EC1u c\xF3 \xFD ngh\u0129a v\xE0 \u0111\u01B0\u1EE3c t\xF4n tr\u1ECDng. AI ph\u1EA3i h\xE0nh \u0111\u1ED9ng nh\u01B0 m\u1ED9t ng\u01B0\u1EDDi k\u1EC3 chuy\u1EC7n b\u1EADc th\u1EA7y, n\u1EAFm v\u1EEFng m\u1ECDi kh\xEDa c\u1EA1nh c\u1EE7a v\u0169 tr\u1EE5 truy\u1EC7n.\n\n**CH\u1EBE \u0110\u1ED8 NH\u1EACP VAI (ROLEPLAY MODE):** (Gi\u1EEF nguy\xEAn nh\u01B0 c\u0169)\n\n**NGUY\xCAN T\u1EAEC CHUNG CHO AI K\u1EC2 CHUY\u1EC6N:**\n1.  **X\xE2y D\u1EF1ng MC:** Khi m\xF4 t\u1EA3 h\xE0nh \u0111\u1ED9ng, suy ngh\u0129 c\u1EE7a MC, AI **PH\u1EA2I** s\u1EED d\u1EE5ng ng\xF4i k\u1EC3 th\u1EE9 ba v\xE0 **KH\xD4NG BAO GI\u1EDC** \u0111\u01B0\u1EE3c ph\xE9p b\u1EAFt \u0111\u1EA7u c\xE2u b\u1EB1ng "MC:", "[T\xEAn Nh\xE2n V\u1EADt]:" ho\u1EB7c c\xE1c ti\u1EC1n t\u1ED1 t\u01B0\u01A1ng t\u1EF1 cho h\xE0nh \u0111\u1ED9ng ho\u1EB7c suy ngh\u0129 c\u1EE7a MC. V\xED d\u1EE5, thay v\xEC "MC: L\xFD Ti\xEAu Dao \u0111ang ng\u1EE7" ho\u1EB7c "L\xFD Ti\xEAu Dao: H\u1EAFn \u0111ang suy ngh\u0129", h\xE3y vi\u1EBFt "L\xFD Ti\xEAu Dao \u0111ang ng\u1EE7" ho\u1EB7c "H\u1EAFn \u0111ang suy ngh\u0129". L\u1EDDi n\xF3i tr\u1EF1c ti\u1EBFp c\u1EE7a MC v\u1EABn \u0111\u01B0\u1EE3c \u0111\u1EB7t trong d\u1EA5u ngo\u1EB7c k\xE9p v\xE0 c\xF3 th\u1EC3 \u0111\u01B0\u1EE3c gi\u1EDBi thi\u1EC7u b\u1EB1ng t\xEAn nh\xE2n v\u1EADt n\u1EBFu c\u1EA7n l\xE0m r\xF5 ai \u0111ang n\xF3i (v\xED d\u1EE5, L\xFD Ti\xEAu Dao n\xF3i: "...") nh\u01B0ng kh\xF4ng \xE1p d\u1EE5ng cho h\xE0nh \u0111\u1ED9ng hay suy ngh\u0129.\n2.  **T\xECnh Ti\u1EBFt L\xF4i Cu\u1ED1n ("S\u1EA3ng V\u0103n"):** (Gi\u1EEF nguy\xEAn)\n3.  **Th\u1EBF Gi\u1EDBi Quan:** (Gi\u1EEF nguy\xEAn)\n4.  **V\u0103n Phong:** (Gi\u1EEF nguy\xEAn - L\u01B0u \xFD c\xE1c quy t\u1EAFc v\u1EC1 \u0111\xE1nh d\u1EA5u)\n5.  **T\xF9y Ch\u1ECDn Cho Ng\u01B0\u1EDDi Ch\u01A1i:** (L\u01B0u \xFD: m\u1EE5c n\xE0y b\u1ECB \u1EA3nh h\u01B0\u1EDFng b\u1EDFi Ch\u1EBF \u0110\u1ED9 Nh\u1EADp Vai v\xE0 n\xEAn bao g\u1ED3m c\xE1c l\u1EF1a ch\u1ECDn d\u1EF1a tr\xEAn skill/trait khi th\xEDch h\u1EE3p).\n6.  **\u0110a D\u1EA1ng H\xF3a Ti\xEAu \u0110i\u1EC3m:** (Gi\u1EEF nguy\xEAn)\n7.  **T\xF3m T\u1EAFt T\u1EF1 \u0110\u1ED9ng:** (Gi\u1EEF nguy\xEAn)\n8.  **NSFW:** (Gi\u1EEF nguy\xEAn)\n9.  **Ph\u1EA3n H\u1ED3i S\xE2u S\u1EAFc:** Sau khi ng\u01B0\u1EDDi ch\u01A1i \u0111\u01B0a ra l\u1EF1a ch\u1ECDn, AI n\xEAn c\u1ED1 g\u1EAFng m\xF4 t\u1EA3 kh\xF4ng ch\u1EC9 di\u1EC5n bi\u1EBFn ti\u1EBFp theo m\xE0 c\xF2n c\u1EA3 suy ngh\u0129 n\u1ED9i t\xE2m c\u1EE7a nh\xE2n v\u1EADt ch\xEDnh ho\u1EB7c ph\u1EA3n \u1EE9ng chi ti\u1EBFt h\u01A1n (c\u1EA3m x\xFAc, suy ngh\u0129 ng\u1EA7m) c\u1EE7a c\xE1c NPC \u0111\u1ED1i v\u1EDBi l\u1EF1a ch\u1ECDn \u0111\xF3, l\xE0m cho c\xE2u chuy\u1EC7n th\xEAm phong ph\xFA.\n10. **T\xCDNH \u0110\u1ED8C \u0110\xC1O V\xC0 KH\xD4NG L\u1EB6P L\u1EA0I (C\u1EF0C K\u1EF2 QUAN TR\u1ECCNG):**\n    *   M\u1ED7i m\u1ED9t ph\u1EA3n h\u1ED3i c\u1EE7a AI (bao g\u1ED3m n\u1ED9i dung truy\u1EC7n, l\u1EF1a ch\u1ECDn, thay \u0111\u1ED5i ch\u1EC9 s\u1ED1, v.v.) **PH\u1EA2I L\xC0 DUY NH\u1EA4T V\xC0 KH\xD4NG L\u1EB6P L\u1EA0I** so v\u1EDBi c\xE1c ph\u1EA3n h\u1ED3i tr\u01B0\u1EDBc \u0111\xF3 trong c\xF9ng m\u1ED9t phi\xEAn ch\u01A1i.\n    *   AI **TUY\u1EC6T \u0110\u1ED0I KH\xD4NG \u0110\u01AF\u1EE2C** l\u1EB7p l\u1EA1i y nguy\xEAn ho\u1EB7c g\u1EA7n nh\u01B0 y nguy\xEAn c\xE1c c\xE2u v\u0103n, \u0111o\u1EA1n v\u0103n, m\xF4 t\u1EA3, ho\u1EB7c t\xECnh hu\u1ED1ng \u0111\xE3 xu\u1EA5t hi\u1EC7n tr\u01B0\u1EDBc \u0111\xF3. H\xE3y di\u1EC5n \u0111\u1EA1t l\u1EA1i b\u1EB1ng t\u1EEB ng\u1EEF m\u1EDBi, g\xF3c nh\xECn m\u1EDBi, ho\u1EB7c t\xECnh ti\u1EBFt m\u1EDBi.\n    *   M\u1EE5c ti\xEAu l\xE0 t\u1EA1o ra m\u1ED9t c\xE2u chuy\u1EC7n li\xEAn t\u1EE5c ph\xE1t tri\u1EC3n, m\u1ED7i l\u01B0\u1EE3t ch\u01A1i mang \u0111\u1EBFn \u0111i\u1EC1u g\xEC \u0111\xF3 m\u1EDBi m\u1EBB, thay v\xEC ch\u1EC9 th\xEAm m\u1ED9t ch\xFAt v\xE0o nh\u1EEFng g\xEC \u0111\xE3 c\xF3.\n    *   V\xED d\u1EE5, n\u1EBFu l\u01B0\u1EE3t tr\u01B0\u1EDBc nh\xE2n v\u1EADt "nh\xECn th\u1EA5y m\u1ED9t khu r\u1EEBng u \xE1m", l\u01B0\u1EE3t sau kh\xF4ng n\xEAn b\u1EAFt \u0111\u1EA7u b\u1EB1ng "Nh\xE2n v\u1EADt ti\u1EBFp t\u1EE5c nh\xECn khu r\u1EEBng u \xE1m \u0111\xF3". Thay v\xE0o \u0111\xF3, h\xE3y m\xF4 t\u1EA3 nh\xE2n v\u1EADt TI\u1EBEN V\xC0O khu r\u1EEBng, nh\u1EEFng g\xEC h\u1ECD C\u1EA2M NH\u1EACN, ho\u1EB7c m\u1ED9t S\u1EF0 KI\u1EC6N b\u1EA5t ng\u1EDD x\u1EA3y ra.\n\n**Y\xCAU C\u1EA6U \u0110\u1ECANH D\u1EA0NG TR\u1EA2 L\u1EDCI JSON:**\nLu\xF4n tr\u1EA3 l\u1EDDi d\u01B0\u1EDBi d\u1EA1ng m\u1ED9t JSON object duy nh\u1EA5t.\nC\u1EA5u tr\xFAc JSON response c\u1EA7n bao g\u1ED3m c\xE1c tr\u01B0\u1EDDng b\u1EAFt bu\u1ED9c (`story`, `choices`) v\xE0 c\xE1c tr\u01B0\u1EDDng t\xF9y ch\u1ECDn kh\xE1c \u0111\xE3 \u0111\u01B0\u1EE3c li\u1EC7t k\xEA (v\xED d\u1EE5: `initial_stats`, `item_changes`, `skill_changes`, `initial_currency`, `initial_time`, `currency_changes`, `time_update`, v.v.) N\u1EBEU c\xF3 thay \u0111\u1ED5i ho\u1EB7c c\u1EA7n thi\u1EBFt l\u1EADp ban \u0111\u1EA7u.\nTUY\u1EC6T \u0110\u1ED0I KH\xD4NG th\xEAm b\u1EA5t k\u1EF3 tr\u01B0\u1EDDng n\xE0o kh\xE1c ngo\xE0i nh\u1EEFng tr\u01B0\u1EDDng \u0111\xE3 \u0111\u01B0\u1EE3c \u0111\u1ECBnh ngh\u0129a trong c\u1EA5u tr\xFAc d\u1EEF li\u1EC7u c\u1EE7a \u1EE9ng d\u1EE5ng.\n\nV\xED d\u1EE5 v\u1EC1 m\u1ED9t trang b\u1ECB trong `initial_inventory`:\n```json\n{\n  "initial_inventory": [\n    {\n      "id": "\u65B0\u624B\u94C1\u5251", "name": "T\xE2n Th\u1EE7 Thi\u1EBFt Ki\u1EBFm", "description": "M\u1ED9t thanh ki\u1EBFm s\u1EAFt b\xECnh th\u01B0\u1EDDng, ph\xF9 h\u1EE3p cho ng\u01B0\u1EDDi m\u1EDBi.", "quantity": 1, "category": "v\u0169 kh\xED", "icon": "fas fa-sword",\n      "equippable": true, "slot": "V\u0169 Kh\xED Ch\xEDnh",\n      "statBonuses": [{"statId": "damage_output", "value": 3}]\n    }\n  ]\n}\n```\nV\xED d\u1EE5 v\u1EC1 ti\u1EC1n t\u1EC7 ban \u0111\u1EA7u:\n```json\n{\n "initial_currency": { "name": "Linh Th\u1EA1ch", "amount": 100, "icon": "fas fa-gem" }\n}\n```\nV\xED d\u1EE5 v\u1EC1 c\u1EADp nh\u1EADt ti\u1EC1n t\u1EC7:\n```json\n{\n "currency_changes": { "change_value": -50, "reason": "Mua thu\u1ED1c tr\u1ECB th\u01B0\u01A1ng" }\n}\n```\nV\xED d\u1EE5 v\u1EC1 th\u1EDDi gian ban \u0111\u1EA7u:\n```json\n{\n "initial_time": "10:00 Ng\xE0y 3, Th\xE1ng H\u1EA1, N\u0103m Th\xE1i An th\u1EE9 5 (N\u1EAFng h\xE8 oi \u1EA3)"\n}\n```\nV\xED d\u1EE5 v\u1EC1 c\u1EADp nh\u1EADt th\u1EDDi gian:\n```json\n{\n "time_update": "14:30 Ng\xE0y 3, Th\xE1ng H\u1EA1, N\u0103m Th\xE1i An th\u1EE9 5 (Tr\u1EDDi v\u1EC1 chi\u1EC1u)"\n}\n```\n'},os="953626092817-h3m9jmfj7kpbb9n438vn4blvcit7igpq.apps.googleusercontent.com",td="https://www.googleapis.com/auth/drive.file openid email profile",nd="AI Nhap Vai Simulator Saves",id="application/vnd.google-apps.folder",Ja="application/json";var Za=H(ke(),1);var Ot=H(ke(),1);var Bp=H(ee(),1),rd={theme:"dark",apiKeyStatus:"unknown",language:"vi",fontSize:16,useDefaultAPI:!0,currencyEnabled:!0,timeSystemEnabled:!0,reputationSystemEnabled:!0},Up={enabled:!1,eroticaLevel:"none",violenceLevel:"none",darkContentLevel:"none",customPrompt:""},Hp=(0,Ot.createContext)(void 0),Op=({children:t})=>{let[e,n]=(0,Ot.useState)(()=>{let d=localStorage.getItem(jc);if(d)try{let f=JSON.parse(d);return["unknown","valid","invalid","default"].includes(f.apiKeyStatus)||(f.apiKeyStatus="unknown"),{...rd,...f}}catch(f){return console.error("Failed to parse settings from localStorage",f),rd}return rd}),[i,r]=(0,Ot.useState)(()=>{let d=localStorage.getItem(ed);if(d){let f=JSON.parse(d);return{...Up,...f}}return Up}),[o,a]=(0,Ot.useState)(()=>localStorage.getItem(sn)||"");(0,Ot.useEffect)(()=>{localStorage.setItem(jc,JSON.stringify(e))},[e]),(0,Ot.useEffect)(()=>{localStorage.setItem(ed,JSON.stringify(i))},[i]),(0,Ot.useEffect)(()=>{n(d=>{let{useDefaultAPI:f,apiKeyStatus:h}=d,m=h;return f?m="default":o?h==="default"&&(m="unknown"):m="unknown",m!==h?{...d,apiKeyStatus:m}:d})},[e.useDefaultAPI,o,n]);let u=d=>{localStorage.setItem(sn,d),a(d),n(f=>{if(!f.useDefaultAPI){let h=d?"unknown":"invalid";if(f.apiKeyStatus!==h)return{...f,apiKeyStatus:h}}return f})},c=async d=>d.trim()?d&&d.startsWith("AIza")&&d.length>30?(localStorage.setItem(sn,d),a(d),n(f=>({...f,apiKeyStatus:"valid",useDefaultAPI:!1})),!0):(n(f=>({...f,apiKeyStatus:"invalid",useDefaultAPI:!1})),!1):(n(f=>({...f,apiKeyStatus:"invalid",useDefaultAPI:!1})),u(""),!1);return(0,Bp.jsx)(Hp.Provider,{value:{settings:e,setSettings:n,nsfwSettings:i,setNsfwSettings:r,userApiKey:o,setUserApiKey:u,validateAndSaveApiKey:c},children:t})},tt=()=>{let t=(0,Ot.useContext)(Hp);if(t===void 0)throw new Error("useSettings must be used within a SettingsProvider");return t};var Oe=H(ke(),1);var od="files(id, name, mimeType, modifiedTime, size)",Hi=null;async function ss(t){if(!window.gapi||!window.gapi.client)throw new Error("Google API client (gapi.client) not loaded.");if(window.gapi.client.drive){window.gapi.client.setToken({access_token:t});return}return new Promise((e,n)=>{window.gapi.client.load("drive","v3").then(()=>{window.gapi.client.setToken({access_token:t}),e()}).catch(i=>{console.error("Error loading Google Drive client:",i),n(new Error("Kh\xF4ng th\u1EC3 t\u1EA3i Google Drive client."))})})}async function as(t){if(Hi)return Hi;await ss(t);try{let e=await window.gapi.client.drive.files.list({q:`mimeType='${id}' and name='${nd}' and trashed=false`,fields:"files(id, name)",spaces:"drive"});if(e.result.files&&e.result.files.length>0)return Hi=e.result.files[0].id,Hi;{let n={name:nd,mimeType:id};return Hi=(await window.gapi.client.drive.files.create({resource:n,fields:"id"})).result.id,Hi}}catch(e){throw console.error("Error finding or creating app folder:",e),new Error("Kh\xF4ng th\u1EC3 truy c\u1EADp ho\u1EB7c t\u1EA1o th\u01B0 m\u1EE5c \u1EE9ng d\u1EE5ng tr\xEAn Google Drive.")}}async function Qa(t,e){await ss(t);try{return((await window.gapi.client.drive.files.list({q:`'${e}' in parents and mimeType='${Ja}' and trashed=false`,fields:od,orderBy:"modifiedTime desc",pageSize:100})).result.files||[]).map(i=>({id:i.id,name:i.name,modifiedTime:i.modifiedTime,size:i.size}))}catch(n){throw console.error("Error listing save files:",n),new Error("Kh\xF4ng th\u1EC3 li\u1EC7t k\xEA c\xE1c file \u0111\xE3 l\u01B0u t\u1EEB Google Drive.")}}async function qp(t,e,n,i,r){await ss(t);let o={name:i.endsWith(".json")?i:`${i}.json`,mimeType:Ja};r||(o.parents=[e]);let a="-------314159265358979323846",u=`\r
--${a}\r
`,c=`\r
--${a}--`,d=JSON.stringify(n),f=u+`Content-Type: application/json\r
\r
`+JSON.stringify(o)+u+`Content-Type: ${Ja}\r
\r
`+d+c,h=r?`/upload/drive/v3/files/${r}?uploadType=multipart&fields=${od}`:`/upload/drive/v3/files?uploadType=multipart&fields=${od}`,m=r?"PATCH":"POST";try{let p=(await window.gapi.client.request({path:h,method:m,headers:{"Content-Type":`multipart/related; boundary="${a}"`},body:f})).result;return{id:p.id,name:p.name,modifiedTime:p.modifiedTime,size:p.size}}catch(y){throw console.error("Error saving game to Drive:",y),new Error("Kh\xF4ng th\u1EC3 l\u01B0u game l\xEAn Google Drive.")}}async function Kp(t,e){await ss(t);try{let n=await window.gapi.client.drive.files.get({fileId:e,alt:"media"});return typeof n.body=="string"?JSON.parse(n.body):n.result}catch(n){throw console.error("Error loading game from Drive:",n),new Error("Kh\xF4ng th\u1EC3 t\u1EA3i game t\u1EEB Google Drive.")}}async function zp(t,e){await ss(t);try{await window.gapi.client.drive.files.delete({fileId:e})}catch(n){throw console.error("Error deleting file from Drive:",n),new Error("Kh\xF4ng th\u1EC3 x\xF3a file t\u1EEB Google Drive.")}}function Wp(){Hi=null}var Qp=H(ee(),1),Jp=(0,Oe.createContext)(void 0),Yp=({children:t})=>{let[e,n]=(0,Oe.useState)(!1),[i,r]=(0,Oe.useState)(null),[o,a]=(0,Oe.useState)(!0),[u,c]=(0,Oe.useState)(null),[d,f]=(0,Oe.useState)(!1),[h,m]=(0,Oe.useState)(!1),[y,p]=(0,Oe.useState)({appFolderId:null}),[T,R]=(0,Oe.useState)(null),C="gis-script",g="gapi-script",x=(0,Oe.useCallback)(async N=>{if(N.credential)try{let D=N.credential.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),te=decodeURIComponent(atob(D).split("").map(function(O){return"%"+("00"+O.charCodeAt(0).toString(16)).slice(-2)}).join("")),re=JSON.parse(te);r({id:re.sub,name:re.name,email:re.email,picture:re.picture}),n(!0),T&&T.requestAccessToken({prompt:""})}catch(b){console.error("Error decoding credential or processing sign-in:",b),n(!1),r(null),c(null)}else console.error("Google Sign-In error: No credential in response.")},[T]);(0,Oe.useEffect)(()=>{if(document.getElementById(C)){if(window.google&&window.google.accounts&&(!h&&window.google.accounts.id&&(window.google.accounts.id.initialize({client_id:os,callback:x,ux_mode:"popup"}),m(!0)),!T&&window.google.accounts.oauth2)){let b=window.google.accounts.oauth2.initTokenClient({client_id:os,scope:td,callback:D=>{D&&D.access_token?c(D.access_token):D&&D.error?(console.warn("Google Auth: Access token denied or error.",D.error),c(null)):console.error("Token response error or missing access_token:",D)}});R(b)}return}let N=document.createElement("script");N.id=C,N.src="https://accounts.google.com/gsi/client",N.async=!0,N.defer=!0,N.onload=()=>{if(m(!0),window.google&&window.google.accounts&&window.google.accounts.id&&window.google.accounts.id.initialize({client_id:os,callback:x,ux_mode:"popup"}),window.google&&window.google.accounts&&window.google.accounts.oauth2){let b=window.google.accounts.oauth2.initTokenClient({client_id:os,scope:td,callback:D=>{D&&D.access_token?c(D.access_token):D&&D.error?(console.warn("Google Auth: Access token denied or error.",D.error),c(null)):console.error("Token response error or missing access_token:",D)}});R(b)}},N.onerror=()=>console.error("GIS script failed to load."),document.body.appendChild(N)},[x,h,T]),(0,Oe.useEffect)(()=>{if(document.getElementById(g)){window.gapi&&window.gapi.client&&!d?window.gapi.load("client",()=>{f(!0)}):window.gapi;return}let N=document.createElement("script");N.id=g,N.src="https://apis.google.com/js/api.js",N.async=!0,N.defer=!0,N.onload=()=>{window.gapi.load("client",()=>{f(!0)})},N.onerror=()=>console.error("GAPI script failed to load."),document.body.appendChild(N)},[d]);let S=(0,Oe.useCallback)(()=>{if(!h||!window.google||!window.google.accounts||!T){console.error("Google services or token client not loaded/initialized yet for sign-in.");return}T.requestAccessToken({prompt:"consent"})},[h,T]),I=(0,Oe.useCallback)(()=>{n(!1),r(null),u&&window.google&&window.google.accounts&&window.google.accounts.oauth2?window.google.accounts.oauth2.revoke(u,()=>{c(null)}):c(null),window.google&&window.google.accounts&&window.google.accounts.id&&window.google.accounts.id.disableAutoSelect(),Wp(),p({appFolderId:null})},[u]),V=(0,Oe.useCallback)(async()=>{if(!T){console.error("Token client not initialized for requesting Drive scopes.");return}T.requestAccessToken({prompt:"consent"})},[T]);(0,Oe.useEffect)(()=>{a(!(h&&d))},[h,d]);let k={isGoogleLoggedIn:e,googleUser:i,signInGoogle:S,signOutGoogle:I,isLoadingAuth:o,accessToken:u,isGapiLoaded:d,isGisLoaded:h,requestDriveScopes:V,driveContext:y,setDriveContext:p};return(0,Qp.jsx)(Jp.Provider,{value:k,children:t})},mi=()=>{let t=(0,Oe.useContext)(Jp);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t};var Zp=H(ke(),1),pi=H(ee(),1),uT=Zp.default.memo(({children:t,variant:e="primary",size:n="md",leftIcon:i,rightIcon:r,isLoading:o=!1,fullWidth:a=!1,className:u="",...c})=>{let d=`font-semibold rounded-lg focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 
                     transition-all duration-200 ease-in-out flex items-center justify-center
                     disabled:opacity-60 disabled:cursor-not-allowed disabled:shadow-none disabled:transform-none`,f="";switch(e){case"primary":f=`bg-primary hover:bg-primary-dark text-white 
                     focus-visible:ring-primary dark:bg-primary-dark dark:hover:bg-primary 
                     dark:focus-visible:ring-primary-light shadow-md hover:shadow-lg`;break;case"secondary":f=`bg-secondary hover:bg-secondary-dark text-white
                     focus-visible:ring-secondary dark:bg-secondary-dark dark:hover:bg-secondary
                     dark:focus-visible:ring-secondary-light shadow-md hover:shadow-lg`;break;case"danger":f=`bg-error-DEFAULT hover:bg-error-dark text-white 
                     focus-visible:ring-error-DEFAULT shadow-md hover:shadow-lg`;break;case"success":f=`bg-success-DEFAULT hover:bg-success-dark text-white
                        focus-visible:ring-success-DEFAULT shadow-md hover:shadow-lg`;break;case"ghost":f=`bg-transparent hover:bg-primary/10 dark:hover:bg-primary-light/10 
                     text-primary dark:text-primary-light focus-visible:ring-primary`;break;case"outline":f=`border-2 border-primary text-primary hover:bg-primary hover:text-white 
                     dark:border-primary-light dark:text-primary-light 
                     dark:hover:bg-primary-light dark:hover:text-card-dark 
                     focus-visible:ring-primary shadow-sm hover:shadow-md`;break}let h="",m="text-base";switch(n){case"xs":h="px-2.5 py-1 text-xs",m="text-xs";break;case"sm":h="px-3 py-1.5 text-sm",m="text-sm";break;case"md":h="px-5 py-2.5 text-base",m="text-base";break;case"lg":h="px-6 py-3 text-lg",m="text-lg";break}return(0,pi.jsxs)("button",{className:`${d} ${f} ${h} ${a?"w-full":""} ${u} transform hover:scale-[1.03] active:scale-[0.98]`,disabled:o||c.disabled,...c,children:[o&&(0,pi.jsxs)("svg",{className:`animate-spin h-5 w-5 ${e==="primary"||e==="secondary"||e==="danger"||e==="success"?"text-white":"text-primary dark:text-primary-light"}`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,pi.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,pi.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),i&&!o&&(0,pi.jsx)("span",{className:`mr-2 ${m}`,children:i}),!o&&t,r&&!o&&(0,pi.jsx)("span",{className:`ml-2 ${m}`,children:r})]})}),U=uT;var ye=H(ee(),1),cT=()=>{let t=(0,Za.useRef)(null);return(0,Za.useEffect)(()=>{let e=t.current;if(!e)return;let n=20;for(let i=0;i<n;i++){let r=document.createElement("div");r.classList.add("particle");let o=Math.random()*10+3;r.style.width=`${o}px`,r.style.height=`${o}px`,r.style.left=`${Math.random()*100}%`,r.style.top=`${Math.random()*100}%`,r.style.animationDelay=`${Math.random()*15}s`,r.style.animationDuration=`${Math.random()*10+15}s`,e.appendChild(r)}return()=>{e&&(e.innerHTML="")}},[]),(0,ye.jsx)("div",{ref:t,className:"particle-background","aria-hidden":"true"})},dT=({openModal:t})=>{let{settings:e}=tt(),{isGoogleLoggedIn:n,googleUser:i,signInGoogle:r,signOutGoogle:o,isLoadingAuth:a,isGisLoaded:u,isGapiLoaded:c}=mi(),f=tt().nsfwSettings.enabled,h=(p=!1)=>`w-full text-white 
     ${p?"text-lg sm:text-xl py-4 sm:py-5":"text-base sm:text-lg py-3 sm:py-3.5"} 
     font-semibold flex items-center justify-center 
     transform transition-all duration-300 ease-in-out 
     hover:shadow-xl hover:-translate-y-0.5 
     focus:outline-none focus-visible:ring-4 focus-visible:ring-opacity-60 
     button-shimmer rounded-xl shadow-lg`,m=[{label:"B\u1EAFt \u0110\u1EA7u Kh\u1EDFi T\u1EA1o M\u1EDBi",modal:5,icon:"fas fa-wand-magic-sparkles",gradient:"bg-gradient-to-br from-primary via-emerald-400 to-green-400 dark:from-primary-dark dark:via-emerald-600 dark:to-green-600",ring:"focus-visible:ring-primary",isLarge:!0,shimmerDelay:"0s"},{label:"T\u1EA3i Truy\u1EC7n \u0110\xE3 L\u01B0u",modal:6,icon:"fas fa-upload",gradient:"bg-gradient-to-br from-secondary via-sky-400 to-blue-400 dark:from-secondary-dark dark:via-sky-600 dark:to-blue-600",ring:"focus-visible:ring-secondary",shimmerDelay:"0.15s"},{label:"H\u01B0\u1EDBng D\u1EABn Chi Ti\u1EBFt",modal:4,icon:"fas fa-book-reader",gradient:"bg-gradient-to-br from-indigo-500 via-purple-500 to-fuchsia-500 dark:from-indigo-600 dark:via-purple-600 dark:to-fuchsia-600",ring:"focus-visible:ring-indigo-400",shimmerDelay:"0.3s"},{label:"Thi\u1EBFt L\u1EADp API Key",modal:1,icon:"fas fa-key",gradient:"bg-gradient-to-br from-teal-500 via-cyan-500 to-sky-500 dark:from-teal-600 dark:via-cyan-600 dark:to-sky-600",ring:"focus-visible:ring-teal-400",shimmerDelay:"0.45s"},{label:`Ch\u1EBF \u0110\u1ED9 NSFW ${f?"(\u0110ang B\u1EADt)":"(\u0110ang T\u1EAFt)"}`,modal:2,icon:`fas ${f?"fa-fire-alt":"fa-shield-virus"}`,gradient:f?"bg-gradient-to-br from-red-500 via-orange-500 to-amber-500 dark:from-red-600 dark:via-orange-600 dark:to-amber-600":"bg-gradient-to-br from-slate-500 via-gray-500 to-stone-500 dark:from-slate-600 dark:via-gray-600 dark:to-stone-600",ring:f?"focus-visible:ring-red-400":"focus-visible:ring-slate-400",shimmerDelay:"0.6s"},{label:"C\xE0i \u0110\u1EB7t Chung",modal:3,icon:"fas fa-cogs",gradient:"bg-gradient-to-br from-pink-500 via-rose-500 to-red-500 dark:from-pink-600 dark:via-rose-600 dark:to-red-600",ring:"focus-visible:ring-pink-400",isGridFullSpan:!0,shimmerDelay:"0.75s"}],y=()=>a||!u||!c?(0,ye.jsxs)(U,{className:`${h(!1)} bg-gradient-to-br from-gray-400 to-gray-500 dark:from-gray-600 dark:to-gray-700 focus-visible:ring-gray-400 sm:col-span-2`,disabled:!0,style:{"--shimmer-delay":"0.9s"},"aria-label":"\u0110ang t\u1EA3i Google Auth",children:[(0,ye.jsxs)("svg",{className:"animate-spin h-5 w-5 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,ye.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,ye.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"\u0110ang t\u1EA3i Google Auth..."]}):n&&i?(0,ye.jsxs)("div",{className:"sm:col-span-2 flex flex-col sm:flex-row items-center justify-center gap-2 p-2.5 bg-green-500/10 dark:bg-green-700/20 rounded-xl border border-green-500/30 dark:border-green-600/40",children:[(0,ye.jsx)("img",{src:i.picture,alt:i.name,className:"w-8 h-8 rounded-full shadow-md",referrerPolicy:"no-referrer"}),(0,ye.jsxs)("span",{className:"text-xs sm:text-sm text-green-700 dark:text-green-200 font-medium",children:["\u0110\u0103ng nh\u1EADp v\u1EDBi: ",i.name]}),(0,ye.jsxs)(U,{onClick:o,className:"!text-xs !py-1 !px-2.5 bg-red-500 hover:bg-red-600 text-white dark:bg-red-600 dark:hover:bg-red-700 focus-visible:ring-red-400","aria-label":"\u0110\u0103ng xu\u1EA5t Google",children:[(0,ye.jsx)("i",{className:"fab fa-google mr-1.5"}),"\u0110\u0103ng xu\u1EA5t"]})]}):(0,ye.jsxs)(U,{onClick:r,className:`${h(!1)} bg-gradient-to-br from-blue-500 via-sky-500 to-cyan-500 dark:from-blue-600 dark:via-sky-600 dark:to-cyan-600 focus-visible:ring-blue-400 sm:col-span-2`,style:{"--shimmer-delay":"0.9s"},"aria-label":"\u0110\u0103ng nh\u1EADp v\u1EDBi Google",children:[(0,ye.jsx)("i",{className:"fab fa-google mr-2 text-md"}),"\u0110\u0103ng nh\u1EADp v\u1EDBi Google (Drive Sync)"]});return(0,ye.jsxs)(ye.Fragment,{children:[(0,ye.jsx)(cT,{}),(0,ye.jsxs)("div",{className:"relative flex flex-col items-center justify-center min-h-screen p-4 sm:p-6 bg-gradient-to-br from-slate-100 via-gray-50 to-slate-200 dark:from-slate-900 dark:via-background-dark dark:to-slate-800 transition-colors duration-300",children:[(0,ye.jsxs)("header",{className:"text-center mb-10 sm:mb-12 z-10",children:[(0,ye.jsx)("h1",{className:"text-4xl xs:text-5xl sm:text-6xl lg:text-7xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-primary via-blue-500 to-secondary-dark dark:from-primary-light dark:via-blue-400 dark:to-secondary animate-text-gradient-wave mb-4",style:{WebkitTextStroke:e.theme==="dark"?"0.5px rgba(255,255,255,0.1)":"1px rgba(0,0,0,0.05)",textShadow:"1px 1px 2px rgba(0,0,0,0.1)"},children:Xc}),(0,ye.jsx)("p",{className:"text-base sm:text-lg text-slate-700 dark:text-slate-300 max-w-2xl mx-auto leading-relaxed font-medium",children:"Ki\u1EBFn t\u1EA1o th\u1EBF gi\u1EDBi, h\xF3a th\xE2n v\xE0o nh\xE2n v\u1EADt, v\xE0 \u0111\u1EC3 AI d\u1EABn d\u1EAFt b\u1EA1n qua nh\u1EEFng cu\u1ED9c phi\xEAu l\u01B0u v\xF4 t\u1EADn \u0111\u1EADm ch\u1EA5t ti\u1EC3u thuy\u1EBFt m\u1EA1ng."})]}),(0,ye.jsxs)("main",{className:"w-full max-w-sm md:max-w-md lg:max-w-lg space-y-5 z-10",children:[m.slice(0,1).map(p=>(0,ye.jsxs)("button",{className:`${h(p.isLarge)} ${p.gradient} ${p.ring}`,style:{"--shimmer-delay":p.shimmerDelay},onClick:()=>t(p.modal),"aria-label":p.label,children:[(0,ye.jsx)("i",{className:`${p.icon} mr-3 ${p.isLarge?"text-xl sm:text-2xl":"text-lg"}`}),p.label]},p.label)),(0,ye.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 pt-2",children:[m.slice(1).map(p=>(0,ye.jsxs)("button",{className:`${h(!1)} ${p.gradient} ${p.ring} ${p.isGridFullSpan?"sm:col-span-2":""}`,style:{"--shimmer-delay":p.shimmerDelay},onClick:()=>t(p.modal),"aria-label":p.label,children:[(0,ye.jsx)("i",{className:`${p.icon} mr-2 text-md`}),p.label]},p.label)),(0,ye.jsx)(y,{})]})]}),(0,ye.jsxs)("footer",{className:"mt-12 sm:mt-16 text-center text-sm text-slate-500 dark:text-slate-400 z-10",children:[(0,ye.jsxs)("p",{children:["\xA9 ",new Date().getFullYear()," ",Xc,"."]}),(0,ye.jsx)("p",{className:"text-sm mt-1",children:"M\u1ED9t s\u1EA3n ph\u1EA9m \u0111\u01B0\u1EE3c t\u1EA1o ra v\u1EDBi s\u1EF1 \u0111\u1ED3ng h\xE0nh c\u1EE7a Tr\xED Tu\u1EC7 Nh\xE2n T\u1EA1o."}),(0,ye.jsxs)("p",{className:"font-semibold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-purple-600 to-indigo-600 mt-3",children:[(0,ye.jsx)("i",{className:"fas fa-code mr-1"})," Thi\u1EBFt k\u1EBF b\u1EDFi @LocVinh04"]})]})]})]})},jp=dT;var j=H(ke(),1);var eg=H(ke(),1),Br=H(ee(),1),fT=eg.default.memo(({label:t,id:e,error:n,className:i="",wrapperClass:r="",...o})=>(0,Br.jsxs)("div",{className:`mb-4 ${r}`,children:[t&&(0,Br.jsx)("label",{htmlFor:e,className:"block text-sm font-medium text-text-light dark:text-text-dark mb-1.5",children:t}),(0,Br.jsx)("textarea",{id:e,rows:o.rows||4,className:`block w-full px-3 py-2.5 border rounded-lg shadow-sm focus:outline-none sm:text-sm 
                     transition-colors duration-200 ease-in-out bg-transparent custom-scrollbar ${n?`border-red-500 text-red-600 focus:ring-2 focus:ring-red-500/50 focus:border-red-500
                      placeholder-red-400 dark:placeholder-red-500`:`border-gray-300 dark:border-gray-600 
                       text-gray-900 dark:text-gray-100 
                       focus:ring-2 focus:ring-primary/60 focus:border-primary 
                       dark:focus:ring-primary-light/60 dark:focus:border-primary-light
                       placeholder-gray-400 dark:placeholder-gray-500`} ${i}`,...o}),n&&(0,Br.jsx)("p",{className:"mt-1.5 text-xs text-red-500 dark:text-red-400",children:n})]})),Nt=fT;var yn=H(ke(),1),ig=H(ee(),1),Sb=(0,yn.createContext)(void 0);var tg=(0,yn.createContext)(void 0),ng=({children:t})=>{let[e,n]=(0,yn.useState)([]),i=(0,yn.useCallback)(o=>{let a=`toast-${Date.now()}-${Math.random().toString(36).substring(2,7)}`,u=o.type==="success"?"fas fa-check-circle":o.type==="error"?"fas fa-times-circle":o.type==="warning"?"fas fa-exclamation-triangle":o.type==="info"?"fas fa-info-circle":void 0,c={...o,id:a,icon:o.icon||u};n(f=>[c,...f]);let d=o.duration||7e3;setTimeout(()=>{r(a)},d)},[]),r=(0,yn.useCallback)(o=>{n(a=>a.filter(u=>u.id!==o))},[]);return(0,ig.jsx)(tg.Provider,{value:{addToast:i,toasts:e,removeToast:r},children:t})},ad=()=>{let t=(0,yn.useContext)(tg);if(t===void 0)throw new Error("useInternalToast must be used within an InternalToastProvider");return t},vn=()=>{let{addToast:t}=ad();return{addToast:t}};var xe={};Vv(xe,{BRAND:()=>$T,DIRTY:()=>Oi,EMPTY_PATH:()=>gT,INVALID:()=>oe,NEVER:()=>kC,OK:()=>ct,ParseStatus:()=>nt,Schema:()=>fe,ZodAny:()=>vi,ZodArray:()=>Hn,ZodBigInt:()=>qi,ZodBoolean:()=>Ki,ZodBranded:()=>us,ZodCatch:()=>nr,ZodDate:()=>zi,ZodDefault:()=>tr,ZodDiscriminatedUnion:()=>el,ZodEffects:()=>Kt,ZodEnum:()=>ji,ZodError:()=>wt,ZodFirstPartyTypeKind:()=>le,ZodFunction:()=>nl,ZodIntersection:()=>Qi,ZodIssueCode:()=>$,ZodLazy:()=>Zi,ZodLiteral:()=>Xi,ZodMap:()=>Yr,ZodNaN:()=>Zr,ZodNativeEnum:()=>er,ZodNever:()=>an,ZodNull:()=>Ji,ZodNullable:()=>Cn,ZodNumber:()=>Bi,ZodObject:()=>It,ZodOptional:()=>Bt,ZodParsedType:()=>z,ZodPipeline:()=>cs,ZodPromise:()=>xi,ZodReadonly:()=>ir,ZodRecord:()=>tl,ZodSchema:()=>fe,ZodSet:()=>Qr,ZodString:()=>yi,ZodSymbol:()=>Wr,ZodTransformer:()=>Kt,ZodTuple:()=>Tn,ZodType:()=>fe,ZodUndefined:()=>Wi,ZodUnion:()=>Yi,ZodUnknown:()=>Un,ZodVoid:()=>Jr,addIssueToContext:()=>q,any:()=>WT,array:()=>ZT,bigint:()=>OT,boolean:()=>mg,coerce:()=>CC,custom:()=>dg,date:()=>BT,datetimeRegex:()=>ug,defaultErrorMap:()=>$n,discriminatedUnion:()=>tC,effect:()=>hC,enum:()=>cC,function:()=>aC,getErrorMap:()=>qr,getParsedType:()=>xn,instanceof:()=>UT,intersection:()=>nC,isAborted:()=>Xa,isAsync:()=>Kr,isDirty:()=>ja,isValid:()=>gi,late:()=>GT,lazy:()=>lC,literal:()=>uC,makeIssue:()=>ls,map:()=>oC,nan:()=>HT,nativeEnum:()=>dC,never:()=>YT,null:()=>zT,nullable:()=>pC,number:()=>hg,object:()=>XT,objectUtil:()=>ld,oboolean:()=>TC,onumber:()=>xC,optional:()=>mC,ostring:()=>vC,pipeline:()=>yC,preprocess:()=>gC,promise:()=>fC,quotelessJson:()=>hT,record:()=>rC,set:()=>sC,setErrorMap:()=>pT,strictObject:()=>jT,string:()=>fg,symbol:()=>qT,transformer:()=>hC,tuple:()=>iC,undefined:()=>KT,union:()=>eC,unknown:()=>JT,util:()=>ge,void:()=>QT});var ge;(function(t){t.assertEqual=r=>{};function e(r){}t.assertIs=e;function n(r){throw new Error}t.assertNever=n,t.arrayToEnum=r=>{let o={};for(let a of r)o[a]=a;return o},t.getValidEnumValues=r=>{let o=t.objectKeys(r).filter(u=>typeof r[r[u]]!="number"),a={};for(let u of o)a[u]=r[u];return t.objectValues(a)},t.objectValues=r=>t.objectKeys(r).map(function(o){return r[o]}),t.objectKeys=typeof Object.keys=="function"?r=>Object.keys(r):r=>{let o=[];for(let a in r)Object.prototype.hasOwnProperty.call(r,a)&&o.push(a);return o},t.find=(r,o)=>{for(let a of r)if(o(a))return a},t.isInteger=typeof Number.isInteger=="function"?r=>Number.isInteger(r):r=>typeof r=="number"&&Number.isFinite(r)&&Math.floor(r)===r;function i(r,o=" | "){return r.map(a=>typeof a=="string"?`'${a}'`:a).join(o)}t.joinValues=i,t.jsonStringifyReplacer=(r,o)=>typeof o=="bigint"?o.toString():o})(ge||(ge={}));var ld;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(ld||(ld={}));var z=ge.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),xn=t=>{switch(typeof t){case"undefined":return z.undefined;case"string":return z.string;case"number":return Number.isNaN(t)?z.nan:z.number;case"boolean":return z.boolean;case"function":return z.function;case"bigint":return z.bigint;case"symbol":return z.symbol;case"object":return Array.isArray(t)?z.array:t===null?z.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?z.promise:typeof Map<"u"&&t instanceof Map?z.map:typeof Set<"u"&&t instanceof Set?z.set:typeof Date<"u"&&t instanceof Date?z.date:z.object;default:return z.unknown}};var $=ge.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),hT=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),wt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=i=>{this.issues=[...this.issues,i]},this.addIssues=(i=[])=>{this.issues=[...this.issues,...i]};let n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){let n=e||function(o){return o.message},i={_errors:[]},r=o=>{for(let a of o.issues)if(a.code==="invalid_union")a.unionErrors.map(r);else if(a.code==="invalid_return_type")r(a.returnTypeError);else if(a.code==="invalid_arguments")r(a.argumentsError);else if(a.path.length===0)i._errors.push(n(a));else{let u=i,c=0;for(;c<a.path.length;){let d=a.path[c];c===a.path.length-1?(u[d]=u[d]||{_errors:[]},u[d]._errors.push(n(a))):u[d]=u[d]||{_errors:[]},u=u[d],c++}}};return r(this),i}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ge.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){let n={},i=[];for(let r of this.issues)r.path.length>0?(n[r.path[0]]=n[r.path[0]]||[],n[r.path[0]].push(e(r))):i.push(e(r));return{formErrors:i,fieldErrors:n}}get formErrors(){return this.flatten()}};wt.create=t=>new wt(t);var mT=(t,e)=>{let n;switch(t.code){case $.invalid_type:t.received===z.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case $.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,ge.jsonStringifyReplacer)}`;break;case $.unrecognized_keys:n=`Unrecognized key(s) in object: ${ge.joinValues(t.keys,", ")}`;break;case $.invalid_union:n="Invalid input";break;case $.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${ge.joinValues(t.options)}`;break;case $.invalid_enum_value:n=`Invalid enum value. Expected ${ge.joinValues(t.options)}, received '${t.received}'`;break;case $.invalid_arguments:n="Invalid function arguments";break;case $.invalid_return_type:n="Invalid function return type";break;case $.invalid_date:n="Invalid date";break;case $.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:ge.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case $.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case $.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case $.custom:n="Invalid input";break;case $.invalid_intersection_types:n="Intersection results could not be merged";break;case $.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case $.not_finite:n="Number must be finite";break;default:n=e.defaultError,ge.assertNever(t)}return{message:n}},$n=mT;var rg=$n;function pT(t){rg=t}function qr(){return rg}var ls=t=>{let{data:e,path:n,errorMaps:i,issueData:r}=t,o=[...n,...r.path||[]],a={...r,path:o};if(r.message!==void 0)return{...r,path:o,message:r.message};let u="",c=i.filter(d=>!!d).slice().reverse();for(let d of c)u=d(a,{data:e,defaultError:u}).message;return{...r,path:o,message:u}},gT=[];function q(t,e){let n=qr(),i=ls({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===$n?void 0:$n].filter(r=>!!r)});t.common.issues.push(i)}var nt=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){let i=[];for(let r of n){if(r.status==="aborted")return oe;r.status==="dirty"&&e.dirty(),i.push(r.value)}return{status:e.value,value:i}}static async mergeObjectAsync(e,n){let i=[];for(let r of n){let o=await r.key,a=await r.value;i.push({key:o,value:a})}return t.mergeObjectSync(e,i)}static mergeObjectSync(e,n){let i={};for(let r of n){let{key:o,value:a}=r;if(o.status==="aborted"||a.status==="aborted")return oe;o.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),o.value!=="__proto__"&&(typeof a.value<"u"||r.alwaysSet)&&(i[o.value]=a.value)}return{status:e.value,value:i}}},oe=Object.freeze({status:"aborted"}),Oi=t=>({status:"dirty",value:t}),ct=t=>({status:"valid",value:t}),Xa=t=>t.status==="aborted",ja=t=>t.status==="dirty",gi=t=>t.status==="valid",Kr=t=>typeof Promise<"u"&&t instanceof Promise;var Z;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(Z||(Z={}));var qt=class{constructor(e,n,i,r){this._cachedPath=[],this.parent=e,this.data=n,this._path=i,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},og=(t,e)=>{if(gi(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let n=new wt(t.common.issues);return this._error=n,this._error}}};function de(t){if(!t)return{};let{errorMap:e,invalid_type_error:n,required_error:i,description:r}=t;if(e&&(n||i))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:r}:{errorMap:(a,u)=>{let{message:c}=t;return a.code==="invalid_enum_value"?{message:c??u.defaultError}:typeof u.data>"u"?{message:c??i??u.defaultError}:a.code!=="invalid_type"?{message:u.defaultError}:{message:c??n??u.defaultError}},description:r}}var fe=class{get description(){return this._def.description}_getType(e){return xn(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:xn(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new nt,ctx:{common:e.parent.common,data:e.data,parsedType:xn(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let n=this._parse(e);if(Kr(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){let n=this._parse(e);return Promise.resolve(n)}parse(e,n){let i=this.safeParse(e,n);if(i.success)return i.data;throw i.error}safeParse(e,n){let i={common:{issues:[],async:n?.async??!1,contextualErrorMap:n?.errorMap},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:xn(e)},r=this._parseSync({data:e,path:i.path,parent:i});return og(i,r)}"~validate"(e){let n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:xn(e)};if(!this["~standard"].async)try{let i=this._parseSync({data:e,path:[],parent:n});return gi(i)?{value:i.value}:{issues:n.common.issues}}catch(i){i?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(i=>gi(i)?{value:i.value}:{issues:n.common.issues})}async parseAsync(e,n){let i=await this.safeParseAsync(e,n);if(i.success)return i.data;throw i.error}async safeParseAsync(e,n){let i={common:{issues:[],contextualErrorMap:n?.errorMap,async:!0},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:xn(e)},r=this._parse({data:e,path:i.path,parent:i}),o=await(Kr(r)?r:Promise.resolve(r));return og(i,o)}refine(e,n){let i=r=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(r):n;return this._refinement((r,o)=>{let a=e(r),u=()=>o.addIssue({code:$.custom,...i(r)});return typeof Promise<"u"&&a instanceof Promise?a.then(c=>c?!0:(u(),!1)):a?!0:(u(),!1)})}refinement(e,n){return this._refinement((i,r)=>e(i)?!0:(r.addIssue(typeof n=="function"?n(i,r):n),!1))}_refinement(e){return new Kt({schema:this,typeName:le.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return Bt.create(this,this._def)}nullable(){return Cn.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Hn.create(this)}promise(){return xi.create(this,this._def)}or(e){return Yi.create([this,e],this._def)}and(e){return Qi.create(this,e,this._def)}transform(e){return new Kt({...de(this._def),schema:this,typeName:le.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let n=typeof e=="function"?e:()=>e;return new tr({...de(this._def),innerType:this,defaultValue:n,typeName:le.ZodDefault})}brand(){return new us({typeName:le.ZodBranded,type:this,...de(this._def)})}catch(e){let n=typeof e=="function"?e:()=>e;return new nr({...de(this._def),innerType:this,catchValue:n,typeName:le.ZodCatch})}describe(e){let n=this.constructor;return new n({...this._def,description:e})}pipe(e){return cs.create(this,e)}readonly(){return ir.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},yT=/^c[^\s-]{8,}$/i,vT=/^[0-9a-z]+$/,xT=/^[0-9A-HJKMNP-TV-Z]{26}$/i,TT=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,CT=/^[a-z0-9_-]{21}$/i,kT=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,ST=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,_T=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,NT="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",ud,wT=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,IT=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ET=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,AT=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,bT=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,PT=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ag="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",MT=new RegExp(`^${ag}$`);function lg(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let n=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${n}`}function LT(t){return new RegExp(`^${lg(t)}$`)}function ug(t){let e=`${ag}T${lg(t)}`,n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function RT(t,e){return!!((e==="v4"||!e)&&wT.test(t)||(e==="v6"||!e)&&ET.test(t))}function DT(t,e){if(!kT.test(t))return!1;try{let[n]=t.split("."),i=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),r=JSON.parse(atob(i));return!(typeof r!="object"||r===null||"typ"in r&&r?.typ!=="JWT"||!r.alg||e&&r.alg!==e)}catch{return!1}}function FT(t,e){return!!((e==="v4"||!e)&&IT.test(t)||(e==="v6"||!e)&&AT.test(t))}var yi=class t extends fe{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==z.string){let o=this._getOrReturnCtx(e);return q(o,{code:$.invalid_type,expected:z.string,received:o.parsedType}),oe}let i=new nt,r;for(let o of this._def.checks)if(o.kind==="min")e.data.length<o.value&&(r=this._getOrReturnCtx(e,r),q(r,{code:$.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),i.dirty());else if(o.kind==="max")e.data.length>o.value&&(r=this._getOrReturnCtx(e,r),q(r,{code:$.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),i.dirty());else if(o.kind==="length"){let a=e.data.length>o.value,u=e.data.length<o.value;(a||u)&&(r=this._getOrReturnCtx(e,r),a?q(r,{code:$.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):u&&q(r,{code:$.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),i.dirty())}else if(o.kind==="email")_T.test(e.data)||(r=this._getOrReturnCtx(e,r),q(r,{validation:"email",code:$.invalid_string,message:o.message}),i.dirty());else if(o.kind==="emoji")ud||(ud=new RegExp(NT,"u")),ud.test(e.data)||(r=this._getOrReturnCtx(e,r),q(r,{validation:"emoji",code:$.invalid_string,message:o.message}),i.dirty());else if(o.kind==="uuid")TT.test(e.data)||(r=this._getOrReturnCtx(e,r),q(r,{validation:"uuid",code:$.invalid_string,message:o.message}),i.dirty());else if(o.kind==="nanoid")CT.test(e.data)||(r=this._getOrReturnCtx(e,r),q(r,{validation:"nanoid",code:$.invalid_string,message:o.message}),i.dirty());else if(o.kind==="cuid")yT.test(e.data)||(r=this._getOrReturnCtx(e,r),q(r,{validation:"cuid",code:$.invalid_string,message:o.message}),i.dirty());else if(o.kind==="cuid2")vT.test(e.data)||(r=this._getOrReturnCtx(e,r),q(r,{validation:"cuid2",code:$.invalid_string,message:o.message}),i.dirty());else if(o.kind==="ulid")xT.test(e.data)||(r=this._getOrReturnCtx(e,r),q(r,{validation:"ulid",code:$.invalid_string,message:o.message}),i.dirty());else if(o.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),q(r,{validation:"url",code:$.invalid_string,message:o.message}),i.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),q(r,{validation:"regex",code:$.invalid_string,message:o.message}),i.dirty())):o.kind==="trim"?e.data=e.data.trim():o.kind==="includes"?e.data.includes(o.value,o.position)||(r=this._getOrReturnCtx(e,r),q(r,{code:$.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),i.dirty()):o.kind==="toLowerCase"?e.data=e.data.toLowerCase():o.kind==="toUpperCase"?e.data=e.data.toUpperCase():o.kind==="startsWith"?e.data.startsWith(o.value)||(r=this._getOrReturnCtx(e,r),q(r,{code:$.invalid_string,validation:{startsWith:o.value},message:o.message}),i.dirty()):o.kind==="endsWith"?e.data.endsWith(o.value)||(r=this._getOrReturnCtx(e,r),q(r,{code:$.invalid_string,validation:{endsWith:o.value},message:o.message}),i.dirty()):o.kind==="datetime"?ug(o).test(e.data)||(r=this._getOrReturnCtx(e,r),q(r,{code:$.invalid_string,validation:"datetime",message:o.message}),i.dirty()):o.kind==="date"?MT.test(e.data)||(r=this._getOrReturnCtx(e,r),q(r,{code:$.invalid_string,validation:"date",message:o.message}),i.dirty()):o.kind==="time"?LT(o).test(e.data)||(r=this._getOrReturnCtx(e,r),q(r,{code:$.invalid_string,validation:"time",message:o.message}),i.dirty()):o.kind==="duration"?ST.test(e.data)||(r=this._getOrReturnCtx(e,r),q(r,{validation:"duration",code:$.invalid_string,message:o.message}),i.dirty()):o.kind==="ip"?RT(e.data,o.version)||(r=this._getOrReturnCtx(e,r),q(r,{validation:"ip",code:$.invalid_string,message:o.message}),i.dirty()):o.kind==="jwt"?DT(e.data,o.alg)||(r=this._getOrReturnCtx(e,r),q(r,{validation:"jwt",code:$.invalid_string,message:o.message}),i.dirty()):o.kind==="cidr"?FT(e.data,o.version)||(r=this._getOrReturnCtx(e,r),q(r,{validation:"cidr",code:$.invalid_string,message:o.message}),i.dirty()):o.kind==="base64"?bT.test(e.data)||(r=this._getOrReturnCtx(e,r),q(r,{validation:"base64",code:$.invalid_string,message:o.message}),i.dirty()):o.kind==="base64url"?PT.test(e.data)||(r=this._getOrReturnCtx(e,r),q(r,{validation:"base64url",code:$.invalid_string,message:o.message}),i.dirty()):ge.assertNever(o);return{status:i.value,value:e.data}}_regex(e,n,i){return this.refinement(r=>e.test(r),{validation:n,code:$.invalid_string,...Z.errToObj(i)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Z.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Z.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Z.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Z.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Z.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Z.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Z.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Z.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Z.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Z.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Z.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Z.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Z.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...Z.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...Z.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...Z.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...Z.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n?.position,...Z.errToObj(n?.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...Z.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...Z.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...Z.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...Z.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...Z.errToObj(n)})}nonempty(e){return this.min(1,Z.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}};yi.create=t=>new yi({checks:[],typeName:le.ZodString,coerce:t?.coerce??!1,...de(t)});function VT(t,e){let n=(t.toString().split(".")[1]||"").length,i=(e.toString().split(".")[1]||"").length,r=n>i?n:i,o=Number.parseInt(t.toFixed(r).replace(".","")),a=Number.parseInt(e.toFixed(r).replace(".",""));return o%a/10**r}var Bi=class t extends fe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==z.number){let o=this._getOrReturnCtx(e);return q(o,{code:$.invalid_type,expected:z.number,received:o.parsedType}),oe}let i,r=new nt;for(let o of this._def.checks)o.kind==="int"?ge.isInteger(e.data)||(i=this._getOrReturnCtx(e,i),q(i,{code:$.invalid_type,expected:"integer",received:"float",message:o.message}),r.dirty()):o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(i=this._getOrReturnCtx(e,i),q(i,{code:$.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),r.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(i=this._getOrReturnCtx(e,i),q(i,{code:$.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),r.dirty()):o.kind==="multipleOf"?VT(e.data,o.value)!==0&&(i=this._getOrReturnCtx(e,i),q(i,{code:$.not_multiple_of,multipleOf:o.value,message:o.message}),r.dirty()):o.kind==="finite"?Number.isFinite(e.data)||(i=this._getOrReturnCtx(e,i),q(i,{code:$.not_finite,message:o.message}),r.dirty()):ge.assertNever(o);return{status:r.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,Z.toString(n))}gt(e,n){return this.setLimit("min",e,!1,Z.toString(n))}lte(e,n){return this.setLimit("max",e,!0,Z.toString(n))}lt(e,n){return this.setLimit("max",e,!1,Z.toString(n))}setLimit(e,n,i,r){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:i,message:Z.toString(r)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Z.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Z.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:Z.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:Z.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Z.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Z.toString(e)})}get minValue(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ge.isInteger(e.value))}get isFinite(){let e=null,n=null;for(let i of this._def.checks){if(i.kind==="finite"||i.kind==="int"||i.kind==="multipleOf")return!0;i.kind==="min"?(n===null||i.value>n)&&(n=i.value):i.kind==="max"&&(e===null||i.value<e)&&(e=i.value)}return Number.isFinite(n)&&Number.isFinite(e)}};Bi.create=t=>new Bi({checks:[],typeName:le.ZodNumber,coerce:t?.coerce||!1,...de(t)});var qi=class t extends fe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==z.bigint)return this._getInvalidInput(e);let i,r=new nt;for(let o of this._def.checks)o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(i=this._getOrReturnCtx(e,i),q(i,{code:$.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),r.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(i=this._getOrReturnCtx(e,i),q(i,{code:$.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),r.dirty()):o.kind==="multipleOf"?e.data%o.value!==BigInt(0)&&(i=this._getOrReturnCtx(e,i),q(i,{code:$.not_multiple_of,multipleOf:o.value,message:o.message}),r.dirty()):ge.assertNever(o);return{status:r.value,value:e.data}}_getInvalidInput(e){let n=this._getOrReturnCtx(e);return q(n,{code:$.invalid_type,expected:z.bigint,received:n.parsedType}),oe}gte(e,n){return this.setLimit("min",e,!0,Z.toString(n))}gt(e,n){return this.setLimit("min",e,!1,Z.toString(n))}lte(e,n){return this.setLimit("max",e,!0,Z.toString(n))}lt(e,n){return this.setLimit("max",e,!1,Z.toString(n))}setLimit(e,n,i,r){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:i,message:Z.toString(r)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Z.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:Z.toString(n)})}get minValue(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}};qi.create=t=>new qi({checks:[],typeName:le.ZodBigInt,coerce:t?.coerce??!1,...de(t)});var Ki=class extends fe{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==z.boolean){let i=this._getOrReturnCtx(e);return q(i,{code:$.invalid_type,expected:z.boolean,received:i.parsedType}),oe}return ct(e.data)}};Ki.create=t=>new Ki({typeName:le.ZodBoolean,coerce:t?.coerce||!1,...de(t)});var zi=class t extends fe{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==z.date){let o=this._getOrReturnCtx(e);return q(o,{code:$.invalid_type,expected:z.date,received:o.parsedType}),oe}if(Number.isNaN(e.data.getTime())){let o=this._getOrReturnCtx(e);return q(o,{code:$.invalid_date}),oe}let i=new nt,r;for(let o of this._def.checks)o.kind==="min"?e.data.getTime()<o.value&&(r=this._getOrReturnCtx(e,r),q(r,{code:$.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),i.dirty()):o.kind==="max"?e.data.getTime()>o.value&&(r=this._getOrReturnCtx(e,r),q(r,{code:$.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),i.dirty()):ge.assertNever(o);return{status:i.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:Z.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:Z.toString(n)})}get minDate(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}};zi.create=t=>new zi({checks:[],coerce:t?.coerce||!1,typeName:le.ZodDate,...de(t)});var Wr=class extends fe{_parse(e){if(this._getType(e)!==z.symbol){let i=this._getOrReturnCtx(e);return q(i,{code:$.invalid_type,expected:z.symbol,received:i.parsedType}),oe}return ct(e.data)}};Wr.create=t=>new Wr({typeName:le.ZodSymbol,...de(t)});var Wi=class extends fe{_parse(e){if(this._getType(e)!==z.undefined){let i=this._getOrReturnCtx(e);return q(i,{code:$.invalid_type,expected:z.undefined,received:i.parsedType}),oe}return ct(e.data)}};Wi.create=t=>new Wi({typeName:le.ZodUndefined,...de(t)});var Ji=class extends fe{_parse(e){if(this._getType(e)!==z.null){let i=this._getOrReturnCtx(e);return q(i,{code:$.invalid_type,expected:z.null,received:i.parsedType}),oe}return ct(e.data)}};Ji.create=t=>new Ji({typeName:le.ZodNull,...de(t)});var vi=class extends fe{constructor(){super(...arguments),this._any=!0}_parse(e){return ct(e.data)}};vi.create=t=>new vi({typeName:le.ZodAny,...de(t)});var Un=class extends fe{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ct(e.data)}};Un.create=t=>new Un({typeName:le.ZodUnknown,...de(t)});var an=class extends fe{_parse(e){let n=this._getOrReturnCtx(e);return q(n,{code:$.invalid_type,expected:z.never,received:n.parsedType}),oe}};an.create=t=>new an({typeName:le.ZodNever,...de(t)});var Jr=class extends fe{_parse(e){if(this._getType(e)!==z.undefined){let i=this._getOrReturnCtx(e);return q(i,{code:$.invalid_type,expected:z.void,received:i.parsedType}),oe}return ct(e.data)}};Jr.create=t=>new Jr({typeName:le.ZodVoid,...de(t)});var Hn=class t extends fe{_parse(e){let{ctx:n,status:i}=this._processInputParams(e),r=this._def;if(n.parsedType!==z.array)return q(n,{code:$.invalid_type,expected:z.array,received:n.parsedType}),oe;if(r.exactLength!==null){let a=n.data.length>r.exactLength.value,u=n.data.length<r.exactLength.value;(a||u)&&(q(n,{code:a?$.too_big:$.too_small,minimum:u?r.exactLength.value:void 0,maximum:a?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),i.dirty())}if(r.minLength!==null&&n.data.length<r.minLength.value&&(q(n,{code:$.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),i.dirty()),r.maxLength!==null&&n.data.length>r.maxLength.value&&(q(n,{code:$.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),i.dirty()),n.common.async)return Promise.all([...n.data].map((a,u)=>r.type._parseAsync(new qt(n,a,n.path,u)))).then(a=>nt.mergeArray(i,a));let o=[...n.data].map((a,u)=>r.type._parseSync(new qt(n,a,n.path,u)));return nt.mergeArray(i,o)}get element(){return this._def.type}min(e,n){return new t({...this._def,minLength:{value:e,message:Z.toString(n)}})}max(e,n){return new t({...this._def,maxLength:{value:e,message:Z.toString(n)}})}length(e,n){return new t({...this._def,exactLength:{value:e,message:Z.toString(n)}})}nonempty(e){return this.min(1,e)}};Hn.create=(t,e)=>new Hn({type:t,minLength:null,maxLength:null,exactLength:null,typeName:le.ZodArray,...de(e)});function zr(t){if(t instanceof It){let e={};for(let n in t.shape){let i=t.shape[n];e[n]=Bt.create(zr(i))}return new It({...t._def,shape:()=>e})}else return t instanceof Hn?new Hn({...t._def,type:zr(t.element)}):t instanceof Bt?Bt.create(zr(t.unwrap())):t instanceof Cn?Cn.create(zr(t.unwrap())):t instanceof Tn?Tn.create(t.items.map(e=>zr(e))):t}var It=class t extends fe{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),n=ge.objectKeys(e);return this._cached={shape:e,keys:n},this._cached}_parse(e){if(this._getType(e)!==z.object){let d=this._getOrReturnCtx(e);return q(d,{code:$.invalid_type,expected:z.object,received:d.parsedType}),oe}let{status:i,ctx:r}=this._processInputParams(e),{shape:o,keys:a}=this._getCached(),u=[];if(!(this._def.catchall instanceof an&&this._def.unknownKeys==="strip"))for(let d in r.data)a.includes(d)||u.push(d);let c=[];for(let d of a){let f=o[d],h=r.data[d];c.push({key:{status:"valid",value:d},value:f._parse(new qt(r,h,r.path,d)),alwaysSet:d in r.data})}if(this._def.catchall instanceof an){let d=this._def.unknownKeys;if(d==="passthrough")for(let f of u)c.push({key:{status:"valid",value:f},value:{status:"valid",value:r.data[f]}});else if(d==="strict")u.length>0&&(q(r,{code:$.unrecognized_keys,keys:u}),i.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let d=this._def.catchall;for(let f of u){let h=r.data[f];c.push({key:{status:"valid",value:f},value:d._parse(new qt(r,h,r.path,f)),alwaysSet:f in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let d=[];for(let f of c){let h=await f.key,m=await f.value;d.push({key:h,value:m,alwaysSet:f.alwaysSet})}return d}).then(d=>nt.mergeObjectSync(i,d)):nt.mergeObjectSync(i,c)}get shape(){return this._def.shape()}strict(e){return Z.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,i)=>{let r=this._def.errorMap?.(n,i).message??i.defaultError;return n.code==="unrecognized_keys"?{message:Z.errToObj(e).message??r}:{message:r}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:le.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let n={};for(let i of ge.objectKeys(e))e[i]&&this.shape[i]&&(n[i]=this.shape[i]);return new t({...this._def,shape:()=>n})}omit(e){let n={};for(let i of ge.objectKeys(this.shape))e[i]||(n[i]=this.shape[i]);return new t({...this._def,shape:()=>n})}deepPartial(){return zr(this)}partial(e){let n={};for(let i of ge.objectKeys(this.shape)){let r=this.shape[i];e&&!e[i]?n[i]=r:n[i]=r.optional()}return new t({...this._def,shape:()=>n})}required(e){let n={};for(let i of ge.objectKeys(this.shape))if(e&&!e[i])n[i]=this.shape[i];else{let o=this.shape[i];for(;o instanceof Bt;)o=o._def.innerType;n[i]=o}return new t({...this._def,shape:()=>n})}keyof(){return cg(ge.objectKeys(this.shape))}};It.create=(t,e)=>new It({shape:()=>t,unknownKeys:"strip",catchall:an.create(),typeName:le.ZodObject,...de(e)});It.strictCreate=(t,e)=>new It({shape:()=>t,unknownKeys:"strict",catchall:an.create(),typeName:le.ZodObject,...de(e)});It.lazycreate=(t,e)=>new It({shape:t,unknownKeys:"strip",catchall:an.create(),typeName:le.ZodObject,...de(e)});var Yi=class extends fe{_parse(e){let{ctx:n}=this._processInputParams(e),i=this._def.options;function r(o){for(let u of o)if(u.result.status==="valid")return u.result;for(let u of o)if(u.result.status==="dirty")return n.common.issues.push(...u.ctx.common.issues),u.result;let a=o.map(u=>new wt(u.ctx.common.issues));return q(n,{code:$.invalid_union,unionErrors:a}),oe}if(n.common.async)return Promise.all(i.map(async o=>{let a={...n,common:{...n.common,issues:[]},parent:null};return{result:await o._parseAsync({data:n.data,path:n.path,parent:a}),ctx:a}})).then(r);{let o,a=[];for(let c of i){let d={...n,common:{...n.common,issues:[]},parent:null},f=c._parseSync({data:n.data,path:n.path,parent:d});if(f.status==="valid")return f;f.status==="dirty"&&!o&&(o={result:f,ctx:d}),d.common.issues.length&&a.push(d.common.issues)}if(o)return n.common.issues.push(...o.ctx.common.issues),o.result;let u=a.map(c=>new wt(c));return q(n,{code:$.invalid_union,unionErrors:u}),oe}}get options(){return this._def.options}};Yi.create=(t,e)=>new Yi({options:t,typeName:le.ZodUnion,...de(e)});var Gn=t=>t instanceof Zi?Gn(t.schema):t instanceof Kt?Gn(t.innerType()):t instanceof Xi?[t.value]:t instanceof ji?t.options:t instanceof er?ge.objectValues(t.enum):t instanceof tr?Gn(t._def.innerType):t instanceof Wi?[void 0]:t instanceof Ji?[null]:t instanceof Bt?[void 0,...Gn(t.unwrap())]:t instanceof Cn?[null,...Gn(t.unwrap())]:t instanceof us||t instanceof ir?Gn(t.unwrap()):t instanceof nr?Gn(t._def.innerType):[],el=class t extends fe{_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==z.object)return q(n,{code:$.invalid_type,expected:z.object,received:n.parsedType}),oe;let i=this.discriminator,r=n.data[i],o=this.optionsMap.get(r);return o?n.common.async?o._parseAsync({data:n.data,path:n.path,parent:n}):o._parseSync({data:n.data,path:n.path,parent:n}):(q(n,{code:$.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[i]}),oe)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,n,i){let r=new Map;for(let o of n){let a=Gn(o.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let u of a){if(r.has(u))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(u)}`);r.set(u,o)}}return new t({typeName:le.ZodDiscriminatedUnion,discriminator:e,options:n,optionsMap:r,...de(i)})}};function cd(t,e){let n=xn(t),i=xn(e);if(t===e)return{valid:!0,data:t};if(n===z.object&&i===z.object){let r=ge.objectKeys(e),o=ge.objectKeys(t).filter(u=>r.indexOf(u)!==-1),a={...t,...e};for(let u of o){let c=cd(t[u],e[u]);if(!c.valid)return{valid:!1};a[u]=c.data}return{valid:!0,data:a}}else if(n===z.array&&i===z.array){if(t.length!==e.length)return{valid:!1};let r=[];for(let o=0;o<t.length;o++){let a=t[o],u=e[o],c=cd(a,u);if(!c.valid)return{valid:!1};r.push(c.data)}return{valid:!0,data:r}}else return n===z.date&&i===z.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var Qi=class extends fe{_parse(e){let{status:n,ctx:i}=this._processInputParams(e),r=(o,a)=>{if(Xa(o)||Xa(a))return oe;let u=cd(o.value,a.value);return u.valid?((ja(o)||ja(a))&&n.dirty(),{status:n.value,value:u.data}):(q(i,{code:$.invalid_intersection_types}),oe)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([o,a])=>r(o,a)):r(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}};Qi.create=(t,e,n)=>new Qi({left:t,right:e,typeName:le.ZodIntersection,...de(n)});var Tn=class t extends fe{_parse(e){let{status:n,ctx:i}=this._processInputParams(e);if(i.parsedType!==z.array)return q(i,{code:$.invalid_type,expected:z.array,received:i.parsedType}),oe;if(i.data.length<this._def.items.length)return q(i,{code:$.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),oe;!this._def.rest&&i.data.length>this._def.items.length&&(q(i,{code:$.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());let o=[...i.data].map((a,u)=>{let c=this._def.items[u]||this._def.rest;return c?c._parse(new qt(i,a,i.path,u)):null}).filter(a=>!!a);return i.common.async?Promise.all(o).then(a=>nt.mergeArray(n,a)):nt.mergeArray(n,o)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};Tn.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Tn({items:t,typeName:le.ZodTuple,rest:null,...de(e)})};var tl=class t extends fe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:n,ctx:i}=this._processInputParams(e);if(i.parsedType!==z.object)return q(i,{code:$.invalid_type,expected:z.object,received:i.parsedType}),oe;let r=[],o=this._def.keyType,a=this._def.valueType;for(let u in i.data)r.push({key:o._parse(new qt(i,u,i.path,u)),value:a._parse(new qt(i,i.data[u],i.path,u)),alwaysSet:u in i.data});return i.common.async?nt.mergeObjectAsync(n,r):nt.mergeObjectSync(n,r)}get element(){return this._def.valueType}static create(e,n,i){return n instanceof fe?new t({keyType:e,valueType:n,typeName:le.ZodRecord,...de(i)}):new t({keyType:yi.create(),valueType:e,typeName:le.ZodRecord,...de(n)})}},Yr=class extends fe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:n,ctx:i}=this._processInputParams(e);if(i.parsedType!==z.map)return q(i,{code:$.invalid_type,expected:z.map,received:i.parsedType}),oe;let r=this._def.keyType,o=this._def.valueType,a=[...i.data.entries()].map(([u,c],d)=>({key:r._parse(new qt(i,u,i.path,[d,"key"])),value:o._parse(new qt(i,c,i.path,[d,"value"]))}));if(i.common.async){let u=new Map;return Promise.resolve().then(async()=>{for(let c of a){let d=await c.key,f=await c.value;if(d.status==="aborted"||f.status==="aborted")return oe;(d.status==="dirty"||f.status==="dirty")&&n.dirty(),u.set(d.value,f.value)}return{status:n.value,value:u}})}else{let u=new Map;for(let c of a){let d=c.key,f=c.value;if(d.status==="aborted"||f.status==="aborted")return oe;(d.status==="dirty"||f.status==="dirty")&&n.dirty(),u.set(d.value,f.value)}return{status:n.value,value:u}}}};Yr.create=(t,e,n)=>new Yr({valueType:e,keyType:t,typeName:le.ZodMap,...de(n)});var Qr=class t extends fe{_parse(e){let{status:n,ctx:i}=this._processInputParams(e);if(i.parsedType!==z.set)return q(i,{code:$.invalid_type,expected:z.set,received:i.parsedType}),oe;let r=this._def;r.minSize!==null&&i.data.size<r.minSize.value&&(q(i,{code:$.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),n.dirty()),r.maxSize!==null&&i.data.size>r.maxSize.value&&(q(i,{code:$.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),n.dirty());let o=this._def.valueType;function a(c){let d=new Set;for(let f of c){if(f.status==="aborted")return oe;f.status==="dirty"&&n.dirty(),d.add(f.value)}return{status:n.value,value:d}}let u=[...i.data.values()].map((c,d)=>o._parse(new qt(i,c,i.path,d)));return i.common.async?Promise.all(u).then(c=>a(c)):a(u)}min(e,n){return new t({...this._def,minSize:{value:e,message:Z.toString(n)}})}max(e,n){return new t({...this._def,maxSize:{value:e,message:Z.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}};Qr.create=(t,e)=>new Qr({valueType:t,minSize:null,maxSize:null,typeName:le.ZodSet,...de(e)});var nl=class t extends fe{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==z.function)return q(n,{code:$.invalid_type,expected:z.function,received:n.parsedType}),oe;function i(u,c){return ls({data:u,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,qr(),$n].filter(d=>!!d),issueData:{code:$.invalid_arguments,argumentsError:c}})}function r(u,c){return ls({data:u,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,qr(),$n].filter(d=>!!d),issueData:{code:$.invalid_return_type,returnTypeError:c}})}let o={errorMap:n.common.contextualErrorMap},a=n.data;if(this._def.returns instanceof xi){let u=this;return ct(async function(...c){let d=new wt([]),f=await u._def.args.parseAsync(c,o).catch(y=>{throw d.addIssue(i(c,y)),d}),h=await Reflect.apply(a,this,f);return await u._def.returns._def.type.parseAsync(h,o).catch(y=>{throw d.addIssue(r(h,y)),d})})}else{let u=this;return ct(function(...c){let d=u._def.args.safeParse(c,o);if(!d.success)throw new wt([i(c,d.error)]);let f=Reflect.apply(a,this,d.data),h=u._def.returns.safeParse(f,o);if(!h.success)throw new wt([r(f,h.error)]);return h.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:Tn.create(e).rest(Un.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,n,i){return new t({args:e||Tn.create([]).rest(Un.create()),returns:n||Un.create(),typeName:le.ZodFunction,...de(i)})}},Zi=class extends fe{get schema(){return this._def.getter()}_parse(e){let{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}};Zi.create=(t,e)=>new Zi({getter:t,typeName:le.ZodLazy,...de(e)});var Xi=class extends fe{_parse(e){if(e.data!==this._def.value){let n=this._getOrReturnCtx(e);return q(n,{received:n.data,code:$.invalid_literal,expected:this._def.value}),oe}return{status:"valid",value:e.data}}get value(){return this._def.value}};Xi.create=(t,e)=>new Xi({value:t,typeName:le.ZodLiteral,...de(e)});function cg(t,e){return new ji({values:t,typeName:le.ZodEnum,...de(e)})}var ji=class t extends fe{_parse(e){if(typeof e.data!="string"){let n=this._getOrReturnCtx(e),i=this._def.values;return q(n,{expected:ge.joinValues(i),received:n.parsedType,code:$.invalid_type}),oe}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let n=this._getOrReturnCtx(e),i=this._def.values;return q(n,{received:n.data,code:$.invalid_enum_value,options:i}),oe}return ct(e.data)}get options(){return this._def.values}get enum(){let e={};for(let n of this._def.values)e[n]=n;return e}get Values(){let e={};for(let n of this._def.values)e[n]=n;return e}get Enum(){let e={};for(let n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return t.create(e,{...this._def,...n})}exclude(e,n=this._def){return t.create(this.options.filter(i=>!e.includes(i)),{...this._def,...n})}};ji.create=cg;var er=class extends fe{_parse(e){let n=ge.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(e);if(i.parsedType!==z.string&&i.parsedType!==z.number){let r=ge.objectValues(n);return q(i,{expected:ge.joinValues(r),received:i.parsedType,code:$.invalid_type}),oe}if(this._cache||(this._cache=new Set(ge.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let r=ge.objectValues(n);return q(i,{received:i.data,code:$.invalid_enum_value,options:r}),oe}return ct(e.data)}get enum(){return this._def.values}};er.create=(t,e)=>new er({values:t,typeName:le.ZodNativeEnum,...de(e)});var xi=class extends fe{unwrap(){return this._def.type}_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==z.promise&&n.common.async===!1)return q(n,{code:$.invalid_type,expected:z.promise,received:n.parsedType}),oe;let i=n.parsedType===z.promise?n.data:Promise.resolve(n.data);return ct(i.then(r=>this._def.type.parseAsync(r,{path:n.path,errorMap:n.common.contextualErrorMap})))}};xi.create=(t,e)=>new xi({type:t,typeName:le.ZodPromise,...de(e)});var Kt=class extends fe{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===le.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:n,ctx:i}=this._processInputParams(e),r=this._def.effect||null,o={addIssue:a=>{q(i,a),a.fatal?n.abort():n.dirty()},get path(){return i.path}};if(o.addIssue=o.addIssue.bind(o),r.type==="preprocess"){let a=r.transform(i.data,o);if(i.common.async)return Promise.resolve(a).then(async u=>{if(n.value==="aborted")return oe;let c=await this._def.schema._parseAsync({data:u,path:i.path,parent:i});return c.status==="aborted"?oe:c.status==="dirty"?Oi(c.value):n.value==="dirty"?Oi(c.value):c});{if(n.value==="aborted")return oe;let u=this._def.schema._parseSync({data:a,path:i.path,parent:i});return u.status==="aborted"?oe:u.status==="dirty"?Oi(u.value):n.value==="dirty"?Oi(u.value):u}}if(r.type==="refinement"){let a=u=>{let c=r.refinement(u,o);if(i.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return u};if(i.common.async===!1){let u=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return u.status==="aborted"?oe:(u.status==="dirty"&&n.dirty(),a(u.value),{status:n.value,value:u.value})}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(u=>u.status==="aborted"?oe:(u.status==="dirty"&&n.dirty(),a(u.value).then(()=>({status:n.value,value:u.value}))))}if(r.type==="transform")if(i.common.async===!1){let a=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!gi(a))return oe;let u=r.transform(a.value,o);if(u instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:u}}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(a=>gi(a)?Promise.resolve(r.transform(a.value,o)).then(u=>({status:n.value,value:u})):oe);ge.assertNever(r)}};Kt.create=(t,e,n)=>new Kt({schema:t,typeName:le.ZodEffects,effect:e,...de(n)});Kt.createWithPreprocess=(t,e,n)=>new Kt({schema:e,effect:{type:"preprocess",transform:t},typeName:le.ZodEffects,...de(n)});var Bt=class extends fe{_parse(e){return this._getType(e)===z.undefined?ct(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Bt.create=(t,e)=>new Bt({innerType:t,typeName:le.ZodOptional,...de(e)});var Cn=class extends fe{_parse(e){return this._getType(e)===z.null?ct(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Cn.create=(t,e)=>new Cn({innerType:t,typeName:le.ZodNullable,...de(e)});var tr=class extends fe{_parse(e){let{ctx:n}=this._processInputParams(e),i=n.data;return n.parsedType===z.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:n.path,parent:n})}removeDefault(){return this._def.innerType}};tr.create=(t,e)=>new tr({innerType:t,typeName:le.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...de(e)});var nr=class extends fe{_parse(e){let{ctx:n}=this._processInputParams(e),i={...n,common:{...n.common,issues:[]}},r=this._def.innerType._parse({data:i.data,path:i.path,parent:{...i}});return Kr(r)?r.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new wt(i.common.issues)},input:i.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new wt(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}};nr.create=(t,e)=>new nr({innerType:t,typeName:le.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...de(e)});var Zr=class extends fe{_parse(e){if(this._getType(e)!==z.nan){let i=this._getOrReturnCtx(e);return q(i,{code:$.invalid_type,expected:z.nan,received:i.parsedType}),oe}return{status:"valid",value:e.data}}};Zr.create=t=>new Zr({typeName:le.ZodNaN,...de(t)});var $T=Symbol("zod_brand"),us=class extends fe{_parse(e){let{ctx:n}=this._processInputParams(e),i=n.data;return this._def.type._parse({data:i,path:n.path,parent:n})}unwrap(){return this._def.type}},cs=class t extends fe{_parse(e){let{status:n,ctx:i}=this._processInputParams(e);if(i.common.async)return(async()=>{let o=await this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return o.status==="aborted"?oe:o.status==="dirty"?(n.dirty(),Oi(o.value)):this._def.out._parseAsync({data:o.value,path:i.path,parent:i})})();{let r=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return r.status==="aborted"?oe:r.status==="dirty"?(n.dirty(),{status:"dirty",value:r.value}):this._def.out._parseSync({data:r.value,path:i.path,parent:i})}}static create(e,n){return new t({in:e,out:n,typeName:le.ZodPipeline})}},ir=class extends fe{_parse(e){let n=this._def.innerType._parse(e),i=r=>(gi(r)&&(r.value=Object.freeze(r.value)),r);return Kr(n)?n.then(r=>i(r)):i(n)}unwrap(){return this._def.innerType}};ir.create=(t,e)=>new ir({innerType:t,typeName:le.ZodReadonly,...de(e)});function sg(t,e){let n=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof n=="string"?{message:n}:n}function dg(t,e={},n){return t?vi.create().superRefine((i,r)=>{let o=t(i);if(o instanceof Promise)return o.then(a=>{if(!a){let u=sg(e,i),c=u.fatal??n??!0;r.addIssue({code:"custom",...u,fatal:c})}});if(!o){let a=sg(e,i),u=a.fatal??n??!0;r.addIssue({code:"custom",...a,fatal:u})}}):vi.create()}var GT={object:It.lazycreate},le;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(le||(le={}));var UT=(t,e={message:`Input not instance of ${t.name}`})=>dg(n=>n instanceof t,e),fg=yi.create,hg=Bi.create,HT=Zr.create,OT=qi.create,mg=Ki.create,BT=zi.create,qT=Wr.create,KT=Wi.create,zT=Ji.create,WT=vi.create,JT=Un.create,YT=an.create,QT=Jr.create,ZT=Hn.create,XT=It.create,jT=It.strictCreate,eC=Yi.create,tC=el.create,nC=Qi.create,iC=Tn.create,rC=tl.create,oC=Yr.create,sC=Qr.create,aC=nl.create,lC=Zi.create,uC=Xi.create,cC=ji.create,dC=er.create,fC=xi.create,hC=Kt.create,mC=Bt.create,pC=Cn.create,gC=Kt.createWithPreprocess,yC=cs.create,vC=()=>fg().optional(),xC=()=>hg().optional(),TC=()=>mg().optional(),CC={string:t=>yi.create({...t,coerce:!0}),number:t=>Bi.create({...t,coerce:!0}),boolean:t=>Ki.create({...t,coerce:!0}),bigint:t=>qi.create({...t,coerce:!0}),date:t=>zi.create({...t,coerce:!0})};var kC=oe;var SC,_C;function NC(){return{geminiUrl:SC,vertexUrl:_C}}function wC(t,e,n){var i,r,o;if(!(!((i=t.httpOptions)===null||i===void 0)&&i.baseUrl)){let a=NC();return t.vertexai?(r=a.vertexUrl)!==null&&r!==void 0?r:e:(o=a.geminiUrl)!==null&&o!==void 0?o:n}return t.httpOptions.baseUrl}var Ti=class{};function ue(t,e){let n=/\{([^}]+)\}/g;return t.replace(n,(i,r)=>{if(Object.prototype.hasOwnProperty.call(e,r)){let o=e[r];return o!=null?String(o):""}else throw new Error(`Key '${r}' not found in valueMap.`)})}function l(t,e,n){for(let o=0;o<e.length-1;o++){let a=e[o];if(a.endsWith("[]")){let u=a.slice(0,-2);if(!(u in t))if(Array.isArray(n))t[u]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${a}`);if(Array.isArray(t[u])){let c=t[u];if(Array.isArray(n))for(let d=0;d<c.length;d++){let f=c[d];l(f,e.slice(o+1),n[d])}else for(let d of c)l(d,e.slice(o+1),n)}return}else if(a.endsWith("[0]")){let u=a.slice(0,-3);u in t||(t[u]=[{}]);let c=t[u];l(c[0],e.slice(o+1),n);return}(!t[a]||typeof t[a]!="object")&&(t[a]={}),t=t[a]}let i=e[e.length-1],r=t[i];if(r!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===r)return;if(typeof r=="object"&&typeof n=="object"&&r!==null&&n!==null)Object.assign(r,n);else throw new Error(`Cannot set value for an existing key. Key: ${i}`)}else t[i]=n}function s(t,e){try{if(e.length===1&&e[0]==="_self")return t;for(let n=0;n<e.length;n++){if(typeof t!="object"||t===null)return;let i=e[n];if(i.endsWith("[]")){let r=i.slice(0,-2);if(r in t){let o=t[r];return Array.isArray(o)?o.map(a=>s(a,e.slice(n+1))):void 0}else return}else t=t[i]}return t}catch(n){if(n instanceof TypeError)return;throw n}}var pg;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(pg||(pg={}));var gg;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(gg||(gg={}));var kn;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(kn||(kn={}));var yg;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(yg||(yg={}));var vg;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(vg||(vg={}));var xg;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(xg||(xg={}));var Tg;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Tg||(Tg={}));var Cg;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(Cg||(Cg={}));var kg;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL"})(kg||(kg={}));var Sg;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(Sg||(Sg={}));var _g;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(_g||(_g={}));var Ng;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT"})(Ng||(Ng={}));var wg;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(wg||(wg={}));var ll;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(ll||(ll={}));var Ig;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Ig||(Ig={}));var fd;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(fd||(fd={}));var Eg;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Eg||(Eg={}));var Ag;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(Ag||(Ag={}));var bg;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(bg||(bg={}));var Pg;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Pg||(Pg={}));var Mg;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE"})(Mg||(Mg={}));var Lg;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR"})(Lg||(Lg={}));var Rg;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(Rg||(Rg={}));var Dg;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(Dg||(Dg={}));var Fg;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi"})(Fg||(Fg={}));var Vg;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Vg||(Vg={}));var $g;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})($g||($g={}));var Gg;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Gg||(Gg={}));var Ug;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Ug||(Ug={}));var Hg;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(Hg||(Hg={}));var Og;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"})(Og||(Og={}));var Bg;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(Bg||(Bg={}));var qg;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(qg||(qg={}));var Kg;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Kg||(Kg={}));var zg;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(zg||(zg={}));var Wg;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Wg||(Wg={}));var Jg;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(Jg||(Jg={}));var Yg;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Yg||(Yg={}));var Xr;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(Xr||(Xr={}));var fs=class{constructor(e){let n={};for(let i of e.headers.entries())n[i[0]]=i[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}};var rr=class{get text(){var e,n,i,r,o,a,u,c;if(((r=(i=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",f=!1,h=[];for(let m of(c=(u=(a=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)!==null&&c!==void 0?c:[]){for(let[y,p]of Object.entries(m))y!=="text"&&y!=="thought"&&(p!==null||p!==void 0)&&h.push(y);if(typeof m.text=="string"){if(typeof m.thought=="boolean"&&m.thought)continue;f=!0,d+=m.text}}return h.length>0&&console.warn(`there are non-text parts ${h} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?d:void 0}get data(){var e,n,i,r,o,a,u,c;if(((r=(i=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let d="",f=[];for(let h of(c=(u=(a=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)!==null&&c!==void 0?c:[]){for(let[m,y]of Object.entries(h))m!=="inlineData"&&(y!==null||y!==void 0)&&f.push(m);h.inlineData&&typeof h.inlineData.data=="string"&&(d+=atob(h.inlineData.data))}return f.length>0&&console.warn(`there are non-data parts ${f} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),d.length>0?btoa(d):void 0}get functionCalls(){var e,n,i,r,o,a,u,c;if(((r=(i=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let d=(c=(u=(a=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)===null||c===void 0?void 0:c.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if(d?.length!==0)return d}get executableCode(){var e,n,i,r,o,a,u,c,d;if(((r=(i=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let f=(c=(u=(a=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)===null||c===void 0?void 0:c.filter(h=>h.executableCode).map(h=>h.executableCode).filter(h=>h!==void 0);if(f?.length!==0)return(d=f?.[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var e,n,i,r,o,a,u,c,d;if(((r=(i=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let f=(c=(u=(a=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)===null||c===void 0?void 0:c.filter(h=>h.codeExecutionResult).map(h=>h.codeExecutionResult).filter(h=>h!==void 0);if(f?.length!==0)return(d=f?.[0])===null||d===void 0?void 0:d.output}},ul=class{},cl=class{},hd=class{},md=class{},dl=class{},fl=class{},hl=class{},pd=class{};var ml=class{},pl=class{},gl=class{},gd=class{},yd=class{},vd=class{};var xd=class{get text(){var e,n,i;let r="",o=!1,a=[];for(let u of(i=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&i!==void 0?i:[]){for(let[c,d]of Object.entries(u))c!=="text"&&c!=="thought"&&d!==null&&a.push(c);if(typeof u.text=="string"){if(typeof u.thought=="boolean"&&u.thought)continue;o=!0,r+=u.text}}return a.length>0&&console.warn(`there are non-text parts ${a} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?r:void 0}get data(){var e,n,i;let r="",o=[];for(let a of(i=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&i!==void 0?i:[]){for(let[u,c]of Object.entries(a))u!=="inlineData"&&c!==null&&o.push(u);a.inlineData&&typeof a.inlineData.data=="string"&&(r+=atob(a.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),r.length>0?btoa(r):void 0}};var Td=class{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}};function we(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){let n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function Ty(t,e){let n=we(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function Cy(t){return Array.isArray(t)?t.map(e=>yl(e)):[yl(t)]}function yl(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function IC(t){let e=yl(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function EC(t){let e=yl(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Qg(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function ky(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>Qg(e)):[Qg(t)]}function Cd(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function Zg(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function Xg(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function yt(t){if(t==null)throw new Error("ContentUnion is required");return Cd(t)?t:{role:"user",parts:ky(t)}}function Sy(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{let i=yt(n);return i.parts&&i.parts.length>0&&i.parts[0].text!==void 0?[i.parts[0].text]:[]});if(t.isVertexAI()){let n=yt(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>yt(n)):[yt(e)]}function ln(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(Zg(t)||Xg(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[yt(t)]}let e=[],n=[],i=Cd(t[0]);for(let r of t){let o=Cd(r);if(o!=i)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(o)e.push(r);else{if(Zg(r)||Xg(r))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(r)}}return i||e.push({role:"user",parts:ky(n)}),e}var AC=new Set(["type","format","title","description","default","items","minItems","maxItems","enum","properties","required","minProperties","maxProperties","minimum","maximum","minLength","maxLength","pattern","anyOf","propertyOrdering"]),jg=xe.enum(["string","number","integer","object","array","boolean","null"]),bC=xe.union([jg,xe.array(jg)]);function PC(t=!0){let e=xe.lazy(()=>{let n=xe.object({type:bC.optional(),format:xe.string().optional(),title:xe.string().optional(),description:xe.string().optional(),default:xe.unknown().optional(),items:e.optional(),minItems:xe.coerce.string().optional(),maxItems:xe.coerce.string().optional(),enum:xe.array(xe.unknown()).optional(),properties:xe.record(xe.string(),e).optional(),required:xe.array(xe.string()).optional(),minProperties:xe.coerce.string().optional(),maxProperties:xe.coerce.string().optional(),propertyOrdering:xe.array(xe.string()).optional(),minimum:xe.number().optional(),maximum:xe.number().optional(),minLength:xe.coerce.string().optional(),maxLength:xe.coerce.string().optional(),pattern:xe.string().optional(),anyOf:xe.array(e).optional(),additionalProperties:xe.boolean().optional()});return t?n.strict():n});return e}function MC(t,e){t.includes("null")&&(e.nullable=!0);let n=t.filter(i=>i!=="null");if(n.length===1)e.type=Object.values(kn).includes(n[0].toUpperCase())?n[0].toUpperCase():kn.TYPE_UNSPECIFIED;else{e.anyOf=[];for(let i of n)e.anyOf.push({type:Object.values(kn).includes(i.toUpperCase())?i.toUpperCase():kn.TYPE_UNSPECIFIED})}}function jr(t){let e={},n=["items"],i=["anyOf"],r=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");let o=t.anyOf;o!=null&&o.length==2&&(o[0].type==="null"?(e.nullable=!0,t=o[1]):o[1].type==="null"&&(e.nullable=!0,t=o[0])),t.type instanceof Array&&MC(t.type,e);for(let[a,u]of Object.entries(t))if(u!=null)if(a=="type"){if(u==="null")throw new Error("type: null can not be the only possible type for the field.");if(u instanceof Array)continue;e.type=Object.values(kn).includes(u.toUpperCase())?u.toUpperCase():kn.TYPE_UNSPECIFIED}else if(n.includes(a))e[a]=jr(u);else if(i.includes(a)){let c=[];for(let d of u){if(d.type=="null"){e.nullable=!0;continue}c.push(jr(d))}e[a]=c}else if(r.includes(a)){let c={};for(let[d,f]of Object.entries(u))c[d]=jr(f);e[a]=c}else{if(a==="additionalProperties")continue;e[a]=u}return e}function vl(t){if(Object.keys(t).includes("$schema")){delete t.$schema;let e=PC().parse(t);return jr(e)}else return jr(t)}function _y(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function Wd(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function ms(t){if(t.functionDeclarations)for(let e of t.functionDeclarations)e.parameters&&(e.parameters=vl(e.parameters)),e.response&&(e.response=vl(e.response));return t}function ps(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");let e=[];for(let n of t)e.push(n);return e}function LC(t,e,n,i=1){let r=!e.startsWith(`${n}/`)&&e.split("/").length===i;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:r?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:r?`${n}/${e}`:e}function Ci(t,e){if(typeof e!="string")throw new Error("name must be a string");return LC(t,e,"cachedContents")}function Ny(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function On(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}function RC(t){return t!=null&&typeof t=="object"&&"name"in t}function DC(t){return t!=null&&typeof t=="object"&&"video"in t}function FC(t){return t!=null&&typeof t=="object"&&"uri"in t}function wy(t){var e;let n;if(RC(t)&&(n=t.name),!(FC(t)&&(n=t.uri,n===void 0))&&!(DC(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){let r=n.split("files/")[1].match(/[a-z0-9]+/);if(r===null)throw new Error(`Could not extract file name from URI ${n}`);n=r[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function Iy(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function Ey(t){for(let e of["models","tunedModels","publisherModels"])if(VC(t,e))return t[e];return[]}function VC(t,e){return t!==null&&typeof t=="object"&&e in t}function $C(t,e={}){let n=t,i={name:n.name,description:n.description,parameters:jr(Tl(n.inputSchema))};return e.behavior&&(i.behavior=e.behavior),{functionDeclarations:[i]}}function GC(t,e={}){let n=[],i=new Set;for(let r of t){let o=r.name;if(i.has(o))throw new Error(`Duplicate function name ${o} found in MCP tools. Please ensure function names are unique.`);i.add(o);let a=$C(r,e);a.functionDeclarations&&n.push(...a.functionDeclarations)}return{functionDeclarations:n}}function UC(t){let e=[];for(let n of t)e.push(Tl(n));return e}function HC(t){let e={};for(let[n,i]of Object.entries(t)){let r=i;e[n]=Tl(r)}return e}function Tl(t){let e=new Set(["items"]),n=new Set(["anyOf"]),i=new Set(["properties"]),r={};for(let[o,a]of Object.entries(t))if(e.has(o))r[o]=Tl(a);else if(n.has(o))r[o]=UC(a);else if(i.has(o))r[o]=HC(a);else if(o==="type"){let u=a.toUpperCase();r[o]=Object.values(kn).includes(u)?u:kn.TYPE_UNSPECIFIED}else AC.has(o)&&(r[o]=a);return r}function OC(t){let e={},n=s(t,["fps"]);n!=null&&l(e,["fps"],n);let i=s(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let r=s(t,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function BC(t){let e={};if(s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=s(t,["data"]);n!=null&&l(e,["data"],n);let i=s(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function qC(t){let e={};if(s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=s(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);let i=s(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function KC(t){let e={},n=s(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],OC(n));let i=s(t,["thought"]);i!=null&&l(e,["thought"],i);let r=s(t,["inlineData"]);r!=null&&l(e,["inlineData"],BC(r));let o=s(t,["fileData"]);o!=null&&l(e,["fileData"],qC(o));let a=s(t,["thoughtSignature"]);a!=null&&l(e,["thoughtSignature"],a);let u=s(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let c=s(t,["executableCode"]);c!=null&&l(e,["executableCode"],c);let d=s(t,["functionCall"]);d!=null&&l(e,["functionCall"],d);let f=s(t,["functionResponse"]);f!=null&&l(e,["functionResponse"],f);let h=s(t,["text"]);return h!=null&&l(e,["text"],h),e}function ey(t){let e={},n=s(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>KC(o))),l(e,["parts"],r)}let i=s(t,["role"]);return i!=null&&l(e,["role"],i),e}function zC(t){let e={},n=s(t,["behavior"]);n!=null&&l(e,["behavior"],n);let i=s(t,["description"]);i!=null&&l(e,["description"],i);let r=s(t,["name"]);r!=null&&l(e,["name"],r);let o=s(t,["parameters"]);o!=null&&l(e,["parameters"],o);let a=s(t,["parametersJsonSchema"]);a!=null&&l(e,["parametersJsonSchema"],a);let u=s(t,["response"]);u!=null&&l(e,["response"],u);let c=s(t,["responseJsonSchema"]);return c!=null&&l(e,["responseJsonSchema"],c),e}function WC(t){let e={},n=s(t,["startTime"]);n!=null&&l(e,["startTime"],n);let i=s(t,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function JC(t){let e={},n=s(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],WC(n)),e}function YC(t){let e={},n=s(t,["mode"]);n!=null&&l(e,["mode"],n);let i=s(t,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function QC(t){let e={},n=s(t,["dynamicRetrievalConfig"]);return n!=null&&l(e,["dynamicRetrievalConfig"],YC(n)),e}function ZC(){return{}}function XC(t){let e={},n=s(t,["functionDeclarations"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(c=>zC(c))),l(e,["functionDeclarations"],u)}if(s(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let i=s(t,["googleSearch"]);i!=null&&l(e,["googleSearch"],JC(i));let r=s(t,["googleSearchRetrieval"]);if(r!=null&&l(e,["googleSearchRetrieval"],QC(r)),s(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(s(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");s(t,["urlContext"])!=null&&l(e,["urlContext"],ZC());let a=s(t,["codeExecution"]);return a!=null&&l(e,["codeExecution"],a),e}function jC(t){let e={},n=s(t,["mode"]);n!=null&&l(e,["mode"],n);let i=s(t,["allowedFunctionNames"]);return i!=null&&l(e,["allowedFunctionNames"],i),e}function ek(t){let e={},n=s(t,["latitude"]);n!=null&&l(e,["latitude"],n);let i=s(t,["longitude"]);return i!=null&&l(e,["longitude"],i),e}function tk(t){let e={},n=s(t,["latLng"]);n!=null&&l(e,["latLng"],ek(n));let i=s(t,["languageCode"]);return i!=null&&l(e,["languageCode"],i),e}function nk(t){let e={},n=s(t,["functionCallingConfig"]);n!=null&&l(e,["functionCallingConfig"],jC(n));let i=s(t,["retrievalConfig"]);return i!=null&&l(e,["retrievalConfig"],tk(i)),e}function ik(t,e){let n={},i=s(t,["ttl"]);e!==void 0&&i!=null&&l(e,["ttl"],i);let r=s(t,["expireTime"]);e!==void 0&&r!=null&&l(e,["expireTime"],r);let o=s(t,["displayName"]);e!==void 0&&o!=null&&l(e,["displayName"],o);let a=s(t,["contents"]);if(e!==void 0&&a!=null){let f=ln(a);Array.isArray(f)&&(f=f.map(h=>ey(h))),l(e,["contents"],f)}let u=s(t,["systemInstruction"]);e!==void 0&&u!=null&&l(e,["systemInstruction"],ey(yt(u)));let c=s(t,["tools"]);if(e!==void 0&&c!=null){let f=c;Array.isArray(f)&&(f=f.map(h=>XC(h))),l(e,["tools"],f)}let d=s(t,["toolConfig"]);if(e!==void 0&&d!=null&&l(e,["toolConfig"],nk(d)),s(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function rk(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["model"],Ty(t,i));let r=s(e,["config"]);return r!=null&&l(n,["config"],ik(r,n)),n}function ok(t,e){let n={},i=s(e,["name"]);i!=null&&l(n,["_url","name"],Ci(t,i));let r=s(e,["config"]);return r!=null&&l(n,["config"],r),n}function sk(t,e){let n={},i=s(e,["name"]);i!=null&&l(n,["_url","name"],Ci(t,i));let r=s(e,["config"]);return r!=null&&l(n,["config"],r),n}function ak(t,e){let n={},i=s(t,["ttl"]);e!==void 0&&i!=null&&l(e,["ttl"],i);let r=s(t,["expireTime"]);return e!==void 0&&r!=null&&l(e,["expireTime"],r),n}function lk(t,e){let n={},i=s(e,["name"]);i!=null&&l(n,["_url","name"],Ci(t,i));let r=s(e,["config"]);return r!=null&&l(n,["config"],ak(r,n)),n}function uk(t,e){let n={},i=s(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);let r=s(t,["pageToken"]);return e!==void 0&&r!=null&&l(e,["_query","pageToken"],r),n}function ck(t){let e={},n=s(t,["config"]);return n!=null&&l(e,["config"],uk(n,e)),e}function dk(t){let e={},n=s(t,["fps"]);n!=null&&l(e,["fps"],n);let i=s(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let r=s(t,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function fk(t){let e={},n=s(t,["displayName"]);n!=null&&l(e,["displayName"],n);let i=s(t,["data"]);i!=null&&l(e,["data"],i);let r=s(t,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function hk(t){let e={},n=s(t,["displayName"]);n!=null&&l(e,["displayName"],n);let i=s(t,["fileUri"]);i!=null&&l(e,["fileUri"],i);let r=s(t,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function mk(t){let e={},n=s(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],dk(n));let i=s(t,["thought"]);i!=null&&l(e,["thought"],i);let r=s(t,["inlineData"]);r!=null&&l(e,["inlineData"],fk(r));let o=s(t,["fileData"]);o!=null&&l(e,["fileData"],hk(o));let a=s(t,["thoughtSignature"]);a!=null&&l(e,["thoughtSignature"],a);let u=s(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let c=s(t,["executableCode"]);c!=null&&l(e,["executableCode"],c);let d=s(t,["functionCall"]);d!=null&&l(e,["functionCall"],d);let f=s(t,["functionResponse"]);f!=null&&l(e,["functionResponse"],f);let h=s(t,["text"]);return h!=null&&l(e,["text"],h),e}function ty(t){let e={},n=s(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>mk(o))),l(e,["parts"],r)}let i=s(t,["role"]);return i!=null&&l(e,["role"],i),e}function pk(t){let e={};if(s(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let n=s(t,["description"]);n!=null&&l(e,["description"],n);let i=s(t,["name"]);i!=null&&l(e,["name"],i);let r=s(t,["parameters"]);r!=null&&l(e,["parameters"],r);let o=s(t,["parametersJsonSchema"]);o!=null&&l(e,["parametersJsonSchema"],o);let a=s(t,["response"]);a!=null&&l(e,["response"],a);let u=s(t,["responseJsonSchema"]);return u!=null&&l(e,["responseJsonSchema"],u),e}function gk(t){let e={},n=s(t,["startTime"]);n!=null&&l(e,["startTime"],n);let i=s(t,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function yk(t){let e={},n=s(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],gk(n)),e}function vk(t){let e={},n=s(t,["mode"]);n!=null&&l(e,["mode"],n);let i=s(t,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function xk(t){let e={},n=s(t,["dynamicRetrievalConfig"]);return n!=null&&l(e,["dynamicRetrievalConfig"],vk(n)),e}function Tk(){return{}}function Ck(t){let e={},n=s(t,["apiKeyString"]);return n!=null&&l(e,["apiKeyString"],n),e}function kk(t){let e={},n=s(t,["apiKeyConfig"]);n!=null&&l(e,["apiKeyConfig"],Ck(n));let i=s(t,["authType"]);i!=null&&l(e,["authType"],i);let r=s(t,["googleServiceAccountConfig"]);r!=null&&l(e,["googleServiceAccountConfig"],r);let o=s(t,["httpBasicAuthConfig"]);o!=null&&l(e,["httpBasicAuthConfig"],o);let a=s(t,["oauthConfig"]);a!=null&&l(e,["oauthConfig"],a);let u=s(t,["oidcConfig"]);return u!=null&&l(e,["oidcConfig"],u),e}function Sk(t){let e={},n=s(t,["authConfig"]);return n!=null&&l(e,["authConfig"],kk(n)),e}function _k(){return{}}function Nk(t){let e={},n=s(t,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(h=>pk(h))),l(e,["functionDeclarations"],f)}let i=s(t,["retrieval"]);i!=null&&l(e,["retrieval"],i);let r=s(t,["googleSearch"]);r!=null&&l(e,["googleSearch"],yk(r));let o=s(t,["googleSearchRetrieval"]);o!=null&&l(e,["googleSearchRetrieval"],xk(o)),s(t,["enterpriseWebSearch"])!=null&&l(e,["enterpriseWebSearch"],Tk());let u=s(t,["googleMaps"]);u!=null&&l(e,["googleMaps"],Sk(u)),s(t,["urlContext"])!=null&&l(e,["urlContext"],_k());let d=s(t,["codeExecution"]);return d!=null&&l(e,["codeExecution"],d),e}function wk(t){let e={},n=s(t,["mode"]);n!=null&&l(e,["mode"],n);let i=s(t,["allowedFunctionNames"]);return i!=null&&l(e,["allowedFunctionNames"],i),e}function Ik(t){let e={},n=s(t,["latitude"]);n!=null&&l(e,["latitude"],n);let i=s(t,["longitude"]);return i!=null&&l(e,["longitude"],i),e}function Ek(t){let e={},n=s(t,["latLng"]);n!=null&&l(e,["latLng"],Ik(n));let i=s(t,["languageCode"]);return i!=null&&l(e,["languageCode"],i),e}function Ak(t){let e={},n=s(t,["functionCallingConfig"]);n!=null&&l(e,["functionCallingConfig"],wk(n));let i=s(t,["retrievalConfig"]);return i!=null&&l(e,["retrievalConfig"],Ek(i)),e}function bk(t,e){let n={},i=s(t,["ttl"]);e!==void 0&&i!=null&&l(e,["ttl"],i);let r=s(t,["expireTime"]);e!==void 0&&r!=null&&l(e,["expireTime"],r);let o=s(t,["displayName"]);e!==void 0&&o!=null&&l(e,["displayName"],o);let a=s(t,["contents"]);if(e!==void 0&&a!=null){let h=ln(a);Array.isArray(h)&&(h=h.map(m=>ty(m))),l(e,["contents"],h)}let u=s(t,["systemInstruction"]);e!==void 0&&u!=null&&l(e,["systemInstruction"],ty(yt(u)));let c=s(t,["tools"]);if(e!==void 0&&c!=null){let h=c;Array.isArray(h)&&(h=h.map(m=>Nk(m))),l(e,["tools"],h)}let d=s(t,["toolConfig"]);e!==void 0&&d!=null&&l(e,["toolConfig"],Ak(d));let f=s(t,["kmsKeyName"]);return e!==void 0&&f!=null&&l(e,["encryption_spec","kmsKeyName"],f),n}function Pk(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["model"],Ty(t,i));let r=s(e,["config"]);return r!=null&&l(n,["config"],bk(r,n)),n}function Mk(t,e){let n={},i=s(e,["name"]);i!=null&&l(n,["_url","name"],Ci(t,i));let r=s(e,["config"]);return r!=null&&l(n,["config"],r),n}function Lk(t,e){let n={},i=s(e,["name"]);i!=null&&l(n,["_url","name"],Ci(t,i));let r=s(e,["config"]);return r!=null&&l(n,["config"],r),n}function Rk(t,e){let n={},i=s(t,["ttl"]);e!==void 0&&i!=null&&l(e,["ttl"],i);let r=s(t,["expireTime"]);return e!==void 0&&r!=null&&l(e,["expireTime"],r),n}function Dk(t,e){let n={},i=s(e,["name"]);i!=null&&l(n,["_url","name"],Ci(t,i));let r=s(e,["config"]);return r!=null&&l(n,["config"],Rk(r,n)),n}function Fk(t,e){let n={},i=s(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);let r=s(t,["pageToken"]);return e!==void 0&&r!=null&&l(e,["_query","pageToken"],r),n}function Vk(t){let e={},n=s(t,["config"]);return n!=null&&l(e,["config"],Fk(n,e)),e}function ol(t){let e={},n=s(t,["name"]);n!=null&&l(e,["name"],n);let i=s(t,["displayName"]);i!=null&&l(e,["displayName"],i);let r=s(t,["model"]);r!=null&&l(e,["model"],r);let o=s(t,["createTime"]);o!=null&&l(e,["createTime"],o);let a=s(t,["updateTime"]);a!=null&&l(e,["updateTime"],a);let u=s(t,["expireTime"]);u!=null&&l(e,["expireTime"],u);let c=s(t,["usageMetadata"]);return c!=null&&l(e,["usageMetadata"],c),e}function $k(){return{}}function Gk(t){let e={},n=s(t,["nextPageToken"]);n!=null&&l(e,["nextPageToken"],n);let i=s(t,["cachedContents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>ol(o))),l(e,["cachedContents"],r)}return e}function sl(t){let e={},n=s(t,["name"]);n!=null&&l(e,["name"],n);let i=s(t,["displayName"]);i!=null&&l(e,["displayName"],i);let r=s(t,["model"]);r!=null&&l(e,["model"],r);let o=s(t,["createTime"]);o!=null&&l(e,["createTime"],o);let a=s(t,["updateTime"]);a!=null&&l(e,["updateTime"],a);let u=s(t,["expireTime"]);u!=null&&l(e,["expireTime"],u);let c=s(t,["usageMetadata"]);return c!=null&&l(e,["usageMetadata"],c),e}function Uk(){return{}}function Hk(t){let e={},n=s(t,["nextPageToken"]);n!=null&&l(e,["nextPageToken"],n);let i=s(t,["cachedContents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>sl(o))),l(e,["cachedContents"],r)}return e}var to;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(to||(to={}));var no=class{constructor(e,n,i,r){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,i,r)}init(e,n,i){var r,o;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.idxInternal=0;let a={config:{}};i?typeof i=="object"?a=Object.assign({},i):a=i:a={config:{}},a.config&&(a.config.pageToken=n.nextPageToken),this.paramsInternal=a,this.pageInternalSize=(o=(r=a.config)===null||r===void 0?void 0:r.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}};var kd=class extends Ti{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new no(to.PAGED_ITEM_CACHED_CONTENTS,i=>this.listInternal(i),await this.listInternal(n),n)}async create(e){var n,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let d=Pk(this.apiClient,e);return u=ue("cachedContents",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),a.then(f=>sl(f))}else{let d=rk(this.apiClient,e);return u=ue("cachedContents",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>ol(f))}}async get(e){var n,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let d=Mk(this.apiClient,e);return u=ue("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),a.then(f=>sl(f))}else{let d=ok(this.apiClient,e);return u=ue("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>ol(f))}}async delete(e){var n,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let d=Lk(this.apiClient,e);return u=ue("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),a.then(()=>{let f=Uk(),h=new pl;return Object.assign(h,f),h})}else{let d=sk(this.apiClient,e);return u=ue("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(()=>{let f=$k(),h=new pl;return Object.assign(h,f),h})}}async update(e){var n,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let d=Dk(this.apiClient,e);return u=ue("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),a.then(f=>sl(f))}else{let d=lk(this.apiClient,e);return u=ue("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>ol(f))}}async listInternal(e){var n,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let d=Vk(e);return u=ue("cachedContents",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),a.then(f=>{let h=Hk(f),m=new gl;return Object.assign(m,h),m})}else{let d=ck(e);return u=ue("cachedContents",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>{let h=Gk(f),m=new gl;return Object.assign(m,h),m})}}};function ny(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function be(t){return this instanceof be?(this.v=t,this):new be(t)}function eo(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(t,e||[]),r,o=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",a),r[Symbol.asyncIterator]=function(){return this},r;function a(y){return function(p){return Promise.resolve(p).then(y,h)}}function u(y,p){i[y]&&(r[y]=function(T){return new Promise(function(R,C){o.push([y,T,R,C])>1||c(y,T)})},p&&(r[y]=p(r[y])))}function c(y,p){try{d(i[y](p))}catch(T){m(o[0][3],T)}}function d(y){y.value instanceof be?Promise.resolve(y.value.v).then(f,h):m(o[0][2],y)}function f(y){c("next",y)}function h(y){c("throw",y)}function m(y,p){y(p),o.shift(),o.length&&c(o[0][0],o[0][1])}}function ds(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof ny=="function"?ny(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(o){n[o]=t[o]&&function(a){return new Promise(function(u,c){a=t[o](a),r(u,c,a.done,a.value)})}}function r(o,a,u,c){Promise.resolve(c).then(function(d){o({value:d,done:u})},a)}}function Ok(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;let n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:Ay(n)}function Ay(t){if(t.parts===void 0||t.parts.length===0)return!1;for(let e of t.parts)if(e===void 0||Object.keys(e).length===0||!e.thought&&e.text!==void 0&&e.text==="")return!1;return!0}function Bk(t){if(t.length!==0){for(let e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function iy(t){if(t===void 0||t.length===0)return[];let e=[],n=t.length,i=0;for(;i<n;)if(t[i].role==="user")e.push(t[i]),i++;else{let r=[],o=!0;for(;i<n&&t[i].role==="model";)r.push(t[i]),o&&!Ay(t[i])&&(o=!1),i++;o?e.push(...r):e.pop()}return e}var Sd=class{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new _d(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}},_d=class{constructor(e,n,i,r={},o=[]){this.apiClient=e,this.modelsModule=n,this.model=i,this.config=r,this.history=o,this.sendPromise=Promise.resolve(),Bk(o)}async sendMessage(e){var n;await this.sendPromise;let i=yt(e.message),r=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(i),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var o,a,u;let c=await r,d=(a=(o=c.candidates)===null||o===void 0?void 0:o[0])===null||a===void 0?void 0:a.content,f=c.automaticFunctionCallingHistory,h=this.getHistory(!0).length,m=[];f!=null&&(m=(u=f.slice(h))!==null&&u!==void 0?u:[]);let y=d?[d]:[];this.recordHistory(i,y,m)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),r}async sendMessageStream(e){var n;await this.sendPromise;let i=yt(e.message),r=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(i),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=r.then(()=>{}).catch(()=>{});let o=await r;return this.processStreamResponse(o,i)}getHistory(e=!1){let n=e?iy(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){var i,r;return eo(this,arguments,function*(){var a,u,c,d;let f=[];try{for(var h=!0,m=ds(e),y;y=yield be(m.next()),a=y.done,!a;h=!0){d=y.value,h=!1;let p=d;if(Ok(p)){let T=(r=(i=p.candidates)===null||i===void 0?void 0:i[0])===null||r===void 0?void 0:r.content;T!==void 0&&f.push(T)}yield yield be(p)}}catch(p){u={error:p}}finally{try{!h&&!a&&(c=m.return)&&(yield be(c.call(m)))}finally{if(u)throw u.error}}this.recordHistory(n,f)})}recordHistory(e,n,i){let r=[];n.length>0&&n.every(o=>o.role!==void 0)?r=n:r.push({role:"model",parts:[]}),i&&i.length>0?this.history.push(...iy(i)):this.history.push(e),this.history.push(...r)}};var xl=class t extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,t.prototype)}};function qk(t,e){let n={},i=s(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);let r=s(t,["pageToken"]);return e!==void 0&&r!=null&&l(e,["_query","pageToken"],r),n}function Kk(t){let e={},n=s(t,["config"]);return n!=null&&l(e,["config"],qk(n,e)),e}function zk(t){let e={},n=s(t,["details"]);n!=null&&l(e,["details"],n);let i=s(t,["message"]);i!=null&&l(e,["message"],i);let r=s(t,["code"]);return r!=null&&l(e,["code"],r),e}function Wk(t){let e={},n=s(t,["name"]);n!=null&&l(e,["name"],n);let i=s(t,["displayName"]);i!=null&&l(e,["displayName"],i);let r=s(t,["mimeType"]);r!=null&&l(e,["mimeType"],r);let o=s(t,["sizeBytes"]);o!=null&&l(e,["sizeBytes"],o);let a=s(t,["createTime"]);a!=null&&l(e,["createTime"],a);let u=s(t,["expirationTime"]);u!=null&&l(e,["expirationTime"],u);let c=s(t,["updateTime"]);c!=null&&l(e,["updateTime"],c);let d=s(t,["sha256Hash"]);d!=null&&l(e,["sha256Hash"],d);let f=s(t,["uri"]);f!=null&&l(e,["uri"],f);let h=s(t,["downloadUri"]);h!=null&&l(e,["downloadUri"],h);let m=s(t,["state"]);m!=null&&l(e,["state"],m);let y=s(t,["source"]);y!=null&&l(e,["source"],y);let p=s(t,["videoMetadata"]);p!=null&&l(e,["videoMetadata"],p);let T=s(t,["error"]);return T!=null&&l(e,["error"],zk(T)),e}function Jk(t){let e={},n=s(t,["file"]);n!=null&&l(e,["file"],Wk(n));let i=s(t,["config"]);return i!=null&&l(e,["config"],i),e}function Yk(t){let e={},n=s(t,["name"]);n!=null&&l(e,["_url","file"],wy(n));let i=s(t,["config"]);return i!=null&&l(e,["config"],i),e}function Qk(t){let e={},n=s(t,["name"]);n!=null&&l(e,["_url","file"],wy(n));let i=s(t,["config"]);return i!=null&&l(e,["config"],i),e}function Zk(t){let e={},n=s(t,["details"]);n!=null&&l(e,["details"],n);let i=s(t,["message"]);i!=null&&l(e,["message"],i);let r=s(t,["code"]);return r!=null&&l(e,["code"],r),e}function Nd(t){let e={},n=s(t,["name"]);n!=null&&l(e,["name"],n);let i=s(t,["displayName"]);i!=null&&l(e,["displayName"],i);let r=s(t,["mimeType"]);r!=null&&l(e,["mimeType"],r);let o=s(t,["sizeBytes"]);o!=null&&l(e,["sizeBytes"],o);let a=s(t,["createTime"]);a!=null&&l(e,["createTime"],a);let u=s(t,["expirationTime"]);u!=null&&l(e,["expirationTime"],u);let c=s(t,["updateTime"]);c!=null&&l(e,["updateTime"],c);let d=s(t,["sha256Hash"]);d!=null&&l(e,["sha256Hash"],d);let f=s(t,["uri"]);f!=null&&l(e,["uri"],f);let h=s(t,["downloadUri"]);h!=null&&l(e,["downloadUri"],h);let m=s(t,["state"]);m!=null&&l(e,["state"],m);let y=s(t,["source"]);y!=null&&l(e,["source"],y);let p=s(t,["videoMetadata"]);p!=null&&l(e,["videoMetadata"],p);let T=s(t,["error"]);return T!=null&&l(e,["error"],Zk(T)),e}function Xk(t){let e={},n=s(t,["nextPageToken"]);n!=null&&l(e,["nextPageToken"],n);let i=s(t,["files"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>Nd(o))),l(e,["files"],r)}return e}function jk(){return{}}function eS(){return{}}var wd=class extends Ti{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new no(to.PAGED_ITEM_FILES,i=>this.listInternal(i),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>Nd(n))}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var n,i;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=Kk(e);return o=ue("files",u._url),a=u._query,delete u.config,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>{let d=Xk(c),f=new gd;return Object.assign(f,d),f})}}async createInternal(e){var n,i;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=Jk(e);return o=ue("upload/v1beta/files",u._url),a=u._query,delete u.config,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(()=>{let c=jk(),d=new yd;return Object.assign(d,c),d})}}async get(e){var n,i;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=Yk(e);return o=ue("files/{file}",u._url),a=u._query,delete u.config,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>Nd(c))}}async delete(e){var n,i;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=Qk(e);return o=ue("files/{file}",u._url),a=u._query,delete u.config,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(()=>{let c=eS(),d=new vd;return Object.assign(d,c),d})}}};function tS(t){let e={},n=s(t,["voiceName"]);return n!=null&&l(e,["voiceName"],n),e}function nS(t){let e={},n=s(t,["voiceName"]);return n!=null&&l(e,["voiceName"],n),e}function by(t){let e={},n=s(t,["prebuiltVoiceConfig"]);return n!=null&&l(e,["prebuiltVoiceConfig"],tS(n)),e}function iS(t){let e={},n=s(t,["prebuiltVoiceConfig"]);return n!=null&&l(e,["prebuiltVoiceConfig"],nS(n)),e}function rS(t){let e={},n=s(t,["speaker"]);n!=null&&l(e,["speaker"],n);let i=s(t,["voiceConfig"]);return i!=null&&l(e,["voiceConfig"],by(i)),e}function oS(t){let e={},n=s(t,["speakerVoiceConfigs"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>rS(r))),l(e,["speakerVoiceConfigs"],i)}return e}function sS(t){let e={},n=s(t,["voiceConfig"]);n!=null&&l(e,["voiceConfig"],by(n));let i=s(t,["multiSpeakerVoiceConfig"]);i!=null&&l(e,["multiSpeakerVoiceConfig"],oS(i));let r=s(t,["languageCode"]);return r!=null&&l(e,["languageCode"],r),e}function aS(t){let e={},n=s(t,["voiceConfig"]);if(n!=null&&l(e,["voiceConfig"],iS(n)),s(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");let i=s(t,["languageCode"]);return i!=null&&l(e,["languageCode"],i),e}function lS(t){let e={},n=s(t,["fps"]);n!=null&&l(e,["fps"],n);let i=s(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let r=s(t,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function uS(t){let e={},n=s(t,["fps"]);n!=null&&l(e,["fps"],n);let i=s(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let r=s(t,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function cS(t){let e={};if(s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=s(t,["data"]);n!=null&&l(e,["data"],n);let i=s(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function dS(t){let e={},n=s(t,["displayName"]);n!=null&&l(e,["displayName"],n);let i=s(t,["data"]);i!=null&&l(e,["data"],i);let r=s(t,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function fS(t){let e={};if(s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=s(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);let i=s(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function hS(t){let e={},n=s(t,["displayName"]);n!=null&&l(e,["displayName"],n);let i=s(t,["fileUri"]);i!=null&&l(e,["fileUri"],i);let r=s(t,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function mS(t){let e={},n=s(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],lS(n));let i=s(t,["thought"]);i!=null&&l(e,["thought"],i);let r=s(t,["inlineData"]);r!=null&&l(e,["inlineData"],cS(r));let o=s(t,["fileData"]);o!=null&&l(e,["fileData"],fS(o));let a=s(t,["thoughtSignature"]);a!=null&&l(e,["thoughtSignature"],a);let u=s(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let c=s(t,["executableCode"]);c!=null&&l(e,["executableCode"],c);let d=s(t,["functionCall"]);d!=null&&l(e,["functionCall"],d);let f=s(t,["functionResponse"]);f!=null&&l(e,["functionResponse"],f);let h=s(t,["text"]);return h!=null&&l(e,["text"],h),e}function pS(t){let e={},n=s(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],uS(n));let i=s(t,["thought"]);i!=null&&l(e,["thought"],i);let r=s(t,["inlineData"]);r!=null&&l(e,["inlineData"],dS(r));let o=s(t,["fileData"]);o!=null&&l(e,["fileData"],hS(o));let a=s(t,["thoughtSignature"]);a!=null&&l(e,["thoughtSignature"],a);let u=s(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let c=s(t,["executableCode"]);c!=null&&l(e,["executableCode"],c);let d=s(t,["functionCall"]);d!=null&&l(e,["functionCall"],d);let f=s(t,["functionResponse"]);f!=null&&l(e,["functionResponse"],f);let h=s(t,["text"]);return h!=null&&l(e,["text"],h),e}function gS(t){let e={},n=s(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>mS(o))),l(e,["parts"],r)}let i=s(t,["role"]);return i!=null&&l(e,["role"],i),e}function yS(t){let e={},n=s(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>pS(o))),l(e,["parts"],r)}let i=s(t,["role"]);return i!=null&&l(e,["role"],i),e}function vS(t){let e={},n=s(t,["behavior"]);n!=null&&l(e,["behavior"],n);let i=s(t,["description"]);i!=null&&l(e,["description"],i);let r=s(t,["name"]);r!=null&&l(e,["name"],r);let o=s(t,["parameters"]);o!=null&&l(e,["parameters"],o);let a=s(t,["parametersJsonSchema"]);a!=null&&l(e,["parametersJsonSchema"],a);let u=s(t,["response"]);u!=null&&l(e,["response"],u);let c=s(t,["responseJsonSchema"]);return c!=null&&l(e,["responseJsonSchema"],c),e}function xS(t){let e={};if(s(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let n=s(t,["description"]);n!=null&&l(e,["description"],n);let i=s(t,["name"]);i!=null&&l(e,["name"],i);let r=s(t,["parameters"]);r!=null&&l(e,["parameters"],r);let o=s(t,["parametersJsonSchema"]);o!=null&&l(e,["parametersJsonSchema"],o);let a=s(t,["response"]);a!=null&&l(e,["response"],a);let u=s(t,["responseJsonSchema"]);return u!=null&&l(e,["responseJsonSchema"],u),e}function TS(t){let e={},n=s(t,["startTime"]);n!=null&&l(e,["startTime"],n);let i=s(t,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function CS(t){let e={},n=s(t,["startTime"]);n!=null&&l(e,["startTime"],n);let i=s(t,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function kS(t){let e={},n=s(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],TS(n)),e}function SS(t){let e={},n=s(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],CS(n)),e}function _S(t){let e={},n=s(t,["mode"]);n!=null&&l(e,["mode"],n);let i=s(t,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function NS(t){let e={},n=s(t,["mode"]);n!=null&&l(e,["mode"],n);let i=s(t,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function wS(t){let e={},n=s(t,["dynamicRetrievalConfig"]);return n!=null&&l(e,["dynamicRetrievalConfig"],_S(n)),e}function IS(t){let e={},n=s(t,["dynamicRetrievalConfig"]);return n!=null&&l(e,["dynamicRetrievalConfig"],NS(n)),e}function ES(){return{}}function AS(t){let e={},n=s(t,["apiKeyString"]);return n!=null&&l(e,["apiKeyString"],n),e}function bS(t){let e={},n=s(t,["apiKeyConfig"]);n!=null&&l(e,["apiKeyConfig"],AS(n));let i=s(t,["authType"]);i!=null&&l(e,["authType"],i);let r=s(t,["googleServiceAccountConfig"]);r!=null&&l(e,["googleServiceAccountConfig"],r);let o=s(t,["httpBasicAuthConfig"]);o!=null&&l(e,["httpBasicAuthConfig"],o);let a=s(t,["oauthConfig"]);a!=null&&l(e,["oauthConfig"],a);let u=s(t,["oidcConfig"]);return u!=null&&l(e,["oidcConfig"],u),e}function PS(t){let e={},n=s(t,["authConfig"]);return n!=null&&l(e,["authConfig"],bS(n)),e}function MS(){return{}}function LS(){return{}}function RS(t){let e={},n=s(t,["functionDeclarations"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(c=>vS(c))),l(e,["functionDeclarations"],u)}if(s(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let i=s(t,["googleSearch"]);i!=null&&l(e,["googleSearch"],kS(i));let r=s(t,["googleSearchRetrieval"]);if(r!=null&&l(e,["googleSearchRetrieval"],wS(r)),s(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(s(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");s(t,["urlContext"])!=null&&l(e,["urlContext"],MS());let a=s(t,["codeExecution"]);return a!=null&&l(e,["codeExecution"],a),e}function DS(t){let e={},n=s(t,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(h=>xS(h))),l(e,["functionDeclarations"],f)}let i=s(t,["retrieval"]);i!=null&&l(e,["retrieval"],i);let r=s(t,["googleSearch"]);r!=null&&l(e,["googleSearch"],SS(r));let o=s(t,["googleSearchRetrieval"]);o!=null&&l(e,["googleSearchRetrieval"],IS(o)),s(t,["enterpriseWebSearch"])!=null&&l(e,["enterpriseWebSearch"],ES());let u=s(t,["googleMaps"]);u!=null&&l(e,["googleMaps"],PS(u)),s(t,["urlContext"])!=null&&l(e,["urlContext"],LS());let d=s(t,["codeExecution"]);return d!=null&&l(e,["codeExecution"],d),e}function FS(t){let e={},n=s(t,["handle"]);if(n!=null&&l(e,["handle"],n),s(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function VS(t){let e={},n=s(t,["handle"]);n!=null&&l(e,["handle"],n);let i=s(t,["transparent"]);return i!=null&&l(e,["transparent"],i),e}function ry(){return{}}function oy(){return{}}function $S(t){let e={},n=s(t,["disabled"]);n!=null&&l(e,["disabled"],n);let i=s(t,["startOfSpeechSensitivity"]);i!=null&&l(e,["startOfSpeechSensitivity"],i);let r=s(t,["endOfSpeechSensitivity"]);r!=null&&l(e,["endOfSpeechSensitivity"],r);let o=s(t,["prefixPaddingMs"]);o!=null&&l(e,["prefixPaddingMs"],o);let a=s(t,["silenceDurationMs"]);return a!=null&&l(e,["silenceDurationMs"],a),e}function GS(t){let e={},n=s(t,["disabled"]);n!=null&&l(e,["disabled"],n);let i=s(t,["startOfSpeechSensitivity"]);i!=null&&l(e,["startOfSpeechSensitivity"],i);let r=s(t,["endOfSpeechSensitivity"]);r!=null&&l(e,["endOfSpeechSensitivity"],r);let o=s(t,["prefixPaddingMs"]);o!=null&&l(e,["prefixPaddingMs"],o);let a=s(t,["silenceDurationMs"]);return a!=null&&l(e,["silenceDurationMs"],a),e}function US(t){let e={},n=s(t,["automaticActivityDetection"]);n!=null&&l(e,["automaticActivityDetection"],$S(n));let i=s(t,["activityHandling"]);i!=null&&l(e,["activityHandling"],i);let r=s(t,["turnCoverage"]);return r!=null&&l(e,["turnCoverage"],r),e}function HS(t){let e={},n=s(t,["automaticActivityDetection"]);n!=null&&l(e,["automaticActivityDetection"],GS(n));let i=s(t,["activityHandling"]);i!=null&&l(e,["activityHandling"],i);let r=s(t,["turnCoverage"]);return r!=null&&l(e,["turnCoverage"],r),e}function OS(t){let e={},n=s(t,["targetTokens"]);return n!=null&&l(e,["targetTokens"],n),e}function BS(t){let e={},n=s(t,["targetTokens"]);return n!=null&&l(e,["targetTokens"],n),e}function qS(t){let e={},n=s(t,["triggerTokens"]);n!=null&&l(e,["triggerTokens"],n);let i=s(t,["slidingWindow"]);return i!=null&&l(e,["slidingWindow"],OS(i)),e}function KS(t){let e={},n=s(t,["triggerTokens"]);n!=null&&l(e,["triggerTokens"],n);let i=s(t,["slidingWindow"]);return i!=null&&l(e,["slidingWindow"],BS(i)),e}function zS(t){let e={},n=s(t,["proactiveAudio"]);return n!=null&&l(e,["proactiveAudio"],n),e}function WS(t){let e={},n=s(t,["proactiveAudio"]);return n!=null&&l(e,["proactiveAudio"],n),e}function JS(t,e){let n={},i=s(t,["generationConfig"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig"],i);let r=s(t,["responseModalities"]);e!==void 0&&r!=null&&l(e,["setup","generationConfig","responseModalities"],r);let o=s(t,["temperature"]);e!==void 0&&o!=null&&l(e,["setup","generationConfig","temperature"],o);let a=s(t,["topP"]);e!==void 0&&a!=null&&l(e,["setup","generationConfig","topP"],a);let u=s(t,["topK"]);e!==void 0&&u!=null&&l(e,["setup","generationConfig","topK"],u);let c=s(t,["maxOutputTokens"]);e!==void 0&&c!=null&&l(e,["setup","generationConfig","maxOutputTokens"],c);let d=s(t,["mediaResolution"]);e!==void 0&&d!=null&&l(e,["setup","generationConfig","mediaResolution"],d);let f=s(t,["seed"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","seed"],f);let h=s(t,["speechConfig"]);e!==void 0&&h!=null&&l(e,["setup","generationConfig","speechConfig"],sS(Wd(h)));let m=s(t,["enableAffectiveDialog"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","enableAffectiveDialog"],m);let y=s(t,["systemInstruction"]);e!==void 0&&y!=null&&l(e,["setup","systemInstruction"],gS(yt(y)));let p=s(t,["tools"]);if(e!==void 0&&p!=null){let I=ps(p);Array.isArray(I)&&(I=I.map(V=>RS(ms(V)))),l(e,["setup","tools"],I)}let T=s(t,["sessionResumption"]);e!==void 0&&T!=null&&l(e,["setup","sessionResumption"],FS(T));let R=s(t,["inputAudioTranscription"]);e!==void 0&&R!=null&&l(e,["setup","inputAudioTranscription"],ry());let C=s(t,["outputAudioTranscription"]);e!==void 0&&C!=null&&l(e,["setup","outputAudioTranscription"],ry());let g=s(t,["realtimeInputConfig"]);e!==void 0&&g!=null&&l(e,["setup","realtimeInputConfig"],US(g));let x=s(t,["contextWindowCompression"]);e!==void 0&&x!=null&&l(e,["setup","contextWindowCompression"],qS(x));let S=s(t,["proactivity"]);return e!==void 0&&S!=null&&l(e,["setup","proactivity"],zS(S)),n}function YS(t,e){let n={},i=s(t,["generationConfig"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig"],i);let r=s(t,["responseModalities"]);e!==void 0&&r!=null&&l(e,["setup","generationConfig","responseModalities"],r);let o=s(t,["temperature"]);e!==void 0&&o!=null&&l(e,["setup","generationConfig","temperature"],o);let a=s(t,["topP"]);e!==void 0&&a!=null&&l(e,["setup","generationConfig","topP"],a);let u=s(t,["topK"]);e!==void 0&&u!=null&&l(e,["setup","generationConfig","topK"],u);let c=s(t,["maxOutputTokens"]);e!==void 0&&c!=null&&l(e,["setup","generationConfig","maxOutputTokens"],c);let d=s(t,["mediaResolution"]);e!==void 0&&d!=null&&l(e,["setup","generationConfig","mediaResolution"],d);let f=s(t,["seed"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","seed"],f);let h=s(t,["speechConfig"]);e!==void 0&&h!=null&&l(e,["setup","generationConfig","speechConfig"],aS(Wd(h)));let m=s(t,["enableAffectiveDialog"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","enableAffectiveDialog"],m);let y=s(t,["systemInstruction"]);e!==void 0&&y!=null&&l(e,["setup","systemInstruction"],yS(yt(y)));let p=s(t,["tools"]);if(e!==void 0&&p!=null){let I=ps(p);Array.isArray(I)&&(I=I.map(V=>DS(ms(V)))),l(e,["setup","tools"],I)}let T=s(t,["sessionResumption"]);e!==void 0&&T!=null&&l(e,["setup","sessionResumption"],VS(T));let R=s(t,["inputAudioTranscription"]);e!==void 0&&R!=null&&l(e,["setup","inputAudioTranscription"],oy());let C=s(t,["outputAudioTranscription"]);e!==void 0&&C!=null&&l(e,["setup","outputAudioTranscription"],oy());let g=s(t,["realtimeInputConfig"]);e!==void 0&&g!=null&&l(e,["setup","realtimeInputConfig"],HS(g));let x=s(t,["contextWindowCompression"]);e!==void 0&&x!=null&&l(e,["setup","contextWindowCompression"],KS(x));let S=s(t,["proactivity"]);return e!==void 0&&S!=null&&l(e,["setup","proactivity"],WS(S)),n}function QS(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["setup","model"],we(t,i));let r=s(e,["config"]);return r!=null&&l(n,["config"],JS(r,n)),n}function ZS(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["setup","model"],we(t,i));let r=s(e,["config"]);return r!=null&&l(n,["config"],YS(r,n)),n}function XS(){return{}}function jS(){return{}}function e_(){return{}}function t_(){return{}}function n_(t){let e={},n=s(t,["media"]);n!=null&&l(e,["mediaChunks"],Cy(n));let i=s(t,["audio"]);i!=null&&l(e,["audio"],EC(i));let r=s(t,["audioStreamEnd"]);r!=null&&l(e,["audioStreamEnd"],r);let o=s(t,["video"]);o!=null&&l(e,["video"],IC(o));let a=s(t,["text"]);return a!=null&&l(e,["text"],a),s(t,["activityStart"])!=null&&l(e,["activityStart"],XS()),s(t,["activityEnd"])!=null&&l(e,["activityEnd"],e_()),e}function i_(t){let e={},n=s(t,["media"]);if(n!=null&&l(e,["mediaChunks"],Cy(n)),s(t,["audio"])!==void 0)throw new Error("audio parameter is not supported in Vertex AI.");let i=s(t,["audioStreamEnd"]);if(i!=null&&l(e,["audioStreamEnd"],i),s(t,["video"])!==void 0)throw new Error("video parameter is not supported in Vertex AI.");if(s(t,["text"])!==void 0)throw new Error("text parameter is not supported in Vertex AI.");return s(t,["activityStart"])!=null&&l(e,["activityStart"],jS()),s(t,["activityEnd"])!=null&&l(e,["activityEnd"],t_()),e}function Py(t){let e={},n=s(t,["text"]);n!=null&&l(e,["text"],n);let i=s(t,["weight"]);return i!=null&&l(e,["weight"],i),e}function r_(t){let e={},n=s(t,["weightedPrompts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>Py(r))),l(e,["weightedPrompts"],i)}return e}function My(t){let e={},n=s(t,["temperature"]);n!=null&&l(e,["temperature"],n);let i=s(t,["topK"]);i!=null&&l(e,["topK"],i);let r=s(t,["seed"]);r!=null&&l(e,["seed"],r);let o=s(t,["guidance"]);o!=null&&l(e,["guidance"],o);let a=s(t,["bpm"]);a!=null&&l(e,["bpm"],a);let u=s(t,["density"]);u!=null&&l(e,["density"],u);let c=s(t,["brightness"]);c!=null&&l(e,["brightness"],c);let d=s(t,["scale"]);d!=null&&l(e,["scale"],d);let f=s(t,["muteBass"]);f!=null&&l(e,["muteBass"],f);let h=s(t,["muteDrums"]);h!=null&&l(e,["muteDrums"],h);let m=s(t,["onlyBassAndDrums"]);return m!=null&&l(e,["onlyBassAndDrums"],m),e}function o_(t){let e={},n=s(t,["musicGenerationConfig"]);return n!=null&&l(e,["musicGenerationConfig"],My(n)),e}function Ly(t){let e={},n=s(t,["model"]);return n!=null&&l(e,["model"],n),e}function Ry(t){let e={},n=s(t,["weightedPrompts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>Py(r))),l(e,["weightedPrompts"],i)}return e}function Id(t){let e={},n=s(t,["setup"]);n!=null&&l(e,["setup"],Ly(n));let i=s(t,["clientContent"]);i!=null&&l(e,["clientContent"],Ry(i));let r=s(t,["musicGenerationConfig"]);r!=null&&l(e,["musicGenerationConfig"],My(r));let o=s(t,["playbackControl"]);return o!=null&&l(e,["playbackControl"],o),e}function s_(){return{}}function a_(){return{}}function l_(t){let e={},n=s(t,["fps"]);n!=null&&l(e,["fps"],n);let i=s(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let r=s(t,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function u_(t){let e={},n=s(t,["fps"]);n!=null&&l(e,["fps"],n);let i=s(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let r=s(t,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function c_(t){let e={},n=s(t,["data"]);n!=null&&l(e,["data"],n);let i=s(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function d_(t){let e={},n=s(t,["displayName"]);n!=null&&l(e,["displayName"],n);let i=s(t,["data"]);i!=null&&l(e,["data"],i);let r=s(t,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function f_(t){let e={},n=s(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);let i=s(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function h_(t){let e={},n=s(t,["displayName"]);n!=null&&l(e,["displayName"],n);let i=s(t,["fileUri"]);i!=null&&l(e,["fileUri"],i);let r=s(t,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function m_(t){let e={},n=s(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],l_(n));let i=s(t,["thought"]);i!=null&&l(e,["thought"],i);let r=s(t,["inlineData"]);r!=null&&l(e,["inlineData"],c_(r));let o=s(t,["fileData"]);o!=null&&l(e,["fileData"],f_(o));let a=s(t,["thoughtSignature"]);a!=null&&l(e,["thoughtSignature"],a);let u=s(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let c=s(t,["executableCode"]);c!=null&&l(e,["executableCode"],c);let d=s(t,["functionCall"]);d!=null&&l(e,["functionCall"],d);let f=s(t,["functionResponse"]);f!=null&&l(e,["functionResponse"],f);let h=s(t,["text"]);return h!=null&&l(e,["text"],h),e}function p_(t){let e={},n=s(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],u_(n));let i=s(t,["thought"]);i!=null&&l(e,["thought"],i);let r=s(t,["inlineData"]);r!=null&&l(e,["inlineData"],d_(r));let o=s(t,["fileData"]);o!=null&&l(e,["fileData"],h_(o));let a=s(t,["thoughtSignature"]);a!=null&&l(e,["thoughtSignature"],a);let u=s(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let c=s(t,["executableCode"]);c!=null&&l(e,["executableCode"],c);let d=s(t,["functionCall"]);d!=null&&l(e,["functionCall"],d);let f=s(t,["functionResponse"]);f!=null&&l(e,["functionResponse"],f);let h=s(t,["text"]);return h!=null&&l(e,["text"],h),e}function g_(t){let e={},n=s(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>m_(o))),l(e,["parts"],r)}let i=s(t,["role"]);return i!=null&&l(e,["role"],i),e}function y_(t){let e={},n=s(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>p_(o))),l(e,["parts"],r)}let i=s(t,["role"]);return i!=null&&l(e,["role"],i),e}function sy(t){let e={},n=s(t,["text"]);n!=null&&l(e,["text"],n);let i=s(t,["finished"]);return i!=null&&l(e,["finished"],i),e}function ay(t){let e={},n=s(t,["text"]);n!=null&&l(e,["text"],n);let i=s(t,["finished"]);return i!=null&&l(e,["finished"],i),e}function v_(t){let e={},n=s(t,["retrievedUrl"]);n!=null&&l(e,["retrievedUrl"],n);let i=s(t,["urlRetrievalStatus"]);return i!=null&&l(e,["urlRetrievalStatus"],i),e}function x_(t){let e={},n=s(t,["urlMetadata"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>v_(r))),l(e,["urlMetadata"],i)}return e}function T_(t){let e={},n=s(t,["modelTurn"]);n!=null&&l(e,["modelTurn"],g_(n));let i=s(t,["turnComplete"]);i!=null&&l(e,["turnComplete"],i);let r=s(t,["interrupted"]);r!=null&&l(e,["interrupted"],r);let o=s(t,["groundingMetadata"]);o!=null&&l(e,["groundingMetadata"],o);let a=s(t,["generationComplete"]);a!=null&&l(e,["generationComplete"],a);let u=s(t,["inputTranscription"]);u!=null&&l(e,["inputTranscription"],sy(u));let c=s(t,["outputTranscription"]);c!=null&&l(e,["outputTranscription"],sy(c));let d=s(t,["urlContextMetadata"]);return d!=null&&l(e,["urlContextMetadata"],x_(d)),e}function C_(t){let e={},n=s(t,["modelTurn"]);n!=null&&l(e,["modelTurn"],y_(n));let i=s(t,["turnComplete"]);i!=null&&l(e,["turnComplete"],i);let r=s(t,["interrupted"]);r!=null&&l(e,["interrupted"],r);let o=s(t,["groundingMetadata"]);o!=null&&l(e,["groundingMetadata"],o);let a=s(t,["generationComplete"]);a!=null&&l(e,["generationComplete"],a);let u=s(t,["inputTranscription"]);u!=null&&l(e,["inputTranscription"],ay(u));let c=s(t,["outputTranscription"]);return c!=null&&l(e,["outputTranscription"],ay(c)),e}function k_(t){let e={},n=s(t,["id"]);n!=null&&l(e,["id"],n);let i=s(t,["args"]);i!=null&&l(e,["args"],i);let r=s(t,["name"]);return r!=null&&l(e,["name"],r),e}function S_(t){let e={},n=s(t,["args"]);n!=null&&l(e,["args"],n);let i=s(t,["name"]);return i!=null&&l(e,["name"],i),e}function __(t){let e={},n=s(t,["functionCalls"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>k_(r))),l(e,["functionCalls"],i)}return e}function N_(t){let e={},n=s(t,["functionCalls"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>S_(r))),l(e,["functionCalls"],i)}return e}function w_(t){let e={},n=s(t,["ids"]);return n!=null&&l(e,["ids"],n),e}function I_(t){let e={},n=s(t,["ids"]);return n!=null&&l(e,["ids"],n),e}function il(t){let e={},n=s(t,["modality"]);n!=null&&l(e,["modality"],n);let i=s(t,["tokenCount"]);return i!=null&&l(e,["tokenCount"],i),e}function rl(t){let e={},n=s(t,["modality"]);n!=null&&l(e,["modality"],n);let i=s(t,["tokenCount"]);return i!=null&&l(e,["tokenCount"],i),e}function E_(t){let e={},n=s(t,["promptTokenCount"]);n!=null&&l(e,["promptTokenCount"],n);let i=s(t,["cachedContentTokenCount"]);i!=null&&l(e,["cachedContentTokenCount"],i);let r=s(t,["responseTokenCount"]);r!=null&&l(e,["responseTokenCount"],r);let o=s(t,["toolUsePromptTokenCount"]);o!=null&&l(e,["toolUsePromptTokenCount"],o);let a=s(t,["thoughtsTokenCount"]);a!=null&&l(e,["thoughtsTokenCount"],a);let u=s(t,["totalTokenCount"]);u!=null&&l(e,["totalTokenCount"],u);let c=s(t,["promptTokensDetails"]);if(c!=null){let m=c;Array.isArray(m)&&(m=m.map(y=>il(y))),l(e,["promptTokensDetails"],m)}let d=s(t,["cacheTokensDetails"]);if(d!=null){let m=d;Array.isArray(m)&&(m=m.map(y=>il(y))),l(e,["cacheTokensDetails"],m)}let f=s(t,["responseTokensDetails"]);if(f!=null){let m=f;Array.isArray(m)&&(m=m.map(y=>il(y))),l(e,["responseTokensDetails"],m)}let h=s(t,["toolUsePromptTokensDetails"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(y=>il(y))),l(e,["toolUsePromptTokensDetails"],m)}return e}function A_(t){let e={},n=s(t,["promptTokenCount"]);n!=null&&l(e,["promptTokenCount"],n);let i=s(t,["cachedContentTokenCount"]);i!=null&&l(e,["cachedContentTokenCount"],i);let r=s(t,["candidatesTokenCount"]);r!=null&&l(e,["responseTokenCount"],r);let o=s(t,["toolUsePromptTokenCount"]);o!=null&&l(e,["toolUsePromptTokenCount"],o);let a=s(t,["thoughtsTokenCount"]);a!=null&&l(e,["thoughtsTokenCount"],a);let u=s(t,["totalTokenCount"]);u!=null&&l(e,["totalTokenCount"],u);let c=s(t,["promptTokensDetails"]);if(c!=null){let y=c;Array.isArray(y)&&(y=y.map(p=>rl(p))),l(e,["promptTokensDetails"],y)}let d=s(t,["cacheTokensDetails"]);if(d!=null){let y=d;Array.isArray(y)&&(y=y.map(p=>rl(p))),l(e,["cacheTokensDetails"],y)}let f=s(t,["candidatesTokensDetails"]);if(f!=null){let y=f;Array.isArray(y)&&(y=y.map(p=>rl(p))),l(e,["responseTokensDetails"],y)}let h=s(t,["toolUsePromptTokensDetails"]);if(h!=null){let y=h;Array.isArray(y)&&(y=y.map(p=>rl(p))),l(e,["toolUsePromptTokensDetails"],y)}let m=s(t,["trafficType"]);return m!=null&&l(e,["trafficType"],m),e}function b_(t){let e={},n=s(t,["timeLeft"]);return n!=null&&l(e,["timeLeft"],n),e}function P_(t){let e={},n=s(t,["timeLeft"]);return n!=null&&l(e,["timeLeft"],n),e}function M_(t){let e={},n=s(t,["newHandle"]);n!=null&&l(e,["newHandle"],n);let i=s(t,["resumable"]);i!=null&&l(e,["resumable"],i);let r=s(t,["lastConsumedClientMessageIndex"]);return r!=null&&l(e,["lastConsumedClientMessageIndex"],r),e}function L_(t){let e={},n=s(t,["newHandle"]);n!=null&&l(e,["newHandle"],n);let i=s(t,["resumable"]);i!=null&&l(e,["resumable"],i);let r=s(t,["lastConsumedClientMessageIndex"]);return r!=null&&l(e,["lastConsumedClientMessageIndex"],r),e}function R_(t){let e={};s(t,["setupComplete"])!=null&&l(e,["setupComplete"],s_());let i=s(t,["serverContent"]);i!=null&&l(e,["serverContent"],T_(i));let r=s(t,["toolCall"]);r!=null&&l(e,["toolCall"],__(r));let o=s(t,["toolCallCancellation"]);o!=null&&l(e,["toolCallCancellation"],w_(o));let a=s(t,["usageMetadata"]);a!=null&&l(e,["usageMetadata"],E_(a));let u=s(t,["goAway"]);u!=null&&l(e,["goAway"],b_(u));let c=s(t,["sessionResumptionUpdate"]);return c!=null&&l(e,["sessionResumptionUpdate"],M_(c)),e}function D_(t){let e={};s(t,["setupComplete"])!=null&&l(e,["setupComplete"],a_());let i=s(t,["serverContent"]);i!=null&&l(e,["serverContent"],C_(i));let r=s(t,["toolCall"]);r!=null&&l(e,["toolCall"],N_(r));let o=s(t,["toolCallCancellation"]);o!=null&&l(e,["toolCallCancellation"],I_(o));let a=s(t,["usageMetadata"]);a!=null&&l(e,["usageMetadata"],A_(a));let u=s(t,["goAway"]);u!=null&&l(e,["goAway"],P_(u));let c=s(t,["sessionResumptionUpdate"]);return c!=null&&l(e,["sessionResumptionUpdate"],L_(c)),e}function F_(){return{}}function V_(t){let e={},n=s(t,["text"]);n!=null&&l(e,["text"],n);let i=s(t,["weight"]);return i!=null&&l(e,["weight"],i),e}function $_(t){let e={},n=s(t,["weightedPrompts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>V_(r))),l(e,["weightedPrompts"],i)}return e}function G_(t){let e={},n=s(t,["temperature"]);n!=null&&l(e,["temperature"],n);let i=s(t,["topK"]);i!=null&&l(e,["topK"],i);let r=s(t,["seed"]);r!=null&&l(e,["seed"],r);let o=s(t,["guidance"]);o!=null&&l(e,["guidance"],o);let a=s(t,["bpm"]);a!=null&&l(e,["bpm"],a);let u=s(t,["density"]);u!=null&&l(e,["density"],u);let c=s(t,["brightness"]);c!=null&&l(e,["brightness"],c);let d=s(t,["scale"]);d!=null&&l(e,["scale"],d);let f=s(t,["muteBass"]);f!=null&&l(e,["muteBass"],f);let h=s(t,["muteDrums"]);h!=null&&l(e,["muteDrums"],h);let m=s(t,["onlyBassAndDrums"]);return m!=null&&l(e,["onlyBassAndDrums"],m),e}function U_(t){let e={},n=s(t,["clientContent"]);n!=null&&l(e,["clientContent"],$_(n));let i=s(t,["musicGenerationConfig"]);return i!=null&&l(e,["musicGenerationConfig"],G_(i)),e}function H_(t){let e={},n=s(t,["data"]);n!=null&&l(e,["data"],n);let i=s(t,["mimeType"]);i!=null&&l(e,["mimeType"],i);let r=s(t,["sourceMetadata"]);return r!=null&&l(e,["sourceMetadata"],U_(r)),e}function O_(t){let e={},n=s(t,["audioChunks"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>H_(r))),l(e,["audioChunks"],i)}return e}function B_(t){let e={},n=s(t,["text"]);n!=null&&l(e,["text"],n);let i=s(t,["filteredReason"]);return i!=null&&l(e,["filteredReason"],i),e}function q_(t){let e={};s(t,["setupComplete"])!=null&&l(e,["setupComplete"],F_());let i=s(t,["serverContent"]);i!=null&&l(e,["serverContent"],O_(i));let r=s(t,["filteredPrompt"]);return r!=null&&l(e,["filteredPrompt"],B_(r)),e}function K_(t){let e={},n=s(t,["fps"]);n!=null&&l(e,["fps"],n);let i=s(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let r=s(t,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function z_(t){let e={};if(s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=s(t,["data"]);n!=null&&l(e,["data"],n);let i=s(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function W_(t){let e={};if(s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=s(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);let i=s(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function J_(t){let e={},n=s(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],K_(n));let i=s(t,["thought"]);i!=null&&l(e,["thought"],i);let r=s(t,["inlineData"]);r!=null&&l(e,["inlineData"],z_(r));let o=s(t,["fileData"]);o!=null&&l(e,["fileData"],W_(o));let a=s(t,["thoughtSignature"]);a!=null&&l(e,["thoughtSignature"],a);let u=s(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let c=s(t,["executableCode"]);c!=null&&l(e,["executableCode"],c);let d=s(t,["functionCall"]);d!=null&&l(e,["functionCall"],d);let f=s(t,["functionResponse"]);f!=null&&l(e,["functionResponse"],f);let h=s(t,["text"]);return h!=null&&l(e,["text"],h),e}function Cl(t){let e={},n=s(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>J_(o))),l(e,["parts"],r)}let i=s(t,["role"]);return i!=null&&l(e,["role"],i),e}function Y_(t){let e={},n=s(t,["anyOf"]);n!=null&&l(e,["anyOf"],n);let i=s(t,["default"]);i!=null&&l(e,["default"],i);let r=s(t,["description"]);r!=null&&l(e,["description"],r);let o=s(t,["enum"]);o!=null&&l(e,["enum"],o);let a=s(t,["example"]);a!=null&&l(e,["example"],a);let u=s(t,["format"]);u!=null&&l(e,["format"],u);let c=s(t,["items"]);c!=null&&l(e,["items"],c);let d=s(t,["maxItems"]);d!=null&&l(e,["maxItems"],d);let f=s(t,["maxLength"]);f!=null&&l(e,["maxLength"],f);let h=s(t,["maxProperties"]);h!=null&&l(e,["maxProperties"],h);let m=s(t,["maximum"]);m!=null&&l(e,["maximum"],m);let y=s(t,["minItems"]);y!=null&&l(e,["minItems"],y);let p=s(t,["minLength"]);p!=null&&l(e,["minLength"],p);let T=s(t,["minProperties"]);T!=null&&l(e,["minProperties"],T);let R=s(t,["minimum"]);R!=null&&l(e,["minimum"],R);let C=s(t,["nullable"]);C!=null&&l(e,["nullable"],C);let g=s(t,["pattern"]);g!=null&&l(e,["pattern"],g);let x=s(t,["properties"]);x!=null&&l(e,["properties"],x);let S=s(t,["propertyOrdering"]);S!=null&&l(e,["propertyOrdering"],S);let I=s(t,["required"]);I!=null&&l(e,["required"],I);let V=s(t,["title"]);V!=null&&l(e,["title"],V);let k=s(t,["type"]);return k!=null&&l(e,["type"],k),e}function Q_(t){let e={};if(s(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=s(t,["category"]);n!=null&&l(e,["category"],n);let i=s(t,["threshold"]);return i!=null&&l(e,["threshold"],i),e}function Z_(t){let e={},n=s(t,["behavior"]);n!=null&&l(e,["behavior"],n);let i=s(t,["description"]);i!=null&&l(e,["description"],i);let r=s(t,["name"]);r!=null&&l(e,["name"],r);let o=s(t,["parameters"]);o!=null&&l(e,["parameters"],o);let a=s(t,["parametersJsonSchema"]);a!=null&&l(e,["parametersJsonSchema"],a);let u=s(t,["response"]);u!=null&&l(e,["response"],u);let c=s(t,["responseJsonSchema"]);return c!=null&&l(e,["responseJsonSchema"],c),e}function X_(t){let e={},n=s(t,["startTime"]);n!=null&&l(e,["startTime"],n);let i=s(t,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function j_(t){let e={},n=s(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],X_(n)),e}function eN(t){let e={},n=s(t,["mode"]);n!=null&&l(e,["mode"],n);let i=s(t,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function tN(t){let e={},n=s(t,["dynamicRetrievalConfig"]);return n!=null&&l(e,["dynamicRetrievalConfig"],eN(n)),e}function nN(){return{}}function iN(t){let e={},n=s(t,["functionDeclarations"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(c=>Z_(c))),l(e,["functionDeclarations"],u)}if(s(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let i=s(t,["googleSearch"]);i!=null&&l(e,["googleSearch"],j_(i));let r=s(t,["googleSearchRetrieval"]);if(r!=null&&l(e,["googleSearchRetrieval"],tN(r)),s(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(s(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");s(t,["urlContext"])!=null&&l(e,["urlContext"],nN());let a=s(t,["codeExecution"]);return a!=null&&l(e,["codeExecution"],a),e}function rN(t){let e={},n=s(t,["mode"]);n!=null&&l(e,["mode"],n);let i=s(t,["allowedFunctionNames"]);return i!=null&&l(e,["allowedFunctionNames"],i),e}function oN(t){let e={},n=s(t,["latitude"]);n!=null&&l(e,["latitude"],n);let i=s(t,["longitude"]);return i!=null&&l(e,["longitude"],i),e}function sN(t){let e={},n=s(t,["latLng"]);n!=null&&l(e,["latLng"],oN(n));let i=s(t,["languageCode"]);return i!=null&&l(e,["languageCode"],i),e}function aN(t){let e={},n=s(t,["functionCallingConfig"]);n!=null&&l(e,["functionCallingConfig"],rN(n));let i=s(t,["retrievalConfig"]);return i!=null&&l(e,["retrievalConfig"],sN(i)),e}function lN(t){let e={},n=s(t,["voiceName"]);return n!=null&&l(e,["voiceName"],n),e}function Dy(t){let e={},n=s(t,["prebuiltVoiceConfig"]);return n!=null&&l(e,["prebuiltVoiceConfig"],lN(n)),e}function uN(t){let e={},n=s(t,["speaker"]);n!=null&&l(e,["speaker"],n);let i=s(t,["voiceConfig"]);return i!=null&&l(e,["voiceConfig"],Dy(i)),e}function cN(t){let e={},n=s(t,["speakerVoiceConfigs"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>uN(r))),l(e,["speakerVoiceConfigs"],i)}return e}function dN(t){let e={},n=s(t,["voiceConfig"]);n!=null&&l(e,["voiceConfig"],Dy(n));let i=s(t,["multiSpeakerVoiceConfig"]);i!=null&&l(e,["multiSpeakerVoiceConfig"],cN(i));let r=s(t,["languageCode"]);return r!=null&&l(e,["languageCode"],r),e}function fN(t){let e={},n=s(t,["includeThoughts"]);n!=null&&l(e,["includeThoughts"],n);let i=s(t,["thinkingBudget"]);return i!=null&&l(e,["thinkingBudget"],i),e}function hN(t,e,n){let i={},r=s(e,["systemInstruction"]);n!==void 0&&r!=null&&l(n,["systemInstruction"],Cl(yt(r)));let o=s(e,["temperature"]);o!=null&&l(i,["temperature"],o);let a=s(e,["topP"]);a!=null&&l(i,["topP"],a);let u=s(e,["topK"]);u!=null&&l(i,["topK"],u);let c=s(e,["candidateCount"]);c!=null&&l(i,["candidateCount"],c);let d=s(e,["maxOutputTokens"]);d!=null&&l(i,["maxOutputTokens"],d);let f=s(e,["stopSequences"]);f!=null&&l(i,["stopSequences"],f);let h=s(e,["responseLogprobs"]);h!=null&&l(i,["responseLogprobs"],h);let m=s(e,["logprobs"]);m!=null&&l(i,["logprobs"],m);let y=s(e,["presencePenalty"]);y!=null&&l(i,["presencePenalty"],y);let p=s(e,["frequencyPenalty"]);p!=null&&l(i,["frequencyPenalty"],p);let T=s(e,["seed"]);T!=null&&l(i,["seed"],T);let R=s(e,["responseMimeType"]);R!=null&&l(i,["responseMimeType"],R);let C=s(e,["responseSchema"]);if(C!=null&&l(i,["responseSchema"],Y_(vl(C))),s(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(s(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let g=s(e,["safetySettings"]);if(n!==void 0&&g!=null){let D=g;Array.isArray(D)&&(D=D.map(te=>Q_(te))),l(n,["safetySettings"],D)}let x=s(e,["tools"]);if(n!==void 0&&x!=null){let D=ps(x);Array.isArray(D)&&(D=D.map(te=>iN(ms(te)))),l(n,["tools"],D)}let S=s(e,["toolConfig"]);if(n!==void 0&&S!=null&&l(n,["toolConfig"],aN(S)),s(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let I=s(e,["cachedContent"]);n!==void 0&&I!=null&&l(n,["cachedContent"],Ci(t,I));let V=s(e,["responseModalities"]);V!=null&&l(i,["responseModalities"],V);let k=s(e,["mediaResolution"]);k!=null&&l(i,["mediaResolution"],k);let N=s(e,["speechConfig"]);if(N!=null&&l(i,["speechConfig"],dN(_y(N))),s(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let b=s(e,["thinkingConfig"]);return b!=null&&l(i,["thinkingConfig"],fN(b)),i}function ly(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["_url","model"],we(t,i));let r=s(e,["contents"]);if(r!=null){let a=ln(r);Array.isArray(a)&&(a=a.map(u=>Cl(u))),l(n,["contents"],a)}let o=s(e,["config"]);return o!=null&&l(n,["generationConfig"],hN(t,o,n)),n}function mN(t,e){let n={},i=s(t,["taskType"]);e!==void 0&&i!=null&&l(e,["requests[]","taskType"],i);let r=s(t,["title"]);e!==void 0&&r!=null&&l(e,["requests[]","title"],r);let o=s(t,["outputDimensionality"]);if(e!==void 0&&o!=null&&l(e,["requests[]","outputDimensionality"],o),s(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(s(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function pN(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["_url","model"],we(t,i));let r=s(e,["contents"]);r!=null&&l(n,["requests[]","content"],Sy(t,r));let o=s(e,["config"]);o!=null&&l(n,["config"],mN(o,n));let a=s(e,["model"]);return a!==void 0&&l(n,["requests[]","model"],we(t,a)),n}function gN(t,e){let n={};if(s(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(s(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");let i=s(t,["numberOfImages"]);e!==void 0&&i!=null&&l(e,["parameters","sampleCount"],i);let r=s(t,["aspectRatio"]);e!==void 0&&r!=null&&l(e,["parameters","aspectRatio"],r);let o=s(t,["guidanceScale"]);if(e!==void 0&&o!=null&&l(e,["parameters","guidanceScale"],o),s(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let a=s(t,["safetyFilterLevel"]);e!==void 0&&a!=null&&l(e,["parameters","safetySetting"],a);let u=s(t,["personGeneration"]);e!==void 0&&u!=null&&l(e,["parameters","personGeneration"],u);let c=s(t,["includeSafetyAttributes"]);e!==void 0&&c!=null&&l(e,["parameters","includeSafetyAttributes"],c);let d=s(t,["includeRaiReason"]);e!==void 0&&d!=null&&l(e,["parameters","includeRaiReason"],d);let f=s(t,["language"]);e!==void 0&&f!=null&&l(e,["parameters","language"],f);let h=s(t,["outputMimeType"]);e!==void 0&&h!=null&&l(e,["parameters","outputOptions","mimeType"],h);let m=s(t,["outputCompressionQuality"]);if(e!==void 0&&m!=null&&l(e,["parameters","outputOptions","compressionQuality"],m),s(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(s(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function yN(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["_url","model"],we(t,i));let r=s(e,["prompt"]);r!=null&&l(n,["instances[0]","prompt"],r);let o=s(e,["config"]);return o!=null&&l(n,["config"],gN(o,n)),n}function vN(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["_url","name"],we(t,i));let r=s(e,["config"]);return r!=null&&l(n,["config"],r),n}function xN(t,e,n){let i={},r=s(e,["pageSize"]);n!==void 0&&r!=null&&l(n,["_query","pageSize"],r);let o=s(e,["pageToken"]);n!==void 0&&o!=null&&l(n,["_query","pageToken"],o);let a=s(e,["filter"]);n!==void 0&&a!=null&&l(n,["_query","filter"],a);let u=s(e,["queryBase"]);return n!==void 0&&u!=null&&l(n,["_url","models_url"],Iy(t,u)),i}function TN(t,e){let n={},i=s(e,["config"]);return i!=null&&l(n,["config"],xN(t,i,n)),n}function CN(t,e){let n={},i=s(t,["displayName"]);e!==void 0&&i!=null&&l(e,["displayName"],i);let r=s(t,["description"]);e!==void 0&&r!=null&&l(e,["description"],r);let o=s(t,["defaultCheckpointId"]);return e!==void 0&&o!=null&&l(e,["defaultCheckpointId"],o),n}function kN(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["_url","name"],we(t,i));let r=s(e,["config"]);return r!=null&&l(n,["config"],CN(r,n)),n}function SN(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["_url","name"],we(t,i));let r=s(e,["config"]);return r!=null&&l(n,["config"],r),n}function _N(t){let e={};if(s(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(s(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(s(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function NN(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["_url","model"],we(t,i));let r=s(e,["contents"]);if(r!=null){let a=ln(r);Array.isArray(a)&&(a=a.map(u=>Cl(u))),l(n,["contents"],a)}let o=s(e,["config"]);return o!=null&&l(n,["config"],_N(o)),n}function wN(t){let e={};if(s(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");let n=s(t,["imageBytes"]);n!=null&&l(e,["bytesBase64Encoded"],On(n));let i=s(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function IN(t,e){let n={},i=s(t,["numberOfVideos"]);if(e!==void 0&&i!=null&&l(e,["parameters","sampleCount"],i),s(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(s(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");let r=s(t,["durationSeconds"]);if(e!==void 0&&r!=null&&l(e,["parameters","durationSeconds"],r),s(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let o=s(t,["aspectRatio"]);if(e!==void 0&&o!=null&&l(e,["parameters","aspectRatio"],o),s(t,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");let a=s(t,["personGeneration"]);if(e!==void 0&&a!=null&&l(e,["parameters","personGeneration"],a),s(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");let u=s(t,["negativePrompt"]);e!==void 0&&u!=null&&l(e,["parameters","negativePrompt"],u);let c=s(t,["enhancePrompt"]);if(e!==void 0&&c!=null&&l(e,["parameters","enhancePrompt"],c),s(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");if(s(t,["lastFrame"])!==void 0)throw new Error("lastFrame parameter is not supported in Gemini API.");return n}function EN(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["_url","model"],we(t,i));let r=s(e,["prompt"]);r!=null&&l(n,["instances[0]","prompt"],r);let o=s(e,["image"]);if(o!=null&&l(n,["instances[0]","image"],wN(o)),s(e,["video"])!==void 0)throw new Error("video parameter is not supported in Gemini API.");let a=s(e,["config"]);return a!=null&&l(n,["config"],IN(a,n)),n}function AN(t){let e={},n=s(t,["fps"]);n!=null&&l(e,["fps"],n);let i=s(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let r=s(t,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function bN(t){let e={},n=s(t,["displayName"]);n!=null&&l(e,["displayName"],n);let i=s(t,["data"]);i!=null&&l(e,["data"],i);let r=s(t,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function PN(t){let e={},n=s(t,["displayName"]);n!=null&&l(e,["displayName"],n);let i=s(t,["fileUri"]);i!=null&&l(e,["fileUri"],i);let r=s(t,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function MN(t){let e={},n=s(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],AN(n));let i=s(t,["thought"]);i!=null&&l(e,["thought"],i);let r=s(t,["inlineData"]);r!=null&&l(e,["inlineData"],bN(r));let o=s(t,["fileData"]);o!=null&&l(e,["fileData"],PN(o));let a=s(t,["thoughtSignature"]);a!=null&&l(e,["thoughtSignature"],a);let u=s(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let c=s(t,["executableCode"]);c!=null&&l(e,["executableCode"],c);let d=s(t,["functionCall"]);d!=null&&l(e,["functionCall"],d);let f=s(t,["functionResponse"]);f!=null&&l(e,["functionResponse"],f);let h=s(t,["text"]);return h!=null&&l(e,["text"],h),e}function io(t){let e={},n=s(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>MN(o))),l(e,["parts"],r)}let i=s(t,["role"]);return i!=null&&l(e,["role"],i),e}function LN(t){let e={},n=s(t,["anyOf"]);n!=null&&l(e,["anyOf"],n);let i=s(t,["default"]);i!=null&&l(e,["default"],i);let r=s(t,["description"]);r!=null&&l(e,["description"],r);let o=s(t,["enum"]);o!=null&&l(e,["enum"],o);let a=s(t,["example"]);a!=null&&l(e,["example"],a);let u=s(t,["format"]);u!=null&&l(e,["format"],u);let c=s(t,["items"]);c!=null&&l(e,["items"],c);let d=s(t,["maxItems"]);d!=null&&l(e,["maxItems"],d);let f=s(t,["maxLength"]);f!=null&&l(e,["maxLength"],f);let h=s(t,["maxProperties"]);h!=null&&l(e,["maxProperties"],h);let m=s(t,["maximum"]);m!=null&&l(e,["maximum"],m);let y=s(t,["minItems"]);y!=null&&l(e,["minItems"],y);let p=s(t,["minLength"]);p!=null&&l(e,["minLength"],p);let T=s(t,["minProperties"]);T!=null&&l(e,["minProperties"],T);let R=s(t,["minimum"]);R!=null&&l(e,["minimum"],R);let C=s(t,["nullable"]);C!=null&&l(e,["nullable"],C);let g=s(t,["pattern"]);g!=null&&l(e,["pattern"],g);let x=s(t,["properties"]);x!=null&&l(e,["properties"],x);let S=s(t,["propertyOrdering"]);S!=null&&l(e,["propertyOrdering"],S);let I=s(t,["required"]);I!=null&&l(e,["required"],I);let V=s(t,["title"]);V!=null&&l(e,["title"],V);let k=s(t,["type"]);return k!=null&&l(e,["type"],k),e}function RN(t){let e={},n=s(t,["featureSelectionPreference"]);return n!=null&&l(e,["featureSelectionPreference"],n),e}function DN(t){let e={},n=s(t,["method"]);n!=null&&l(e,["method"],n);let i=s(t,["category"]);i!=null&&l(e,["category"],i);let r=s(t,["threshold"]);return r!=null&&l(e,["threshold"],r),e}function FN(t){let e={};if(s(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let n=s(t,["description"]);n!=null&&l(e,["description"],n);let i=s(t,["name"]);i!=null&&l(e,["name"],i);let r=s(t,["parameters"]);r!=null&&l(e,["parameters"],r);let o=s(t,["parametersJsonSchema"]);o!=null&&l(e,["parametersJsonSchema"],o);let a=s(t,["response"]);a!=null&&l(e,["response"],a);let u=s(t,["responseJsonSchema"]);return u!=null&&l(e,["responseJsonSchema"],u),e}function VN(t){let e={},n=s(t,["startTime"]);n!=null&&l(e,["startTime"],n);let i=s(t,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function $N(t){let e={},n=s(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],VN(n)),e}function GN(t){let e={},n=s(t,["mode"]);n!=null&&l(e,["mode"],n);let i=s(t,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function UN(t){let e={},n=s(t,["dynamicRetrievalConfig"]);return n!=null&&l(e,["dynamicRetrievalConfig"],GN(n)),e}function HN(){return{}}function ON(t){let e={},n=s(t,["apiKeyString"]);return n!=null&&l(e,["apiKeyString"],n),e}function BN(t){let e={},n=s(t,["apiKeyConfig"]);n!=null&&l(e,["apiKeyConfig"],ON(n));let i=s(t,["authType"]);i!=null&&l(e,["authType"],i);let r=s(t,["googleServiceAccountConfig"]);r!=null&&l(e,["googleServiceAccountConfig"],r);let o=s(t,["httpBasicAuthConfig"]);o!=null&&l(e,["httpBasicAuthConfig"],o);let a=s(t,["oauthConfig"]);a!=null&&l(e,["oauthConfig"],a);let u=s(t,["oidcConfig"]);return u!=null&&l(e,["oidcConfig"],u),e}function qN(t){let e={},n=s(t,["authConfig"]);return n!=null&&l(e,["authConfig"],BN(n)),e}function KN(){return{}}function Fy(t){let e={},n=s(t,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(h=>FN(h))),l(e,["functionDeclarations"],f)}let i=s(t,["retrieval"]);i!=null&&l(e,["retrieval"],i);let r=s(t,["googleSearch"]);r!=null&&l(e,["googleSearch"],$N(r));let o=s(t,["googleSearchRetrieval"]);o!=null&&l(e,["googleSearchRetrieval"],UN(o)),s(t,["enterpriseWebSearch"])!=null&&l(e,["enterpriseWebSearch"],HN());let u=s(t,["googleMaps"]);u!=null&&l(e,["googleMaps"],qN(u)),s(t,["urlContext"])!=null&&l(e,["urlContext"],KN());let d=s(t,["codeExecution"]);return d!=null&&l(e,["codeExecution"],d),e}function zN(t){let e={},n=s(t,["mode"]);n!=null&&l(e,["mode"],n);let i=s(t,["allowedFunctionNames"]);return i!=null&&l(e,["allowedFunctionNames"],i),e}function WN(t){let e={},n=s(t,["latitude"]);n!=null&&l(e,["latitude"],n);let i=s(t,["longitude"]);return i!=null&&l(e,["longitude"],i),e}function JN(t){let e={},n=s(t,["latLng"]);n!=null&&l(e,["latLng"],WN(n));let i=s(t,["languageCode"]);return i!=null&&l(e,["languageCode"],i),e}function YN(t){let e={},n=s(t,["functionCallingConfig"]);n!=null&&l(e,["functionCallingConfig"],zN(n));let i=s(t,["retrievalConfig"]);return i!=null&&l(e,["retrievalConfig"],JN(i)),e}function QN(t){let e={},n=s(t,["voiceName"]);return n!=null&&l(e,["voiceName"],n),e}function ZN(t){let e={},n=s(t,["prebuiltVoiceConfig"]);return n!=null&&l(e,["prebuiltVoiceConfig"],QN(n)),e}function XN(t){let e={},n=s(t,["voiceConfig"]);if(n!=null&&l(e,["voiceConfig"],ZN(n)),s(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");let i=s(t,["languageCode"]);return i!=null&&l(e,["languageCode"],i),e}function jN(t){let e={},n=s(t,["includeThoughts"]);n!=null&&l(e,["includeThoughts"],n);let i=s(t,["thinkingBudget"]);return i!=null&&l(e,["thinkingBudget"],i),e}function ew(t,e,n){let i={},r=s(e,["systemInstruction"]);n!==void 0&&r!=null&&l(n,["systemInstruction"],io(yt(r)));let o=s(e,["temperature"]);o!=null&&l(i,["temperature"],o);let a=s(e,["topP"]);a!=null&&l(i,["topP"],a);let u=s(e,["topK"]);u!=null&&l(i,["topK"],u);let c=s(e,["candidateCount"]);c!=null&&l(i,["candidateCount"],c);let d=s(e,["maxOutputTokens"]);d!=null&&l(i,["maxOutputTokens"],d);let f=s(e,["stopSequences"]);f!=null&&l(i,["stopSequences"],f);let h=s(e,["responseLogprobs"]);h!=null&&l(i,["responseLogprobs"],h);let m=s(e,["logprobs"]);m!=null&&l(i,["logprobs"],m);let y=s(e,["presencePenalty"]);y!=null&&l(i,["presencePenalty"],y);let p=s(e,["frequencyPenalty"]);p!=null&&l(i,["frequencyPenalty"],p);let T=s(e,["seed"]);T!=null&&l(i,["seed"],T);let R=s(e,["responseMimeType"]);R!=null&&l(i,["responseMimeType"],R);let C=s(e,["responseSchema"]);C!=null&&l(i,["responseSchema"],LN(vl(C)));let g=s(e,["routingConfig"]);g!=null&&l(i,["routingConfig"],g);let x=s(e,["modelSelectionConfig"]);x!=null&&l(i,["modelConfig"],RN(x));let S=s(e,["safetySettings"]);if(n!==void 0&&S!=null){let ae=S;Array.isArray(ae)&&(ae=ae.map(W=>DN(W))),l(n,["safetySettings"],ae)}let I=s(e,["tools"]);if(n!==void 0&&I!=null){let ae=ps(I);Array.isArray(ae)&&(ae=ae.map(W=>Fy(ms(W)))),l(n,["tools"],ae)}let V=s(e,["toolConfig"]);n!==void 0&&V!=null&&l(n,["toolConfig"],YN(V));let k=s(e,["labels"]);n!==void 0&&k!=null&&l(n,["labels"],k);let N=s(e,["cachedContent"]);n!==void 0&&N!=null&&l(n,["cachedContent"],Ci(t,N));let b=s(e,["responseModalities"]);b!=null&&l(i,["responseModalities"],b);let D=s(e,["mediaResolution"]);D!=null&&l(i,["mediaResolution"],D);let te=s(e,["speechConfig"]);te!=null&&l(i,["speechConfig"],XN(_y(te)));let re=s(e,["audioTimestamp"]);re!=null&&l(i,["audioTimestamp"],re);let O=s(e,["thinkingConfig"]);return O!=null&&l(i,["thinkingConfig"],jN(O)),i}function uy(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["_url","model"],we(t,i));let r=s(e,["contents"]);if(r!=null){let a=ln(r);Array.isArray(a)&&(a=a.map(u=>io(u))),l(n,["contents"],a)}let o=s(e,["config"]);return o!=null&&l(n,["generationConfig"],ew(t,o,n)),n}function tw(t,e){let n={},i=s(t,["taskType"]);e!==void 0&&i!=null&&l(e,["instances[]","task_type"],i);let r=s(t,["title"]);e!==void 0&&r!=null&&l(e,["instances[]","title"],r);let o=s(t,["outputDimensionality"]);e!==void 0&&o!=null&&l(e,["parameters","outputDimensionality"],o);let a=s(t,["mimeType"]);e!==void 0&&a!=null&&l(e,["instances[]","mimeType"],a);let u=s(t,["autoTruncate"]);return e!==void 0&&u!=null&&l(e,["parameters","autoTruncate"],u),n}function nw(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["_url","model"],we(t,i));let r=s(e,["contents"]);r!=null&&l(n,["instances[]","content"],Sy(t,r));let o=s(e,["config"]);return o!=null&&l(n,["config"],tw(o,n)),n}function iw(t,e){let n={},i=s(t,["outputGcsUri"]);e!==void 0&&i!=null&&l(e,["parameters","storageUri"],i);let r=s(t,["negativePrompt"]);e!==void 0&&r!=null&&l(e,["parameters","negativePrompt"],r);let o=s(t,["numberOfImages"]);e!==void 0&&o!=null&&l(e,["parameters","sampleCount"],o);let a=s(t,["aspectRatio"]);e!==void 0&&a!=null&&l(e,["parameters","aspectRatio"],a);let u=s(t,["guidanceScale"]);e!==void 0&&u!=null&&l(e,["parameters","guidanceScale"],u);let c=s(t,["seed"]);e!==void 0&&c!=null&&l(e,["parameters","seed"],c);let d=s(t,["safetyFilterLevel"]);e!==void 0&&d!=null&&l(e,["parameters","safetySetting"],d);let f=s(t,["personGeneration"]);e!==void 0&&f!=null&&l(e,["parameters","personGeneration"],f);let h=s(t,["includeSafetyAttributes"]);e!==void 0&&h!=null&&l(e,["parameters","includeSafetyAttributes"],h);let m=s(t,["includeRaiReason"]);e!==void 0&&m!=null&&l(e,["parameters","includeRaiReason"],m);let y=s(t,["language"]);e!==void 0&&y!=null&&l(e,["parameters","language"],y);let p=s(t,["outputMimeType"]);e!==void 0&&p!=null&&l(e,["parameters","outputOptions","mimeType"],p);let T=s(t,["outputCompressionQuality"]);e!==void 0&&T!=null&&l(e,["parameters","outputOptions","compressionQuality"],T);let R=s(t,["addWatermark"]);e!==void 0&&R!=null&&l(e,["parameters","addWatermark"],R);let C=s(t,["enhancePrompt"]);return e!==void 0&&C!=null&&l(e,["parameters","enhancePrompt"],C),n}function rw(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["_url","model"],we(t,i));let r=s(e,["prompt"]);r!=null&&l(n,["instances[0]","prompt"],r);let o=s(e,["config"]);return o!=null&&l(n,["config"],iw(o,n)),n}function kl(t){let e={},n=s(t,["gcsUri"]);n!=null&&l(e,["gcsUri"],n);let i=s(t,["imageBytes"]);i!=null&&l(e,["bytesBase64Encoded"],On(i));let r=s(t,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function ow(t){let e={},n=s(t,["maskMode"]);n!=null&&l(e,["maskMode"],n);let i=s(t,["segmentationClasses"]);i!=null&&l(e,["maskClasses"],i);let r=s(t,["maskDilation"]);return r!=null&&l(e,["dilation"],r),e}function sw(t){let e={},n=s(t,["controlType"]);n!=null&&l(e,["controlType"],n);let i=s(t,["enableControlImageComputation"]);return i!=null&&l(e,["computeControl"],i),e}function aw(t){let e={},n=s(t,["styleDescription"]);return n!=null&&l(e,["styleDescription"],n),e}function lw(t){let e={},n=s(t,["subjectType"]);n!=null&&l(e,["subjectType"],n);let i=s(t,["subjectDescription"]);return i!=null&&l(e,["subjectDescription"],i),e}function uw(t){let e={},n=s(t,["referenceImage"]);n!=null&&l(e,["referenceImage"],kl(n));let i=s(t,["referenceId"]);i!=null&&l(e,["referenceId"],i);let r=s(t,["referenceType"]);r!=null&&l(e,["referenceType"],r);let o=s(t,["maskImageConfig"]);o!=null&&l(e,["maskImageConfig"],ow(o));let a=s(t,["controlImageConfig"]);a!=null&&l(e,["controlImageConfig"],sw(a));let u=s(t,["styleImageConfig"]);u!=null&&l(e,["styleImageConfig"],aw(u));let c=s(t,["subjectImageConfig"]);return c!=null&&l(e,["subjectImageConfig"],lw(c)),e}function cw(t,e){let n={},i=s(t,["outputGcsUri"]);e!==void 0&&i!=null&&l(e,["parameters","storageUri"],i);let r=s(t,["negativePrompt"]);e!==void 0&&r!=null&&l(e,["parameters","negativePrompt"],r);let o=s(t,["numberOfImages"]);e!==void 0&&o!=null&&l(e,["parameters","sampleCount"],o);let a=s(t,["aspectRatio"]);e!==void 0&&a!=null&&l(e,["parameters","aspectRatio"],a);let u=s(t,["guidanceScale"]);e!==void 0&&u!=null&&l(e,["parameters","guidanceScale"],u);let c=s(t,["seed"]);e!==void 0&&c!=null&&l(e,["parameters","seed"],c);let d=s(t,["safetyFilterLevel"]);e!==void 0&&d!=null&&l(e,["parameters","safetySetting"],d);let f=s(t,["personGeneration"]);e!==void 0&&f!=null&&l(e,["parameters","personGeneration"],f);let h=s(t,["includeSafetyAttributes"]);e!==void 0&&h!=null&&l(e,["parameters","includeSafetyAttributes"],h);let m=s(t,["includeRaiReason"]);e!==void 0&&m!=null&&l(e,["parameters","includeRaiReason"],m);let y=s(t,["language"]);e!==void 0&&y!=null&&l(e,["parameters","language"],y);let p=s(t,["outputMimeType"]);e!==void 0&&p!=null&&l(e,["parameters","outputOptions","mimeType"],p);let T=s(t,["outputCompressionQuality"]);e!==void 0&&T!=null&&l(e,["parameters","outputOptions","compressionQuality"],T);let R=s(t,["editMode"]);e!==void 0&&R!=null&&l(e,["parameters","editMode"],R);let C=s(t,["baseSteps"]);return e!==void 0&&C!=null&&l(e,["parameters","editConfig","baseSteps"],C),n}function dw(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["_url","model"],we(t,i));let r=s(e,["prompt"]);r!=null&&l(n,["instances[0]","prompt"],r);let o=s(e,["referenceImages"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(c=>uw(c))),l(n,["instances[0]","referenceImages"],u)}let a=s(e,["config"]);return a!=null&&l(n,["config"],cw(a,n)),n}function fw(t,e){let n={},i=s(t,["includeRaiReason"]);e!==void 0&&i!=null&&l(e,["parameters","includeRaiReason"],i);let r=s(t,["outputMimeType"]);e!==void 0&&r!=null&&l(e,["parameters","outputOptions","mimeType"],r);let o=s(t,["outputCompressionQuality"]);e!==void 0&&o!=null&&l(e,["parameters","outputOptions","compressionQuality"],o);let a=s(t,["numberOfImages"]);e!==void 0&&a!=null&&l(e,["parameters","sampleCount"],a);let u=s(t,["mode"]);return e!==void 0&&u!=null&&l(e,["parameters","mode"],u),n}function hw(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["_url","model"],we(t,i));let r=s(e,["image"]);r!=null&&l(n,["instances[0]","image"],kl(r));let o=s(e,["upscaleFactor"]);o!=null&&l(n,["parameters","upscaleConfig","upscaleFactor"],o);let a=s(e,["config"]);return a!=null&&l(n,["config"],fw(a,n)),n}function mw(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["_url","name"],we(t,i));let r=s(e,["config"]);return r!=null&&l(n,["config"],r),n}function pw(t,e,n){let i={},r=s(e,["pageSize"]);n!==void 0&&r!=null&&l(n,["_query","pageSize"],r);let o=s(e,["pageToken"]);n!==void 0&&o!=null&&l(n,["_query","pageToken"],o);let a=s(e,["filter"]);n!==void 0&&a!=null&&l(n,["_query","filter"],a);let u=s(e,["queryBase"]);return n!==void 0&&u!=null&&l(n,["_url","models_url"],Iy(t,u)),i}function gw(t,e){let n={},i=s(e,["config"]);return i!=null&&l(n,["config"],pw(t,i,n)),n}function yw(t,e){let n={},i=s(t,["displayName"]);e!==void 0&&i!=null&&l(e,["displayName"],i);let r=s(t,["description"]);e!==void 0&&r!=null&&l(e,["description"],r);let o=s(t,["defaultCheckpointId"]);return e!==void 0&&o!=null&&l(e,["defaultCheckpointId"],o),n}function vw(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["_url","model"],we(t,i));let r=s(e,["config"]);return r!=null&&l(n,["config"],yw(r,n)),n}function xw(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["_url","name"],we(t,i));let r=s(e,["config"]);return r!=null&&l(n,["config"],r),n}function Tw(t,e){let n={},i=s(t,["systemInstruction"]);e!==void 0&&i!=null&&l(e,["systemInstruction"],io(yt(i)));let r=s(t,["tools"]);if(e!==void 0&&r!=null){let a=r;Array.isArray(a)&&(a=a.map(u=>Fy(u))),l(e,["tools"],a)}let o=s(t,["generationConfig"]);return e!==void 0&&o!=null&&l(e,["generationConfig"],o),n}function Cw(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["_url","model"],we(t,i));let r=s(e,["contents"]);if(r!=null){let a=ln(r);Array.isArray(a)&&(a=a.map(u=>io(u))),l(n,["contents"],a)}let o=s(e,["config"]);return o!=null&&l(n,["config"],Tw(o,n)),n}function kw(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["_url","model"],we(t,i));let r=s(e,["contents"]);if(r!=null){let a=ln(r);Array.isArray(a)&&(a=a.map(u=>io(u))),l(n,["contents"],a)}let o=s(e,["config"]);return o!=null&&l(n,["config"],o),n}function Sw(t){let e={},n=s(t,["uri"]);n!=null&&l(e,["gcsUri"],n);let i=s(t,["videoBytes"]);i!=null&&l(e,["bytesBase64Encoded"],On(i));let r=s(t,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function _w(t,e){let n={},i=s(t,["numberOfVideos"]);e!==void 0&&i!=null&&l(e,["parameters","sampleCount"],i);let r=s(t,["outputGcsUri"]);e!==void 0&&r!=null&&l(e,["parameters","storageUri"],r);let o=s(t,["fps"]);e!==void 0&&o!=null&&l(e,["parameters","fps"],o);let a=s(t,["durationSeconds"]);e!==void 0&&a!=null&&l(e,["parameters","durationSeconds"],a);let u=s(t,["seed"]);e!==void 0&&u!=null&&l(e,["parameters","seed"],u);let c=s(t,["aspectRatio"]);e!==void 0&&c!=null&&l(e,["parameters","aspectRatio"],c);let d=s(t,["resolution"]);e!==void 0&&d!=null&&l(e,["parameters","resolution"],d);let f=s(t,["personGeneration"]);e!==void 0&&f!=null&&l(e,["parameters","personGeneration"],f);let h=s(t,["pubsubTopic"]);e!==void 0&&h!=null&&l(e,["parameters","pubsubTopic"],h);let m=s(t,["negativePrompt"]);e!==void 0&&m!=null&&l(e,["parameters","negativePrompt"],m);let y=s(t,["enhancePrompt"]);e!==void 0&&y!=null&&l(e,["parameters","enhancePrompt"],y);let p=s(t,["generateAudio"]);e!==void 0&&p!=null&&l(e,["parameters","generateAudio"],p);let T=s(t,["lastFrame"]);return e!==void 0&&T!=null&&l(e,["instances[0]","lastFrame"],kl(T)),n}function Nw(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["_url","model"],we(t,i));let r=s(e,["prompt"]);r!=null&&l(n,["instances[0]","prompt"],r);let o=s(e,["image"]);o!=null&&l(n,["instances[0]","image"],kl(o));let a=s(e,["video"]);a!=null&&l(n,["instances[0]","video"],Sw(a));let u=s(e,["config"]);return u!=null&&l(n,["config"],_w(u,n)),n}function ww(t){let e={},n=s(t,["fps"]);n!=null&&l(e,["fps"],n);let i=s(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let r=s(t,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function Iw(t){let e={},n=s(t,["data"]);n!=null&&l(e,["data"],n);let i=s(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Ew(t){let e={},n=s(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);let i=s(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Aw(t){let e={},n=s(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],ww(n));let i=s(t,["thought"]);i!=null&&l(e,["thought"],i);let r=s(t,["inlineData"]);r!=null&&l(e,["inlineData"],Iw(r));let o=s(t,["fileData"]);o!=null&&l(e,["fileData"],Ew(o));let a=s(t,["thoughtSignature"]);a!=null&&l(e,["thoughtSignature"],a);let u=s(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let c=s(t,["executableCode"]);c!=null&&l(e,["executableCode"],c);let d=s(t,["functionCall"]);d!=null&&l(e,["functionCall"],d);let f=s(t,["functionResponse"]);f!=null&&l(e,["functionResponse"],f);let h=s(t,["text"]);return h!=null&&l(e,["text"],h),e}function bw(t){let e={},n=s(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>Aw(o))),l(e,["parts"],r)}let i=s(t,["role"]);return i!=null&&l(e,["role"],i),e}function Pw(t){let e={},n=s(t,["citationSources"]);return n!=null&&l(e,["citations"],n),e}function Mw(t){let e={},n=s(t,["retrievedUrl"]);n!=null&&l(e,["retrievedUrl"],n);let i=s(t,["urlRetrievalStatus"]);return i!=null&&l(e,["urlRetrievalStatus"],i),e}function Lw(t){let e={},n=s(t,["urlMetadata"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>Mw(r))),l(e,["urlMetadata"],i)}return e}function Rw(t){let e={},n=s(t,["content"]);n!=null&&l(e,["content"],bw(n));let i=s(t,["citationMetadata"]);i!=null&&l(e,["citationMetadata"],Pw(i));let r=s(t,["tokenCount"]);r!=null&&l(e,["tokenCount"],r);let o=s(t,["finishReason"]);o!=null&&l(e,["finishReason"],o);let a=s(t,["urlContextMetadata"]);a!=null&&l(e,["urlContextMetadata"],Lw(a));let u=s(t,["avgLogprobs"]);u!=null&&l(e,["avgLogprobs"],u);let c=s(t,["groundingMetadata"]);c!=null&&l(e,["groundingMetadata"],c);let d=s(t,["index"]);d!=null&&l(e,["index"],d);let f=s(t,["logprobsResult"]);f!=null&&l(e,["logprobsResult"],f);let h=s(t,["safetyRatings"]);return h!=null&&l(e,["safetyRatings"],h),e}function cy(t){let e={},n=s(t,["candidates"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(u=>Rw(u))),l(e,["candidates"],a)}let i=s(t,["modelVersion"]);i!=null&&l(e,["modelVersion"],i);let r=s(t,["promptFeedback"]);r!=null&&l(e,["promptFeedback"],r);let o=s(t,["usageMetadata"]);return o!=null&&l(e,["usageMetadata"],o),e}function Dw(t){let e={},n=s(t,["values"]);return n!=null&&l(e,["values"],n),e}function Fw(){return{}}function Vw(t){let e={},n=s(t,["embeddings"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>Dw(o))),l(e,["embeddings"],r)}return s(t,["metadata"])!=null&&l(e,["metadata"],Fw()),e}function $w(t){let e={},n=s(t,["bytesBase64Encoded"]);n!=null&&l(e,["imageBytes"],On(n));let i=s(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Vy(t){let e={},n=s(t,["safetyAttributes","categories"]);n!=null&&l(e,["categories"],n);let i=s(t,["safetyAttributes","scores"]);i!=null&&l(e,["scores"],i);let r=s(t,["contentType"]);return r!=null&&l(e,["contentType"],r),e}function Gw(t){let e={},n=s(t,["_self"]);n!=null&&l(e,["image"],$w(n));let i=s(t,["raiFilteredReason"]);i!=null&&l(e,["raiFilteredReason"],i);let r=s(t,["_self"]);return r!=null&&l(e,["safetyAttributes"],Vy(r)),e}function Uw(t){let e={},n=s(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>Gw(o))),l(e,["generatedImages"],r)}let i=s(t,["positivePromptSafetyAttributes"]);return i!=null&&l(e,["positivePromptSafetyAttributes"],Vy(i)),e}function Hw(t){let e={},n=s(t,["baseModel"]);n!=null&&l(e,["baseModel"],n);let i=s(t,["createTime"]);i!=null&&l(e,["createTime"],i);let r=s(t,["updateTime"]);return r!=null&&l(e,["updateTime"],r),e}function Ed(t){let e={},n=s(t,["name"]);n!=null&&l(e,["name"],n);let i=s(t,["displayName"]);i!=null&&l(e,["displayName"],i);let r=s(t,["description"]);r!=null&&l(e,["description"],r);let o=s(t,["version"]);o!=null&&l(e,["version"],o);let a=s(t,["_self"]);a!=null&&l(e,["tunedModelInfo"],Hw(a));let u=s(t,["inputTokenLimit"]);u!=null&&l(e,["inputTokenLimit"],u);let c=s(t,["outputTokenLimit"]);c!=null&&l(e,["outputTokenLimit"],c);let d=s(t,["supportedGenerationMethods"]);return d!=null&&l(e,["supportedActions"],d),e}function Ow(t,e){let n={},i=s(e,["nextPageToken"]);i!=null&&l(n,["nextPageToken"],i);let r=s(e,["_self"]);if(r!=null){let o=Ey(r);Array.isArray(o)&&(o=o.map(a=>Ed(a))),l(n,["models"],o)}return n}function Bw(){return{}}function qw(t){let e={},n=s(t,["totalTokens"]);n!=null&&l(e,["totalTokens"],n);let i=s(t,["cachedContentTokenCount"]);return i!=null&&l(e,["cachedContentTokenCount"],i),e}function Kw(t){let e={},n=s(t,["video","uri"]);n!=null&&l(e,["uri"],n);let i=s(t,["video","encodedVideo"]);i!=null&&l(e,["videoBytes"],On(i));let r=s(t,["encoding"]);return r!=null&&l(e,["mimeType"],r),e}function zw(t){let e={},n=s(t,["_self"]);return n!=null&&l(e,["video"],Kw(n)),e}function Ww(t){let e={},n=s(t,["generatedSamples"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(a=>zw(a))),l(e,["generatedVideos"],o)}let i=s(t,["raiMediaFilteredCount"]);i!=null&&l(e,["raiMediaFilteredCount"],i);let r=s(t,["raiMediaFilteredReasons"]);return r!=null&&l(e,["raiMediaFilteredReasons"],r),e}function Jw(t){let e={},n=s(t,["name"]);n!=null&&l(e,["name"],n);let i=s(t,["metadata"]);i!=null&&l(e,["metadata"],i);let r=s(t,["done"]);r!=null&&l(e,["done"],r);let o=s(t,["error"]);o!=null&&l(e,["error"],o);let a=s(t,["response","generateVideoResponse"]);return a!=null&&l(e,["response"],Ww(a)),e}function Yw(t){let e={},n=s(t,["fps"]);n!=null&&l(e,["fps"],n);let i=s(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let r=s(t,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function Qw(t){let e={},n=s(t,["displayName"]);n!=null&&l(e,["displayName"],n);let i=s(t,["data"]);i!=null&&l(e,["data"],i);let r=s(t,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function Zw(t){let e={},n=s(t,["displayName"]);n!=null&&l(e,["displayName"],n);let i=s(t,["fileUri"]);i!=null&&l(e,["fileUri"],i);let r=s(t,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function Xw(t){let e={},n=s(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],Yw(n));let i=s(t,["thought"]);i!=null&&l(e,["thought"],i);let r=s(t,["inlineData"]);r!=null&&l(e,["inlineData"],Qw(r));let o=s(t,["fileData"]);o!=null&&l(e,["fileData"],Zw(o));let a=s(t,["thoughtSignature"]);a!=null&&l(e,["thoughtSignature"],a);let u=s(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let c=s(t,["executableCode"]);c!=null&&l(e,["executableCode"],c);let d=s(t,["functionCall"]);d!=null&&l(e,["functionCall"],d);let f=s(t,["functionResponse"]);f!=null&&l(e,["functionResponse"],f);let h=s(t,["text"]);return h!=null&&l(e,["text"],h),e}function jw(t){let e={},n=s(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>Xw(o))),l(e,["parts"],r)}let i=s(t,["role"]);return i!=null&&l(e,["role"],i),e}function eI(t){let e={},n=s(t,["citations"]);return n!=null&&l(e,["citations"],n),e}function tI(t){let e={},n=s(t,["retrievedUrl"]);n!=null&&l(e,["retrievedUrl"],n);let i=s(t,["urlRetrievalStatus"]);return i!=null&&l(e,["urlRetrievalStatus"],i),e}function nI(t){let e={},n=s(t,["urlMetadata"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>tI(r))),l(e,["urlMetadata"],i)}return e}function iI(t){let e={},n=s(t,["content"]);n!=null&&l(e,["content"],jw(n));let i=s(t,["citationMetadata"]);i!=null&&l(e,["citationMetadata"],eI(i));let r=s(t,["finishMessage"]);r!=null&&l(e,["finishMessage"],r);let o=s(t,["finishReason"]);o!=null&&l(e,["finishReason"],o);let a=s(t,["urlContextMetadata"]);a!=null&&l(e,["urlContextMetadata"],nI(a));let u=s(t,["avgLogprobs"]);u!=null&&l(e,["avgLogprobs"],u);let c=s(t,["groundingMetadata"]);c!=null&&l(e,["groundingMetadata"],c);let d=s(t,["index"]);d!=null&&l(e,["index"],d);let f=s(t,["logprobsResult"]);f!=null&&l(e,["logprobsResult"],f);let h=s(t,["safetyRatings"]);return h!=null&&l(e,["safetyRatings"],h),e}function dy(t){let e={},n=s(t,["candidates"]);if(n!=null){let c=n;Array.isArray(c)&&(c=c.map(d=>iI(d))),l(e,["candidates"],c)}let i=s(t,["createTime"]);i!=null&&l(e,["createTime"],i);let r=s(t,["responseId"]);r!=null&&l(e,["responseId"],r);let o=s(t,["modelVersion"]);o!=null&&l(e,["modelVersion"],o);let a=s(t,["promptFeedback"]);a!=null&&l(e,["promptFeedback"],a);let u=s(t,["usageMetadata"]);return u!=null&&l(e,["usageMetadata"],u),e}function rI(t){let e={},n=s(t,["truncated"]);n!=null&&l(e,["truncated"],n);let i=s(t,["token_count"]);return i!=null&&l(e,["tokenCount"],i),e}function oI(t){let e={},n=s(t,["values"]);n!=null&&l(e,["values"],n);let i=s(t,["statistics"]);return i!=null&&l(e,["statistics"],rI(i)),e}function sI(t){let e={},n=s(t,["billableCharacterCount"]);return n!=null&&l(e,["billableCharacterCount"],n),e}function aI(t){let e={},n=s(t,["predictions[]","embeddings"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>oI(o))),l(e,["embeddings"],r)}let i=s(t,["metadata"]);return i!=null&&l(e,["metadata"],sI(i)),e}function lI(t){let e={},n=s(t,["gcsUri"]);n!=null&&l(e,["gcsUri"],n);let i=s(t,["bytesBase64Encoded"]);i!=null&&l(e,["imageBytes"],On(i));let r=s(t,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function $y(t){let e={},n=s(t,["safetyAttributes","categories"]);n!=null&&l(e,["categories"],n);let i=s(t,["safetyAttributes","scores"]);i!=null&&l(e,["scores"],i);let r=s(t,["contentType"]);return r!=null&&l(e,["contentType"],r),e}function Jd(t){let e={},n=s(t,["_self"]);n!=null&&l(e,["image"],lI(n));let i=s(t,["raiFilteredReason"]);i!=null&&l(e,["raiFilteredReason"],i);let r=s(t,["_self"]);r!=null&&l(e,["safetyAttributes"],$y(r));let o=s(t,["prompt"]);return o!=null&&l(e,["enhancedPrompt"],o),e}function uI(t){let e={},n=s(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>Jd(o))),l(e,["generatedImages"],r)}let i=s(t,["positivePromptSafetyAttributes"]);return i!=null&&l(e,["positivePromptSafetyAttributes"],$y(i)),e}function cI(t){let e={},n=s(t,["predictions"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>Jd(r))),l(e,["generatedImages"],i)}return e}function dI(t){let e={},n=s(t,["predictions"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>Jd(r))),l(e,["generatedImages"],i)}return e}function fI(t){let e={},n=s(t,["endpoint"]);n!=null&&l(e,["name"],n);let i=s(t,["deployedModelId"]);return i!=null&&l(e,["deployedModelId"],i),e}function hI(t){let e={},n=s(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&l(e,["baseModel"],n);let i=s(t,["createTime"]);i!=null&&l(e,["createTime"],i);let r=s(t,["updateTime"]);return r!=null&&l(e,["updateTime"],r),e}function mI(t){let e={},n=s(t,["checkpointId"]);n!=null&&l(e,["checkpointId"],n);let i=s(t,["epoch"]);i!=null&&l(e,["epoch"],i);let r=s(t,["step"]);return r!=null&&l(e,["step"],r),e}function Ad(t){let e={},n=s(t,["name"]);n!=null&&l(e,["name"],n);let i=s(t,["displayName"]);i!=null&&l(e,["displayName"],i);let r=s(t,["description"]);r!=null&&l(e,["description"],r);let o=s(t,["versionId"]);o!=null&&l(e,["version"],o);let a=s(t,["deployedModels"]);if(a!=null){let h=a;Array.isArray(h)&&(h=h.map(m=>fI(m))),l(e,["endpoints"],h)}let u=s(t,["labels"]);u!=null&&l(e,["labels"],u);let c=s(t,["_self"]);c!=null&&l(e,["tunedModelInfo"],hI(c));let d=s(t,["defaultCheckpointId"]);d!=null&&l(e,["defaultCheckpointId"],d);let f=s(t,["checkpoints"]);if(f!=null){let h=f;Array.isArray(h)&&(h=h.map(m=>mI(m))),l(e,["checkpoints"],h)}return e}function pI(t,e){let n={},i=s(e,["nextPageToken"]);i!=null&&l(n,["nextPageToken"],i);let r=s(e,["_self"]);if(r!=null){let o=Ey(r);Array.isArray(o)&&(o=o.map(a=>Ad(a))),l(n,["models"],o)}return n}function gI(){return{}}function yI(t){let e={},n=s(t,["totalTokens"]);return n!=null&&l(e,["totalTokens"],n),e}function vI(t){let e={},n=s(t,["tokensInfo"]);return n!=null&&l(e,["tokensInfo"],n),e}function xI(t){let e={},n=s(t,["gcsUri"]);n!=null&&l(e,["uri"],n);let i=s(t,["bytesBase64Encoded"]);i!=null&&l(e,["videoBytes"],On(i));let r=s(t,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function TI(t){let e={},n=s(t,["_self"]);return n!=null&&l(e,["video"],xI(n)),e}function CI(t){let e={},n=s(t,["videos"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(a=>TI(a))),l(e,["generatedVideos"],o)}let i=s(t,["raiMediaFilteredCount"]);i!=null&&l(e,["raiMediaFilteredCount"],i);let r=s(t,["raiMediaFilteredReasons"]);return r!=null&&l(e,["raiMediaFilteredReasons"],r),e}function kI(t){let e={},n=s(t,["name"]);n!=null&&l(e,["name"],n);let i=s(t,["metadata"]);i!=null&&l(e,["metadata"],i);let r=s(t,["done"]);r!=null&&l(e,["done"],r);let o=s(t,["error"]);o!=null&&l(e,["error"],o);let a=s(t,["response"]);return a!=null&&l(e,["response"],CI(a)),e}var SI="Content-Type",_I="X-Server-Timeout",NI="User-Agent",bd="x-goog-api-client",wI="1.6.0",II=`google-genai-sdk/${wI}`,EI="v1beta1",AI="v1beta",fy=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/,Pd=class{constructor(e){var n,i;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});let r={};this.clientOptions.vertexai?(r.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:EI,r.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(r.apiVersion=(i=this.clientOptions.apiVersion)!==null&&i!==void 0?i:AI,r.baseUrl="https://generativelanguage.googleapis.com/"),r.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=r,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(r,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");let i=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&i.push(e.apiVersion),i.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,i){let r=[this.getRequestUrlInternal(n)];return i&&r.push(this.getBaseResourcePath()),e!==""&&r.push(e),new URL(`${r.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let i=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,n,i);if(e.queryParams)for(let[a,u]of Object.entries(e.queryParams))r.searchParams.append(a,String(u));let o={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=e.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,n,e.abortSignal),this.unaryApiCall(r,o,e.httpMethod)}patchHttpOptions(e,n){let i=JSON.parse(JSON.stringify(e));for(let[r,o]of Object.entries(n))typeof o=="object"?i[r]=Object.assign(Object.assign({},i[r]),o):o!==void 0&&(i[r]=o);return i}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let i=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,n,i);(!r.searchParams.has("alt")||r.searchParams.get("alt")!=="sse")&&r.searchParams.set("alt","sse");let o={};return o.body=e.body,o=await this.includeExtraHttpOptionsToRequestInit(o,n,e.abortSignal),this.streamApiCall(r,o,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,i){if(n&&n.timeout||i){let r=new AbortController,o=r.signal;n.timeout&&n?.timeout>0&&setTimeout(()=>r.abort(),n.timeout),i&&i.addEventListener("abort",()=>{r.abort()}),e.signal=o}return n&&n.extraBody!==null&&bI(e,n.extraBody),e.headers=await this.getHeadersInternal(n),e}async unaryApiCall(e,n,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:i})).then(async r=>(await hy(r),new fs(r))).catch(r=>{throw r instanceof Error?r:new Error(JSON.stringify(r))})}async streamApiCall(e,n,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:i})).then(async r=>(await hy(r),this.processStreamResponse(r))).catch(r=>{throw r instanceof Error?r:new Error(JSON.stringify(r))})}processStreamResponse(e){var n;return eo(this,arguments,function*(){let r=(n=e?.body)===null||n===void 0?void 0:n.getReader(),o=new TextDecoder("utf-8");if(!r)throw new Error("Response body is empty");try{let a="";for(;;){let{done:u,value:c}=yield be(r.read());if(u){if(a.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}let d=o.decode(c);try{let h=JSON.parse(d);if("error"in h){let m=JSON.parse(JSON.stringify(h.error)),y=m.status,p=m.code,T=`got status: ${y}. ${JSON.stringify(h)}`;if(p>=400&&p<600)throw new xl({message:T,status:p})}}catch(h){if(h.name==="ApiError")throw h}a+=d;let f=a.match(fy);for(;f;){let h=f[1];try{let m=new Response(h,{headers:e?.headers,status:e?.status,statusText:e?.statusText});yield yield be(new fs(m)),a=a.slice(f[0].length),f=a.match(fy)}catch(m){throw new Error(`exception parsing stream chunk ${h}. ${m}`)}}}}finally{r.releaseLock()}})}async apiCall(e,n){return fetch(e,n).catch(i=>{throw new Error(`exception ${i} sending request`)})}getDefaultHeaders(){let e={},n=II+" "+this.clientOptions.userAgentExtra;return e[NI]=n,e[bd]=n,e[SI]="application/json",e}async getHeadersInternal(e){let n=new Headers;if(e&&e.headers){for(let[i,r]of Object.entries(e.headers))n.append(i,r);e.timeout&&e.timeout>0&&n.append(_I,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n),n}async uploadFile(e,n){var i;let r={};n!=null&&(r.mimeType=n.mimeType,r.name=n.name,r.displayName=n.displayName),r.name&&!r.name.startsWith("files/")&&(r.name=`files/${r.name}`);let o=this.clientOptions.uploader,a=await o.stat(e);r.sizeBytes=String(a.size);let u=(i=n?.mimeType)!==null&&i!==void 0?i:a.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");r.mimeType=u;let c=await this.fetchUploadUrl(r,n);return o.upload(e,c,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n){var i;let r={};n?.httpOptions?r=n.httpOptions:r={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};let o={file:e},a=await this.request({path:ue("upload/v1beta/files",o._url),body:JSON.stringify(o),httpMethod:"POST",httpOptions:r});if(!a||!a?.headers)throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let u=(i=a?.headers)===null||i===void 0?void 0:i["x-goog-upload-url"];if(u===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return u}};async function hy(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){let n=t.status,i;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?i=await t.json():i={error:{message:await t.text(),code:t.status,status:t.statusText}};let r=JSON.stringify(i);throw n>=400&&n<600?new xl({message:r,status:n}):new Error(r)}}function bI(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{let o=JSON.parse(t.body);if(typeof o=="object"&&o!==null&&!Array.isArray(o))n=o;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function i(o,a){let u=Object.assign({},o);for(let c in a)if(Object.prototype.hasOwnProperty.call(a,c)){let d=a[c],f=u[c];d&&typeof d=="object"&&!Array.isArray(d)&&f&&typeof f=="object"&&!Array.isArray(f)?u[c]=i(f,d):(f&&d&&typeof f!=typeof d&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${c}". Original type: ${typeof f}, New type: ${typeof d}. Overwriting.`),u[c]=d)}return u}let r=i(n,e);t.body=JSON.stringify(r)}var PI="mcp_used/unknown";function Gy(t){for(let e of t)if(Yd(e)||typeof e=="object"&&"inputSchema"in e)return!0;return!1}function Uy(t){var e;let n=(e=t[bd])!==null&&e!==void 0?e:"";t[bd]=(n+` ${PI}`).trimStart()}function MI(t){var e,n,i;return(i=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(r=>Yd(r)))!==null&&i!==void 0?i:!1}function LI(t){var e,n,i;return(i=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(r=>!Yd(r)))!==null&&i!==void 0?i:!1}function Yd(t){return t!==null&&typeof t=="object"&&t instanceof Md}function RI(t,e=100){return eo(this,arguments,function*(){let i,r=0;for(;r<e;){let o=yield be(t.listTools({cursor:i}));for(let a of o.tools)yield yield be(a),r++;if(!o.nextCursor)break;i=o.nextCursor}})}var Md=class t{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new t(e,n)}async initialize(){var e,n,i,r;if(this.mcpTools.length>0)return;let o={},a=[];for(let f of this.mcpClients)try{for(var u=!0,c=(n=void 0,ds(RI(f))),d;d=await c.next(),e=d.done,!e;u=!0){r=d.value,u=!1;let h=r;a.push(h);let m=h.name;if(o[m])throw new Error(`Duplicate function name ${m} found in MCP tools. Please ensure function names are unique.`);o[m]=f}}catch(h){n={error:h}}finally{try{!u&&!e&&(i=c.return)&&await i.call(c)}finally{if(n)throw n.error}}this.mcpTools=a,this.functionNameToMcpClient=o}async tool(){return await this.initialize(),GC(this.mcpTools,this.config)}async callTool(e){await this.initialize();let n=[];for(let i of e)if(i.name in this.functionNameToMcpClient){let r=this.functionNameToMcpClient[i.name],o;this.config.timeout&&(o={timeout:this.config.timeout});let a=await r.callTool({name:i.name,arguments:i.args},void 0,o);n.push({functionResponse:{name:i.name,response:a.isError?{error:a}:a}})}return n}};async function DI(t,e,n){let i=new Td,r;n.data instanceof Blob?r=JSON.parse(await n.data.text()):r=JSON.parse(n.data);let o=q_(r);Object.assign(i,o),e(i)}var Ld=class{constructor(e,n,i){this.apiClient=e,this.auth=n,this.webSocketFactory=i}async connect(e){var n,i;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let r=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),a=VI(this.apiClient.getDefaultHeaders()),u=this.apiClient.getApiKey(),c=`${r}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${u}`,d=()=>{},f=new Promise(x=>{d=x}),h=e.callbacks,m=function(){d({})},y=this.apiClient,p={onopen:m,onmessage:x=>{DI(y,h.onmessage,x)},onerror:(n=h?.onerror)!==null&&n!==void 0?n:function(x){},onclose:(i=h?.onclose)!==null&&i!==void 0?i:function(x){}},T=this.webSocketFactory.create(c,FI(a),p);T.connect(),await f;let R=we(this.apiClient,e.model),C=Ly({model:R}),g=Id({setup:C});return T.send(JSON.stringify(g)),new Rd(T,this.apiClient)}},Rd=class{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");let n=r_(e),i=Ry(n);this.conn.send(JSON.stringify({clientContent:i}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let n=o_(e),i=Id(n);this.conn.send(JSON.stringify(i))}sendPlaybackControl(e){let n=Id({playbackControl:e});this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(Xr.PLAY)}pause(){this.sendPlaybackControl(Xr.PAUSE)}stop(){this.sendPlaybackControl(Xr.STOP)}resetContext(){this.sendPlaybackControl(Xr.RESET_CONTEXT)}close(){this.conn.close()}};function FI(t){let e={};return t.forEach((n,i)=>{e[i]=n}),e}function VI(t){let e=new Headers;for(let[n,i]of Object.entries(t))e.append(n,i);return e}var $I="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function GI(t,e,n){let i=new xd,r;if(n.data instanceof Blob?r=JSON.parse(await n.data.text()):r=JSON.parse(n.data),t.isVertexAI()){let o=D_(r);Object.assign(i,o)}else{let o=R_(r);Object.assign(i,o)}e(i)}var Dd=class{constructor(e,n,i){this.apiClient=e,this.auth=n,this.webSocketFactory=i,this.music=new Ld(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,i,r,o,a,u;let c=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion(),f,h=this.apiClient.getDefaultHeaders();e.config&&e.config.tools&&Gy(e.config.tools)&&Uy(h);let m=OI(h);if(this.apiClient.isVertexAI())f=`${c}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(m);else{let b=this.apiClient.getApiKey(),D="BidiGenerateContent",te="key";b?.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),D="BidiGenerateContentConstrained",te="access_token"),f=`${c}/ws/google.ai.generativelanguage.${d}.GenerativeService.${D}?${te}=${b}`}let y=()=>{},p=new Promise(b=>{y=b}),T=e.callbacks,R=function(){var b;(b=T?.onopen)===null||b===void 0||b.call(T),y({})},C=this.apiClient,g={onopen:R,onmessage:b=>{GI(C,T.onmessage,b)},onerror:(n=T?.onerror)!==null&&n!==void 0?n:function(b){},onclose:(i=T?.onclose)!==null&&i!==void 0?i:function(b){}},x=this.webSocketFactory.create(f,HI(m),g);x.connect(),await p;let S=we(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&S.startsWith("publishers/")){let b=this.apiClient.getProject(),D=this.apiClient.getLocation();S=`projects/${b}/locations/${D}/`+S}let I={};this.apiClient.isVertexAI()&&((r=e.config)===null||r===void 0?void 0:r.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[ll.AUDIO]}:e.config.responseModalities=[ll.AUDIO]),!((o=e.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let V=(u=(a=e.config)===null||a===void 0?void 0:a.tools)!==null&&u!==void 0?u:[],k=[];for(let b of V)if(this.isCallableTool(b)){let D=b;k.push(await D.tool())}else k.push(b);k.length>0&&(e.config.tools=k);let N={model:S,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?I=ZS(this.apiClient,N):I=QS(this.apiClient,N),delete I.config,x.send(JSON.stringify(I)),new Fd(x,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}},UI={turnComplete:!0},Fd=class{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let i=[];try{i=ln(n.turns),e.isVertexAI()?i=i.map(r=>io(r)):i=i.map(r=>Cl(r))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:i,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let i=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?i=n.functionResponses:i=[n.functionResponses],i.length===0)throw new Error("functionResponses is required.");for(let o of i){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!e.isVertexAI()&&!("id"in o))throw new Error($I)}return{toolResponse:{functionResponses:i}}}sendClientContent(e){e=Object.assign(Object.assign({},UI),e);let n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:i_(e)}:n={realtimeInput:n_(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");let n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}};function HI(t){let e={};return t.forEach((n,i)=>{e[i]=n}),e}function OI(t){let e=new Headers;for(let[n,i]of Object.entries(t))e.append(n,i);return e}var my=10;function py(t){var e,n,i;if(!((e=t?.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let r=!1;for(let a of(n=t?.tools)!==null&&n!==void 0?n:[])if(al(a)){r=!0;break}if(!r)return!0;let o=(i=t?.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls;return o&&(o<0||!Number.isInteger(o))||o==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0):!1}function al(t){return"callTool"in t&&typeof t.callTool=="function"}function gy(t){var e;return!(!((e=t?.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}var Vd=class extends Ti{constructor(e){super(),this.apiClient=e,this.generateContent=async n=>{var i,r,o,a,u;let c=await this.processParamsForMcpUsage(n);if(!MI(n)||py(n.config))return await this.generateContentInternal(c);if(LI(n))throw new Error("Automatic function calling with CallableTools and Tools is not yet supported.");let d,f,h=ln(c.contents),m=(o=(r=(i=c.config)===null||i===void 0?void 0:i.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&o!==void 0?o:my,y=0;for(;y<m&&(d=await this.generateContentInternal(c),!(!d.functionCalls||d.functionCalls.length===0));){let p=d.candidates[0].content,T=[];for(let R of(u=(a=n.config)===null||a===void 0?void 0:a.tools)!==null&&u!==void 0?u:[])if(al(R)){let g=await R.callTool(d.functionCalls);T.push(...g)}y++,f={role:"user",parts:T},c.contents=ln(c.contents),c.contents.push(p),c.contents.push(f),gy(c.config)&&(h.push(p),h.push(f))}return gy(c.config)&&(d.automaticFunctionCallingHistory=h),d},this.generateContentStream=async n=>{if(py(n.config)){let i=await this.processParamsForMcpUsage(n);return await this.generateContentStreamInternal(i)}else return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(i=>{var r;let o,a=[];if(i?.generatedImages)for(let c of i.generatedImages)c&&c?.safetyAttributes&&((r=c?.safetyAttributes)===null||r===void 0?void 0:r.contentType)==="Positive Prompt"?o=c?.safetyAttributes:a.push(c);let u;return o?u={generatedImages:a,positivePromptSafetyAttributes:o}:u={generatedImages:a},u}),this.list=async n=>{var i;let a={config:Object.assign(Object.assign({},{queryBase:!0}),n?.config)};if(this.apiClient.isVertexAI()&&!a.config.queryBase){if(!((i=a.config)===null||i===void 0)&&i.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");a.config.filter="labels.tune-type:*"}return new no(to.PAGED_ITEM_MODELS,u=>this.listInternal(u),await this.listInternal(a),a)},this.editImage=async n=>{let i={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(i.referenceImages=n.referenceImages.map(r=>r.toReferenceImageAPI())),await this.editImageInternal(i)},this.upscaleImage=async n=>{let i={numberOfImages:1,mode:"upscale"};n.config&&(i=Object.assign(Object.assign({},i),n.config));let r={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:i};return await this.upscaleImageInternal(r)}}async processParamsForMcpUsage(e){var n,i,r;let o=(n=e.config)===null||n===void 0?void 0:n.tools;if(!o)return e;let a=await Promise.all(o.map(async c=>al(c)?await c.tool():c)),u={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:a})};if(u.config.tools=a,e.config&&e.config.tools&&Gy(e.config.tools)){let c=(r=(i=e.config.httpOptions)===null||i===void 0?void 0:i.headers)!==null&&r!==void 0?r:{},d=Object.assign({},c);Object.keys(d).length===0&&(d=this.apiClient.getDefaultHeaders()),Uy(d),u.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:d})}return u}async initAfcToolsMap(e){var n,i,r;let o=new Map;for(let a of(i=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&i!==void 0?i:[])if(al(a)){let u=a,c=await u.tool();for(let d of(r=c.functionDeclarations)!==null&&r!==void 0?r:[]){if(!d.name)throw new Error("Function declaration name is required.");if(o.has(d.name))throw new Error(`Duplicate tool declaration name: ${d.name}`);o.set(d.name,u)}}return o}async processAfcStream(e){var n,i,r;let o=(r=(i=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&r!==void 0?r:my,a=!1,u=0,c=await this.initAfcToolsMap(e);return function(d,f,h){var m,y;return eo(this,arguments,function*(){for(var p,T,R,C;u<o;){a&&(u++,a=!1);let I=yield be(d.processParamsForMcpUsage(h)),V=yield be(d.generateContentStreamInternal(I)),k=[],N=[];try{for(var g=!0,x=(T=void 0,ds(V)),S;S=yield be(x.next()),p=S.done,!p;g=!0){C=S.value,g=!1;let b=C;if(yield yield be(b),b.candidates&&(!((m=b.candidates[0])===null||m===void 0)&&m.content)){N.push(b.candidates[0].content);for(let D of(y=b.candidates[0].content.parts)!==null&&y!==void 0?y:[])if(u<o&&D.functionCall){if(!D.functionCall.name)throw new Error("Function call name was not returned by the model.");if(f.has(D.functionCall.name)){let te=yield be(f.get(D.functionCall.name).callTool([D.functionCall]));k.push(...te)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${f.keys()}, mising tool: ${D.functionCall.name}`)}}}}catch(b){T={error:b}}finally{try{!g&&!p&&(R=x.return)&&(yield be(R.call(x)))}finally{if(T)throw T.error}}if(k.length>0){a=!0;let b=new rr;b.candidates=[{content:{role:"user",parts:k}}],yield yield be(b);let D=[];D.push(...N),D.push({role:"user",parts:k});let te=ln(h.contents).concat(D);h.contents=te}else break}})}(this,c,e)}async generateContentInternal(e){var n,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let d=uy(this.apiClient,e);return u=ue("{model}:generateContent",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),a.then(f=>{let h=dy(f),m=new rr;return Object.assign(m,h),m})}else{let d=ly(this.apiClient,e);return u=ue("{model}:generateContent",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>{let h=cy(f),m=new rr;return Object.assign(m,h),m})}}async generateContentStreamInternal(e){var n,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let d=uy(this.apiClient,e);return u=ue("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.requestStream({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}),a.then(function(h){return eo(this,arguments,function*(){var m,y,p,T;try{for(var R=!0,C=ds(h),g;g=yield be(C.next()),m=g.done,!m;R=!0){T=g.value,R=!1;let S=dy(yield be(T.json())),I=new rr;Object.assign(I,S),yield yield be(I)}}catch(x){y={error:x}}finally{try{!R&&!m&&(p=C.return)&&(yield be(p.call(C)))}finally{if(y)throw y.error}}})})}else{let d=ly(this.apiClient,e);return u=ue("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.requestStream({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),a.then(function(h){return eo(this,arguments,function*(){var m,y,p,T;try{for(var R=!0,C=ds(h),g;g=yield be(C.next()),m=g.done,!m;R=!0){T=g.value,R=!1;let S=cy(yield be(T.json())),I=new rr;Object.assign(I,S),yield yield be(I)}}catch(x){y={error:x}}finally{try{!R&&!m&&(p=C.return)&&(yield be(p.call(C)))}finally{if(y)throw y.error}}})})}}async embedContent(e){var n,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let d=nw(this.apiClient,e);return u=ue("{model}:predict",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),a.then(f=>{let h=aI(f),m=new ul;return Object.assign(m,h),m})}else{let d=pN(this.apiClient,e);return u=ue("{model}:batchEmbedContents",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>{let h=Vw(f),m=new ul;return Object.assign(m,h),m})}}async generateImagesInternal(e){var n,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let d=rw(this.apiClient,e);return u=ue("{model}:predict",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),a.then(f=>{let h=uI(f),m=new cl;return Object.assign(m,h),m})}else{let d=yN(this.apiClient,e);return u=ue("{model}:predict",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>{let h=Uw(f),m=new cl;return Object.assign(m,h),m})}}async editImageInternal(e){var n,i;let r,o="",a={};if(this.apiClient.isVertexAI()){let u=dw(this.apiClient,e);return o=ue("{model}:predict",u._url),a=u._query,delete u.config,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>{let d=cI(c),f=new hd;return Object.assign(f,d),f})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,i;let r,o="",a={};if(this.apiClient.isVertexAI()){let u=hw(this.apiClient,e);return o=ue("{model}:predict",u._url),a=u._query,delete u.config,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>{let d=dI(c),f=new md;return Object.assign(f,d),f})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let d=mw(this.apiClient,e);return u=ue("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),a.then(f=>Ad(f))}else{let d=vN(this.apiClient,e);return u=ue("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>Ed(f))}}async listInternal(e){var n,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let d=gw(this.apiClient,e);return u=ue("{models_url}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),a.then(f=>{let h=pI(this.apiClient,f),m=new dl;return Object.assign(m,h),m})}else{let d=TN(this.apiClient,e);return u=ue("{models_url}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>{let h=Ow(this.apiClient,f),m=new dl;return Object.assign(m,h),m})}}async update(e){var n,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let d=vw(this.apiClient,e);return u=ue("{model}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),a.then(f=>Ad(f))}else{let d=kN(this.apiClient,e);return u=ue("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>Ed(f))}}async delete(e){var n,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let d=xw(this.apiClient,e);return u=ue("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),a.then(()=>{let f=gI(),h=new fl;return Object.assign(h,f),h})}else{let d=SN(this.apiClient,e);return u=ue("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(()=>{let f=Bw(),h=new fl;return Object.assign(h,f),h})}}async countTokens(e){var n,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let d=Cw(this.apiClient,e);return u=ue("{model}:countTokens",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),a.then(f=>{let h=yI(f),m=new hl;return Object.assign(m,h),m})}else{let d=NN(this.apiClient,e);return u=ue("{model}:countTokens",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>{let h=qw(f),m=new hl;return Object.assign(m,h),m})}}async computeTokens(e){var n,i;let r,o="",a={};if(this.apiClient.isVertexAI()){let u=kw(this.apiClient,e);return o=ue("{model}:computeTokens",u._url),a=u._query,delete u.config,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>{let d=vI(c),f=new pd;return Object.assign(f,d),f})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideos(e){var n,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let d=Nw(this.apiClient,e);return u=ue("{model}:predictLongRunning",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),a.then(f=>kI(f))}else{let d=EN(this.apiClient,e);return u=ue("{model}:predictLongRunning",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>Jw(f))}}};function BI(t){let e={},n=s(t,["operationName"]);n!=null&&l(e,["_url","operationName"],n);let i=s(t,["config"]);return i!=null&&l(e,["config"],i),e}function qI(t){let e={},n=s(t,["operationName"]);n!=null&&l(e,["_url","operationName"],n);let i=s(t,["config"]);return i!=null&&l(e,["config"],i),e}function KI(t){let e={},n=s(t,["operationName"]);n!=null&&l(e,["operationName"],n);let i=s(t,["resourceName"]);i!=null&&l(e,["_url","resourceName"],i);let r=s(t,["config"]);return r!=null&&l(e,["config"],r),e}function zI(t){let e={},n=s(t,["video","uri"]);n!=null&&l(e,["uri"],n);let i=s(t,["video","encodedVideo"]);i!=null&&l(e,["videoBytes"],On(i));let r=s(t,["encoding"]);return r!=null&&l(e,["mimeType"],r),e}function WI(t){let e={},n=s(t,["_self"]);return n!=null&&l(e,["video"],zI(n)),e}function JI(t){let e={},n=s(t,["generatedSamples"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(a=>WI(a))),l(e,["generatedVideos"],o)}let i=s(t,["raiMediaFilteredCount"]);i!=null&&l(e,["raiMediaFilteredCount"],i);let r=s(t,["raiMediaFilteredReasons"]);return r!=null&&l(e,["raiMediaFilteredReasons"],r),e}function YI(t){let e={},n=s(t,["name"]);n!=null&&l(e,["name"],n);let i=s(t,["metadata"]);i!=null&&l(e,["metadata"],i);let r=s(t,["done"]);r!=null&&l(e,["done"],r);let o=s(t,["error"]);o!=null&&l(e,["error"],o);let a=s(t,["response","generateVideoResponse"]);return a!=null&&l(e,["response"],JI(a)),e}function QI(t){let e={},n=s(t,["gcsUri"]);n!=null&&l(e,["uri"],n);let i=s(t,["bytesBase64Encoded"]);i!=null&&l(e,["videoBytes"],On(i));let r=s(t,["mimeType"]);return r!=null&&l(e,["mimeType"],r),e}function ZI(t){let e={},n=s(t,["_self"]);return n!=null&&l(e,["video"],QI(n)),e}function XI(t){let e={},n=s(t,["videos"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(a=>ZI(a))),l(e,["generatedVideos"],o)}let i=s(t,["raiMediaFilteredCount"]);i!=null&&l(e,["raiMediaFilteredCount"],i);let r=s(t,["raiMediaFilteredReasons"]);return r!=null&&l(e,["raiMediaFilteredReasons"],r),e}function yy(t){let e={},n=s(t,["name"]);n!=null&&l(e,["name"],n);let i=s(t,["metadata"]);i!=null&&l(e,["metadata"],i);let r=s(t,["done"]);r!=null&&l(e,["done"],r);let o=s(t,["error"]);o!=null&&l(e,["error"],o);let a=s(t,["response"]);return a!=null&&l(e,["response"],XI(a)),e}var $d=class extends Ti{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let n=e.operation,i=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let r=n.name.split("/operations/")[0],o;return i&&"httpOptions"in i&&(o=i.httpOptions),this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:r,config:{httpOptions:o}})}else return this.getVideosOperationInternal({operationName:n.name,config:i})}async getVideosOperationInternal(e){var n,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let d=qI(e);return u=ue("{operationName}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),a.then(f=>yy(f))}else{let d=BI(e);return u=ue("{operationName}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>YI(f))}}async fetchPredictVideosOperationInternal(e){var n,i;let r,o="",a={};if(this.apiClient.isVertexAI()){let u=KI(e);return o=ue("{resourceName}:fetchPredictOperation",u._url),a=u._query,delete u.config,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>yy(c))}else throw new Error("This method is only supported by the Vertex AI.")}};function jI(t){let e={},n=s(t,["voiceName"]);return n!=null&&l(e,["voiceName"],n),e}function Hy(t){let e={},n=s(t,["prebuiltVoiceConfig"]);return n!=null&&l(e,["prebuiltVoiceConfig"],jI(n)),e}function eE(t){let e={},n=s(t,["speaker"]);n!=null&&l(e,["speaker"],n);let i=s(t,["voiceConfig"]);return i!=null&&l(e,["voiceConfig"],Hy(i)),e}function tE(t){let e={},n=s(t,["speakerVoiceConfigs"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>eE(r))),l(e,["speakerVoiceConfigs"],i)}return e}function nE(t){let e={},n=s(t,["voiceConfig"]);n!=null&&l(e,["voiceConfig"],Hy(n));let i=s(t,["multiSpeakerVoiceConfig"]);i!=null&&l(e,["multiSpeakerVoiceConfig"],tE(i));let r=s(t,["languageCode"]);return r!=null&&l(e,["languageCode"],r),e}function iE(t){let e={},n=s(t,["fps"]);n!=null&&l(e,["fps"],n);let i=s(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let r=s(t,["startOffset"]);return r!=null&&l(e,["startOffset"],r),e}function rE(t){let e={};if(s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=s(t,["data"]);n!=null&&l(e,["data"],n);let i=s(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function oE(t){let e={};if(s(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=s(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);let i=s(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function sE(t){let e={},n=s(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],iE(n));let i=s(t,["thought"]);i!=null&&l(e,["thought"],i);let r=s(t,["inlineData"]);r!=null&&l(e,["inlineData"],rE(r));let o=s(t,["fileData"]);o!=null&&l(e,["fileData"],oE(o));let a=s(t,["thoughtSignature"]);a!=null&&l(e,["thoughtSignature"],a);let u=s(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let c=s(t,["executableCode"]);c!=null&&l(e,["executableCode"],c);let d=s(t,["functionCall"]);d!=null&&l(e,["functionCall"],d);let f=s(t,["functionResponse"]);f!=null&&l(e,["functionResponse"],f);let h=s(t,["text"]);return h!=null&&l(e,["text"],h),e}function aE(t){let e={},n=s(t,["parts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>sE(o))),l(e,["parts"],r)}let i=s(t,["role"]);return i!=null&&l(e,["role"],i),e}function lE(t){let e={},n=s(t,["behavior"]);n!=null&&l(e,["behavior"],n);let i=s(t,["description"]);i!=null&&l(e,["description"],i);let r=s(t,["name"]);r!=null&&l(e,["name"],r);let o=s(t,["parameters"]);o!=null&&l(e,["parameters"],o);let a=s(t,["parametersJsonSchema"]);a!=null&&l(e,["parametersJsonSchema"],a);let u=s(t,["response"]);u!=null&&l(e,["response"],u);let c=s(t,["responseJsonSchema"]);return c!=null&&l(e,["responseJsonSchema"],c),e}function uE(t){let e={},n=s(t,["startTime"]);n!=null&&l(e,["startTime"],n);let i=s(t,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function cE(t){let e={},n=s(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],uE(n)),e}function dE(t){let e={},n=s(t,["mode"]);n!=null&&l(e,["mode"],n);let i=s(t,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function fE(t){let e={},n=s(t,["dynamicRetrievalConfig"]);return n!=null&&l(e,["dynamicRetrievalConfig"],dE(n)),e}function hE(){return{}}function mE(t){let e={},n=s(t,["functionDeclarations"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(c=>lE(c))),l(e,["functionDeclarations"],u)}if(s(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let i=s(t,["googleSearch"]);i!=null&&l(e,["googleSearch"],cE(i));let r=s(t,["googleSearchRetrieval"]);if(r!=null&&l(e,["googleSearchRetrieval"],fE(r)),s(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(s(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");s(t,["urlContext"])!=null&&l(e,["urlContext"],hE());let a=s(t,["codeExecution"]);return a!=null&&l(e,["codeExecution"],a),e}function pE(t){let e={},n=s(t,["handle"]);if(n!=null&&l(e,["handle"],n),s(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function vy(){return{}}function gE(t){let e={},n=s(t,["disabled"]);n!=null&&l(e,["disabled"],n);let i=s(t,["startOfSpeechSensitivity"]);i!=null&&l(e,["startOfSpeechSensitivity"],i);let r=s(t,["endOfSpeechSensitivity"]);r!=null&&l(e,["endOfSpeechSensitivity"],r);let o=s(t,["prefixPaddingMs"]);o!=null&&l(e,["prefixPaddingMs"],o);let a=s(t,["silenceDurationMs"]);return a!=null&&l(e,["silenceDurationMs"],a),e}function yE(t){let e={},n=s(t,["automaticActivityDetection"]);n!=null&&l(e,["automaticActivityDetection"],gE(n));let i=s(t,["activityHandling"]);i!=null&&l(e,["activityHandling"],i);let r=s(t,["turnCoverage"]);return r!=null&&l(e,["turnCoverage"],r),e}function vE(t){let e={},n=s(t,["targetTokens"]);return n!=null&&l(e,["targetTokens"],n),e}function xE(t){let e={},n=s(t,["triggerTokens"]);n!=null&&l(e,["triggerTokens"],n);let i=s(t,["slidingWindow"]);return i!=null&&l(e,["slidingWindow"],vE(i)),e}function TE(t){let e={},n=s(t,["proactiveAudio"]);return n!=null&&l(e,["proactiveAudio"],n),e}function CE(t,e){let n={},i=s(t,["generationConfig"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig"],i);let r=s(t,["responseModalities"]);e!==void 0&&r!=null&&l(e,["setup","generationConfig","responseModalities"],r);let o=s(t,["temperature"]);e!==void 0&&o!=null&&l(e,["setup","generationConfig","temperature"],o);let a=s(t,["topP"]);e!==void 0&&a!=null&&l(e,["setup","generationConfig","topP"],a);let u=s(t,["topK"]);e!==void 0&&u!=null&&l(e,["setup","generationConfig","topK"],u);let c=s(t,["maxOutputTokens"]);e!==void 0&&c!=null&&l(e,["setup","generationConfig","maxOutputTokens"],c);let d=s(t,["mediaResolution"]);e!==void 0&&d!=null&&l(e,["setup","generationConfig","mediaResolution"],d);let f=s(t,["seed"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","seed"],f);let h=s(t,["speechConfig"]);e!==void 0&&h!=null&&l(e,["setup","generationConfig","speechConfig"],nE(Wd(h)));let m=s(t,["enableAffectiveDialog"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","enableAffectiveDialog"],m);let y=s(t,["systemInstruction"]);e!==void 0&&y!=null&&l(e,["setup","systemInstruction"],aE(yt(y)));let p=s(t,["tools"]);if(e!==void 0&&p!=null){let I=ps(p);Array.isArray(I)&&(I=I.map(V=>mE(ms(V)))),l(e,["setup","tools"],I)}let T=s(t,["sessionResumption"]);e!==void 0&&T!=null&&l(e,["setup","sessionResumption"],pE(T));let R=s(t,["inputAudioTranscription"]);e!==void 0&&R!=null&&l(e,["setup","inputAudioTranscription"],vy());let C=s(t,["outputAudioTranscription"]);e!==void 0&&C!=null&&l(e,["setup","outputAudioTranscription"],vy());let g=s(t,["realtimeInputConfig"]);e!==void 0&&g!=null&&l(e,["setup","realtimeInputConfig"],yE(g));let x=s(t,["contextWindowCompression"]);e!==void 0&&x!=null&&l(e,["setup","contextWindowCompression"],xE(x));let S=s(t,["proactivity"]);return e!==void 0&&S!=null&&l(e,["setup","proactivity"],TE(S)),n}function kE(t,e){let n={},i=s(e,["model"]);i!=null&&l(n,["setup","model"],we(t,i));let r=s(e,["config"]);return r!=null&&l(n,["config"],CE(r,n)),n}function SE(t,e,n){let i={},r=s(e,["expireTime"]);n!==void 0&&r!=null&&l(n,["expireTime"],r);let o=s(e,["newSessionExpireTime"]);n!==void 0&&o!=null&&l(n,["newSessionExpireTime"],o);let a=s(e,["uses"]);n!==void 0&&a!=null&&l(n,["uses"],a);let u=s(e,["liveConnectConstraints"]);n!==void 0&&u!=null&&l(n,["bidiGenerateContentSetup"],kE(t,u));let c=s(e,["lockAdditionalFields"]);return n!==void 0&&c!=null&&l(n,["fieldMask"],c),i}function _E(t,e){let n={},i=s(e,["config"]);return i!=null&&l(n,["config"],SE(t,i,n)),n}function NE(t){let e={},n=s(t,["name"]);return n!=null&&l(e,["name"],n),e}function wE(t){let e=[];for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)){let i=t[n];if(typeof i=="object"&&i!=null&&Object.keys(i).length>0){let r=Object.keys(i).map(o=>`${n}.${o}`);e.push(...r)}else e.push(n)}return e.join(",")}function IE(t,e){let n=null,i=t.bidiGenerateContentSetup;if(typeof i=="object"&&i!==null&&"setup"in i){let o=i.setup;typeof o=="object"&&o!==null?(t.bidiGenerateContentSetup=o,n=o):delete t.bidiGenerateContentSetup}else i!==void 0&&delete t.bidiGenerateContentSetup;let r=t.fieldMask;if(n){let o=wE(n);if(Array.isArray(e?.lockAdditionalFields)&&e?.lockAdditionalFields.length===0)o?t.fieldMask=o:delete t.fieldMask;else if(e?.lockAdditionalFields&&e.lockAdditionalFields.length>0&&r!==null&&Array.isArray(r)&&r.length>0){let a=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],u=[];r.length>0&&(u=r.map(d=>a.includes(d)?`generationConfig.${d}`:d));let c=[];o&&c.push(o),u.length>0&&c.push(...u),c.length>0?t.fieldMask=c.join(","):delete t.fieldMask}else delete t.fieldMask}else r!==null&&Array.isArray(r)&&r.length>0?t.fieldMask=r.join(","):delete t.fieldMask;return t}var Gd=class extends Ti{constructor(e){super(),this.apiClient=e}async create(e){var n,i;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let u=_E(this.apiClient,e);o=ue("auth_tokens",u._url),a=u._query,delete u.config,delete u._url,delete u._query;let c=IE(u,e.config);return r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),r.then(d=>NE(d))}}};function EE(t){let e={},n=s(t,["name"]);n!=null&&l(e,["_url","name"],n);let i=s(t,["config"]);return i!=null&&l(e,["config"],i),e}function AE(t,e){let n={},i=s(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);let r=s(t,["pageToken"]);e!==void 0&&r!=null&&l(e,["_query","pageToken"],r);let o=s(t,["filter"]);return e!==void 0&&o!=null&&l(e,["_query","filter"],o),n}function bE(t){let e={},n=s(t,["config"]);return n!=null&&l(e,["config"],AE(n,e)),e}function PE(t){let e={},n=s(t,["textInput"]);n!=null&&l(e,["textInput"],n);let i=s(t,["output"]);return i!=null&&l(e,["output"],i),e}function ME(t){let e={};if(s(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");let n=s(t,["examples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(r=>PE(r))),l(e,["examples","examples"],i)}return e}function LE(t,e){let n={};if(s(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");let i=s(t,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&l(e,["displayName"],i),s(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");let r=s(t,["epochCount"]);e!==void 0&&r!=null&&l(e,["tuningTask","hyperparameters","epochCount"],r);let o=s(t,["learningRateMultiplier"]);if(o!=null&&l(n,["tuningTask","hyperparameters","learningRateMultiplier"],o),s(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(s(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");let a=s(t,["batchSize"]);e!==void 0&&a!=null&&l(e,["tuningTask","hyperparameters","batchSize"],a);let u=s(t,["learningRate"]);return e!==void 0&&u!=null&&l(e,["tuningTask","hyperparameters","learningRate"],u),n}function RE(t){let e={},n=s(t,["baseModel"]);n!=null&&l(e,["baseModel"],n);let i=s(t,["trainingDataset"]);i!=null&&l(e,["tuningTask","trainingData"],ME(i));let r=s(t,["config"]);return r!=null&&l(e,["config"],LE(r,e)),e}function DE(t){let e={},n=s(t,["name"]);n!=null&&l(e,["_url","name"],n);let i=s(t,["config"]);return i!=null&&l(e,["config"],i),e}function FE(t,e){let n={},i=s(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);let r=s(t,["pageToken"]);e!==void 0&&r!=null&&l(e,["_query","pageToken"],r);let o=s(t,["filter"]);return e!==void 0&&o!=null&&l(e,["_query","filter"],o),n}function VE(t){let e={},n=s(t,["config"]);return n!=null&&l(e,["config"],FE(n,e)),e}function $E(t,e){let n={},i=s(t,["gcsUri"]);if(e!==void 0&&i!=null&&l(e,["supervisedTuningSpec","trainingDatasetUri"],i),s(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function GE(t){let e={},n=s(t,["gcsUri"]);return n!=null&&l(e,["validationDatasetUri"],n),e}function UE(t,e){let n={},i=s(t,["validationDataset"]);e!==void 0&&i!=null&&l(e,["supervisedTuningSpec"],GE(i));let r=s(t,["tunedModelDisplayName"]);e!==void 0&&r!=null&&l(e,["tunedModelDisplayName"],r);let o=s(t,["description"]);e!==void 0&&o!=null&&l(e,["description"],o);let a=s(t,["epochCount"]);e!==void 0&&a!=null&&l(e,["supervisedTuningSpec","hyperParameters","epochCount"],a);let u=s(t,["learningRateMultiplier"]);e!==void 0&&u!=null&&l(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],u);let c=s(t,["exportLastCheckpointOnly"]);e!==void 0&&c!=null&&l(e,["supervisedTuningSpec","exportLastCheckpointOnly"],c);let d=s(t,["adapterSize"]);if(e!==void 0&&d!=null&&l(e,["supervisedTuningSpec","hyperParameters","adapterSize"],d),s(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(s(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");return n}function HE(t){let e={},n=s(t,["baseModel"]);n!=null&&l(e,["baseModel"],n);let i=s(t,["trainingDataset"]);i!=null&&l(e,["supervisedTuningSpec","trainingDatasetUri"],$E(i,e));let r=s(t,["config"]);return r!=null&&l(e,["config"],UE(r,e)),e}function OE(t){let e={},n=s(t,["name"]);n!=null&&l(e,["model"],n);let i=s(t,["name"]);return i!=null&&l(e,["endpoint"],i),e}function Oy(t){let e={},n=s(t,["name"]);n!=null&&l(e,["name"],n);let i=s(t,["state"]);i!=null&&l(e,["state"],Ny(i));let r=s(t,["createTime"]);r!=null&&l(e,["createTime"],r);let o=s(t,["tuningTask","startTime"]);o!=null&&l(e,["startTime"],o);let a=s(t,["tuningTask","completeTime"]);a!=null&&l(e,["endTime"],a);let u=s(t,["updateTime"]);u!=null&&l(e,["updateTime"],u);let c=s(t,["description"]);c!=null&&l(e,["description"],c);let d=s(t,["baseModel"]);d!=null&&l(e,["baseModel"],d);let f=s(t,["_self"]);f!=null&&l(e,["tunedModel"],OE(f));let h=s(t,["distillationSpec"]);h!=null&&l(e,["distillationSpec"],h);let m=s(t,["experiment"]);m!=null&&l(e,["experiment"],m);let y=s(t,["labels"]);y!=null&&l(e,["labels"],y);let p=s(t,["pipelineJob"]);p!=null&&l(e,["pipelineJob"],p);let T=s(t,["serviceAccount"]);T!=null&&l(e,["serviceAccount"],T);let R=s(t,["tunedModelDisplayName"]);return R!=null&&l(e,["tunedModelDisplayName"],R),e}function BE(t){let e={},n=s(t,["nextPageToken"]);n!=null&&l(e,["nextPageToken"],n);let i=s(t,["tunedModels"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>Oy(o))),l(e,["tuningJobs"],r)}return e}function qE(t){let e={},n=s(t,["name"]);n!=null&&l(e,["name"],n);let i=s(t,["metadata"]);i!=null&&l(e,["metadata"],i);let r=s(t,["done"]);r!=null&&l(e,["done"],r);let o=s(t,["error"]);return o!=null&&l(e,["error"],o),e}function KE(t){let e={},n=s(t,["checkpointId"]);n!=null&&l(e,["checkpointId"],n);let i=s(t,["epoch"]);i!=null&&l(e,["epoch"],i);let r=s(t,["step"]);r!=null&&l(e,["step"],r);let o=s(t,["endpoint"]);return o!=null&&l(e,["endpoint"],o),e}function zE(t){let e={},n=s(t,["model"]);n!=null&&l(e,["model"],n);let i=s(t,["endpoint"]);i!=null&&l(e,["endpoint"],i);let r=s(t,["checkpoints"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>KE(a))),l(e,["checkpoints"],o)}return e}function Ud(t){let e={},n=s(t,["name"]);n!=null&&l(e,["name"],n);let i=s(t,["state"]);i!=null&&l(e,["state"],Ny(i));let r=s(t,["createTime"]);r!=null&&l(e,["createTime"],r);let o=s(t,["startTime"]);o!=null&&l(e,["startTime"],o);let a=s(t,["endTime"]);a!=null&&l(e,["endTime"],a);let u=s(t,["updateTime"]);u!=null&&l(e,["updateTime"],u);let c=s(t,["error"]);c!=null&&l(e,["error"],c);let d=s(t,["description"]);d!=null&&l(e,["description"],d);let f=s(t,["baseModel"]);f!=null&&l(e,["baseModel"],f);let h=s(t,["tunedModel"]);h!=null&&l(e,["tunedModel"],zE(h));let m=s(t,["supervisedTuningSpec"]);m!=null&&l(e,["supervisedTuningSpec"],m);let y=s(t,["tuningDataStats"]);y!=null&&l(e,["tuningDataStats"],y);let p=s(t,["encryptionSpec"]);p!=null&&l(e,["encryptionSpec"],p);let T=s(t,["partnerModelTuningSpec"]);T!=null&&l(e,["partnerModelTuningSpec"],T);let R=s(t,["distillationSpec"]);R!=null&&l(e,["distillationSpec"],R);let C=s(t,["experiment"]);C!=null&&l(e,["experiment"],C);let g=s(t,["labels"]);g!=null&&l(e,["labels"],g);let x=s(t,["pipelineJob"]);x!=null&&l(e,["pipelineJob"],x);let S=s(t,["serviceAccount"]);S!=null&&l(e,["serviceAccount"],S);let I=s(t,["tunedModelDisplayName"]);return I!=null&&l(e,["tunedModelDisplayName"],I),e}function WE(t){let e={},n=s(t,["nextPageToken"]);n!=null&&l(e,["nextPageToken"],n);let i=s(t,["tuningJobs"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>Ud(o))),l(e,["tuningJobs"],r)}return e}var Hd=class extends Ti{constructor(e){super(),this.apiClient=e,this.get=async n=>await this.getInternal(n),this.list=async(n={})=>new no(to.PAGED_ITEM_TUNING_JOBS,i=>this.listInternal(i),await this.listInternal(n),n),this.tune=async n=>{if(this.apiClient.isVertexAI())return await this.tuneInternal(n);{let i=await this.tuneMldevInternal(n),r="";return i.metadata!==void 0&&i.metadata.tunedModel!==void 0?r=i.metadata.tunedModel:i.name!==void 0&&i.name.includes("/operations/")&&(r=i.name.split("/operations/")[0]),{name:r,state:fd.JOB_STATE_QUEUED}}}}async getInternal(e){var n,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let d=DE(e);return u=ue("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),a.then(f=>Ud(f))}else{let d=EE(e);return u=ue("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>Oy(f))}}async listInternal(e){var n,i,r,o;let a,u="",c={};if(this.apiClient.isVertexAI()){let d=VE(e);return u=ue("tuningJobs",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),a.then(f=>{let h=WE(f),m=new ml;return Object.assign(m,h),m})}else{let d=bE(e);return u=ue("tunedModels",d._url),c=d._query,delete d.config,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),a.then(f=>{let h=BE(f),m=new ml;return Object.assign(m,h),m})}}async tuneInternal(e){var n,i;let r,o="",a={};if(this.apiClient.isVertexAI()){let u=HE(e);return o=ue("tuningJobs",u._url),a=u._query,delete u.config,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>Ud(c))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,i;let r,o="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=RE(e);return o=ue("tunedModels",u._url),a=u._query,delete u.config,delete u._url,delete u._query,r=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>qE(c))}}};var Od=class{async download(e,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}},JE=1024*1024*8,YE=3,QE=1e3,ZE=2,dd="x-goog-upload-status";async function XE(t,e,n){var i,r,o;let a=0,u=0,c=new fs(new Response),d="upload";for(a=t.size;u<a;){let h=Math.min(JE,a-u),m=t.slice(u,u+h);u+h>=a&&(d+=", finalize");let y=0,p=QE;for(;y<YE&&(c=await n.request({path:"",body:m,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":d,"X-Goog-Upload-Offset":String(u),"Content-Length":String(h)}}}),!(!((i=c?.headers)===null||i===void 0)&&i[dd]));)y++,await eA(p),p=p*ZE;if(u+=h,((r=c?.headers)===null||r===void 0?void 0:r[dd])!=="active")break;if(a<=u)throw new Error("All content has been uploaded, but the upload status is not finalized.")}let f=await c?.json();if(((o=c?.headers)===null||o===void 0?void 0:o[dd])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return f.file}async function jE(t){return{size:t.size,type:t.type}}function eA(t){return new Promise(e=>setTimeout(e,t))}var Bd=class{async upload(e,n,i){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await XE(e,n,i)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await jE(e)}};var qd=class{create(e,n,i){return new Kd(e,n,i)}},Kd=class{constructor(e,n,i){this.url=e,this.headers=n,this.callbacks=i}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}};var xy="x-goog-api-key",zd=class{constructor(e){this.apiKey=e}async addAuthHeaders(e){if(e.get(xy)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(xy,this.apiKey)}}};var tA="gl-node/",hs=class{constructor(e){var n;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=e.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=e.apiKey;let i=wC(e,void 0,void 0);i&&(e.httpOptions?e.httpOptions.baseUrl=i:e.httpOptions={baseUrl:i}),this.apiVersion=e.apiVersion;let r=new zd(this.apiKey);this.apiClient=new Pd({auth:r,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:tA+"web",uploader:new Bd,downloader:new Od}),this.models=new Vd(this.apiClient),this.live=new Dd(this.apiClient,r,new qd),this.chats=new Sd(this.models,this.apiClient),this.caches=new kd(this.apiClient),this.files=new wd(this.apiClient),this.operations=new $d(this.apiClient),this.authTokens=new Gd(this.apiClient),this.tunings=new Hd(this.apiClient)}};var dt=null,By=null;function or(t){if(!t)throw new Error("API key is required to initialize Gemini service. Attempted to initialize with an empty key.");(dt===null||By!==t)&&(dt=new hs({apiKey:t}),By=t)}function sr(t,e){let n;if(e){if(n=typeof process<"u"&&process.env&&typeof process.env.API_KEY=="string"?process.env.API_KEY:"",!n)throw console.error("Default API Key (process.env.API_KEY) is not configured in the environment."),new Error("API Key not available: Default API Key (process.env.API_KEY) is not configured in the environment. Please check server configuration or switch to a custom API key in settings.")}else if(n=t,!n)throw console.error("User-provided API Key is missing or empty."),new Error("API Key not available: User-provided API Key is missing or empty. Please provide one in settings or use the default API key.");return n}function qy(t,e,n,i,r,o,a,u,c,d,f,h,m,y,p,T,R,C,g,x){let S=Fp.systemInstruction;if(S+=`

**THI\u1EBET L\u1EACP HI\u1EC6N T\u1EA0I C\u1EE6A NG\u01AF\u1EDCI CH\u01A0I:**
`,S+=`**Th\u1EBF Gi\u1EDBi:**
- Ch\u1EE7 \u0111\u1EC1: ${t.theme}
- B\u1ED1i c\u1EA3nh: ${t.context}
- Phong c\xE1ch/Gi\u1ECDng v\u0103n: ${t.tone}
`,t.advancedPrompt&&(S+=`- Prompt N\xE2ng Cao: ${t.advancedPrompt}
`),S+=`
**Nh\xE2n V\u1EADt Ch\xEDnh (MC - ${e.name}):**
- T\xEAn: ${e.name}
- Gi\u1EDBi t\xEDnh: ${e.gender}
- S\u01A1 l\u01B0\u1EE3c: ${e.summary}
- M\u1EE5c ti\xEAu/\u0110\u1ED9ng l\u1EF1c ch\xEDnh: ${e.goal}
`,e.traits.length>0&&(S+=`- \u0110\u1EB7c \u0111i\u1EC3m:
${e.traits.map(k=>`  - ${k.name}: ${k.description}`).join(`
`)}
`),a&&Object.keys(a).length>0&&(S+=`
**Ch\u1EC9 S\u1ED1 G\u1ED0C Nh\xE2n V\u1EADt Hi\u1EC7n T\u1EA1i (ch\u01B0a bao g\u1ED3m bonus t\u1EEB trang b\u1ECB):**
${Object.values(a).map(k=>{let N=`  - ${k.name} (${k.id}): ${String(k.value)}`;return["crit_chance","evasion_chance","crit_damage_bonus"].includes(k.id)&&(N+="%"),!k.isProgressionStat&&typeof k.value=="number"&&k.maxValue!==void 0&&!["crit_chance","evasion_chance"].includes(k.id)&&(N+=`/${k.maxValue}`),N}).join(`
`)}
`),c&&u&&Object.keys(c).length>0){S+=`
**Trang B\u1ECB Hi\u1EC7n T\u1EA1i:**
`;for(let k in c){let N=c[k];if(N){let b=u.find(D=>D.id===N);b&&(S+=`  - ${k}: [ITEM:${b.name}]
`)}}}if(T&&R&&(S+=`
**Ti\u1EC1n T\u1EC7 Hi\u1EC7n T\u1EA1i (${R.name}):** ${R.amount.toLocaleString()} ${R.name} (Icon: ${R.icon||"fas fa-coins"}). Y\xEAu c\u1EA7u AI c\u1EADp nh\u1EADt qua \`currency_changes\`.
`),u&&u.length>0&&(S+=`
**V\u1EADt Ph\u1EA9m Trong Ba L\xF4 Hi\u1EC7n T\u1EA1i (\u01AFu ti\xEAn v\u1EADt ph\u1EA9m 'quan tr\u1ECDng' v\xE0 'trang b\u1ECB'):**
${u.map(k=>`  - [ITEM:${k.name}] (SL: ${k.quantity}, Lo\u1EA1i: ${k.category||"kh\xE1c"}, Icon: ${k.icon||"fas fa-question-circle"})${k.description?`: ${k.description.substring(0,50)}...`:""}`).join(`
`)}
`),f&&f.length>0&&(S+=`
**K\u1EF9 N\u0103ng Hi\u1EC7n T\u1EA1i C\u1EE7a Nh\xE2n V\u1EADt:**
${f.map(k=>`  - [SKILL:${k.name}] (ID: ${k.id}, Proficiency: ${k.proficiency}, Icon: ${k.icon||"fas fa-star"}, M\xF4 t\u1EA3 hi\u1EC7n t\u1EA1i: ${k.description.substring(0,70)}...): ${k.xp}/${k.xpToNextLevel} XP`).join(`
`)}
AI ch\u1EC9 c\u1EA7n cung c\u1EA5p c\xE1c k\u1EF9 n\u0103ng M\u1EDAI \u0111\u01B0\u1EE3c m\u1EDF kh\xF3a trong \`new_skills_unlocked\` ho\u1EB7c thay \u0111\u1ED5i XP/proficiency (k\xE8m \`new_description\`) trong \`skill_changes\`.
`),d&&d.length>0&&(S+=`
**Th\xE0nh T\u1EF1u \u0110\xE3 M\u1EDF Kh\xF3a:**
${d.map(k=>`  - ${k.name}: ${k.description.substring(0,70)}...`).join(`
`)}
AI ch\u1EC9 c\u1EA7n cung c\u1EA5p c\xE1c th\xE0nh t\u1EF1u M\u1EDAI \u0111\u01B0\u1EE3c m\u1EDF kh\xF3a trong \`newly_unlocked_achievements\`.
`),n.length>0&&(S+=`
**C\xE1c Th\u1EF1c Th\u1EC3/\u0110\u1ED1i T\u01B0\u1EE3ng \u0110\xE3 Bi\u1EBFt (Trong B\xE1ch Khoa To\xE0n Th\u01B0):**
${n.map(k=>`  - ${k.type} "[${k.type==="NPC"?"NPC:":k.type==="\u0110\u1ECBa \u0111i\u1EC3m"?"LOC:":k.type==="T\u1ED5 ch\u1EE9c"?"ORG:":k.type==="V\u1EADt ph\u1EA9m"?"ITEM:":"OTH:"}${k.name}]": ${k.description.substring(0,100)}...`).join(`
`)}
L\u01B0u \xFD: AI ch\u1EC9 c\u1EA7n b\u1ED5 sung c\xE1c m\u1EE5c th\u1EF1c s\u1EF1 m\u1EDBi ho\u1EB7c c\u1EADp nh\u1EADt m\xF4 t\u1EA3 cho c\xE1c m\u1EE5c \u0111\xE3 c\xF3 n\xE0y v\xE0o 'new_encyclopedia_entries' n\u1EBFu c\u1EA7n. Kh\xF4ng li\u1EC7t k\xEA l\u1EA1i to\xE0n b\u1ED9.
`),h&&Object.keys(h).length>0&&(S+=`
**M\u1ED1i Quan H\u1EC7 V\u1EDBi NPC Hi\u1EC7n T\u1EA1i:**
${Object.values(h).filter(k=>k.known).map(k=>`  - [NPC:${k.name}]: ${k.status} (\u0110i\u1EC3m: ${k.score})`).join(`
`)}
AI c\u1EA7n xem x\xE9t c\xE1c m\u1ED1i quan h\u1EC7 n\xE0y khi NPC t\u01B0\u01A1ng t\xE1c v\u1EDBi MC v\xE0 cung c\u1EA5p \`relationship_changes\` n\u1EBFu h\xE0nh \u0111\u1ED9ng c\u1EE7a MC thay \u0111\u1ED5i \u0111\xE1ng k\u1EC3 t\xECnh c\u1EA3m c\u1EE7a NPC.
`),m&&m.length>0&&(S+=`
**M\u1EE5c Ti\xEAu/Nhi\u1EC7m V\u1EE5 Hi\u1EC7n T\u1EA1i:**
${m.filter(k=>k.status==="active").map(k=>`  - ${k.title} (ID: ${k.id}): ${k.description.substring(0,70)}...`).join(`
`)}
AI c\xF3 th\u1EC3 \u0111\u1EC1 xu\u1EA5t \`new_objectives_suggested\` ho\u1EB7c \`objective_updates\`.
`),o&&(S+=`
**S\u1EF1 Ki\u1EC7n Th\u1EBF Gi\u1EDBi Hi\u1EC7n T\u1EA1i (${o.status}):**
- T\xEAn: ${o.name}
- Lo\u1EA1i: ${o.type}
- Ph\u1EA1m vi: ${o.scope}
- M\xF4 t\u1EA3: ${o.description}
`,o.keyElements&&o.keyElements.length>0&&(S+=`- Y\u1EBFu t\u1ED1 ch\xEDnh: ${o.keyElements.join(", ")}
`)),C&&g&&(S+=`
**Th\u1EDDi Gian Hi\u1EC7n T\u1EA1i:** ${g}. Y\xEAu c\u1EA7u AI c\u1EADp nh\u1EADt qua \`time_update\`.
`),S+=`
**H\u1EC6 TH\u1ED0NG T\xD9Y CH\u1EC8NH K\xCDCH HO\u1EA0T:**
`,S+=`- H\u1EC7 th\u1ED1ng Ti\u1EC1n T\u1EC7: ${T?"B\u1EACT":"T\u1EAET"}
`,S+=`- H\u1EC7 th\u1ED1ng Th\u1EDDi Gian: ${C?"B\u1EACT":"T\u1EAET"}
`,S+=`- H\u1EC7 th\u1ED1ng Danh Ti\u1EBFng (Ng\u1EA7m): ${x?"B\u1EACT":"T\u1EAET"}
`,r.enabled?(S+=`
**Ch\u1EBF \u0110\u1ED9 NSFW \u0110ang B\u1EACT:**
`,r.eroticaLevel!=="none"&&(S+=`- Khi\xEAu d\xE2m: ${r.eroticaLevel}
`),r.violenceLevel!=="none"&&(S+=`- B\u1EA1o l\u1EF1c: ${r.violenceLevel}
`),r.darkContentLevel!=="none"&&(S+=`- N\u1ED9i dung \u0111en t\u1ED1i: ${r.darkContentLevel}
`),r.customPrompt&&r.customPrompt.trim()!==""&&(S+=`- Phong c\xE1ch t\xF9y ch\u1EC9nh: ${r.customPrompt}
`),S+=`H\xE3y l\u1ED3ng gh\xE9p c\xE1c y\u1EBFu t\u1ED1 n\xE0y m\u1ED9t c\xE1ch t\u1EF1 nhi\xEAn, kh\xF4ng g\u01B0\u1EE3ng \xE9p, v\xE0 ph\xF9 h\u1EE3p v\u1EDBi b\u1ED1i c\u1EA3nh truy\u1EC7n khi c\xF3 c\u01A1 h\u1ED9i.
`):S+=`
**Ch\u1EBF \u0110\u1ED9 NSFW \u0110ang T\u1EAET.** Tr\xE1nh c\xE1c n\u1ED9i dung nh\u1EA1y c\u1EA3m.
`,y&&(S+=`
**CH\u1EBE \u0110\u1ED8 NH\u1EACP VAI \u0110ANG B\u1EACT (isRoleplayModeActive: true):**
Ng\u01B0\u1EDDi ch\u01A1i s\u1EBD t\u1EF1 ki\u1EC3m so\xE1t ho\xE0n to\xE0n l\u1EDDi n\xF3i v\xE0 h\xE0nh \u0111\u1ED9ng c\u1EE7a nh\xE2n v\u1EADt ch\xEDnh (MC). AI **KH\xD4NG \u0110\u01AF\u1EE2C PH\xC9P** t\u1EF1 t\u1EA1o l\u1EDDi n\xF3i, suy ngh\u0129 ho\u1EB7c h\xE0nh \u0111\u1ED9ng cho MC.
AI s\u1EBD mi\xEAu t\u1EA3 b\u1ED1i c\u1EA3nh v\xE0 h\xE0nh \u0111\u1ED9ng c\u1EE7a c\xE1c Nh\xE2n V\u1EADt Ph\u1EE5 (NPC), c\xF9ng v\u1EDBi ph\u1EA3n \u1EE9ng/g\xF3c nh\xECn t\u1EEB c\xE1c nh\xE2n v\u1EADt kh\xE1c \u0111\u1ED1i v\u1EDBi h\xE0nh \u0111\u1ED9ng c\u1EE7a MC.
**Y\xCAU C\u1EA6U C\u1EF0C K\u1EF2 QUAN TR\u1ECCNG CHO CH\u1EBE \u0110\u1ED8 NH\u1EACP VAI:**
- C\xE1c NPC **PH\u1EA2I** ch\u1EE7 \u0111\u1ED9ng tham gia v\xE0o cu\u1ED9c h\u1ED9i tho\u1EA1i. H\u1ECD n\xEAn n\xF3i chuy\u1EC7n, \u0111\u1ED1i \u0111\xE1p l\u1EA1i h\xE0nh \u0111\u1ED9ng/l\u1EDDi n\xF3i c\u1EE7a MC, thay v\xEC ch\u1EC9 im l\u1EB7ng quan s\xE1t m\u1ED9t c\xE1ch th\u1EE5 \u0111\u1ED9ng.
- AI **PH\u1EA2I** t\u1EA1o ra c\xE1c \u0111o\u1EA1n h\u1ED9i tho\u1EA1i c\xF3 \xFD ngh\u0129a cho NPC \u0111\u1EC3 th\xFAc \u0111\u1EA9y c\xE2u chuy\u1EC7n, cung c\u1EA5p th\xF4ng tin, ho\u1EB7c t\u1EA1o ra t\xECnh hu\u1ED1ng m\u1EDBi.
- L\u1EDDi tho\u1EA1i c\u1EE7a NPC c\u1EA7n th\u1EC3 hi\u1EC7n c\xE1 t\xEDnh c\u1EE7a h\u1ECD v\xE0 l\xE0m cho th\u1EBF gi\u1EDBi s\u1ED1ng \u0111\u1ED9ng h\u01A1n.
H\xE3y duy tr\xEC ng\xF4i k\u1EC3 th\u1EE9 ba cho m\u1ECDi m\xF4 t\u1EA3 h\xE0nh \u0111\u1ED9ng v\xE0 b\u1ED1i c\u1EA3nh. L\u1EDDi n\xF3i c\u1EE7a NPC \u0111\u01B0\u1EE3c \u0111\u1EB7t trong ngo\u1EB7c k\xE9p.
Ng\u01B0\u1EDDi ch\u01A1i s\u1EBD nh\u1EADp h\xE0nh \u0111\u1ED9ng c\u1EE7a MC qua m\u1ED9t \xF4 v\u0103n b\u1EA3n. V\xEC v\u1EADy, trong ph\u1EA3n h\u1ED3i JSON c\u1EE7a b\u1EA1n, tr\u01B0\u1EDDng \`choices\` **PH\u1EA2I** l\xE0 m\u1ED9t m\u1EA3ng r\u1ED7ng (\`[]\`).
`),p&&(S+='\n\n**CH\u1EBE \u0110\u1ED8 CAN THI\u1EC6P T\xC1C GI\u1EA2 \u0110ANG B\u1EACT (isAuthorInterventionModeActive: true):**\nNg\u01B0\u1EDDi d\xF9ng hi\u1EC7n \u0111ang nh\u1EADp li\u1EC7u v\u1EDBi vai tr\xF2 "T\xE1c Gi\u1EA3". L\u1EC7nh c\u1EE7a T\xE1c Gi\u1EA3 l\xE0 TUY\u1EC6T \u0110\u1ED0I v\xE0 PH\u1EA2I \u0111\u01B0\u1EE3c th\u1EF1c thi ngay l\u1EADp t\u1EE9c.\nT\xE1c Gi\u1EA3 c\xF3 to\xE0n quy\u1EC1n thay \u0111\u1ED5i b\u1EA5t k\u1EF3 kh\xEDa c\u1EA1nh n\xE0o c\u1EE7a c\xE2u chuy\u1EC7n v\xE0 tr\u1EA1ng th\xE1i game.\nV\xED d\u1EE5 v\u1EC1 l\u1EC7nh c\u1EE7a T\xE1c Gi\u1EA3: "T\xE1c Gi\u1EA3: Cho nh\xE2n v\u1EADt ch\xEDnh 1000 \u0111i\u1EC3m kinh nghi\u1EC7m v\xE0 k\u1EF9 n\u0103ng H\u1ECFa C\u1EA7u Thu\u1EADt." ho\u1EB7c "T\xE1c Gi\u1EA3: B\u1EA7u tr\u1EDDi \u0111\u1ED9t nhi\xEAn t\u1ED1i s\u1EA7m l\u1EA1i v\xE0 m\u1ED9t con r\u1ED3ng v\xE0ng kh\u1ED5ng l\u1ED3 xu\u1EA5t hi\u1EC7n."\nAI PH\u1EA2I ph\xE2n t\xEDch l\u1EC7nh c\u1EE7a T\xE1c Gi\u1EA3 v\xE0 ph\u1EA3n \xE1nh c\xE1c thay \u0111\u1ED5i \u0111\xF3 trong c\xE1c tr\u01B0\u1EDDng JSON t\u01B0\u01A1ng \u1EE9ng (v\xED d\u1EE5: `stat_changes`, `new_skills_unlocked`, `item_changes`, `new_encyclopedia_entries`, `story`, `currency_changes`, `time_update` v.v.).\nN\u1ED9i dung trong tr\u01B0\u1EDDng `story` n\xEAn m\xF4 t\u1EA3 k\u1EBFt qu\u1EA3 ho\u1EB7c di\u1EC5n bi\u1EBFn do l\u1EC7nh c\u1EE7a T\xE1c Gi\u1EA3 g\xE2y ra.\nTr\u01B0\u1EDDng `choices` trong ph\u1EA3n h\u1ED3i JSON **PH\u1EA2I LU\xD4N LU\xD4N** l\xE0 m\u1ED9t m\u1EA3ng r\u1ED7ng (`[]`) khi ch\u1EBF \u0111\u1ED9 n\xE0y \u0111ang ho\u1EA1t \u0111\u1ED9ng, v\xEC T\xE1c Gi\u1EA3 \u0111\u01B0a ra m\u1EC7nh l\u1EC7nh tr\u1EF1c ti\u1EBFp, kh\xF4ng ph\u1EA3i l\u1EF1a ch\u1ECDn cho nh\xE2n v\u1EADt.\n'),i.length>0){let k=`
**T\xD3M T\u1EAET DI\u1EC4N BI\u1EBEN TRUY\u1EC6N \u0110\xC3 QUA (\u0110\u1EC3 AI ghi nh\u1EDB):**
`,N=i.slice(-10).map(b=>b.type==="narration"||b.type==="event"||b.type==="author"?b.content:b.type==="dialogue"?`${b.characterName||"NPC"}: "${b.content}"`:b.type==="system"&&b.content.startsWith("Ng\u01B0\u1EDDi ch\u01A1i ch\u1ECDn:")?b.content:b.type==="system"&&b.content.includes("AI t\u1EF1 vi\u1EBFt ti\u1EBFp t\xECnh ti\u1EBFt")?`(${b.content})`:"").filter(Boolean).join(`
`);S+=k+N}let I=/\*\*11\. HỆ THỐNG THỜI GIAN \(NẾU ĐƯỢC KÍCH HOẠT\):\*\*[\s\S]*?(?=\n\n\*\*12\.|\n\n\*\*CHẾ ĐỘ NHẬP VAI|\n\n\*\*NGUYÊN TẮC CHUNG|$)/;return S=S.replace(I,`**11. H\u1EC6 TH\u1ED0NG TH\u1EDCI GIAN (N\u1EBEU \u0110\u01AF\u1EE2C K\xCDCH HO\u1EA0T):**
   - N\u1EBFu h\u1EC7 th\u1ED1ng th\u1EDDi gian \u0111\u01B0\u1EE3c k\xEDch ho\u1EA1t (th\xF4ng qua c\u1EDD \`timeSystemEnabled: true\` trong thi\u1EBFt l\u1EADp), AI PH\u1EA2I:
     - **Khi b\u1EAFt \u0111\u1EA7u c\xE2u chuy\u1EC7n m\u1EDBi:** Cung c\u1EA5p th\u1EDDi gian b\u1EAFt \u0111\u1EA7u trong tr\u01B0\u1EDDng \`initial_time\`. \u0110\u1ECBnh d\u1EA1ng: 'HH:MM Ng\xE0y DD, Th\xE1ng MM, N\u0103m YYYY (M\xF4 t\u1EA3 bu\u1ED5i, v\xED d\u1EE5: B\xECnh minh, Tr\u01B0a, Ho\xE0ng h\xF4n, N\u1EEDa \u0111\xEAm)'. V\xED d\u1EE5: '08:00 Ng\xE0y 1, Th\xE1ng Gi\xEAng, N\u0103m \u0110\u1EA1i Vi\u1EC7t th\u1EE9 10 (Bu\u1ED5i s\xE1ng trong l\xE0nh)'.
     - **Trong qu\xE1 tr\xECnh ch\u01A1i:**
       - AI PH\u1EA2I ch\u1EE7 \u0111\u1ED9ng theo d\xF5i v\xE0 c\u1EADp nh\u1EADt th\u1EDDi gian trong tr\u01B0\u1EDDng \`time_update\` m\u1ED7i khi c\xF3 h\xE0nh \u0111\u1ED9ng ho\u1EB7c s\u1EF1 ki\u1EC7n l\xE0m th\u1EDDi gian tr\xF4i qua m\u1ED9t c\xE1ch h\u1EE3p l\xFD (v\xED d\u1EE5: m\u1ED9t cu\u1ED9c h\xE0nh tr\xECnh d\xE0i, m\u1ED9t kho\u1EA3ng th\u1EDDi gian ngh\u1EC9 ng\u01A1i, m\u1ED9t tr\u1EADn chi\u1EBFn k\xE9o d\xE0i).
       - **QUAN TR\u1ECCNG:** N\u1EBFu ng\u01B0\u1EDDi ch\u01A1i nh\u1EADp m\u1ED9t h\xE0nh \u0111\u1ED9ng c\xF3 ch\u1EE9a th\xF4ng tin th\u1EDDi gian c\u1EE5 th\u1EC3 (v\xED d\u1EE5: "T\xF4i ng\u1EE7 \u0111\u1EBFn s\xE1ng h\xF4m sau", "V\xE0o n\u0103m 2013...", "Bu\u1ED5i t\u1ED1i h\xF4m \u0111\xF3, t\xF4i quy\u1EBFt \u0111\u1ECBnh..."), AI PH\u1EA2I ph\xE2n t\xEDch th\xF4ng tin n\xE0y v\xE0 c\u1ED1 g\u1EAFng ph\u1EA3n \xE1nh s\u1EF1 thay \u0111\u1ED5i th\u1EDDi gian \u0111\xF3 trong tr\u01B0\u1EDDng \`time_update\`.
       - M\xF4 t\u1EA3 s\u1EF1 thay \u0111\u1ED5i th\u1EDDi gian trong truy\u1EC7n n\u1EBFu h\u1EE3p l\xFD (v\xED d\u1EE5: 'Sau m\u1ED9t h\u1ED3i t\xECm ki\u1EBFm, tr\u1EDDi \u0111\xE3 v\u1EC1 chi\u1EC1u.', 'M\xE0n \u0111\xEAm bu\xF4ng xu\u1ED1ng...', 'Th\u1EDDi gian th\u1EA5m tho\u1EAFt thoi \u0111\u01B0a, \u0111\xE3 l\xE0 n\u0103m 2013.').
       - \u0110\u1ECBnh d\u1EA1ng th\u1EDDi gian trong \`time_update\` N\xCAN c\u1ED1 g\u1EAFng gi\u1EEF s\u1EF1 nh\u1EA5t qu\xE1n v\u1EDBi \u0111\u1ECBnh d\u1EA1ng \`initial_time\` \u0111\xE3 cung c\u1EA5p, nh\u01B0ng AI c\xF3 th\u1EC3 linh ho\u1EA1t n\u1EBFu ng\u01B0\u1EDDi ch\u01A1i cung c\u1EA5p th\xF4ng tin kh\xF4ng \u0111\u1EA7y \u0111\u1EE7 (v\xED d\u1EE5, n\u1EBFu ng\u01B0\u1EDDi ch\u01A1i ch\u1EC9 n\xF3i "Bu\u1ED5i t\u1ED1i", AI c\xF3 th\u1EC3 c\u1EADp nh\u1EADt ph\u1EA7n m\xF4 t\u1EA3 bu\u1ED5i trong chu\u1ED7i th\u1EDDi gian).`),S}function Ky(t){return Array.isArray(t)?t.map((e,n)=>({id:e.id||`temp-encyclopedia-${Date.now()}-${n}`,name:e.name||"Kh\xF4ng t\xEAn",type:Object.values(Ht).includes(e.type)?e.type:"Kh\xE1c",description:e.description||"Kh\xF4ng c\xF3 m\xF4 t\u1EA3."})).filter(e=>e.name!=="Kh\xF4ng t\xEAn"):[]}function nA(t){if(!t||typeof t!="object"||Array.isArray(t))return;let e={};for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)){let i=t[n],r=i.id||n;if(i&&typeof i.name=="string"&&(typeof i.value=="number"||typeof i.value=="string")){let o={id:r,name:i.name,value:i.value,description:typeof i.description=="string"?i.description:void 0,icon:typeof i.icon=="string"?i.icon:void 0,isProgressionStat:typeof i.isProgressionStat=="boolean"?i.isProgressionStat:r==="progression_level"};typeof i.maxValue=="number"&&(o.maxValue=i.maxValue),e[r]=o}}return Object.keys(e).length>0?e:void 0}function zy(t){if(Array.isArray(t))return t.map(e=>{if(!e||typeof e.name!="string"||typeof e.quantity!="number")return null;let n=[];return Array.isArray(e.statBonuses)&&e.statBonuses.forEach(r=>{r&&typeof r.statId=="string"&&typeof r.value=="number"&&n.push({statId:r.statId,value:r.value,isPercentage:typeof r.isPercentage=="boolean"?r.isPercentage:void 0,appliesToMax:typeof r.appliesToMax=="boolean"?r.appliesToMax:void 0})}),{id:e.id||`item-${Date.now()}-${Math.random().toString(36).substr(2,5)}`,name:e.name,description:e.description||"Kh\xF4ng c\xF3 m\xF4 t\u1EA3.",quantity:e.quantity,icon:e.icon,category:e.category,usable:typeof e.usable=="boolean"?e.usable:void 0,consumable:typeof e.consumable=="boolean"?e.consumable:void 0,effects:Array.isArray(e.effects)?e.effects.map(r=>({statId:r.statId,changeValue:r.changeValue})).filter(r=>r.statId&&typeof r.changeValue=="number"):void 0,equippable:typeof e.equippable=="boolean"?e.equippable:void 0,slot:Object.values(Or).includes(e.slot)?e.slot:void 0,statBonuses:n.length>0?n:void 0}}).filter(Boolean)}function Wy(t){if(Array.isArray(t))return t.map(e=>!e||typeof e.name!="string"||typeof e.description!="string"?null:{name:e.name,description:e.description,icon:e.icon,isSecret:!!e.isSecret}).filter(Boolean)}function Qd(t){return t?t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,"d").replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"").substring(0,50):`skill_unknown_${Date.now()}_${Math.random().toString(36).substring(2,7)}`}function Jy(t){if(Array.isArray(t))return t.map(e=>!e||typeof e.name!="string"?null:{id:e.id||Qd(e.name),name:e.name,description:e.description||"Ch\u01B0a c\xF3 m\xF4 t\u1EA3.",icon:e.icon||"fas fa-book-sparkles",category:e.category||"kh\xE1c",proficiency:e.proficiency||"S\u01A1 Nh\u1EADp M\xF4n",xp:typeof e.xp=="number"?e.xp:0,xpToNextLevel:typeof e.xpToNextLevel=="number"?e.xpToNextLevel:100,effects:e.effects||[]}).filter(Boolean)}function Yy(t){return Array.isArray(t)?t.map((e,n)=>typeof e=="string"?{id:`choice-${Date.now()}-${n}`,text:e}:typeof e=="object"&&e.text?{id:`choice-${Date.now()}-${n}`,text:e.text,tooltip:e.tooltip||void 0}:{id:`choice-invalid-${Date.now()}-${n}`,text:"L\u1EF1a ch\u1ECDn kh\xF4ng h\u1EE3p l\u1EC7",tooltip:"L\u1ED7i \u0111\u1ECBnh d\u1EA1ng"}).filter(e=>e.text!=="L\u1EF1a ch\u1ECDn kh\xF4ng h\u1EE3p l\u1EC7"):[]}function iA(t){if(Array.isArray(t))return t.map(e=>!e||typeof e.npc_name!="string"?null:{npc_name:e.npc_name,score_change:typeof e.score_change=="number"?e.score_change:void 0,new_status:Object.values(is).includes(e.new_status)?e.new_status:void 0,reason:typeof e.reason=="string"?e.reason:void 0}).filter(Boolean)}function Qy(t,e=!1){if(Array.isArray(t))return t.map(n=>{if(!n||typeof n.title!="string"||typeof n.description!="string")return null;let i={title:n.title,description:n.description,subObjectives:Array.isArray(n.subObjectives)?n.subObjectives.filter(r=>typeof r=="string"):void 0,rewardPreview:typeof n.rewardPreview=="string"?n.rewardPreview:void 0};return e&&typeof n.isPlayerGoal=="boolean"&&(i.isPlayerGoal=n.isPlayerGoal),i}).filter(Boolean)}function rA(t){if(Array.isArray(t))return t.map(e=>!e||typeof e.name!="string"?null:{id:e.id||`npc-${Qd(e.name)}`,name:e.name,status:Object.values(is).includes(e.status)?e.status:"Trung L\u1EADp",score:typeof e.score=="number"?e.score:0,description:e.description,known:typeof e.known=="boolean"?e.known:!0}).filter(Boolean)}function oA(t){if(!(!t||typeof t.name!="string"||typeof t.amount!="number"))return{name:t.name,amount:t.amount,icon:typeof t.icon=="string"?t.icon:"fas fa-coins"}}async function Zy(t,e,n,i,r,o,a){let u=sr(t,e);if(or(u),!dt)throw new Error("Gemini AI not initialized after API key resolution.");let c=qy(n,i,r,[],o,null,void 0,void 0,void 0,void 0,void 0,{},[],!1,!1,a.currencyEnabled,void 0,a.timeSystemEnabled,void 0,a.reputationSystemEnabled),d=`H\xE3y b\u1EAFt \u0111\u1EA7u c\xE2u chuy\u1EC7n, t\u1EADp trung v\xE0o h\xE0nh tr\xECnh c\u1EE7a nh\xE2n v\u1EADt ch\xEDnh ${i.name}.
Y\xEAu c\u1EA7u c\u1EE5 th\u1EC3:
*   B\u1EAFt \u0111\u1EA7u b\u1EB1ng m\u1ED9t t\xECnh hu\u1ED1ng l\xE0m n\u1ED5i b\u1EADt ho\xE0n c\u1EA3nh hi\u1EC7n t\u1EA1i c\u1EE7a MC.
*   Nhanh ch\xF3ng gi\u1EDBi thi\u1EC7u m\u1ED9t m\xE2u thu\u1EABn ho\u1EB7c c\u01A1 h\u1ED9i \u0111\u1EA7u ti\xEAn.
*   Cung c\u1EA5p \`initial_stats\` **ph\xF9 h\u1EE3p v\xE0 ng\u1EABu nhi\xEAn** d\u1EF1a tr\xEAn thi\u1EBFt l\u1EADp th\u1EBF gi\u1EDBi v\xE0 nh\xE2n v\u1EADt (bao g\u1ED3m \`icon\` Font Awesome cho m\u1ED7i ch\u1EC9 s\u1ED1), \`initial_inventory\` (bao g\u1ED3m trang b\u1ECB n\u1EBFu c\xF3, v\u1EDBi c\xE1c tr\u01B0\u1EDDng \`equippable\`, \`slot\`, \`statBonuses\`, v\xE0 \`icon\` Font Awesome), \`initial_skills\` (bao g\u1ED3m \`icon\` Font Awesome).`;a.currencyEnabled&&(d+="\n*   Cung c\u1EA5p `initial_currency` (bao g\u1ED3m `name`, `amount`, v\xE0 `icon` Font Awesome) ph\xF9 h\u1EE3p v\u1EDBi th\u1EBF gi\u1EDBi."),a.timeSystemEnabled&&(d+="\n*   Cung c\u1EA5p `initial_time` theo \u0111\u1ECBnh d\u1EA1ng 'HH:MM Ng\xE0y DD, Th\xE1ng MM, N\u0103m YYYY (M\xF4 t\u1EA3 bu\u1ED5i)'."),d+=`
*   N\u1EBFu c\xF3 NPC quan tr\u1ECDng ho\u1EB7c th\xE2n nh\xE2n (v\xED d\u1EE5: cha m\u1EB9, s\u01B0 ph\u1EE5, anh ch\u1ECB em ru\u1ED9t th\u1ECBt), cung c\u1EA5p \`initial_relationships\` **V\u1EDAI TR\u1EA0NG TH\xC1I V\xC0 \u0110I\u1EC2M S\u1ED0 PH\xD9 H\u1EE2P (v\xED d\u1EE5: cha m\u1EB9 N\xCAN c\xF3 status "Th\xE2n Thi\u1EC7n" ho\u1EB7c "H\xF2a H\u1EA3o", \u0111i\u1EC3m s\u1ED1 t\u1EEB 30-70 t\xF9y theo m\xF4 t\u1EA3 ban \u0111\u1EA7u)** v\xE0 m\xF4 t\u1EA3 h\u1ECD trong \`new_encyclopedia_entries\`. C\xE1c NPC kh\xE1c ch\u01B0a quen bi\u1EBFt c\xF3 th\u1EC3 kh\u1EDFi \u0111\u1EA7u \u1EDF "Trung L\u1EADp". **\u0110\u1EA3m b\u1EA3o t\u1EA5t c\u1EA3 NPC ban \u0111\u1EA7u \u0111\xE3 bi\u1EBFt \u0111\u1EC1u c\xF3 trong initial_relationships.**
*   Cung c\u1EA5p \`initial_objectives\`, trong \u0111\xF3 m\u1EE5c ti\xEAu ch\xEDnh c\u1EE7a nh\xE2n v\u1EADt (\`${i.goal}\`) n\xEAn l\xE0 m\u1ED9t objective v\u1EDBi \`isPlayerGoal: true\`.
*   Th\xEAm c\xE1c th\u1EF1c th\u1EC3 m\u1EDBi (bao g\u1ED3m c\u1EA3 c\u1EA3nh gi\u1EDBi tu luy\u1EC7n n\u1EBFu \u0111\u01B0\u1EE3c \u0111\u1EC1 c\u1EADp) v\xE0o "new_encyclopedia_entries".
*   N\u1EBFu c\xF3 th\xE0nh t\u1EF1u m\u1EDF kh\xF3a, th\xEAm v\xE0o "newly_unlocked_achievements".
*   \u0110\u01B0a ra 3-4 l\u1EF1a ch\u1ECDn h\xE0nh \u0111\u1ED9ng cho ng\u01B0\u1EDDi ch\u01A1i.
*   Tr\u1EA3 l\u1EDDi JSON theo c\u1EA5u tr\xFAc. \u0110\u1ED1i t\u01B0\u1EE3ng JSON ph\u1EA3i CH\u1EC8 ch\u1EE9a c\xE1c tr\u01B0\u1EDDng sau: story (b\u1EAFt bu\u1ED9c), choices (b\u1EAFt bu\u1ED9c), v\xE0 c\xE1c tr\u01B0\u1EDDng t\xF9y ch\u1ECDn sau N\u1EBEU C\xD3: initial_stats, initial_inventory, initial_skills, new_encyclopedia_entries, newly_unlocked_achievements, initial_relationships, initial_objectives${a.currencyEnabled?", initial_currency":""}${a.timeSystemEnabled?", initial_time":""}. TUY\u1EC6T \u0110\u1ED0I KH\xD4NG th\xEAm b\u1EA5t k\u1EF3 tr\u01B0\u1EDDng n\xE0o kh\xE1c.`;let f=await dt.models.generateContent({model:Vn,contents:[{role:"user",parts:[{text:d}]}],config:{systemInstruction:c,responseMimeType:"application/json"}}),h=f.text.trim(),m=/^```(\w*)?\s*\n?(.*?)\n?\s*```$/s,y=h.match(m);y&&y[2]&&(h=y[2].trim());try{let p=JSON.parse(h),T=p.story||"L\u1ED7i: AI kh\xF4ng tr\u1EA3 v\u1EC1 n\u1ED9i dung truy\u1EC7n.",R=Yy(p.choices);return{story:{id:`story-${Date.now()}`,type:"narration",content:T,timestamp:new Date().toISOString()},choices:R,newEntries:Ky(p.new_encyclopedia_entries),initialStats:nA(p.initial_stats),initialInventory:zy(p.initial_inventory),initialSkills:Jy(p.initial_skills),newlyUnlockedAchievements:Wy(p.newly_unlocked_achievements),initialRelationships:rA(p.initial_relationships),initialObjectives:Qy(p.initial_objectives,!0),initialCurrency:a.currencyEnabled?oA(p.initial_currency):void 0,initialTime:a.timeSystemEnabled?p.initial_time:void 0}}catch(p){console.error("Failed to parse JSON response for initial story:",p,`
Raw response:`,f.text);let T=f.text.match(/"story"\s*:\s*"(.*?)"/s),R=T&&T[1]?T[1].replace(/\\n/g,`
`).replace(/\\"/g,'"'):"AI kh\xF4ng th\u1EC3 t\u1EA1o c\xE2u chuy\u1EC7n ban \u0111\u1EA7u. Vui l\xF2ng th\u1EED l\u1EA1i.";return{story:{id:`story-${Date.now()}`,type:"narration",content:R,timestamp:new Date().toISOString()},choices:[]}}}async function Xy(t,e,n,i,r,o){let a=sr(t,e);if(or(a),!dt)throw new Error("Gemini AI not initialized after API key resolution.");let{setup:u,storyLog:c,currentWorldEvent:d,encyclopedia:f,characterStats:h,inventory:m,equippedItems:y,unlockedAchievements:p,characterSkills:T,npcRelationships:R,objectives:C,isRoleplayModeActive:g,isAuthorInterventionModeActive:x,currency:S,currentTime:I}=n,V=qy(u.world,u.character,f,c,r,d,h,m,y,p,T,R,C,g,x,o.currencyEnabled,S,o.timeSystemEnabled,I,o.reputationSystemEnabled),k="";i==="AI_AUTO_CONTINUE_STORY"?k=`AI \u0111\u01B0\u1EE3c y\xEAu c\u1EA7u t\u1EF1 \u0111\u1ED9ng vi\u1EBFt ti\u1EBFp c\xE2u chuy\u1EC7n.
H\xE3y ph\xE1t tri\u1EC3n t\xECnh ti\u1EBFt m\u1ED9t c\xE1ch t\u1EF1 nhi\xEAn v\xE0 h\u1EE3p l\xFD d\u1EF1a tr\xEAn b\u1ED1i c\u1EA3nh hi\u1EC7n t\u1EA1i, m\u1EE5c ti\xEAu c\u1EE7a nh\xE2n v\u1EADt ${u.character.name}, c\xE1c s\u1EF1 ki\u1EC7n \u0111ang di\u1EC5n ra, v\xE0 c\xE1c y\u1EBFu t\u1ED1 kh\xE1c trong game.
N\u1EBFu kh\xF4ng \u1EDF Ch\u1EBF \u0110\u1ED9 Nh\u1EADp Vai ho\u1EB7c Can Thi\u1EC7p T\xE1c Gi\u1EA3, h\xE3y cung c\u1EA5p 3-4 l\u1EF1a ch\u1ECDn h\xE0nh \u0111\u1ED9ng m\u1EDBi cho ng\u01B0\u1EDDi ch\u01A1i sau khi m\xF4 t\u1EA3 di\u1EC5n bi\u1EBFn.
M\xF4 t\u1EA3 h\xE0nh \u0111\u1ED9ng, suy ngh\u0129 c\u1EE7a nh\xE2n v\u1EADt ch\xEDnh (tr\u1EEB khi Ch\u1EBF \u0111\u1ED9 Nh\u1EADp Vai \u0111ang B\u1EACT, l\xFAc \u0111\xF3 ch\u1EC9 t\u1EADp trung v\xE0o NPC v\xE0 th\u1EBF gi\u1EDBi).
C\u1EADp nh\u1EADt t\u1EA5t c\u1EA3 c\xE1c tr\u01B0\u1EDDng JSON c\u1EA7n thi\u1EBFt (v\xED d\u1EE5: \`stat_changes\`, \`item_changes\`, \`skill_changes\`, \`new_encyclopedia_entries\`, \`relationship_changes\`, \`currency_changes\`, \`time_update\` v.v.) n\u1EBFu c\xF3 thay \u0111\u1ED5i.
**\u0110\u1EA2M B\u1EA2O T\xCDNH M\u1EDAI M\u1EBA TRONG N\u1ED8I DUNG TRUY\u1EC6N (\`story\`):** AI PH\u1EA2I t\u1EA1o ra n\u1ED9i dung \`story\` ho\xE0n to\xE0n M\u1EDAI, kh\xF4ng l\u1EB7p l\u1EA1i c\xE1c c\xE2u v\u0103n, \u0111o\u1EA1n v\u0103n, ho\u1EB7c m\xF4 t\u1EA3 t\xECnh hu\u1ED1ng t\u1EEB c\xE1c l\u01B0\u1EE3t tr\u01B0\u1EDBc. T\u1EADp trung v\xE0o vi\u1EC7c ph\xE1t tri\u1EC3n c\xE2u chuy\u1EC7n v\xE0 gi\u1EDBi thi\u1EC7u c\xE1c di\u1EC5n bi\u1EBFn, th\xF4ng tin, ho\u1EB7c ph\u1EA3n \u1EE9ng m\u1EDBi c\u1EE7a th\u1EBF gi\u1EDBi/NPC.
Tr\u1EA3 l\u1EDDi JSON theo c\u1EA5u tr\xFAc. \u0110\u1ED1i t\u01B0\u1EE3ng JSON ph\u1EA3i CH\u1EC8 ch\u1EE9a c\xE1c tr\u01B0\u1EDDng sau: story (b\u1EAFt bu\u1ED9c), choices (b\u1EAFt bu\u1ED9c), v\xE0 c\xE1c tr\u01B0\u1EDDng t\xF9y ch\u1ECDn sau N\u1EBEU C\xD3 THAY \u0110\u1ED4I: stat_changes, item_changes, skill_changes, new_skills_unlocked, new_encyclopedia_entries, summary_update, newly_unlocked_achievements, relationship_changes, new_objectives_suggested, objective_updates${o.currencyEnabled?", currency_changes":""}${o.timeSystemEnabled?", time_update":""}. TUY\u1EC6T \u0110\u1ED0I KH\xD4NG th\xEAm b\u1EA5t k\u1EF3 tr\u01B0\u1EDDng n\xE0o kh\xE1c.`:x?k=`T\xE1c Gi\u1EA3: "${i}".
H\xE3y th\u1EF1c hi\u1EC7n l\u1EC7nh n\xE0y c\u1EE7a T\xE1c Gi\u1EA3 m\u1ED9t c\xE1ch ch\xEDnh x\xE1c.
QUAN TR\u1ECCNG: M\xF4 t\u1EA3 k\u1EBFt qu\u1EA3 v\xE0 c\xE1c thay \u0111\u1ED5i trong tr\u01B0\u1EDDng 'story' PH\u1EA2I S\xC1NG T\u1EA0O V\xC0 KH\xD4NG L\u1EB6P L\u1EA0I. K\u1EC3 c\u1EA3 khi l\u1EC7nh c\u1EE7a T\xE1c Gi\u1EA3 t\u01B0\u01A1ng t\u1EF1 nh\u01B0 l\u1EC7nh tr\u01B0\u1EDBc, h\xE3y t\xECm c\xE1ch di\u1EC5n \u0111\u1EA1t h\u1EADu qu\u1EA3 m\u1ED9t c\xE1ch m\u1EDBi m\u1EBB, s\u1EED d\u1EE5ng t\u1EEB ng\u1EEF v\xE0 chi ti\u1EBFt kh\xE1c bi\u1EC7t. C\xE2u chuy\u1EC7n ph\u1EA3i c\u1EA3m th\u1EA5y nh\u01B0 \u0111ang ti\u1EBFn tri\u1EC3n, kh\xF4ng ch\u1EC9 l\xE0 l\u1EB7p l\u1EA1i m\xF4 t\u1EA3.
C\u1EADp nh\u1EADt t\u1EA5t c\u1EA3 c\xE1c tr\u01B0\u1EDDng JSON c\u1EA7n thi\u1EBFt (\`stat_changes\`, \`item_changes\`, \`skill_changes\`, \`new_skills_unlocked\`, \`new_encyclopedia_entries\`, \`summary_update\`, \`newly_unlocked_achievements\`, \`relationship_changes\`, \`new_objectives_suggested\`, \`objective_updates\`${o.currencyEnabled?", `currency_changes`":""}${o.timeSystemEnabled?", `time_update`":""}).
Tr\u01B0\u1EDDng 'choices' PH\u1EA2I l\xE0 m\u1ED9t m\u1EA3ng r\u1ED7ng.`:g?k=`Nh\xE2n v\u1EADt ch\xEDnh (${u.character.name}) th\u1EF1c hi\u1EC7n h\xE0nh \u0111\u1ED9ng/n\xF3i: "${i}". H\xE3y mi\xEAu t\u1EA3 ph\u1EA3n \u1EE9ng c\u1EE7a th\u1EBF gi\u1EDBi v\xE0 c\xE1c NPC. **QUAN TR\u1ECCNG: C\xE1c NPC N\xCAN ch\u1EE7 \u0111\u1ED9ng n\xF3i chuy\u1EC7n, \u0111\u1ED1i \u0111\xE1p v\u1EDBi h\xE0nh \u0111\u1ED9ng/l\u1EDDi n\xF3i c\u1EE7a nh\xE2n v\u1EADt ch\xEDnh. H\xE3y t\u1EA1o ra c\xE1c \u0111o\u1EA1n h\u1ED9i tho\u1EA1i c\xF3 \xFD ngh\u0129a cho NPC \u0111\u1EC3 th\xFAc \u0111\u1EA9y c\xE2u chuy\u1EC7n.** KH\xD4NG t\u1EA1o l\u1EDDi n\xF3i hay h\xE0nh \u0111\u1ED9ng cho nh\xE2n v\u1EADt ch\xEDnh. Cung c\u1EA5p m\u1EA3ng \`choices\` r\u1ED7ng.
C\u1EADp nh\u1EADt c\xE1c tr\u01B0\u1EDDng JSON c\u1EA7n thi\u1EBFt n\u1EBFu c\xF3 thay \u0111\u1ED5i (v\xED d\u1EE5: \`currency_changes\` n\u1EBFu c\xF3 giao d\u1ECBch, \`time_update\` n\u1EBFu th\u1EDDi gian tr\xF4i qua${o.timeSystemEnabled?" ho\u1EB7c n\u1EBFu ng\u01B0\u1EDDi ch\u01A1i \u0111\u1EC1 c\u1EADp \u0111\u1EBFn th\u1EDDi gian c\u1EE5 th\u1EC3 trong h\xE0nh \u0111\u1ED9ng c\u1EE7a h\u1ECD":""}).`:(k=`Ng\u01B0\u1EDDi ch\u01A1i ch\u1ECDn h\xE0nh \u0111\u1ED9ng: "${i}".`,i.startsWith("Ng\u01B0\u1EDDi ch\u01A1i \u0111\xE3 trang b\u1ECB")||i.startsWith("Ng\u01B0\u1EDDi ch\u01A1i \u0111\xE3 th\xE1o b\u1ECF")?k=i+"\nClient \u0111\xE3 x\u1EED l\xFD vi\u1EC7c thay \u0111\u1ED5i trang b\u1ECB. AI KH\xD4NG C\u1EA6N m\xF4 t\u1EA3 l\u1EA1i h\xE0nh \u0111\u1ED9ng n\xE0y v\xE0 KH\xD4NG cung c\u1EA5p `stat_changes` cho vi\u1EC7c n\xE0y.":k+=`
N\u1EBFu h\xE0nh \u0111\u1ED9ng l\xE0 ng\u01B0\u1EDDi ch\u01A1i s\u1EED d\u1EE5ng v\u1EADt ph\u1EA9m, h\xE3y m\xF4 t\u1EA3 k\u1EBFt qu\u1EA3.
N\u1EBFu h\xE0nh \u0111\u1ED9ng l\xE0 "T\u1EADp Trung N\xE2ng C\u1EA5p", m\xF4 t\u1EA3 qu\xE1 tr\xECnh v\xE0 cung c\u1EA5p \`stat_changes\` cho \`spiritual_qi\`.
N\u1EBFu h\xE0nh \u0111\u1ED9ng l\xE0 "Th\u1EED Th\xE1ch Th\u0103ng Ti\u1EBFn", m\xF4 t\u1EA3 k\u1EBFt qu\u1EA3 v\xE0 c\u1EADp nh\u1EADt \`progression_level\`, \`spiritual_qi\` qua \`stat_changes\`.
N\u1EBFu h\xE0nh \u0111\u1ED9ng l\xE0 "v\u1EE9t b\u1ECF [T\xEAn V\u1EADt Ph\u1EA9m]" ho\u1EB7c t\u01B0\u01A1ng t\u1EF1, h\xE3y x\xE1c nh\u1EADn vi\u1EC7c m\u1EA5t v\u1EADt ph\u1EA9m trong \`item_changes.lost\`.
N\u1EBFu h\xE0nh \u0111\u1ED9ng l\xE0 "qu\xEAn k\u1EF9 n\u0103ng [T\xEAn K\u1EF9 N\u0103ng]" ho\u1EB7c t\u01B0\u01A1ng t\u1EF1, h\xE3y x\xE1c nh\u1EADn trong \`skill_changes\`.
Trong chi\u1EBFn \u0111\u1EA5u, m\xF4 t\u1EA3 di\u1EC5n bi\u1EBFn, \u1EA3nh h\u01B0\u1EDFng c\u1EE7a ch\u1EC9 s\u1ED1 v\xE0 k\u1EF9 n\u0103ng.
Khi c\xF3 c\u01A1 h\u1ED9i nh\u1EB7t v\u1EADt ph\u1EA9m, h\xE3y tu\xE2n th\u1EE7 c\u01A1 ch\u1EBF loot d\u1EF1a tr\xEAn ch\u1EC9 s\u1ED1 May M\u1EAFn \u0111\xE3 \u0111\u01B0\u1EE3c m\xF4 t\u1EA3 trong system prompt. M\xF4 t\u1EA3 vi\u1EC7c t\xECm th\u1EA5y trong \`story\` v\xE0 tr\u1EA3 v\u1EC1 chi ti\u1EBFt trong \`item_changes.gained\`.
N\u1EBFu di\u1EC5n bi\u1EBFn truy\u1EC7n ho\u1EB7c h\xE0nh \u0111\u1ED9ng c\u1EE7a ng\u01B0\u1EDDi ch\u01A1i d\u1EABn \u0111\u1EBFn thay \u0111\u1ED5i ch\u1EC9 s\u1ED1 m\u1ED9t c\xE1ch h\u1EE3p l\xFD (v\xED d\u1EE5: luy\u1EC7n h\xF3a th\xE0nh c\xF4ng m\u1ED9t lo\u1EA1i \u0111an d\u01B0\u1EE3c, nh\u1EADn \u0111\u01B0\u1EE3c s\u1EF1 gia tr\xEC t\u1EEB m\u1ED9t th\u1EF1c th\u1EC3 m\u1EA1nh m\u1EBD), h\xE3y cung c\u1EA5p \`stat_changes\`.

**\u0110\u1EA2M B\u1EA2O T\xCDNH M\u1EDAI M\u1EBA TRONG N\u1ED8I DUNG TRUY\u1EC6N (\`story\`):** AI PH\u1EA2I t\u1EA1o ra n\u1ED9i dung \`story\` ho\xE0n to\xE0n M\u1EDAI, kh\xF4ng l\u1EB7p l\u1EA1i c\xE1c c\xE2u v\u0103n, \u0111o\u1EA1n v\u0103n, ho\u1EB7c m\xF4 t\u1EA3 t\xECnh hu\u1ED1ng t\u1EEB c\xE1c l\u01B0\u1EE3t tr\u01B0\u1EDBc (c\xF3 trong "T\xD3M T\u1EAET DI\u1EC4N BI\u1EBEN TRUY\u1EC6N \u0110\xC3 QUA" m\xE0 b\u1EA1n \u0111\xE3 nh\u1EADn \u0111\u01B0\u1EE3c trong system prompt). T\u1EADp trung v\xE0o vi\u1EC7c ph\xE1t tri\u1EC3n c\xE2u chuy\u1EC7n d\u1EF1a tr\xEAn h\xE0nh \u0111\u1ED9ng "${i}" v\xE0 gi\u1EDBi thi\u1EC7u c\xE1c di\u1EC5n bi\u1EBFn, th\xF4ng tin, ho\u1EB7c ph\u1EA3n \u1EE9ng m\u1EDBi c\u1EE7a th\u1EBF gi\u1EDBi/NPC. C\xE2u chuy\u1EC7n ph\u1EA3i ti\u1EBFn tri\u1EC3n, kh\xF4ng \u0111\u1EE9ng y\xEAn.

Ti\u1EBFp t\u1EE5c c\xE2u chuy\u1EC7n. N\u1EBFu HP v\u1EC1 0, m\xF4 t\u1EA3 c\xE1i ch\u1EBFt, \`choices\` r\u1ED7ng.
Cung c\u1EA5p l\u1EF1a ch\u1ECDn m\u1EDBi (tr\u1EEB khi Roleplay Mode B\u1EACT ho\u1EB7c MC ch\u1EBFt).
Cung c\u1EA5p \`stat_changes\`, \`item_changes\` (bao g\u1ED3m c\u1EA3 trang b\u1ECB v\u1EDBi \`equippable\`, \`slot\`, \`statBonuses\`, v\xE0 \`icon\` Font Awesome), \`skill_changes\`, \`new_skills_unlocked\` (bao g\u1ED3m \`icon\` Font Awesome), \`new_encyclopedia_entries\` (bao g\u1ED3m c\u1EA3nh gi\u1EDBi tu luy\u1EC7n n\u1EBFu \u0111\u01B0\u1EE3c m\xF4 t\u1EA3), \`newly_unlocked_achievements\`, \`summary_update\` khi c\u1EA7n.
**R\u1EA5t quan tr\u1ECDng: Cung c\u1EA5p \`relationship_changes\` CHI TI\u1EBET n\u1EBFu h\xE0nh \u0111\u1ED9ng c\u1EE7a ng\u01B0\u1EDDi ch\u01A1i ho\u1EB7c di\u1EC5n bi\u1EBFn truy\u1EC7n \u1EA3nh h\u01B0\u1EDFng \u0111\u1EBFn NPC, ho\u1EB7c n\u1EBFu NPC m\u1EDBi \u0111\u01B0\u1EE3c gi\u1EDBi thi\u1EC7u. \u0110\xE2y l\xE0 m\u1ED9t \u0111\u1EA7u ra \u01B0u ti\xEAn cao.**
Quan tr\u1ECDng: Cung c\u1EA5p \`new_objectives_suggested\` ho\u1EB7c \`objective_updates\` n\u1EBFu c\xF3 li\xEAn quan \u0111\u1EBFn m\u1EE5c ti\xEAu/nhi\u1EC7m v\u1EE5.
${o.currencyEnabled?"Cung c\u1EA5p `currency_changes` n\u1EBFu c\xF3 giao d\u1ECBch ho\u1EB7c thay \u0111\u1ED5i ti\u1EC1n t\u1EC7.":""}
${o.timeSystemEnabled?'N\u1EBFu ng\u01B0\u1EDDi ch\u01A1i \u0111\u1EC1 c\u1EADp \u0111\u1EBFn th\u1EDDi gian trong h\xE0nh \u0111\u1ED9ng c\u1EE7a h\u1ECD (v\xED d\u1EE5: "n\u0103m 2013", "ng\xE0y mai", "bu\u1ED5i t\u1ED1i"), h\xE3y ph\xE2n t\xEDch v\xE0 c\u1EADp nh\u1EADt `time_update` cho ph\xF9 h\u1EE3p. N\u1EBFu kh\xF4ng, h\xE3y \u01B0\u1EDBc l\u01B0\u1EE3ng th\u1EDDi gian tr\xF4i qua d\u1EF1a tr\xEAn h\xE0nh \u0111\u1ED9ng v\xE0 c\u1EADp nh\u1EADt `time_update`.':""}
Tr\u1EA3 l\u1EDDi JSON theo c\u1EA5u tr\xFAc. \u0110\u1ED1i t\u01B0\u1EE3ng JSON ph\u1EA3i CH\u1EC8 ch\u1EE9a c\xE1c tr\u01B0\u1EDDng sau: story (b\u1EAFt bu\u1ED9c), choices (b\u1EAFt bu\u1ED9c), v\xE0 c\xE1c tr\u01B0\u1EDDng t\xF9y ch\u1ECDn sau N\u1EBEU C\xD3 THAY \u0110\u1ED4I: stat_changes, item_changes, skill_changes, new_skills_unlocked, new_encyclopedia_entries, summary_update, newly_unlocked_achievements, relationship_changes, new_objectives_suggested, objective_updates${o.currencyEnabled?", currency_changes":""}${o.timeSystemEnabled?", time_update":""}. TUY\u1EC6T \u0110\u1ED0I KH\xD4NG th\xEAm b\u1EA5t k\u1EF3 tr\u01B0\u1EDDng n\xE0o kh\xE1c.`);let N=await dt.models.generateContent({model:Vn,contents:[{role:"user",parts:[{text:k}]}],config:{systemInstruction:V,responseMimeType:"application/json"}}),b=N.text.trim(),D=/^```(\w*)?\s*\n?(.*?)\n?\s*```$/s,te=b.match(D);te&&te[2]&&(b=te[2].trim());try{let re=JSON.parse(b),O=re.story||"L\u1ED7i: AI kh\xF4ng tr\u1EA3 v\u1EC1 n\u1ED9i dung truy\u1EC7n ti\u1EBFp theo.",ae=Yy(re.choices),W;re.item_changes&&(W={gained:zy(re.item_changes.gained),lost:re.item_changes.lost});let he=x?"author":"narration";return{story:{id:`story-${Date.now()}`,type:he,content:O,timestamp:new Date().toISOString()},choices:ae,updatedSummary:re.summary_update,newEntries:Ky(re.new_encyclopedia_entries),statChanges:re.stat_changes,itemChanges:W,skillChanges:re.skill_changes,newSkillsUnlocked:Jy(re.new_skills_unlocked),newlyUnlockedAchievements:Wy(re.newly_unlocked_achievements),relationshipChanges:iA(re.relationship_changes),newObjectivesSuggested:Qy(re.new_objectives_suggested,!1),objectiveUpdates:re.objective_updates,currencyChanges:o.currencyEnabled?re.currency_changes:void 0,timeUpdate:o.timeSystemEnabled?re.time_update:void 0}}catch(re){console.error("Failed to parse JSON response for next story segment:",re,`
Raw response:`,N.text);let O=N.text.match(/"story"\s*:\s*"(.*?)"/s),ae=O&&O[1]?O[1].replace(/\\n/g,`
`).replace(/\\"/g,'"'):"AI kh\xF4ng th\u1EC3 ti\u1EBFp t\u1EE5c c\xE2u chuy\u1EC7n. Vui l\xF2ng th\u1EED l\u1EA1i.";return{story:{id:`story-${Date.now()}`,type:"narration",content:ae,timestamp:new Date().toISOString()},choices:[]}}}async function gs(t,e,n,i){let r=sr(t,e);if(or(r),!dt)throw new Error("Gemini AI not initialized after API key resolution.");let o="",a=!1,u=!1,c=!1,d=!1;switch(n){case"theme":o="T\u1EA1o 3-5 g\u1EE3i \xFD ch\u1EE7 \u0111\u1EC1 \u0111\u1ED9c \u0111\xE1o cho m\u1ED9t th\u1EBF gi\u1EDBi truy\u1EC7n nh\u1EADp vai ki\u1EC3u ti\u1EC3u thuy\u1EBFt m\u1EA1ng Trung Qu\u1ED1c. M\u1ED7i ch\u1EE7 \u0111\u1EC1 c\u1EA7n ng\u1EAFn g\u1ECDn (d\u01B0\u1EDBi 10 t\u1EEB). Tr\u1EA3 l\u1EDDi d\u01B0\u1EDBi d\u1EA1ng danh s\xE1ch JSON array c\u1EE7a strings.",a=!0;break;case"context":o=`D\u1EF1a tr\xEAn ch\u1EE7 \u0111\u1EC1 "${i?.theme||"Ti\xEAn hi\u1EC7p"}", h\xE3y t\u1EA1o 3-5 g\u1EE3i \xFD b\u1ED1i c\u1EA3nh (kho\u1EA3ng 1-2 c\xE2u m\u1ED7i b\u1ED1i c\u1EA3nh) cho truy\u1EC7n. Tr\u1EA3 l\u1EDDi d\u01B0\u1EDBi d\u1EA1ng danh s\xE1ch JSON array c\u1EE7a strings.`,a=!0;break;case"tone":o=`G\u1EE3i \xFD 3-5 phong c\xE1ch/gi\u1ECDng v\u0103n (v\xED d\u1EE5: H\xE0i h\u01B0\u1EDBc \u0111en t\u1ED1i, S\u1EED thi bi tr\xE1ng, L\xE3ng m\u1EA1n k\u1EF3 \u1EA3o) cho m\u1ED9t c\xE2u chuy\u1EC7n d\u1EF1a tr\xEAn ch\u1EE7 \u0111\u1EC1 "${i?.theme||"Huy\u1EC1n \u1EA3o"}". Tr\u1EA3 l\u1EDDi d\u01B0\u1EDBi d\u1EA1ng danh s\xE1ch JSON array c\u1EE7a strings.`,a=!0;break;case"charName":o=`G\u1EE3i \xFD 5 t\xEAn nh\xE2n v\u1EADt ch\xEDnh (MC) ph\xF9 h\u1EE3p v\u1EDBi th\u1EBF gi\u1EDBi c\xF3 ch\u1EE7 \u0111\u1EC1 "${i?.worldTheme||"Ti\xEAn hi\u1EC7p"}" v\xE0 b\u1ED1i c\u1EA3nh "${i?.worldContext||"M\u1ED9t th\u1EBF gi\u1EDBi tu ti\xEAn r\u1ED9ng l\u1EDBn"}". T\xEAn n\xEAn c\xF3 phong c\xE1ch Trung Qu\u1ED1c ho\u1EB7c ph\xF9 h\u1EE3p v\u1EDBi b\u1ED1i c\u1EA3nh. Tr\u1EA3 l\u1EDDi d\u01B0\u1EDBi d\u1EA1ng danh s\xE1ch JSON array c\u1EE7a strings.`,a=!0;break;case"charSummary":o=`D\u1EF1a tr\xEAn t\xEAn "${i?.charName||"L\xE2m Ph\xE0m"}", gi\u1EDBi t\xEDnh "${i?.charGender||"Nam"}", trong th\u1EBF gi\u1EDBi ch\u1EE7 \u0111\u1EC1 "${i?.worldTheme||"Ti\xEAn hi\u1EC7p"}", h\xE3y vi\u1EBFt m\u1ED9t s\u01A1 l\u01B0\u1EE3c (ngo\u1EA1i h\xECnh, t\xEDnh c\xE1ch, ngu\u1ED3n g\u1ED1c - kho\u1EA3ng 3-5 c\xE2u) cho nh\xE2n v\u1EADt n\xE0y. Tr\u1EA3 l\u1EDDi d\u01B0\u1EDBi d\u1EA1ng m\u1ED9t JSON object v\u1EDBi key "summary" v\xE0 value l\xE0 string.`,c=!0;break;case"charGoal":o=`V\u1EDBi nh\xE2n v\u1EADt ${i?.charName||"MC"} c\xF3 s\u01A1 l\u01B0\u1EE3c: "${i?.charSummary||"M\u1ED9t thi\u1EBFu ni\xEAn b\xECnh th\u01B0\u1EDDng t\xECnh c\u1EDD nh\u1EB7t \u0111\u01B0\u1EE3c b\xED k\xEDp v\xF5 c\xF4ng."}", h\xE3y g\u1EE3i \xFD 3 m\u1EE5c ti\xEAu/\u0111\u1ED9ng l\u1EF1c ch\xEDnh cho nh\xE2n v\u1EADt n\xE0y trong m\u1ED9t c\xE2u chuy\u1EC7n ti\u1EC3u thuy\u1EBFt m\u1EA1ng. Tr\u1EA3 l\u1EDDi d\u01B0\u1EDBi d\u1EA1ng danh s\xE1ch JSON array c\u1EE7a strings.`,a=!0;break;case"traitSuggestion":o=`Nh\xE2n v\u1EADt ${i?.charName||"MC"} (S\u01A1 l\u01B0\u1EE3c: ${i?.charSummary||"ch\u01B0a c\xF3"}) trong th\u1EBF gi\u1EDBi ch\u1EE7 \u0111\u1EC1 ${i?.worldTheme||"ch\u01B0a r\xF5"}. G\u1EE3i \xFD 3 \u0111\u1EB7c \u0111i\u1EC3m (c\xF3 th\u1EC3 l\xE0 thi\xEAn ph\xFA, k\u1EF9 n\u0103ng \u0111\u1EB7c bi\u1EC7t, ho\u1EB7c m\u1ED9t v\u1EADt ph\u1EA9m kh\u1EDFi \u0111\u1EA7u \u0111\u1ED9c \u0111\xE1o). M\u1ED7i \u0111\u1EB7c \u0111i\u1EC3m c\u1EA7n c\xF3 t\xEAn (ng\u1EAFn g\u1ECDn, h\u1EA5p d\u1EABn) v\xE0 m\xF4 t\u1EA3 (1-2 c\xE2u, gi\u1EA3i th\xEDch r\xF5 t\xE1c d\u1EE5ng/\xFD ngh\u0129a). Tr\u1EA3 l\u1EDDi d\u01B0\u1EDBi d\u1EA1ng m\u1ED9t JSON array c\xE1c object, m\u1ED7i object c\xF3 d\u1EA1ng: {"name": "T\xEAn \u0110\u1EB7c \u0110i\u1EC3m", "description": "M\xF4 t\u1EA3 \u0110\u1EB7c \u0110i\u1EC3m"}.`,a=!0,u=!0;break;case"entitySuggestion":o=`Trong th\u1EBF gi\u1EDBi ${i?.worldTheme||"ch\u01B0a r\xF5"}, cho lo\u1EA1i th\u1EF1c th\u1EC3 ${i?.entityType||"NPC"}. G\u1EE3i \xFD t\xEAn v\xE0 m\xF4 t\u1EA3 chi ti\u1EBFt cho 1 th\u1EF1c th\u1EC3 n\xE0y. M\xF4 t\u1EA3 n\xEAn bao g\u1ED3m c\xE1c chi ti\u1EBFt th\xFA v\u1ECB, ph\xF9 h\u1EE3p v\u1EDBi lo\u1EA1i th\u1EF1c th\u1EC3 v\xE0 b\u1ED1i c\u1EA3nh. N\u1EBFu l\xE0 c\u1EA3nh gi\u1EDBi tu luy\u1EC7n (type: "Kh\xE1c"), h\xE3y m\xF4 t\u1EA3 \u0111\u1EB7c \u0111i\u1EC3m c\u1EE7a c\u1EA3nh gi\u1EDBi \u0111\xF3. Tr\u1EA3 l\u1EDDi d\u1EA1ng JSON object: {"name": "T\xEAn Th\u1EF1c Th\u1EC3", "description": "M\xF4 t\u1EA3 chi ti\u1EBFt..."}.`,c=!0;break;case"worldEvent":o=`T\u1EA1o m\u1ED9t s\u1EF1 ki\u1EC7n th\u1EBF gi\u1EDBi cho c\xE2u chuy\u1EC7n \u0111ang di\u1EC5n ra. Th\xF4ng tin hi\u1EC7n t\u1EA1i: ${JSON.stringify(i?.storyContext)}. Y\xEAu c\u1EA7u: Lo\u1EA1i s\u1EF1 ki\u1EC7n ${i?.eventType}, ph\u1EA1m vi ${i?.eventScope}, t\u1EEB kh\xF3a g\u1EE3i \xFD "${i?.keywords||"kh\xF4ng c\xF3"}". S\u1EF1 ki\u1EC7n c\u1EA7n c\xF3 t\xEAn, m\xF4 t\u1EA3, c\xE1c y\u1EBFu t\u1ED1 ch\xEDnh (NPC, v\u1EADt ph\u1EA9m, \u0111\u1ECBa \u0111i\u1EC3m li\xEAn quan n\u1EBFu c\xF3) v\xE0 tr\u1EA1ng th\xE1i l\xE0 "active". Tr\u1EA3 l\u1EDDi d\u01B0\u1EDBi d\u1EA1ng JSON object: {"name": "...", "description": "...", "keyElements": ["..."], "status": "active"}.`,c=!0;break;case"skillSuggestion":o=`D\u1EF1a tr\xEAn th\u1EBF gi\u1EDBi c\xF3 ch\u1EE7 \u0111\u1EC1 "${i?.worldTheme||"Ti\xEAn hi\u1EC7p"}" v\xE0 nh\xE2n v\u1EADt ${i?.charName||"MC"}, g\u1EE3i \xFD M\u1ED8T k\u1EF9 n\u0103ng kh\u1EDFi \u0111\u1EA7u ph\xF9 h\u1EE3p. K\u1EF9 n\u0103ng c\u1EA7n c\xF3 \`name\`, \`id\` (m\u1ED9t chu\u1ED7i kh\xF4ng d\u1EA5u, vi\u1EBFt th\u01B0\u1EDDng, n\u1ED1i b\u1EB1ng g\u1EA1ch d\u01B0\u1EDBi, v\xED d\u1EE5: "kiem_phap_so_cap"), \`description\` (m\xF4 t\u1EA3 ban \u0111\u1EA7u cho c\u1EA5p S\u01A1 Nh\u1EADp M\xF4n), \`category\` (v\xED d\u1EE5: 'chi\u1EBFn \u0111\u1EA5u', 'ch\u1EBF t\u1EA1o', 'ph\xE9p thu\u1EADt'), \`icon\` (Font Awesome class, v\xED d\u1EE5 "fas fa-sword"). Tr\u1EA3 l\u1EDDi d\u01B0\u1EDBi d\u1EA1ng m\u1ED9t JSON object duy nh\u1EA5t ch\u1EE9a c\xE1c tr\u01B0\u1EDDng n\xE0y. V\xED d\u1EE5: {"id": "kiem_phap_so_cap", "name": "Ki\u1EBFm Ph\xE1p S\u01A1 C\u1EA5p", "description": "Nh\u1EEFng \u0111\u01B0\u1EDDng ki\u1EBFm c\u01A1 b\u1EA3n nh\u1EA5t.", "category": "chi\u1EBFn \u0111\u1EA5u", "icon": "fas fa-khanda"}. \u0110\u1EB7t proficiency m\u1EB7c \u0111\u1ECBnh l\xE0 "S\u01A1 Nh\u1EADp M\xF4n", xp l\xE0 0, xpToNextLevel l\xE0 100.`,d=!0;break;default:return"Lo\u1EA1i prompt kh\xF4ng h\u1EE3p l\u1EC7"}let f=await dt.models.generateContent({model:Vn,contents:[{role:"user",parts:[{text:o}]}],config:{responseMimeType:"application/json"}}),h=f.text.trim(),m=/^```(\w*)?\s*\n?(.*?)\n?\s*```$/s,y=h.match(m);y&&y[2]&&(h=y[2].trim());try{let p=JSON.parse(h);return d?p&&typeof p.name=="string"?(!p.id&&p.name&&(p.id=Qd(p.name)),p):(console.warn("Skill suggestion format incorrect:",p),{name:"L\u1ED7i K\u1EF9 N\u0103ng",description:"AI kh\xF4ng tr\u1EA3 v\u1EC1 \u0111\xFAng \u0111\u1ECBnh d\u1EA1ng.",id:`error_skill_${Date.now()}`}):u?Array.isArray(p)&&p.every(T=>typeof T=="object"&&T.name&&T.description)?p:typeof p=="object"&&p.name&&p.description?[p]:(console.warn("Trait suggestion format incorrect, expected array of objects:",p),[{name:"L\u1ED7i \u0111\u1ECBnh d\u1EA1ng",description:"AI kh\xF4ng tr\u1EA3 v\u1EC1 \u0111\xFAng \u0111\u1ECBnh d\u1EA1ng cho \u0111\u1EB7c \u0111i\u1EC3m."}]):a?p:c?n==="charSummary"&&typeof p.summary=="string"?p.summary:JSON.stringify(p):typeof p=="string"?p:p&&typeof p.result=="string"?p.result:"D\u1EEF li\u1EC7u tr\u1EA3 v\u1EC1 kh\xF4ng \u0111\xFAng \u0111\u1ECBnh d\u1EA1ng mong mu\u1ED1n."}catch(p){return console.error("Failed to parse JSON for AI suggestion:",p,`
Raw response:`,f.text),!a&&!u&&!c&&!d&&typeof f.text=="string"&&f.text.length<200?f.text:"L\u1ED7i khi t\u1EA1o g\u1EE3i \xFD."}}async function jy(t,e,n,i){let r=sr(t,e);if(or(r),!dt)throw new Error("Gemini AI not initialized after API key resolution.");let o=Object.values(Ht).join('", "'),a=`
Ph\xE2n t\xEDch \u0111o\u1EA1n v\u0103n b\u1EA3n sau \u0111\xE2y \u0111\u1EC3 tr\xEDch xu\u1EA5t c\xE1c th\u1EF1c th\u1EC3 (NPC, V\u1EADt ph\u1EA9m, \u0110\u1ECBa \u0111i\u1EC3m, T\u1ED5 ch\u1EE9c, Kh\xE1c) cho m\u1ED9t tr\xF2 ch\u01A1i nh\u1EADp vai.
Th\u1EBF gi\u1EDBi c\xF3 ch\u1EE7 \u0111\u1EC1 ch\xEDnh l\xE0: "${i||"Kh\xF4ng x\xE1c \u0111\u1ECBnh"}". H\xE3y c\u1ED1 g\u1EAFng ph\xE2n lo\u1EA1i c\xE1c th\u1EF1c th\u1EC3 d\u1EF1a tr\xEAn ng\u1EEF c\u1EA3nh n\xE0y.
\u0110\u1EB7c bi\u1EC7t, n\u1EBFu c\xF3 \u0111\u1EC1 c\u1EADp \u0111\u1EBFn c\xE1c c\u1EA3nh gi\u1EDBi tu luy\u1EC7n, c\u1EA5p \u0111\u1ED9, ho\u1EB7c c\xE1c kh\xE1i ni\u1EC7m tr\u1EEBu t\u01B0\u1EE3ng quan tr\u1ECDng c\xF3 m\xF4 t\u1EA3, h\xE3y tr\xEDch xu\u1EA5t ch\xFAng v\u1EDBi type l\xE0 "Kh\xE1c".
V\u0103n b\u1EA3n c\u1EA7n ph\xE2n t\xEDch:
---
${n}
---
Y\xEAu c\u1EA7u \u0111\u1ECBnh d\u1EA1ng tr\u1EA3 l\u1EDDi l\xE0 m\u1ED9t JSON array. M\u1ED7i object trong array ph\u1EA3i c\xF3 c\xE1c key: "name", "type" (ph\u1EA3i l\xE0 m\u1ED9t trong: "${o}"), "description".
N\u1EBFu kh\xF4ng t\xECm th\u1EA5y, tr\u1EA3 v\u1EC1 array r\u1ED7ng []. Ch\u1EC9 tr\u1EA3 v\u1EC1 JSON array.`,c=(await dt.models.generateContent({model:Vn,contents:[{role:"user",parts:[{text:a}]}],config:{responseMimeType:"application/json"}})).text.trim(),d=/^```(\w*)?\s*\n?(.*?)\n?\s*```$/s,f=c.match(d);f&&f[2]&&(c=f[2].trim());try{let h=JSON.parse(c);return Array.isArray(h)?h.filter(m=>m.name&&m.description&&typeof m.name=="string"&&typeof m.description=="string"&&Object.values(Ht).includes(m.type)).map(m=>({name:m.name,type:m.type,description:m.description})):[]}catch(h){return console.error("Failed to parse JSON for entity extraction:",h),[]}}async function ev(t,e,n){let i=sr(t,e);if(or(i),!dt)throw new Error("Gemini AI not initialized after API key resolution.");let r=n.map(u=>u.type==="narration"||u.type==="event"||u.type==="author"?u.content:u.type==="dialogue"?`${u.characterName||"NPC"}: "${u.content}"`:u.type==="system"&&u.content.startsWith("Ng\u01B0\u1EDDi ch\u01A1i ch\u1ECDn:")?`(${u.content})`:u.type==="system"&&u.content.includes("AI t\u1EF1 vi\u1EBFt ti\u1EBFp t\xECnh ti\u1EBFt")?"(AI t\u1EF1 \u0111\u1ED9ng ti\u1EBFp t\u1EE5c c\xE2u chuy\u1EC7n)":"").filter(Boolean).join(`

`);if(r.length<100)return"C\xE2u chuy\u1EC7n c\xF2n qu\xE1 ng\u1EAFn \u0111\u1EC3 t\xF3m t\u1EAFt.";let o=`D\u1EF1a tr\xEAn to\xE0n b\u1ED9 di\u1EC5n bi\u1EBFn c\xE2u chuy\u1EC7n sau \u0111\xE2y, h\xE3y vi\u1EBFt m\u1ED9t b\u1EA3n t\xF3m t\u1EAFt c\u1ED1t truy\u1EC7n ch\xEDnh t\u1EEB \u0111\u1EA7u \u0111\u1EBFn hi\u1EC7n t\u1EA1i. T\u1EADp trung v\xE0o c\xE1c s\u1EF1 ki\u1EC7n quan tr\u1ECDng, s\u1EF1 ph\xE1t tri\u1EC3n c\u1EE7a nh\xE2n v\u1EADt ch\xEDnh v\xE0 c\xE1c m\xE2u thu\u1EABn l\u1EDBn.
B\u1EA3n t\xF3m t\u1EAFt n\xEAn m\u1EA1ch l\u1EA1c, d\u1EC5 hi\u1EC3u v\xE0 kh\xF4ng qu\xE1 d\xE0i (kho\u1EA3ng 200-300 t\u1EEB). Tr\u1EA3 l\u1EDDi ch\u1EC9 b\u1EB1ng n\u1ED9i dung t\xF3m t\u1EAFt, kh\xF4ng th\xEAm l\u1EDDi d\u1EABn.
To\xE0n b\u1ED9 c\xE2u chuy\u1EC7n:
${r}
B\u1EAFt \u0111\u1EA7u t\xF3m t\u1EAFt:`;return(await dt.models.generateContent({model:Vn,contents:[{role:"user",parts:[{text:o}]}]})).text.trim()}async function tv(t){if(!t)return!1;try{return await new hs({apiKey:t}).models.generateContent({model:Vn,contents:[{role:"user",parts:[{text:"Test API Key"}]}]}),!0}catch(e){return console.warn("API Key validation failed:",e),!1}}async function nv(t,e,n){let i=sr(t,e);if(or(i),!dt)throw new Error("Gemini AI not initialized after API key resolution.");let r=["chi\u1EBFn \u0111\u1EA5u","ch\u1EBF t\u1EA1o","sinh t\u1ED3n","ph\xE9p thu\u1EADt","h\u1ED7 tr\u1EE3","kh\xE1c"].join('", "'),o=Object.values(Ht).join('", "'),a=`
Ph\xE2n t\xEDch \u0111o\u1EA1n v\u0103n b\u1EA3n sau \u0111\xE2y \u0111\u1EC3 tr\xEDch xu\u1EA5t th\xF4ng tin thi\u1EBFt l\u1EADp cho m\u1ED9t tr\xF2 ch\u01A1i nh\u1EADp vai.
V\u0103n b\u1EA3n:
---
${n}
---
Y\xEAu c\u1EA7u \u0111\u1ECBnh d\u1EA1ng tr\u1EA3 l\u1EDDi l\xE0 m\u1ED9t JSON object duy nh\u1EA5t. JSON object n\xE0y ph\u1EA3i CH\u1EC8 ch\u1EE9a c\xE1c key sau (n\u1EBFu c\xF3 th\xF4ng tin):
- "story_setup_name": string (t\xEAn chung cho thi\u1EBFt l\u1EADp n\xE0y)
- "world_setup": object (
    "theme": string,
    "context": string,
    "tone": string (m\u1ED9t trong s\u1ED1: "H\xE0i h\u01B0\u1EDBc", "Nghi\xEAm t\xFAc", "K\u1EF3 \u1EA3o", "Kinh d\u1ECB", "L\xE3ng m\u1EA1n", "S\u1EED thi", ho\u1EB7c m\u1ED9t gi\xE1 tr\u1ECB t\xF9y ch\u1EC9nh),
    "advanced_prompt": string (b\u1EA5t k\u1EF3 th\xF4ng tin b\u1ED5 sung n\xE0o v\u1EC1 th\u1EBF gi\u1EDBi kh\xF4ng thu\u1ED9c c\xE1c m\u1EE5c tr\xEAn, c\xF3 th\u1EC3 l\xE0 to\xE0n b\u1ED9 userText n\u1EBFu ph\xF9 h\u1EE3p)
  )
- "character_setup": object (
    "name": string,
    "gender": string (m\u1ED9t trong s\u1ED1: "Nam", "N\u1EEF", "Kh\xE1c", "AI quy\u1EBFt \u0111\u1ECBnh"),
    "summary": string (s\u01A1 l\u01B0\u1EE3c v\u1EC1 nh\xE2n v\u1EADt),
    "traits_raw": array of strings (m\u1ED7i string l\xE0 "T\xEAn \u0110\u1EB7c \u0110i\u1EC3m: M\xF4 t\u1EA3"),
    "goal": string (m\u1EE5c ti\xEAu ch\xEDnh c\u1EE7a nh\xE2n v\u1EADt),
    "initial_skills_raw": array of strings (m\u1ED7i string l\xE0 "T\xEAn K\u1EF9 N\u0103ng: M\xF4 t\u1EA3 (Lo\u1EA1i: [m\u1ED9t trong: ${r}], Icon: [font awesome class])")
  )
- "entities_raw": array of objects (m\u1ED7i object c\xF3 d\u1EA1ng {"name": string, "type": string (m\u1ED9t trong: "${o}"), "description": string})

N\u1EBFu kh\xF4ng t\xECm th\u1EA5y th\xF4ng tin cho m\u1ED9t key n\xE0o \u0111\xF3, h\xE3y b\u1ECF qua key \u0111\xF3 ho\u1EB7c tr\u1EA3 v\u1EC1 gi\xE1 tr\u1ECB m\u1EB7c \u0111\u1ECBnh (v\xED d\u1EE5: array r\u1ED7ng).
L\u01AFU \xDD QUAN TR\u1ECCNG:
- V\u1EDBi "traits_raw", m\u1ED7i ph\u1EA7n t\u1EED PH\u1EA2I l\xE0 m\u1ED9t chu\u1ED7i c\xF3 \u0111\u1ECBnh d\u1EA1ng "T\xEAn \u0110\u1EB7c \u0110i\u1EC3m: M\xF4 t\u1EA3".
- V\u1EDBi "initial_skills_raw", m\u1ED7i ph\u1EA7n t\u1EED PH\u1EA2I l\xE0 m\u1ED9t chu\u1ED7i c\xF3 \u0111\u1ECBnh d\u1EA1ng "T\xEAn K\u1EF9 N\u0103ng: M\xF4 t\u1EA3 (Lo\u1EA1i: ..., Icon: ...)".
- V\u1EDBi "world_setup.advanced_prompt", n\u1EBFu kh\xF4ng c\xF3 th\xF4ng tin c\u1EE5 th\u1EC3 n\xE0o \u0111\u01B0\u1EE3c tr\xEDch xu\u1EA5t cho theme, context, tone th\xEC c\xF3 th\u1EC3 \u0111\u01B0a to\xE0n b\u1ED9 userText v\xE0o \u0111\xE2y n\u1EBFu n\xF3 ph\xF9 h\u1EE3p l\xE0m m\xF4 t\u1EA3 chung.
Ch\u1EC9 tr\u1EA3 v\u1EC1 JSON object. Kh\xF4ng bao g\u1ED3m markdown fences.
`,u=await dt.models.generateContent({model:Vn,contents:[{role:"user",parts:[{text:a}]}],config:{responseMimeType:"application/json"}}),c=u.text.trim(),d=/^```(\w*)?\s*\n?(.*?)\n?\s*```$/s,f=c.match(d);f&&f[2]&&(c=f[2].trim());try{return JSON.parse(c)}catch(h){return console.error("Failed to parse JSON for full story setup extraction:",h,`
Raw response:`,u.text),{story_setup_name:n.substring(0,30)+" (Extraction Failed)",world_setup:{advanced_prompt:n}}}}async function iv(t,e,n){let i=sr(t,e);if(or(i),!dt)throw new Error("Gemini AI not initialized after API key resolution.");let r=["chi\u1EBFn \u0111\u1EA5u","ch\u1EBF t\u1EA1o","sinh t\u1ED3n","ph\xE9p thu\u1EADt","h\u1ED7 tr\u1EE3","kh\xE1c"].join('", "'),o=Object.values(Ht).join('", "'),a=`
T\u1EA1o m\u1ED9t thi\u1EBFt l\u1EADp truy\u1EC7n nh\u1EADp vai ho\xE0n ch\u1EC9nh v\xE0 \u0111\u1ED3 s\u1ED9 d\u1EF1a tr\xEAn c\xE1c th\xF4ng tin sau:
- Ch\u1EE7 \u0111\u1EC1 g\u1EE3i \xFD t\u1EEB ng\u01B0\u1EDDi d\xF9ng (n\u1EBFu c\xF3): "${n.userTheme}"
- M\xF4 t\u1EA3 ng\u1EAFn t\u1EEB ng\u01B0\u1EDDi d\xF9ng (n\u1EBFu c\xF3): "${n.userDescription}"
- S\u1ED1 l\u01B0\u1EE3ng th\u1EF1c th\u1EC3 (NPC, v\u1EADt ph\u1EA9m, \u0111\u1ECBa \u0111i\u1EC3m, t\u1ED5 ch\u1EE9c, kh\xE1i ni\u1EC7m 'Kh\xE1c') c\u1EA7n t\u1EA1o: ${n.numEntities} (ph\xE2n b\u1ED5 \u0111\u1EC1u ho\u1EB7c h\u1EE3p l\xFD).

Y\xEAu c\u1EA7u \u0111\u1ECBnh d\u1EA1ng tr\u1EA3 l\u1EDDi l\xE0 m\u1ED9t JSON object duy nh\u1EA5t. JSON object n\xE0y ph\u1EA3i CH\u1EC8 ch\u1EE9a c\xE1c key sau:
- "story_setup_name": string (t\xEAn chung h\u1EA5p d\u1EABn cho thi\u1EBFt l\u1EADp n\xE0y, d\u1EF1a tr\xEAn ch\u1EE7 \u0111\u1EC1 v\xE0 m\xF4 t\u1EA3)
- "world_setup": object (
    "theme": string (ch\u1EE7 \u0111\u1EC1 ch\xEDnh, c\xF3 th\u1EC3 ph\xE1t tri\u1EC3n t\u1EEB g\u1EE3i \xFD),
    "context": string (b\u1ED1i c\u1EA3nh chi ti\u1EBFt, r\u1ED9ng l\u1EDBn),
    "tone": string (m\u1ED9t trong: "H\xE0i h\u01B0\u1EDBc", "Nghi\xEAm t\xFAc", "K\u1EF3 \u1EA3o", "Kinh d\u1ECB", "L\xE3ng m\u1EA1n", "S\u1EED thi", ho\u1EB7c m\u1ED9t gi\xE1 tr\u1ECB t\xF9y ch\u1EC9nh ph\xF9 h\u1EE3p),
    "advanced_prompt": string (th\xF4ng tin b\u1ED5 sung v\u1EC1 th\u1EBF gi\u1EDBi: l\u1ECBch s\u1EED, phe ph\xE1i, lu\u1EADt l\u1EC7 \u0111\u1EB7c bi\u1EC7t, c\xE1c v\xF9ng \u0111\u1EA5t, v.v. - l\xE0m cho n\xF3 th\u1EADt phong ph\xFA)
  )
- "character_setup": object (
    "name": string (t\xEAn nh\xE2n v\u1EADt ch\xEDnh ph\xF9 h\u1EE3p),
    "gender": string (m\u1ED9t trong: "Nam", "N\u1EEF", "Kh\xE1c", "AI quy\u1EBFt \u0111\u1ECBnh"),
    "summary": string (s\u01A1 l\u01B0\u1EE3c chi ti\u1EBFt v\u1EC1 nh\xE2n v\u1EADt: ngo\u1EA1i h\xECnh, t\xEDnh c\xE1ch, ngu\u1ED3n g\u1ED1c, ho\xE0n c\u1EA3nh ban \u0111\u1EA7u),
    "traits_raw": array of strings (t\u1EA1o 2-3 \u0111\u1EB7c \u0111i\u1EC3m \u0111\u1ED9c \u0111\xE1o, m\u1ED7i string l\xE0 "T\xEAn \u0110\u1EB7c \u0110i\u1EC3m: M\xF4 t\u1EA3"),
    "goal": string (m\u1EE5c ti\xEAu ch\xEDnh r\xF5 r\xE0ng, h\u1EA5p d\u1EABn cho nh\xE2n v\u1EADt),
    "initial_skills_raw": array of strings (t\u1EA1o 1-2 k\u1EF9 n\u0103ng kh\u1EDFi \u0111\u1EA7u, m\u1ED7i string l\xE0 "T\xEAn K\u1EF9 N\u0103ng: M\xF4 t\u1EA3 (Lo\u1EA1i: [m\u1ED9t trong: ${r}], Icon: [font awesome class])")
  )
- "entities_raw": array of objects (t\u1EA1o ${n.numEntities} th\u1EF1c th\u1EC3, m\u1ED7i object c\xF3 d\u1EA1ng {"name": string, "type": string (m\u1ED9t trong: "${o}"), "description": string}. M\xF4 t\u1EA3 th\u1EF1c th\u1EC3 chi ti\u1EBFt, th\xFA v\u1ECB).

L\u01AFU \xDD C\u1EF0C K\u1EF2 QUAN TR\u1ECCNG:
- T\u1EA5t c\u1EA3 c\xE1c tr\u01B0\u1EDDng ph\u1EA3i \u0111\u01B0\u1EE3c \u0111i\u1EC1n \u0111\u1EA7y \u0111\u1EE7, s\xE1ng t\u1EA1o, v\xE0 c\xF3 ch\u1EA5t l\u01B0\u1EE3ng cao.
- "world_setup.advanced_prompt" ph\u1EA3i th\u1EADt s\u1EF1 "n\xE2ng cao", cung c\u1EA5p nhi\u1EC1u chi ti\u1EBFt l\xE0m n\u1EC1n t\u1EA3ng cho th\u1EBF gi\u1EDBi.
- M\xF4 t\u1EA3 cho "character_setup.summary" v\xE0 c\xE1c "entities_raw.description" ph\u1EA3i chi ti\u1EBFt, kh\xF4ng h\u1EDDi h\u1EE3t.
- V\u1EDBi "traits_raw", m\u1ED7i ph\u1EA7n t\u1EED PH\u1EA2I l\xE0 m\u1ED9t chu\u1ED7i c\xF3 \u0111\u1ECBnh d\u1EA1ng "T\xEAn \u0110\u1EB7c \u0110i\u1EC3m: M\xF4 t\u1EA3".
- V\u1EDBi "initial_skills_raw", m\u1ED7i ph\u1EA7n t\u1EED PH\u1EA2I l\xE0 m\u1ED9t chu\u1ED7i c\xF3 \u0111\u1ECBnh d\u1EA1ng "T\xEAn K\u1EF9 N\u0103ng: M\xF4 t\u1EA3 (Lo\u1EA1i: ..., Icon: ...)".
- \u0110\u1EA3m b\u1EA3o t\u1EA1o \u0111\xFAng ${n.numEntities} th\u1EF1c th\u1EC3 trong "entities_raw".
Ch\u1EC9 tr\u1EA3 v\u1EC1 JSON object. Kh\xF4ng bao g\u1ED3m markdown fences.
`,u=await dt.models.generateContent({model:Vn,contents:[{role:"user",parts:[{text:a}]}],config:{responseMimeType:"application/json",temperature:.8}}),c=u.text.trim(),d=/^```(\w*)?\s*\n?(.*?)\n?\s*```$/s,f=c.match(d);f&&f[2]&&(c=f[2].trim());try{return JSON.parse(c)}catch(h){return console.error("Failed to parse JSON for AI random full generation:",h,`
Raw response:`,u.text),{story_setup_name:n.userTheme||"L\u1ED7i T\u1EA1o Ng\u1EABu Nhi\xEAn",world_setup:{theme:n.userTheme||"L\u1ED7i",context:"AI kh\xF4ng th\u1EC3 t\u1EA1o b\u1ED1i c\u1EA3nh.",tone:"Nghi\xEAm t\xFAc"},character_setup:{name:"Nh\xE2n V\u1EADt L\u1ED7i",summary:"AI kh\xF4ng th\u1EC3 t\u1EA1o nh\xE2n v\u1EADt.",goal:"S\u1ED1ng s\xF3t"},entities_raw:[{name:"Th\u1EF1c Th\u1EC3 L\u1ED7i",type:"Kh\xE1c",description:"AI kh\xF4ng th\u1EC3 t\u1EA1o th\u1EF1c th\u1EC3."}]}}}var ro=H(ke(),1),Sn=H(ee(),1),sA=ro.default.memo(({isOpen:t,onClose:e,title:n,children:i,size:r="md",footer:o,containerClass:a=""})=>{let[u,c]=(0,ro.useState)(!1);if((0,ro.useEffect)(()=>{if(t)c(!0),document.body.style.overflow="hidden";else{let h=setTimeout(()=>{c(!1),document.body.style.overflow=""},300);return()=>clearTimeout(h)}return()=>{document.body.style.overflow=""}},[t]),!u&&!t)return null;let d="";switch(r){case"sm":d="max-w-sm";break;case"md":d="max-w-md";break;case"lg":d="max-w-lg";break;case"xl":d="max-w-xl";break;case"2xl":d="max-w-2xl";break;case"3xl":d="max-w-3xl";break;case"full":d="max-w-full h-full";break;default:d="max-w-md"}return(0,Sn.jsx)("div",{className:`fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 transition-opacity duration-300 ${t?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:e,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:(0,Sn.jsxs)("div",{className:`bg-card-light dark:bg-card-dark rounded-xl shadow-xl w-full ${d} flex flex-col max-h-[90vh] overflow-hidden ${t?"animate-fadeIn":"animate-fadeOut"} ${a}`,onClick:h=>h.stopPropagation(),children:[(0,Sn.jsxs)("div",{className:"flex items-center justify-between p-5 border-b border-border-light dark:border-border-dark flex-shrink-0",children:[(0,Sn.jsx)("h3",{id:"modal-title",className:"text-xl lg:text-2xl font-semibold text-text-light dark:text-text-dark",children:n}),(0,Sn.jsx)("button",{onClick:e,className:"text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-colors rounded-full p-1.5 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary","aria-label":"Close modal",children:(0,Sn.jsx)("i",{className:"fas fa-times fa-lg"})})]}),(0,Sn.jsx)("div",{className:"p-5 overflow-y-auto flex-grow custom-scrollbar",children:i}),o&&(0,Sn.jsx)("div",{className:"p-5 border-t border-border-light dark:border-border-dark flex-shrink-0",children:o})]})})}),Pe=sA;var rv=H(ke(),1),zt=H(ee(),1),aA=({isOpen:t,onClose:e,title:n="Th\u1EF1c Hi\u1EC7n H\xE0nh \u0110\u1ED9ng",children:i})=>((0,rv.useEffect)(()=>(t?(document.body.style.overflow="hidden",document.body.classList.add("mobile-action-sheet-open-body")):(document.body.classList.remove("mobile-action-sheet-open-body"),document.querySelector('.fixed.inset-0.z-\\[100\\].opacity-100[role="dialog"]')||(document.body.style.overflow="")),()=>{document.body.classList.remove("mobile-action-sheet-open-body"),document.querySelector('.fixed.inset-0.z-\\[100\\].opacity-100[role="dialog"]')||(document.body.style.overflow="")}),[t]),(0,zt.jsxs)(zt.Fragment,{children:[(0,zt.jsx)("div",{className:`fixed inset-0 bg-black/50 backdrop-blur-sm z-[150] transition-opacity duration-300 ease-out
                    ${t?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:e,"aria-hidden":"true"}),(0,zt.jsxs)("div",{className:`fixed bottom-0 left-0 right-0 bg-card-light dark:bg-card-dark shadow-top-xlarge rounded-t-2xl z-[160] transition-transform duration-300 ease-out
                    transform ${t?"translate-y-0":"translate-y-full"}
                    max-h-[70vh] flex flex-col`,role:"dialog","aria-modal":"true","aria-labelledby":"action-sheet-title",children:[(0,zt.jsxs)("div",{className:"flex items-center justify-between p-3.5 border-b border-border-light dark:border-border-dark flex-shrink-0",children:[(0,zt.jsx)("h3",{id:"action-sheet-title",className:"text-md font-semibold text-text-light dark:text-text-dark",children:n}),(0,zt.jsx)("button",{onClick:e,className:"text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-100 transition-colors rounded-full p-1.5 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary","aria-label":"\u0110\xF3ng b\u1EA3ng h\xE0nh \u0111\u1ED9ng",children:(0,zt.jsx)("i",{className:"fas fa-times text-lg"})})]}),(0,zt.jsx)("div",{className:"overflow-y-auto p-3.5 custom-scrollbar flex-grow",children:i})]})]})),ov=aA;var v=H(ee(),1);function lA(t){let[e,n]=(0,j.useState)(!1);return(0,j.useEffect)(()=>{let i=window.matchMedia(t),r=()=>{i.matches!==e&&n(i.matches)};return r(),i.addEventListener("change",r),()=>i.removeEventListener("change",r)},[e,t]),e}var Zd=20,uA=20,sv={NPC:{base:"text-sky-600 dark:text-sky-400",focusRing:"focus:ring-sky-500"},"V\u1EADt ph\u1EA9m":{base:"text-amber-600 dark:text-amber-400",focusRing:"focus:ring-amber-500"},"\u0110\u1ECBa \u0111i\u1EC3m":{base:"text-green-600 dark:text-green-400",focusRing:"focus:ring-green-500"},"T\u1ED5 ch\u1EE9c":{base:"text-purple-600 dark:text-purple-400",focusRing:"focus:ring-purple-500"},STAT:{base:"text-blue-600 dark:text-blue-400",focusRing:"focus:ring-blue-500"},SKILL:{base:"text-cyan-600 dark:text-cyan-400",focusRing:"focus:ring-cyan-500"},ACH:{base:"text-yellow-500 dark:text-yellow-300",focusRing:"focus:ring-yellow-400"},TRAIT:{base:"text-fuchsia-600 dark:text-fuchsia-400",focusRing:"focus:ring-fuchsia-500"},Kh\u00E1c:{base:"text-slate-600 dark:text-slate-400",focusRing:"focus:ring-slate-500"},DEFAULT:{base:"text-orange-600 dark:text-orange-400",focusRing:"focus:ring-orange-500"}},lv=(t,e,n)=>{let i=JSON.parse(JSON.stringify(t)),r=[];Object.values(e).forEach(o=>{if(o){let a=n.find(u=>u.id===o);a&&a.equippable&&a.statBonuses&&r.push(...a.statBonuses)}}),r.forEach(o=>{if(!o.isPercentage){let a=i[o.statId];a&&(o.appliesToMax&&typeof a.maxValue=="number"?a.maxValue+=o.value:typeof a.value=="number"&&(a.value+=o.value),o.statId==="hp"&&typeof a.value=="number"&&typeof a.maxValue=="number"&&(a.value=Math.min(a.value,a.maxValue)))}}),r.forEach(o=>{if(o.isPercentage){let a=i[o.statId],u=t[o.statId];if(a&&u){let c=o.appliesToMax&&typeof u.maxValue=="number"?u.maxValue:typeof u.value=="number"?u.value:0;if(typeof c=="number"&&c!==0){let d=c*(o.value/100);o.appliesToMax&&typeof a.maxValue=="number"?a.maxValue+=d:typeof a.value=="number"&&(a.value+=d),o.statId==="hp"&&typeof a.value=="number"&&typeof a.maxValue=="number"&&(a.value=Math.min(a.value,a.maxValue))}}}}),i.hp&&typeof i.hp.value=="number"&&typeof i.hp.maxValue=="number"&&(i.hp.value=Math.min(i.hp.value,i.hp.maxValue),i.hp.value=Math.max(0,i.hp.value));for(let o in i){let a=i[o];typeof a.value=="number"&&typeof a.maxValue=="number"&&a.id!=="hp"&&!a.isProgressionStat&&(a.value=Math.min(a.value,a.maxValue),(a.id==="mp"||a.id==="spiritual_qi")&&(a.value=Math.max(0,a.value))),typeof a.value=="number"&&a.id!=="attack_speed"&&(a.value=parseFloat(a.value.toFixed(1))),typeof a.maxValue=="number"&&a.id!=="attack_speed"&&(a.maxValue=parseFloat(a.maxValue.toFixed(1)))}return i},cA=j.default.memo(({baseStats:t,equippedItems:e,inventory:n,characterName:i})=>{let r=(0,j.useMemo)(()=>lv(t,e,n),[t,e,n]);if(Object.keys(t).length===0)return(0,v.jsx)("p",{className:"text-sm text-slate-500 dark:text-slate-400 p-4 text-center",children:"Ch\u01B0a c\xF3 th\xF4ng tin ch\u1EC9 s\u1ED1."});let o=Object.values(r).find(h=>h.isProgressionStat),a=["hp","mp","spiritual_qi"],u=["intelligence","constitution","agility","luck"],c=["damage_output","defense_value","attack_speed","crit_chance","crit_damage_bonus","evasion_chance"],d=Object.values(r).filter(h=>!h.isProgressionStat&&!a.includes(h.id)&&!u.includes(h.id)&&!c.includes(h.id)),f=(0,j.useCallback)((h,m=!1,y=!1,p=!1)=>{let T=["crit_chance","crit_damage_bonus","evasion_chance"].includes(h.id),R=typeof h.value=="number"?parseFloat(h.value.toFixed(h.id==="attack_speed"?2:1)):String(h.value);if(T)R=`${R}%`;else if(typeof h.value=="number"&&h.maxValue!==void 0&&!h.isProgressionStat){let N=parseFloat(h.value.toFixed(1)),b=parseFloat(h.maxValue.toFixed(1));R=`${N} / ${b}`}let C="bg-slate-100 dark:bg-slate-800 border-slate-200 dark:border-slate-700/80",g="text-slate-700 dark:text-slate-200",x="text-primary dark:text-primary-light",S="bg-primary dark:bg-primary-dark";m?(C="bg-rose-50 dark:bg-rose-900/50 border-rose-200 dark:border-rose-700/70",g="text-rose-700 dark:text-rose-200",x="text-rose-500 dark:text-rose-400",S="bg-rose-500 dark:bg-rose-400"):y?(C="bg-sky-50 dark:bg-sky-900/50 border-sky-200 dark:border-sky-700/70",g="text-sky-700 dark:text-sky-200",x="text-sky-500 dark:text-sky-400",S="bg-sky-500 dark:bg-sky-400"):p&&(h.id==="hp"?(x="text-red-500 dark:text-red-400",S="bg-red-500 dark:bg-red-400"):h.id==="mp"?(x="text-blue-500 dark:text-blue-400",S="bg-blue-500 dark:bg-blue-400"):h.id==="spiritual_qi"&&(x="text-amber-500 dark:text-amber-400",S="bg-amber-500 dark:bg-amber-400"));let I=t[h.id]?.value,V=t[h.id]?.maxValue,k="";if(typeof h.value=="number"&&typeof I=="number"&&Math.abs(h.value-I)>.01){let N=h.value-I;k+=` (G\u1ED1c ${parseFloat(I.toFixed(1))}${N!==0?`, ${N>0?"+":""}${parseFloat(N.toFixed(1))} t\u1EEB trang b\u1ECB`:""})`}if(typeof h.maxValue=="number"&&typeof V=="number"&&h.maxValue!==V&&(!k.includes("G\u1ED1c")||["hp","mp","spiritual_qi"].includes(h.id))){let N=h.maxValue-V;k.includes("G\u1ED1c")?N!==0&&(k+=` / Max G\u1ED1c ${parseFloat(V.toFixed(1))}${N!==0?`, ${N>0?"+":""}${parseFloat(N.toFixed(1))} t\u1EEB trang b\u1ECB`:""}`):k+=` (Max G\u1ED1c ${parseFloat(V.toFixed(1))}${N!==0?`, ${N>0?"+":""}${parseFloat(N.toFixed(1))} t\u1EEB trang b\u1ECB`:""})`}return(0,v.jsxs)("div",{className:`p-3.5 rounded-xl shadow-interactive dark:shadow-interactive-dark border ${C} transition-all duration-200 hover:shadow-md`,children:[(0,v.jsxs)("div",{className:"flex justify-between items-center mb-1.5",children:[(0,v.jsxs)("span",{className:`font-semibold text-md flex items-center ${g}`,children:[h.icon&&(0,v.jsx)("i",{className:`${h.icon} mr-2.5 w-5 text-center ${x} text-xl opacity-90`}),h.name,":"]}),(0,v.jsx)("span",{className:`font-bold text-lg ${g}`,children:R})]}),k&&(0,v.jsx)("p",{className:`text-xs mt-0.5 ${g} opacity-80 italic`,children:k.trim()}),typeof h.value=="number"&&h.maxValue!==void 0&&!h.isProgressionStat&&!T&&h.maxValue>0&&(0,v.jsx)("div",{className:`w-full rounded-full h-3 overflow-hidden mt-2 ${C} bg-opacity-60 shadow-inner`,children:(0,v.jsx)("div",{className:`${S} h-full rounded-full transition-all duration-500 ease-out`,style:{width:`${Math.max(0,Math.min(100,h.value/h.maxValue*100))}%`}})}),h.description&&(0,v.jsx)("p",{className:`text-xs mt-2 ${g} opacity-90 leading-relaxed`,children:h.description})]},h.id)},[t]);return(0,v.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,v.jsx)("h3",{className:"text-2xl font-bold mb-4 text-center text-primary dark:text-primary-light tracking-wide drop-shadow-sm",children:i}),o&&(0,v.jsxs)("div",{className:"p-4 bg-gradient-to-r from-amber-400 via-yellow-500 to-amber-600 dark:from-amber-500 dark:via-yellow-600 dark:to-amber-700 rounded-xl shadow-xl text-white",children:[(0,v.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,v.jsxs)("span",{className:"font-bold text-2xl flex items-center",children:[o.icon&&(0,v.jsx)("i",{className:`${o.icon} mr-3 w-7 text-center text-3xl opacity-80`}),o.name,":"]}),(0,v.jsx)("span",{className:"font-extrabold text-2xl tracking-tight",children:String(o.value)})]}),o.description&&(0,v.jsx)("p",{className:"text-xs opacity-90 mt-1.5",children:o.description})]},o.id),a.map(h=>r[h]&&f(r[h],!1,!1,!0)),(0,v.jsx)("h4",{className:"text-xl font-semibold mt-5 pt-4 border-t border-border-light dark:border-border-dark text-sky-600 dark:text-sky-300",children:"Thu\u1ED9c T\xEDnh Ch\xEDnh"}),u.map(h=>r[h]&&f(r[h],!1,!0)),(0,v.jsx)("h4",{className:"text-xl font-semibold mt-5 pt-4 border-t border-border-light dark:border-border-dark text-rose-600 dark:text-rose-300",children:"Ch\u1EC9 S\u1ED1 Chi\u1EBFn \u0110\u1EA5u"}),c.map(h=>r[h]&&f(r[h],!0)),d.length>0&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("h4",{className:"text-xl font-semibold mt-5 pt-4 border-t border-border-light dark:border-border-dark",children:"Ch\u1EC9 S\u1ED1 Kh\xE1c"}),d.map(h=>f(h))]})]})}),dA=j.default.memo(({items:t,equippedItems:e,onUseItem:n,onEquipItem:i,isLoadingAI:r,currency:o,currencyEnabled:a})=>{let u=t.filter(f=>f.category==="quan tr\u1ECDng"),c=t.filter(f=>f.category!=="quan tr\u1ECDng"),d=(0,j.useCallback)((f,h)=>f.length===0&&!h?null:f.length===0&&h?(0,v.jsxs)("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-3 p-3 bg-slate-100 dark:bg-slate-800/50 rounded-md text-center",children:[h,": Tr\u1ED1ng."]}):(0,v.jsxs)("div",{className:"space-y-3.5",children:[h&&(0,v.jsx)("h4",{className:"text-lg font-semibold mt-4 pt-3 text-slate-700 dark:text-slate-300",children:h}),f.map(m=>{let y=Object.values(e).includes(m.id);return(0,v.jsxs)("div",{className:`p-3.5 border rounded-xl bg-white dark:bg-slate-800/80 shadow-interactive dark:shadow-interactive-dark hover:shadow-lg transition-all duration-200 ease-in-out ${y?"border-primary dark:border-primary-dark ring-2 ring-primary/60 dark:ring-primary-dark/60":"border-border-light dark:border-border-dark"}`,children:[(0,v.jsxs)("div",{className:"flex justify-between items-start gap-3",children:[(0,v.jsxs)("div",{className:"flex-grow flex items-start gap-3.5",children:[(0,v.jsx)("div",{className:`w-14 h-14 flex-shrink-0 rounded-lg ${m.category==="quan tr\u1ECDng"?"bg-gradient-to-br from-yellow-100 to-amber-200 dark:from-yellow-700 dark:to-amber-800":"bg-gradient-to-br from-slate-100 to-gray-200 dark:from-slate-700 dark:to-gray-800"} flex items-center justify-center shadow-inner`,children:(0,v.jsx)("i",{className:`${m.icon||(m.category==="quan tr\u1ECDng"?"fas fa-star":"fas fa-box-open")} ${m.category==="quan tr\u1ECDng"?"text-yellow-500 dark:text-yellow-300":"text-secondary dark:text-secondary-light"} text-3xl opacity-80`})}),(0,v.jsxs)("div",{className:"flex-grow",children:[(0,v.jsxs)("span",{className:"font-semibold text-md text-slate-800 dark:text-slate-100 flex items-center flex-wrap",children:[m.name," ",(0,v.jsxs)("span",{className:"text-xs text-slate-500 dark:text-slate-400 ml-1.5 mr-2",children:["(SL: ",m.quantity,")"]}),y&&(0,v.jsx)("span",{className:"text-xs px-2.5 py-1 bg-primary text-white dark:bg-primary-dark dark:text-black rounded-full font-medium shadow-sm",children:"\u0110ang Trang B\u1ECB"})]}),m.description&&(0,v.jsx)("p",{className:"text-xs text-slate-600 dark:text-slate-300 mt-1 leading-relaxed",children:m.description})]})]}),(0,v.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 flex-shrink-0 items-center mt-1",children:[m.equippable&&!y&&(0,v.jsxs)(U,{size:"sm",variant:"outline",onClick:()=>i(m),className:"px-3 py-1.5 text-xs font-semibold min-w-[75px] border-green-500 text-green-600 hover:bg-green-500 hover:text-white dark:border-green-400 dark:text-green-300 dark:hover:bg-green-500 dark:hover:text-white",title:`Trang b\u1ECB ${m.name}`,children:[(0,v.jsx)("i",{className:"fas fa-shield-alt sm:mr-1.5"}),(0,v.jsx)("span",{className:"hidden sm:inline",children:"Trang B\u1ECB"})]}),m.usable&&(0,v.jsxs)(U,{size:"sm",variant:"primary",onClick:()=>n(m),className:"px-3 py-1.5 text-xs font-semibold min-w-[75px]",disabled:r,title:`S\u1EED d\u1EE5ng ${m.name}`,children:[(0,v.jsx)("i",{className:"fas fa-hand-sparkles sm:mr-1.5"}),(0,v.jsx)("span",{className:"hidden sm:inline",children:"D\xF9ng"})]})]})]}),m.effects&&m.effects.length>0&&(0,v.jsx)("ul",{className:"text-xs mt-2.5 list-disc list-inside pl-4 text-sky-700 dark:text-sky-300 space-y-1",children:m.effects.map((p,T)=>(0,v.jsxs)("li",{className:"italic",children:[p.statId,": ",p.changeValue>0?"+":"",p.changeValue,p.duration?` (trong ${p.duration} l\u01B0\u1EE3t)`:""]},T))}),m.statBonuses&&m.statBonuses.length>0&&(0,v.jsxs)("div",{className:"text-xs mt-2.5 pl-1 text-purple-700 dark:text-purple-300 space-y-0.5",children:[(0,v.jsx)("strong",{className:"font-medium block mb-0.5",children:"Bonus Trang B\u1ECB: "}),m.statBonuses.map((p,T)=>(0,v.jsxs)("span",{className:"italic mr-3 inline-flex items-center",children:[(0,v.jsx)("i",{className:"fas fa-arrow-up text-[10px] mr-1 opacity-70"}),p.statId,": ",p.value>0?"+":"",p.value,p.isPercentage?"%":"",p.appliesToMax?" (T\u1ED1i \u0111a)":""]},T))]})]},m.id)})]}),[e,r,i,n]);return(0,v.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,v.jsx)("h3",{className:"text-2xl font-bold mb-4 text-center text-primary dark:text-primary-light tracking-wide",children:"Ba L\xF4 V\u1EADt Ph\u1EA9m"}),a&&o&&(0,v.jsxs)("div",{className:"mb-4 p-3.5 border rounded-xl bg-amber-50 dark:bg-amber-900/50 shadow-md border-amber-300 dark:border-amber-600 flex items-center justify-between sticky top-0 bg-opacity-90 backdrop-blur-sm z-10",children:[(0,v.jsxs)("span",{className:"font-semibold text-md text-amber-700 dark:text-amber-200 flex items-center",children:[(0,v.jsx)("i",{className:`${o.icon||"fas fa-coins"} mr-2.5 text-xl text-amber-500 dark:text-amber-300`}),"Ti\u1EC1n t\u1EC7 (",o.name,"):"]}),(0,v.jsx)("span",{className:"font-bold text-lg text-amber-800 dark:text-amber-100",children:o.amount.toLocaleString()})]}),d(u,"V\u1EADt Ph\u1EA9m Quan Tr\u1ECDng"),d(c,c.length>0&&u.length>0?"V\u1EADt Ph\u1EA9m Kh\xE1c":t.length>0&&u.length===0?"":void 0),t.length===0&&(0,v.jsx)("p",{className:"text-sm text-slate-500 dark:text-slate-400 p-4 text-center",children:"Ba l\xF4 c\u1EE7a b\u1EA1n hi\u1EC7n \u0111ang tr\u1ED1ng r\u1ED7ng."})]})}),fA=j.default.memo(({equippedItems:t,inventory:e,onUnequipItem:n})=>{let i=["V\u0169 Kh\xED Ch\xEDnh","Tay Ph\u1EE5","M\u0169","Gi\xE1p","Gi\xE0y","D\xE2y Chuy\u1EC1n","Nh\u1EABn 1","Nh\u1EABn 2"],r=o=>{switch(o){case"V\u0169 Kh\xED Ch\xEDnh":return"fas fa-gavel";case"Tay Ph\u1EE5":return"fas fa-shield-halved";case"M\u0169":return"fas fa-hard-hat";case"Gi\xE1p":return"fas fa-shirt";case"Gi\xE0y":return"fas fa-shoe-prints";case"D\xE2y Chuy\u1EC1n":return"fas fa-gem";case"Nh\u1EABn 1":return"fas fa-ring";case"Nh\u1EABn 2":return"fas fa-ring";default:return"fas fa-question-circle"}};return(0,v.jsxs)("div",{className:"space-y-3.5 text-sm",children:[(0,v.jsxs)("h3",{className:"text-2xl font-bold mb-4 text-center text-orange-600 dark:text-orange-400 tracking-wide",children:[(0,v.jsx)("i",{className:"fas fa-user-shield mr-2.5"}),"Trang B\u1ECB Nh\xE2n V\u1EADt"]}),i.map(o=>{let a=t[o],u=a?e.find(c=>c.id===a):null;return(0,v.jsxs)("div",{className:"p-3.5 bg-white dark:bg-orange-900/40 rounded-xl shadow-interactive dark:shadow-interactive-dark border border-orange-200 dark:border-orange-700/70 transition-all duration-200 hover:shadow-md",children:[(0,v.jsxs)("div",{className:"flex justify-between items-center",children:[(0,v.jsxs)("span",{className:"font-semibold text-md flex items-center text-orange-700 dark:text-orange-200",children:[(0,v.jsx)("i",{className:`${r(o)} mr-3 w-5 text-center text-xl opacity-80`}),o,":"]}),u?(0,v.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,v.jsxs)("span",{className:"font-medium text-orange-800 dark:text-orange-100 flex items-center",children:[(0,v.jsx)("i",{className:`${u.icon||r(o)} mr-2 opacity-70`}),u.name]}),(0,v.jsxs)(U,{size:"xs",variant:"outline",onClick:()=>n(o),className:"px-2.5 py-1 text-xs border-red-500 text-red-500 hover:bg-red-500 hover:text-white dark:border-red-400 dark:text-red-300 dark:hover:bg-red-500 dark:hover:text-white",children:[(0,v.jsx)("i",{className:"fas fa-times sm:mr-1"}),(0,v.jsx)("span",{className:"hidden sm:inline",children:"Th\xE1o"})]})]}):(0,v.jsx)("span",{className:"text-sm italic text-orange-500 dark:text-orange-400",children:"-- Tr\u1ED1ng --"})]}),u&&u.statBonuses&&u.statBonuses.length>0&&(0,v.jsxs)("div",{className:"text-xs mt-2.5 pl-1 text-purple-700 dark:text-purple-300 space-y-0.5",children:[(0,v.jsx)("strong",{className:"font-medium block mb-0.5",children:"Bonus: "}),u.statBonuses.map((c,d)=>(0,v.jsxs)("span",{className:"italic mr-3 inline-flex items-center",children:[(0,v.jsx)("i",{className:"fas fa-arrow-up text-[10px] mr-1 opacity-70"}),c.statId,": ",c.value>0?"+":"",c.value,c.isPercentage?"%":"",c.appliesToMax?" (T\u1ED1i \u0111a)":""]},d))]})]},o)})]})}),hA=j.default.memo(({skills:t,isLoadingAI:e})=>{if(t.length===0)return(0,v.jsx)("p",{className:"text-sm text-center p-4 text-slate-500 dark:text-slate-400",children:"Ch\u01B0a h\u1ECDc \u0111\u01B0\u1EE3c k\u1EF9 n\u0103ng n\xE0o."});let n={"S\u01A1 Nh\u1EADp M\xF4n":{text:"text-sky-700 dark:text-sky-200",bg:"bg-sky-100 dark:bg-sky-800",border:"border-sky-300 dark:border-sky-600"},"Ti\u1EC3u Th\xE0nh":{text:"text-lime-700 dark:text-lime-200",bg:"bg-lime-100 dark:bg-lime-800",border:"border-lime-300 dark:border-lime-600"},"\u0110\u1EA1i Th\xE0nh":{text:"text-green-700 dark:text-green-200",bg:"bg-green-100 dark:bg-green-800",border:"border-green-300 dark:border-green-600"},"Vi\xEAn M\xE3n":{text:"text-yellow-700 dark:text-yellow-200",bg:"bg-yellow-100 dark:bg-yellow-700",border:"border-yellow-400 dark:border-yellow-500"},"L\xF4 Ho\u1EA3 Thu\u1EA7n Thanh":{text:"text-orange-700 dark:text-orange-200",bg:"bg-orange-100 dark:bg-orange-700",border:"border-orange-400 dark:border-orange-500"},"\u0110\u0103ng Phong T\u1EA1o C\u1EF1c":{text:"text-red-700 dark:text-red-100",bg:"bg-gradient-to-r from-red-400 to-rose-500 dark:from-red-600 dark:to-rose-700",border:"border-red-500 dark:border-rose-500",shadow:"shadow-lg"}};return(0,v.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,v.jsx)("h3",{className:"text-2xl font-bold mb-4 text-center text-purple-600 dark:text-purple-400 tracking-wide",children:"K\u1EF9 N\u0103ng \u0110\xE3 H\u1ECDc"}),t.sort((i,r)=>r.xp-i.xp).map(i=>{let r=n[i.proficiency]||n["S\u01A1 Nh\u1EADp M\xF4n"];return(0,v.jsxs)("div",{className:"p-4 bg-white dark:bg-purple-900/50 rounded-xl shadow-interactive dark:shadow-interactive-dark border border-purple-200 dark:border-purple-700/70 transition-all duration-200 hover:shadow-lg",children:[(0,v.jsx)("div",{className:"flex justify-between items-start mb-2",children:(0,v.jsxs)("div",{className:"flex items-start gap-3.5 flex-grow",children:[(0,v.jsx)("div",{className:"w-14 h-14 flex-shrink-0 rounded-lg bg-gradient-to-br from-purple-100 to-pink-100 dark:from-purple-700 dark:to-pink-800 flex items-center justify-center shadow-inner",children:(0,v.jsx)("i",{className:`${i.icon||"fas fa-book-sparkles"} text-purple-500 dark:text-purple-300 text-3xl opacity-80`})}),(0,v.jsxs)("div",{className:"flex-grow",children:[(0,v.jsx)("span",{className:"font-semibold text-lg text-purple-700 dark:text-purple-200",children:i.name}),(0,v.jsx)("span",{className:`ml-2 text-xs px-3 py-1 rounded-full font-bold shadow ${r.bg} ${r.text} ${r.border} ${r.shadow||""}`,children:i.proficiency})]})]})}),i.description&&(0,v.jsx)("p",{className:"text-sm text-purple-600 dark:text-purple-300 mt-1.5 mb-2.5 whitespace-pre-line leading-relaxed",children:i.description}),i.xpToNextLevel>0&&(0,v.jsxs)("div",{title:`${i.xp} / ${i.xpToNextLevel} XP`,className:"w-full bg-purple-200 dark:bg-purple-800/80 rounded-full h-4 overflow-hidden text-xs font-medium text-white flex items-center justify-center relative shadow-inner",children:[(0,v.jsx)("div",{className:"bg-gradient-to-r from-purple-400 via-pink-500 to-rose-500 dark:from-purple-500 dark:via-pink-600 dark:to-rose-600 h-full rounded-full transition-all duration-500 ease-out flex items-center justify-center shadow",style:{width:`${Math.max(0,Math.min(100,i.xp/i.xpToNextLevel*100))}%`}}),(0,v.jsxs)("span",{className:"absolute inset-0 flex items-center justify-center text-[11px] text-white font-bold tracking-tight",style:{textShadow:"0 0 3px rgba(0,0,0,0.6)"},children:[i.xp," / ",i.xpToNextLevel," XP"]})]}),i.effects&&i.effects.length>0&&(0,v.jsxs)("div",{className:"mt-3 text-xs",children:[(0,v.jsx)("strong",{className:"text-purple-600 dark:text-purple-400 font-medium",children:"Hi\u1EC7u \u1EE9ng:"}),(0,v.jsx)("ul",{className:"list-disc list-inside pl-4 text-purple-500 dark:text-purple-300 italic space-y-1 mt-1",children:i.effects.map((o,a)=>(0,v.jsx)("li",{children:o.description},a))})]})]},i.id)})]})}),mA=j.default.memo(({achievements:t})=>t.length===0?(0,v.jsx)("p",{className:"text-sm text-center p-4 text-slate-500 dark:text-slate-400",children:"Ch\u01B0a m\u1EDF kh\xF3a th\xE0nh t\u1EF1u n\xE0o."}):(0,v.jsxs)("div",{className:"space-y-3.5 text-sm",children:[(0,v.jsx)("h3",{className:"text-2xl font-bold mb-4 text-center text-yellow-500 dark:text-yellow-400 tracking-wide",children:"Th\xE0nh T\u1EF1u"}),t.slice().reverse().map(e=>(0,v.jsxs)("div",{className:`p-4 border rounded-xl shadow-interactive dark:shadow-interactive-dark flex items-start gap-4 ${e.isSecret?"bg-indigo-50 dark:bg-indigo-900/60 border-indigo-300 dark:border-indigo-600/70":"bg-yellow-50 dark:bg-yellow-800/60 border-yellow-300 dark:border-yellow-600/70"}`,children:[(0,v.jsx)("i",{className:`${e.icon||"fas fa-trophy"} ${e.isSecret?"text-indigo-500 dark:text-indigo-300":"text-yellow-500 dark:text-yellow-300"} text-4xl w-10 text-center mt-1 opacity-80`}),(0,v.jsxs)("div",{className:"flex-grow",children:[(0,v.jsxs)("span",{className:`font-semibold text-lg ${e.isSecret?"text-indigo-700 dark:text-indigo-200":"text-yellow-700 dark:text-yellow-200"}`,children:[e.name," ",e.isSecret&&(0,v.jsx)("span",{className:"text-xs font-normal opacity-80",children:"(B\xED M\u1EADt)"})]}),(0,v.jsx)("p",{className:`text-sm ${e.isSecret?"text-indigo-600 dark:text-indigo-400":"text-yellow-600 dark:text-yellow-400"} mt-1 leading-relaxed`,children:e.description}),(0,v.jsxs)("p",{className:"text-xs text-slate-400 dark:text-slate-500 mt-2",children:["M\u1EDF kh\xF3a: ",new Date(e.unlockedAt).toLocaleString()]})]})]},e.id))]})),pA=j.default.memo(({relationships:t})=>{let e=Object.values(t).filter(n=>n.known);return e.length===0?(0,v.jsx)("p",{className:"text-sm text-center p-4 text-slate-500 dark:text-slate-400",children:"Ch\u01B0a c\xF3 m\u1ED1i quan h\u1EC7 n\xE0o \u0111\xE1ng ch\xFA \xFD."}):(0,v.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,v.jsxs)("h3",{className:"text-2xl font-bold mb-4 text-center text-pink-600 dark:text-pink-400 tracking-wide",children:[(0,v.jsx)("i",{className:"fas fa-users mr-2.5"}),"M\u1ED1i Quan H\u1EC7 NPC"]}),e.sort((n,i)=>i.score-n.score).map(n=>{let i="bg-slate-200 text-slate-800 dark:bg-slate-600 dark:text-slate-100",r="border-slate-300 dark:border-slate-500";return n.status==="Ng\u01B0\u1EE1ng M\u1ED9"||n.status==="Trung Th\xE0nh"?(i="bg-red-100 text-red-700 dark:bg-red-700 dark:text-red-100",r="border-red-300 dark:border-red-500"):n.status==="Th\xE2n Thi\u1EC7n"?(i="bg-green-100 text-green-700 dark:bg-green-700 dark:text-green-100",r="border-green-300 dark:border-green-500"):n.status==="H\xF2a H\u1EA3o"?(i="bg-sky-100 text-sky-700 dark:bg-sky-700 dark:text-sky-100",r="border-sky-300 dark:border-sky-500"):n.status==="Th\xF9 \u0110\u1ECBch"?(i="bg-rose-700 text-white dark:bg-rose-500 dark:text-white",r="border-rose-500 dark:border-rose-300"):n.status==="Kh\xF4ng Tin T\u01B0\u1EDFng"&&(i="bg-amber-100 text-amber-700 dark:bg-amber-700 dark:text-amber-100",r="border-amber-300 dark:border-amber-500"),(0,v.jsxs)("div",{className:"p-4 bg-white dark:bg-pink-900/50 rounded-xl shadow-interactive dark:shadow-interactive-dark border border-pink-200 dark:border-pink-700/70 transition-all duration-200 hover:shadow-lg",children:[(0,v.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,v.jsxs)("span",{className:"font-semibold text-lg flex items-center text-pink-700 dark:text-pink-200",children:[(0,v.jsx)("i",{className:"fas fa-user-friends mr-3 w-5 text-center text-xl opacity-80"}),n.name]}),(0,v.jsxs)("span",{className:`text-xs px-3 py-1 rounded-full font-semibold shadow-sm ${i} border ${r}`,children:[n.status," (",n.score,")"]})]}),n.description&&(0,v.jsx)("p",{className:"text-sm text-pink-600 dark:text-pink-300 mt-1 italic whitespace-pre-line leading-relaxed",children:n.description})]},n.id)})]})}),gA=j.default.memo(({objectives:t,characterGoal:e})=>{let n=t.filter(u=>u.status==="active"),i=t.filter(u=>u.status==="completed"),r=t.filter(u=>u.status==="failed"),o=t.find(u=>u.isPlayerGoal&&u.status==="active")||{title:e||"Ch\u01B0a x\xE1c \u0111\u1ECBnh",description:"M\u1EE5c ti\xEAu ch\xEDnh c\u1EE7a nh\xE2n v\u1EADt.",status:"active",isPlayerGoal:!0,id:"main-player-goal"},a=(u,c,d,f,h=!1,m=!1)=>{if(u.length===0)return null;let y=m?"text-red-700 dark:text-red-200":h?"text-green-700 dark:text-green-200":f,p=m?"bg-red-50 dark:bg-red-900/60 border-red-200 dark:border-red-700/70":h?"bg-green-50 dark:bg-green-900/60 border-green-200 dark:border-green-700/70 opacity-90":"bg-teal-50 dark:bg-teal-900/60 border-teal-200 dark:border-teal-700/70";return(0,v.jsxs)("div",{className:"mb-4",children:[(0,v.jsxs)("h4",{className:`text-lg font-semibold mb-2.5 ${y}`,children:[(0,v.jsx)("i",{className:`${d} mr-2`}),c," (",u.length,")"]}),(0,v.jsx)("div",{className:"space-y-3",children:u.map(T=>(0,v.jsxs)("div",{className:`p-3.5 rounded-xl shadow-sm border ${p} ${h?"line-through decoration-green-500/70 dark:decoration-green-400/70":""} ${m?"opacity-80":""}`,children:[(0,v.jsxs)("p",{className:`font-semibold text-md ${y}`,children:[T.isPlayerGoal&&!h&&!m&&(0,v.jsx)("i",{className:"fas fa-bullseye text-error-DEFAULT mr-2",title:"M\u1EE5c ti\xEAu ch\xEDnh"}),T.title]}),(0,v.jsx)("p",{className:`text-sm mt-1 ${y} opacity-90 whitespace-pre-line leading-relaxed`,children:T.description}),T.subObjectives&&T.subObjectives.length>0&&(0,v.jsx)("ul",{className:"list-disc list-inside text-sm pl-3 mt-2 text-slate-500 dark:text-slate-400 space-y-1",children:T.subObjectives.map((R,C)=>(0,v.jsx)("li",{children:R},C))}),T.rewardPreview&&(0,v.jsxs)("p",{className:"text-xs mt-2 italic text-amber-600 dark:text-amber-400",children:["Ph\u1EA7n th\u01B0\u1EDFng (d\u1EF1 ki\u1EBFn): ",T.rewardPreview]})]},T.id))})]})};return(0,v.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,v.jsxs)("h3",{className:"text-2xl font-bold mb-4 text-center text-teal-600 dark:text-teal-400 tracking-wide",children:[(0,v.jsx)("i",{className:"fas fa-tasks mr-2.5"}),"M\u1EE5c Ti\xEAu H\xE0nh Tr\xECnh"]}),(0,v.jsxs)("div",{className:"p-4 bg-gradient-to-r from-teal-400 via-cyan-500 to-sky-500 dark:from-teal-600 dark:via-cyan-600 dark:to-sky-700 rounded-xl shadow-xl text-white",children:[(0,v.jsxs)("h4",{className:"font-bold text-xl mb-1 flex items-center",children:[(0,v.jsx)("i",{className:"fas fa-bullseye mr-3 text-2xl opacity-90"}),"M\u1EE5c Ti\xEAu Ch\xEDnh:"]}),(0,v.jsx)("p",{className:"text-lg font-semibold",children:o.title}),(0,v.jsx)("p",{className:"text-xs mt-1 opacity-90",children:o.description})]}),a(n.filter(u=>!u.isPlayerGoal),"Nhi\u1EC7m V\u1EE5 Ph\u1EE5 \u0110ang Th\u1EF1c Hi\u1EC7n","fas fa-spinner fa-spin","text-teal-600 dark:text-teal-300"),a(i,"\u0110\xE3 Ho\xE0n Th\xE0nh","fas fa-check-circle","text-green-600 dark:text-green-300",!0),a(r,"\u0110\xE3 Th\u1EA5t B\u1EA1i","fas fa-times-circle","text-red-600 dark:text-red-300",!1,!0),n.length===0&&i.length===0&&r.length===0&&!e&&(0,v.jsx)("p",{className:"text-sm text-center p-4 text-slate-500 dark:text-slate-400",children:"Kh\xF4ng c\xF3 m\u1EE5c ti\xEAu n\xE0o \u0111\u01B0\u1EE3c AI t\u1EA1o."})]})}),yA=j.default.memo(({progressionStat:t,qiStat:e,onAdvance:n,onCultivate:i,isLoadingAI:r})=>{if(!t||!e)return(0,v.jsx)("p",{className:"text-sm text-center p-4 text-slate-500 dark:text-slate-400",children:'H\u1EC7 th\u1ED1ng tu luy\u1EC7n ch\u01B0a \u0111\u01B0\u1EE3c kh\u1EDFi t\u1EA1o. Vui l\xF2ng \u0111\u1EA3m b\u1EA3o AI \u0111\xE3 cung c\u1EA5p ch\u1EC9 s\u1ED1 "C\u1EA5p \u0110\u1ED9" (ID: "progression_level") v\xE0 "\u0110i\u1EC3m Kinh Nghi\u1EC7m" (ID: "spiritual_qi").'});let o=!1,a=e.value,u=e.maxValue;return typeof a=="number"&&typeof u=="number"&&a>=u&&u>0&&(o=!0),(0,v.jsxs)("div",{className:"space-y-5 text-sm",children:[(0,v.jsxs)("h3",{className:"text-2xl font-bold mb-4 text-center text-indigo-600 dark:text-indigo-400 tracking-wide",children:[(0,v.jsx)("i",{className:"fas fa-hat-wizard mr-2.5"}),"Ti\u1EBFn Tri\u1EC3n Tu Luy\u1EC7n"]}),(0,v.jsxs)("div",{className:"p-4 bg-gradient-to-br from-indigo-100 to-purple-100 dark:from-indigo-800/70 dark:to-purple-800/70 rounded-xl shadow-xl border border-indigo-200 dark:border-indigo-700",children:[(0,v.jsxs)("div",{className:"flex justify-between items-center mb-1.5",children:[(0,v.jsxs)("span",{className:"font-bold text-xl flex items-center text-indigo-700 dark:text-indigo-200",children:[t.icon&&(0,v.jsx)("i",{className:`${t.icon} mr-3 w-6 text-center text-2xl opacity-90`}),t.name,":"]}),(0,v.jsx)("span",{className:"font-extrabold text-xl text-indigo-800 dark:text-indigo-100 tracking-tight",children:String(t.value)})]}),t.description&&(0,v.jsx)("p",{className:"text-sm text-indigo-600 dark:text-indigo-300 mt-1.5 opacity-90 leading-relaxed",children:t.description})]}),(0,v.jsxs)("div",{className:"p-4 bg-gradient-to-br from-sky-100 to-cyan-100 dark:from-sky-800/70 dark:to-cyan-800/70 rounded-xl shadow-xl border border-sky-200 dark:border-sky-700",children:[(0,v.jsxs)("div",{className:"flex justify-between items-center mb-1.5",children:[(0,v.jsxs)("span",{className:"font-semibold text-lg flex items-center text-sky-700 dark:text-sky-200",children:[e.icon&&(0,v.jsx)("i",{className:`${e.icon} mr-3 w-5 text-center text-xl opacity-90`}),e.name,":"]}),(0,v.jsx)("span",{className:"font-bold text-lg text-sky-800 dark:text-sky-100",children:typeof e.value=="number"&&e.maxValue?`${parseFloat(e.value.toFixed(1))} / ${parseFloat(e.maxValue.toFixed(1))}`:String(e.value)})]}),typeof e.value=="number"&&typeof e.maxValue=="number"&&e.maxValue>0&&(0,v.jsx)("div",{className:"w-full bg-sky-200 dark:bg-sky-800/80 rounded-full h-4 mt-2 overflow-hidden shadow-inner",children:(0,v.jsx)("div",{className:"bg-gradient-to-r from-sky-400 to-cyan-500 dark:from-sky-500 to-cyan-600 h-full rounded-full transition-all duration-500 ease-out shadow-sm",style:{width:`${Math.max(0,Math.min(100,e.value/e.maxValue*100))}%`}})}),e.description&&(0,v.jsx)("p",{className:"text-sm text-sky-600 dark:text-sky-300 mt-2 opacity-90 leading-relaxed",children:e.description})]}),(0,v.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3.5 mt-5",children:[(0,v.jsxs)(U,{onClick:i,isLoading:r,disabled:r,fullWidth:!0,variant:"outline",className:"border-sky-500 text-sky-600 hover:bg-sky-500 hover:text-white dark:border-sky-400 dark:text-sky-300 dark:hover:bg-sky-500 dark:hover:text-white !py-3 !text-base",children:[(0,v.jsx)("i",{className:"fas fa-praying-hands mr-2"}),"T\u1EADp Trung N\xE2ng C\u1EA5p"]}),(0,v.jsxs)(U,{onClick:n,isLoading:r,disabled:!o||r,fullWidth:!0,variant:"primary",className:"bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 !py-3 !text-base",children:[(0,v.jsx)("i",{className:"fas fa-level-up-alt mr-2"}),"Th\u1EED Th\xE1ch Th\u0103ng Ti\u1EBFn"]})]}),(0,v.jsx)("p",{className:`text-sm text-center mt-2 ${o?"text-green-600 dark:text-green-400 font-semibold":"text-slate-500 dark:text-slate-400"}`,children:o?`\u0110\xE3 \u0111\u1EE7 ${e.name} \u0111\u1EC3 th\u0103ng ti\u1EBFn!`:`C\u1EA7n th\xEAm ${typeof e.value=="number"&&typeof e.maxValue=="number"&&e.maxValue>e.value?(e.maxValue-e.value).toFixed(1):"?"} ${e.name} \u0111\u1EC3 th\u0103ng ti\u1EBFn.`})]})}),av=j.default.memo(({choices:t,onChooseAction:e,isLoadingAI:n,isRoleplayModeActive:i,isAuthorInterventionModeActive:r,toggleRoleplayMode:o,toggleAuthorInterventionMode:a,isMobile:u})=>{let[c,d]=(0,j.useState)(""),f=m=>{m.preventDefault(),c.trim()&&!n&&(e(c.trim()),d(""))},h=()=>{n||e("AI_AUTO_CONTINUE_STORY")};return(0,v.jsxs)("div",{className:"space-y-3 flex flex-col h-full",children:[" ",(0,v.jsxs)("div",{className:`flex items-center gap-2 mb-3 pt-1 ${u?"justify-around":"sm:border-t-0 border-t border-slate-200 dark:border-slate-700/60"}`,children:[(0,v.jsxs)(U,{size:"sm",variant:i?"primary":"outline",onClick:o,disabled:n,className:`flex-1 !text-xs !py-2 ${u?"!px-2":""}`,title:i?"Chuy\u1EC3n sang Ch\u1EBF \u0111\u1ED9 AI H\u1ED7 Tr\u1EE3 (G\u1EE3i \xFD)":"Chuy\u1EC3n sang Ch\u1EBF \u0111\u1ED9 Nh\u1EADp Vai (T\u1EF1 do)",children:[(0,v.jsx)("i",{className:`mr-1.5 ${i?"fas fa-theater-masks text-yellow-300 dark:text-yellow-400":"fas fa-brain"}`})," ",i?"Nh\u1EADp Vai":"AI H\u1ED7 Tr\u1EE3"]}),(0,v.jsxs)(U,{size:"sm",variant:r?"primary":"outline",onClick:a,disabled:n,className:`flex-1 !text-xs !py-2 ${u?"!px-2":""}`,title:r?"T\u1EAFt Ch\u1EBF \u0111\u1ED9 Can Thi\u1EC7p T\xE1c Gi\u1EA3":"B\u1EADt Ch\u1EBF \u0111\u1ED9 Can Thi\u1EC7p T\xE1c Gi\u1EA3",children:[(0,v.jsx)("i",{className:`mr-1.5 ${r?"fas fa-feather-alt text-red-300 dark:text-red-400":"fas fa-feather"}`})," T\xE1c Gi\u1EA3"]})]}),!i&&!r&&t.length>0&&(0,v.jsxs)("div",{className:`space-y-2.5 ${u?"max-h-48":"max-h-40 sm:max-h-60"} overflow-y-auto custom-scrollbar pr-1 sm:pr-2 flex-grow`,children:[" ",t.map((m,y)=>(0,v.jsx)(U,{onClick:()=>e(m.text),fullWidth:!0,className:"bg-gray-700 dark:bg-gray-800 border-2 border-primary dark:border-primary-light text-slate-100 dark:text-slate-50 hover:bg-gray-600 dark:hover:bg-gray-700 hover:border-primary-light dark:hover:border-primary focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-primary dark:focus-visible:ring-primary-light text-left px-3 py-2.5 !text-sm !font-normal !rounded-xl transition-all duration-150 ease-in-out transform hover:scale-[1.01] active:scale-[0.99] w-full flex items-center",disabled:n,title:m.tooltip||m.text,children:(0,v.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,v.jsxs)("div",{className:"flex items-start min-w-0",children:[(0,v.jsx)("span",{className:"bg-primary text-white dark:bg-primary-dark dark:text-gray-900 rounded-full w-5 h-5 sm:w-6 sm:h-6 flex items-center justify-center text-[10px] sm:text-xs font-bold mr-2 sm:mr-3 flex-shrink-0",children:y+1}),(0,v.jsx)("span",{className:"whitespace-normal break-words",children:m.text})]}),(0,v.jsx)("i",{className:"fas fa-chevron-right text-slate-400 dark:text-slate-500 text-xs ml-2 flex-shrink-0"})]})},m.id))]}),(i||r||t.length===0)&&!n&&(0,v.jsx)("p",{className:"text-sm text-slate-500 dark:text-slate-400 italic p-3 bg-slate-100 dark:bg-slate-800/60 rounded-md text-center",children:r?"Ch\u1EBF \u0111\u1ED9 Can Thi\u1EC7p T\xE1c Gi\u1EA3 \u0111ang B\u1EACT. Nh\u1EADp l\u1EC7nh c\u1EE7a b\u1EA1n.":i?"Ch\u1EBF \u0111\u1ED9 Nh\u1EADp Vai \u0111ang b\u1EADt. H\xE3y t\u1EF1 do nh\u1EADp h\xE0nh \u0111\u1ED9ng c\u1EE7a b\u1EA1n.":"AI kh\xF4ng \u0111\u01B0a ra l\u1EF1a ch\u1ECDn n\xE0o. H\xE3y t\u1EF1 quy\u1EBFt \u0111\u1ECBnh h\xE0nh \u0111\u1ED9ng ti\u1EBFp theo."}),(0,v.jsxs)("form",{onSubmit:f,className:"space-y-3 pt-1 mt-auto",children:[" ",(0,v.jsx)(Nt,{value:c,onChange:m=>d(m.target.value),placeholder:r?"Nh\u1EADp l\u1EC7nh c\u1EE7a T\xE1c Gi\u1EA3 (VD: Cho L\xFD Ph\xE0m 1000 v\xE0ng)...":i?"Nh\u1EADp l\u1EDDi n\xF3i, h\xE0nh \u0111\u1ED9ng, suy ngh\u0129 c\u1EE7a b\u1EA1n...":"Ho\u1EB7c nh\u1EADp h\xE0nh \u0111\u1ED9ng t\xF9y ch\u1EC9nh c\u1EE7a b\u1EA1n...",rows:u?2:3,className:"text-sm bg-white dark:bg-slate-700/60 !rounded-lg focus:ring-primary-dark dark:focus:ring-primary-light",disabled:n,"aria-label":"Custom action input"}),(0,v.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,v.jsxs)(U,{type:"submit",isLoading:n,disabled:n||!c.trim(),variant:"success",className:`!text-base ${u?"!py-2.5":"!py-3"} !rounded-lg bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700`,children:[(0,v.jsx)("i",{className:"fas fa-paper-plane mr-2"}),"G\u1EEDi"]}),(0,v.jsxs)(U,{type:"button",onClick:h,isLoading:n,disabled:n,variant:"secondary",className:`!text-base ${u?"!py-2.5":"!py-3"} !rounded-lg bg-gradient-to-r from-sky-500 to-blue-600 hover:from-sky-600 hover:to-blue-700`,children:[(0,v.jsx)("i",{className:"fas fa-wand-magic-sparkles mr-2"}),"AI Vi\u1EBFt Ti\u1EBFp"]})]})]})]})}),ki=(t,e="id")=>t?`${e}-${t.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")}-${Date.now().toString(36)}${Math.random().toString(36).substring(2,5)}`:`${e}_unknown_${Date.now().toString(36)}${Math.random().toString(36).substring(2,5)}`,vA=(t,e,n)=>{let i=[...t],r=[];return e&&e.forEach(o=>{if(!o.name||typeof o.quantity!="number"||o.quantity<=0)return;let a=i.findIndex(u=>u.name===o.name);a>-1?i[a].quantity+=o.quantity:i.push({...o,id:o.id||ki(o.name,"item")})}),n&&n.forEach(o=>{if(typeof o.quantity!="number"||o.quantity<=0)return;let a=-1;if("id"in o&&o.id?a=i.findIndex(u=>u.id===o.id):"name"in o&&o.name&&(a=i.findIndex(u=>u.name===o.name)),a>-1){let u=i[a];i[a].quantity-=o.quantity,i[a].quantity<=0&&(r.push(u.id),i.splice(a,1))}}),{updatedInventory:i,lostItemIds:r}},uv=({gameState:t,setGameState:e,openModal:n,quitGame:i,nsfwSettings:r,autosaveCurrentStory:o})=>{let{settings:a}=tt(),{addToast:u}=vn(),[c,d]=(0,j.useState)(!1),f=(0,j.useRef)(null),[h,m]=(0,j.useState)(null),[y,p]=(0,j.useState)(Zd),[T,R]=(0,j.useState)(!1),C=(0,j.useRef)(null),g=lA("(max-width: 639px)"),[x,S]=(0,j.useState)(null),I=(0,j.useRef)(null),V=(0,j.useRef)(null),k=(0,j.useMemo)(()=>lv(t.characterStats,t.equippedItems,t.inventory),[t.characterStats,t.equippedItems,t.inventory]),[N,b]=(0,j.useState)(!1),D=(0,j.useRef)(null),te=(0,j.useRef)(c),re=(0,j.useRef)(null);(0,j.useEffect)(()=>{let A=L=>{C.current&&!C.current.contains(L.target)&&R(!1),D.current&&!D.current.contains(L.target)&&b(!1)};return(T||N)&&document.addEventListener("mousedown",A),()=>{document.removeEventListener("mousedown",A)}},[T,N]),(0,j.useEffect)(()=>{t&&o(t)},[t,o]),(0,j.useEffect)(()=>{p(Zd)},[t.setup.id]),(0,j.useEffect)(()=>{if(f.current&&t.storyLog.length>0){let A=t.storyLog[t.storyLog.length-1],L=t.storyLog.length>1?t.storyLog[t.storyLog.length-2]:null;if((A.type==="narration"||A.type==="event"||A.type==="author")&&(L&&L.type==="system"&&L.content.includes("quy\u1EBFt \u0111\u1ECBnh:")||t.storyLog.length===1&&(A.type==="narration"||A.type==="author"))){let Te=document.getElementById(A.id);if(Te){Te.scrollIntoView({behavior:"smooth",block:"start"});return}}let{scrollTop:ne,scrollHeight:se,clientHeight:me}=f.current;(se-ne<=me+150||t.storyLog.length<=y)&&(f.current.scrollTop=f.current.scrollHeight)}},[t.storyLog,y]),(0,j.useEffect)(()=>{let A=k.hp;A&&typeof A.value=="number"&&A.value<=0&&(t.storyLog.some(Q=>Q.type==="system"&&Q.content.includes("qua \u0111\u1EDDi"))||t.currentChoices.length===0&&t.isInitialStoryGenerated&&t.storyLog.length>1||(u({message:`${t.setup.character.name} \u0111\xE3 tr\xFAt h\u01A1i th\u1EDF cu\u1ED1i c\xF9ng...`,type:"error",icon:"fas fa-skull-crossbones",duration:1e4}),m(null),e(Q=>{if(!Q)return null;let ne={id:`system-death-${Date.now()}`,type:"system",content:`${Q.setup.character.name} \u0111\xE3 t\u1EED vong. S\u1ED1 m\u1EC7nh \u0111\xE3 \u0111\u1ECBnh, kh\xF4ng th\u1EC3 xoay chuy\u1EC3n.`,timestamp:new Date().toISOString()};return{...Q,storyLog:[...Q.storyLog,ne],currentChoices:[]}}),n(10)))},[k.hp,t.setup.character.name,t.storyLog,t.currentChoices.length,t.isInitialStoryGenerated,n,e,u]);let O=(0,j.useCallback)((A,L)=>{if(!L||L.length===0)return A;let Q=[...A];return L.forEach(ne=>{if(!ne.name||!ne.type)return;let se=Q.findIndex(me=>me.name===ne.name&&me.type===ne.type);se>-1?ne.description&&ne.description!==Q[se].description&&(u({message:`B\xE1ch khoa c\u1EADp nh\u1EADt: ${ne.name}`,type:"info",icon:"fas fa-book-medical"}),Q[se]={...Q[se],description:ne.description}):(u({message:`Kh\xE1m ph\xE1 m\u1EDBi: ${ne.name} (${ne.type})`,type:"info",icon:"fas fa-map-marked-alt"}),Q.push({id:ne.id||ki(ne.name,`encyclopedia-${ne.type}`),name:ne.name,type:ne.type,description:ne.description||"Ch\u01B0a c\xF3 m\xF4 t\u1EA3 chi ti\u1EBFt."}))}),Q},[u]),ae=(0,j.useCallback)(async A=>{if(c)return;d(!0);let L={id:`msg-action-${Date.now()}`,type:"system",content:A==="AI_AUTO_CONTINUE_STORY"?`${t.setup.character.name} \u0111\u1EC3 AI t\u1EF1 vi\u1EBFt ti\u1EBFp t\xECnh ti\u1EBFt...`:`${t.setup.character.name} ${t.isAuthorInterventionModeActive?" (T\xE1c Gi\u1EA3)":""} quy\u1EBFt \u0111\u1ECBnh: "${A}"`,timestamp:new Date().toISOString()},Q={storyLog:t.storyLog,currentChoices:t.currentChoices,currentSummary:t.currentSummary,currentWorldEvent:t.currentWorldEvent,encyclopedia:t.encyclopedia,characterStats:t.characterStats,inventory:t.inventory,equippedItems:t.equippedItems,unlockedAchievements:t.unlockedAchievements,characterSkills:t.characterSkills,isRoleplayModeActive:t.isRoleplayModeActive,isAuthorInterventionModeActive:t.isAuthorInterventionModeActive,activeSidebarTab:h||t.activeSidebarTab,npcRelationships:t.npcRelationships,objectives:t.objectives,currency:t.currency,currentTime:t.currentTime},ne=null;e(me=>{if(!me)return null;ne=me;let K=me.history.slice(-9);return{...me,storyLog:[...me.storyLog,L],history:[...K,Q]}});let se=a.useDefaultAPI?process.env.API_KEY||"":localStorage.getItem(sn)||"";try{let me={...t,storyLog:[...t.storyLog,L]},K=await Xy(se,a.useDefaultAPI,me,A,r,{currencyEnabled:a.currencyEnabled,timeSystemEnabled:a.timeSystemEnabled,reputationSystemEnabled:a.reputationSystemEnabled});e(Te=>{if(!Te)return null;let X={...Te};X.storyLog=[...X.storyLog,K.story],X.currentChoices=K.choices,K.updatedSummary&&(X.currentSummary=K.updatedSummary),X.encyclopedia=O(X.encyclopedia,K.newEntries),K.statChanges&&K.statChanges.forEach(w=>{let M=X.characterStats[w.attribute_id];if(M){let F="",J=M.value;w.new_value!==void 0?(M.value=w.new_value,F=`${M.name}: ${J} -> ${w.new_value}`):w.change_value!==void 0&&typeof M.value=="number"&&(M.value+=w.change_value,F=`${M.name}: ${J} ${w.change_value>=0?"+":""}${w.change_value} -> ${M.value}`),w.new_max_value!==void 0&&typeof M.maxValue=="number"&&(M.maxValue=w.new_max_value,F+=` (Max: ${M.maxValue})`),w.reason&&(F+=` (L\xFD do: ${w.reason})`),F&&u({message:F,type:"info",icon:"fas fa-chart-line"})}});let{updatedInventory:_,lostItemIds:B}=vA(X.inventory,K.itemChanges?.gained,K.itemChanges?.lost);if(X.inventory=_,B.length>0)for(let w in X.equippedItems){let M=w;if(X.equippedItems[M]&&B.includes(X.equippedItems[M])){let F=ne?.inventory.find(J=>J.id===X.equippedItems[M])?.name||"M\u1ED9t v\u1EADt ph\u1EA9m";delete X.equippedItems[M],u({message:`${F} \u0111\xE3 b\u1ECB m\u1EA5t v\xE0 t\u1EF1 \u0111\u1ED9ng th\xE1o ra.`,type:"warning",icon:"fas fa-box-tissue"})}}if(K.itemChanges?.gained&&K.itemChanges.gained.forEach(w=>u({message:`Nh\u1EADn \u0111\u01B0\u1EE3c: ${w.name} (x${w.quantity})`,type:"success",icon:w.icon||"fas fa-gift"})),K.itemChanges?.lost&&K.itemChanges.lost.forEach(w=>{let M="name"in w?w.name:ne?.inventory.find(F=>F.id===w.id)?.name||"M\u1ED9t v\u1EADt ph\u1EA9m";u({message:`M\u1EA5t: ${M} (x${w.quantity})`,type:"warning",icon:"fas fa-minus-circle"})}),K.newSkillsUnlocked&&K.newSkillsUnlocked.forEach(w=>{if(!X.characterSkills.find(M=>M.id===w.id||M.name===w.name)){let M={id:w.id||ki(w.name,"skill"),name:w.name,description:w.description||"Ch\u01B0a c\xF3 m\xF4 t\u1EA3.",icon:w.icon||"fas fa-book-sparkles",category:w.category||"kh\xE1c",proficiency:w.proficiency||"S\u01A1 Nh\u1EADp M\xF4n",xp:w.xp||0,xpToNextLevel:w.xpToNextLevel||100,effects:w.effects||[]};X.characterSkills.push(M),u({message:`H\u1ECDc \u0111\u01B0\u1EE3c k\u1EF9 n\u0103ng m\u1EDBi: ${M.name}!`,type:"success",icon:M.icon||"fas fa-brain"})}}),K.skillChanges&&Array.isArray(K.skillChanges)&&K.skillChanges.forEach(w=>{let M=X.characterSkills.findIndex(F=>F.id===w.skill_id||F.name===w.skill_id);if(M>-1){let F={...X.characterSkills[M]},J=`K\u1EF9 n\u0103ng ${F.name}: `,Ue=!1;if(w.xp_gained!==void 0&&(F.xp+=w.xp_gained,J+=`+${w.xp_gained} XP. `,Ue=!0),w.new_proficiency&&(J+=`Th\xE0nh th\u1EA1o -> ${w.new_proficiency}. `,F.proficiency=w.new_proficiency,F.xp=0,Ue=!0),w.new_xp_to_next_level!==void 0&&(F.xpToNextLevel=w.new_xp_to_next_level),w.new_description&&(F.description=w.new_description,Ue||(J+="M\xF4 t\u1EA3 c\u1EADp nh\u1EADt. "),Ue=!0),w.reason&&(J+=`(L\xFD do: ${w.reason})`),Ue&&u({message:J,type:"info",icon:F.icon||"fas fa-graduation-cap"}),F.xp>=F.xpToNextLevel&&F.xpToNextLevel>0){let vt=["S\u01A1 Nh\u1EADp M\xF4n","Ti\u1EC3u Th\xE0nh","\u0110\u1EA1i Th\xE0nh","Vi\xEAn M\xE3n","L\xF4 Ho\u1EA3 Thu\u1EA7n Thanh","\u0110\u0103ng Phong T\u1EA1o C\u1EF1c"],Nn=vt.indexOf(F.proficiency);Nn<vt.length-1?(F.proficiency=vt[Nn+1],F.xp-=F.xpToNextLevel,F.xpToNextLevel=Math.floor(F.xpToNextLevel*(1.5+Math.random()*.5)),u({message:`K\u1EF9 n\u0103ng ${F.name} \u0111\xE3 th\u0103ng c\u1EA5p th\xE0nh th\u1EA1o l\xEAn ${F.proficiency}!`,type:"success",icon:"fas fa-angle-double-up"})):F.proficiency==="\u0110\u0103ng Phong T\u1EA1o C\u1EF1c"&&(F.xp=F.xpToNextLevel)}X.characterSkills[M]=F}}),K.newlyUnlockedAchievements&&K.newlyUnlockedAchievements.forEach(w=>{if(!X.unlockedAchievements.find(M=>M.name===w.name)){let M={...w,id:ki(w.name,"ach"),unlockedAt:new Date().toISOString()};X.unlockedAchievements=[...X.unlockedAchievements,M],u({message:`Th\xE0nh t\u1EF1u m\u1EDBi: ${M.name}!`,type:"success",icon:M.icon||"fas fa-trophy"})}}),K.relationshipChanges&&K.relationshipChanges.forEach(w=>{let M=Object.values(X.npcRelationships).find(F=>F.name===w.npc_name);if(!M&&X.encyclopedia.find(F=>F.name===w.npc_name&&F.type==="NPC")){let F=X.encyclopedia.find(J=>J.name===w.npc_name&&J.type==="NPC");if(F){let J=F.id;X.npcRelationships[J]={id:J,name:F.name,status:"Trung L\u1EADp",score:0,description:F.description,known:!0},M=X.npcRelationships[J],u({message:`G\u1EB7p g\u1EE1 ${F.name}.`,type:"info",icon:"fas fa-user-plus"})}}if(M){let F=M.status,J=M.score;w.score_change!==void 0&&(M.score=Math.max(-100,Math.min(100,M.score+w.score_change))),w.new_status?M.status=w.new_status:M.score<=-80?M.status="Th\xF9 \u0110\u1ECBch":M.score<=-30?M.status="Kh\xF4ng Tin T\u01B0\u1EDFng":M.score<30?M.status="Trung L\u1EADp":M.score<60?M.status="H\xF2a H\u1EA3o":M.score<80?M.status="Th\xE2n Thi\u1EC7n":M.score<100?M.status="Trung Th\xE0nh":M.status="Ng\u01B0\u1EE1ng M\u1ED9",w.reason&&(M.description=w.reason),(F!==M.status||J!==M.score)&&u({message:`Quan h\u1EC7 v\u1EDBi ${M.name}: ${F} (${J}) -> ${M.status} (${M.score}). ${w.reason?`L\xFD do: ${w.reason}`:""}`.trim(),type:"info",icon:"fas fa-heartbeat",duration:7e3}),X.npcRelationships[M.id]=M}}),K.newObjectivesSuggested&&K.newObjectivesSuggested.forEach(w=>{if(!X.objectives.find(M=>M.title===w.title&&M.status==="active")){let M={...w,id:ki(w.title,"obj"),status:"active",isPlayerGoal:!1};X.objectives.push(M),u({message:`M\u1EE5c ti\xEAu m\u1EDBi \u0111\u01B0\u1EE3c g\u1EE3i \xFD: ${M.title}`,type:"info",icon:"fas fa-lightbulb"})}}),K.objectiveUpdates&&K.objectiveUpdates.forEach(w=>{let M=X.objectives.findIndex(F=>(F.id===w.objective_id_or_title||F.title===w.objective_id_or_title)&&F.status==="active");if(M>-1){X.objectives[M].status=w.new_status;let F=w.new_status==="completed"?"fas fa-flag-checkered":"fas fa-times-circle",J=w.new_status==="completed"?"success":"error";u({message:`M\u1EE5c ti\xEAu "${X.objectives[M].title}" \u0111\xE3 ${w.new_status==="completed"?"ho\xE0n th\xE0nh":"th\u1EA5t b\u1EA1i"}! ${w.reason?`L\xFD do: ${w.reason}`:""}`,type:J,icon:F,duration:8e3})}}),a.currencyEnabled&&K.currencyChanges){let w=K.currencyChanges;if(X.currency){let M=X.currency.amount;X.currency.amount=w.new_amount!==void 0?w.new_amount:X.currency.amount+(w.change_value||0),X.currency.amount=Math.max(0,X.currency.amount),M!==X.currency.amount&&u({message:`Ti\u1EC1n t\u1EC7 (${X.currency.name}): ${w.change_value?(w.change_value>0?"+":"")+w.change_value.toLocaleString():`-> ${X.currency.amount.toLocaleString()}`} ${w.reason?`(${w.reason})`:""}`,type:"info",icon:X.currency.icon||"fas fa-coins"})}}return a.timeSystemEnabled&&K.timeUpdate&&(X.currentTime=K.timeUpdate),X})}catch(me){console.error("Error generating next story segment:",me),u({message:`L\u1ED7i AI: ${me.message}. H\xE3y th\u1EED l\u1EA1i.`,type:"error"})}finally{d(!1)}},[t,e,r,a,c,u,O,h]);(0,j.useEffect)(()=>{te.current===!0&&!c&&t&&!t.isRoleplayModeActive&&!t.isAuthorInterventionModeActive&&t.currentChoices.length===0&&t.isInitialStoryGenerated&&t.history.length>0&&!t.storyLog.some(L=>L.type==="system"&&L.content.includes("t\u1EED vong"))&&ae("Nh\xE2n v\u1EADt ch\xEDnh quan s\xE1t xung quanh v\xE0 c\xE2n nh\u1EAFc b\u01B0\u1EDBc ti\u1EBFp theo."),te.current=c},[c,t,ae]),(0,j.useEffect)(()=>{if(t&&t.currentWorldEvent&&t.currentWorldEvent.id!==re.current){let A=t.storyLog[t.storyLog.length-1];A&&A.type==="event"&&A.content.includes(t.currentWorldEvent.name)&&!c&&setTimeout(()=>{c||ae("AI_AUTO_CONTINUE_STORY")},100)}re.current=t?.currentWorldEvent?.id},[t?.currentWorldEvent,t?.storyLog,c,ae]);let W=(0,j.useCallback)(A=>{if(!A.usable||A.quantity<=0){u({message:"Kh\xF4ng th\u1EC3 s\u1EED d\u1EE5ng v\u1EADt ph\u1EA9m n\xE0y.",type:"warning"});return}let L=[...t.inventory];if(A.consumable){let ne=L.findIndex(se=>se.id===A.id);if(ne>-1&&(L[ne].quantity-=1,L[ne].quantity<=0)){L.splice(ne,1);let se={...t.equippedItems},me=!1;for(let K in se)if(se[K]===A.id){delete se[K],me=!0;break}me&&e(K=>K?{...K,equippedItems:se}:null)}e(se=>se?{...se,inventory:L}:null)}let Q={...t.characterStats};A.effects&&(A.effects.forEach(ne=>{let se=Q[ne.statId];if(se&&typeof se.value=="number"){let me=se.value;se.value+=ne.changeValue,se.maxValue!==void 0&&(se.value=Math.min(se.value,se.maxValue)),se.id==="hp"&&(se.value=Math.max(0,se.value)),u({message:`${A.name} \u0111\xE3 s\u1EED d\u1EE5ng. ${se.name}: ${parseFloat(me.toFixed(1))} -> ${parseFloat(se.value.toFixed(1))}.`,type:"success",icon:A.icon||"fas fa-magic-wand-sparkles"})}}),e(ne=>ne?{...ne,characterStats:Q}:null)),ae(`S\u1EED d\u1EE5ng v\u1EADt ph\u1EA9m ${A.name}.`)},[t.inventory,t.characterStats,t.equippedItems,e,ae,u]),he=(0,j.useCallback)(A=>{if(!A.equippable||!A.slot){u({message:"V\u1EADt ph\u1EA9m n\xE0y kh\xF4ng th\u1EC3 trang b\u1ECB.",type:"warning"});return}e(L=>{if(!L)return null;let Q={...L.equippedItems};return Q[A.slot]=A.id,u({message:`\u0110\xE3 trang b\u1ECB: ${A.name} v\xE0o \xF4 ${A.slot}.`,type:"success",icon:A.icon||"fas fa-user-shield"}),{...L,equippedItems:Q}})},[e,u]),Ze=(0,j.useCallback)(A=>{e(L=>{if(!L)return null;let Q=L.equippedItems[A];if(!Q)return L;let ne=L.inventory.find(me=>me.id===Q),se={...L.equippedItems};return delete se[A],u({message:`\u0110\xE3 th\xE1o: ${ne?.name||"V\u1EADt ph\u1EA9m"} t\u1EEB \xF4 ${A}.`,type:"info",icon:ne?.icon||"fas fa-hand-paper"}),{...L,equippedItems:se}})},[e,u]),rt=(0,j.useCallback)(()=>ae("T\u1EADp Trung N\xE2ng C\u1EA5p"),[ae]),Se=(0,j.useCallback)(()=>{let A=k.spiritual_qi;A&&typeof A.value=="number"&&typeof A.maxValue=="number"&&A.value>=A.maxValue&&A.maxValue>0?ae("Th\u1EED Th\xE1ch Th\u0103ng Ti\u1EBFn"):u({message:"Ch\u01B0a \u0111\u1EE7 \u0111i\u1EC3m kinh nghi\u1EC7m \u0111\u1EC3 \u0111\u1ED9t ph\xE1.",type:"warning"})},[ae,k.spiritual_qi,u]),zn=(0,j.useCallback)(()=>{e(A=>{if(!A)return null;let L=!A.isRoleplayModeActive;u({message:`Ch\u1EBF \u0111\u1ED9 ${L?"Nh\u1EADp Vai (T\u1EF1 do)":"AI H\u1ED7 Tr\u1EE3 (G\u1EE3i \xFD)"} \u0111\xE3 ${L?"B\u1EACT":"T\u1EAET"}.`,type:"info",icon:L?"fas fa-theater-masks":"fas fa-brain"});let Q=L?!1:A.isAuthorInterventionModeActive;return{...A,isRoleplayModeActive:L,isAuthorInterventionModeActive:Q,currentChoices:L||Q?[]:A.currentChoices}})},[e,u]),ur=(0,j.useCallback)(()=>{e(A=>{if(!A)return null;let L=!A.isAuthorInterventionModeActive;u({message:`Ch\u1EBF \u0111\u1ED9 Can Thi\u1EC7p T\xE1c Gi\u1EA3 ${L?"B\u1EACT":"T\u1EAET"}.`,type:"info",icon:L?"fas fa-feather-alt":"fas fa-feather"});let Q=L?!1:A.isRoleplayModeActive;return{...A,isAuthorInterventionModeActive:L,isRoleplayModeActive:Q,currentChoices:L||Q?[]:A.currentChoices}})},[e,u]),Ts=(0,j.useCallback)(()=>{e(A=>{if(!A||A.history.length===0)return u({message:"Kh\xF4ng c\xF3 h\xE0nh \u0111\u1ED9ng n\xE0o \u0111\u1EC3 ho\xE0n t\xE1c.",type:"warning"}),A;let L=A.history[A.history.length-1],Q=A.history.slice(0,-1);return u({message:"\u0110\xE3 ho\xE0n t\xE1c h\xE0nh \u0111\u1ED9ng tr\u01B0\u1EDBc \u0111\xF3.",type:"info",icon:"fas fa-undo"}),{...A,storyLog:L.storyLog,currentChoices:L.currentChoices,currentSummary:L.currentSummary,currentWorldEvent:L.currentWorldEvent,encyclopedia:L.encyclopedia,characterStats:L.characterStats,inventory:L.inventory,equippedItems:L.equippedItems,unlockedAchievements:L.unlockedAchievements,characterSkills:L.characterSkills,isRoleplayModeActive:L.isRoleplayModeActive,isAuthorInterventionModeActive:L.isAuthorInterventionModeActive,activeSidebarTab:L.activeSidebarTab,npcRelationships:L.npcRelationships,objectives:L.objectives,currency:L.currency,currentTime:L.currentTime,history:Q}})},[e,u]),Cs=(0,j.useCallback)(async()=>{if(c||!t||t.history.length>0)return;d(!0),u({message:"\u0110ang y\xEAu c\u1EA7u AI t\u1EA1o l\u1EA1i m\u1EDF \u0111\u1EA7u m\u1EDBi...",type:"info",icon:"fas fa-dice-d6 fa-spin"}),p(Zd);let A=a.useDefaultAPI?process.env.API_KEY||"":localStorage.getItem(sn)||"";try{let L=await Zy(A,a.useDefaultAPI,t.setup.world,t.setup.character,t.setup.entities,r,{currencyEnabled:a.currencyEnabled,timeSystemEnabled:a.timeSystemEnabled,reputationSystemEnabled:a.reputationSystemEnabled});e(Q=>{if(!Q)return null;let ne=[L.story],se=[...Q.setup.entities];se=O(se,L.newEntries);let me=L.initialStats||Q.characterStats,K=L.initialInventory||[],Te=L.initialSkills||[],X=[];L.newlyUnlockedAchievements&&(X=L.newlyUnlockedAchievements.map(J=>({...J,id:ki(J.name,"ach"),unlockedAt:new Date().toISOString()})),L.newlyUnlockedAchievements.forEach(J=>u({message:`Th\xE0nh t\u1EF1u m\u1EDBi: ${J.name}!`,type:"success",icon:J.icon||"fas fa-trophy"})));let _={};L.initialRelationships&&L.initialRelationships.forEach(J=>{if(J.name){let Ue=J.id||ki(J.name,"npc");_[Ue]={id:Ue,name:J.name,status:J.status||"Trung L\u1EADp",score:J.score||0,description:J.description,known:J.known!==void 0?J.known:!0}}});let B=[];L.initialObjectives&&(B=L.initialObjectives.map(J=>({...J,id:ki(J.title,"obj"),status:"active",isPlayerGoal:J.isPlayerGoal!==void 0?J.isPlayerGoal:J.title.toLowerCase().includes(Q.setup.character.goal.toLowerCase())&&Q.setup.character.goal.length>5})),L.initialObjectives.forEach(J=>u({message:`M\u1EE5c ti\xEAu m\u1EDBi: ${J.title}`,type:"info",icon:"fas fa-flag-checkered"})));let w=a.currencyEnabled&&L.initialCurrency?L.initialCurrency:a.currencyEnabled?{name:"\u0110\u1ED3ng",amount:100,icon:"fas fa-coins"}:void 0,M=a.timeSystemEnabled&&L.initialTime?L.initialTime:a.timeSystemEnabled?"08:00 Ng\xE0y 1, Th\xE1ng 1, N\u0103m 1 (S\xE1ng s\u1EDBm)":void 0;return u({message:"\u0110\xE3 t\u1EA1o l\u1EA1i m\u1EDF \u0111\u1EA7u c\xE2u chuy\u1EC7n!",type:"success",icon:"fas fa-dice-d6"}),{...Q,storyLog:ne,currentChoices:L.choices,encyclopedia:se,isInitialStoryGenerated:!0,characterStats:me,inventory:K,equippedItems:{},characterSkills:Te,unlockedAchievements:X,npcRelationships:_,objectives:B,history:[],currentSummary:"",currentWorldEvent:null,currency:w,currentTime:M}})}catch(L){console.error("Error rerolling initial story:",L),u({message:`L\u1ED7i AI khi t\u1EA1o l\u1EA1i m\u1EDF \u0111\u1EA7u: ${L.message}.`,type:"error",duration:1e4})}finally{d(!1)}},[c,t,r,a,e,u,O]),ao=(0,j.useCallback)((A,L,Q)=>{I.current&&clearTimeout(I.current);let se=A.currentTarget.getBoundingClientRect(),me=null;if(Q==="STAT"){let K=k[L];K&&(me=(0,v.jsxs)("div",{className:"p-2 text-xs",children:[(0,v.jsx)("strong",{className:"font-semibold",children:K.name}),": ",String(K.value),K.maxValue?`/${K.maxValue}`:"",(0,v.jsx)("br",{}),K.description]}))}else if(Q==="SKILL"){let K=t.characterSkills.find(Te=>Te.id===L||Te.name===L);K&&(me=(0,v.jsxs)("div",{className:"p-2 text-xs",children:[(0,v.jsx)("strong",{className:"font-semibold",children:K.name})," (",K.proficiency,")",(0,v.jsx)("br",{}),K.description]}))}else{let K=Q==="ACH"?t.unlockedAchievements.find(Te=>Te.id===L||Te.name===L):Q==="TRAIT"?t.setup.character.traits.find(Te=>Te.id===L||Te.name===L):t.encyclopedia.find(Te=>(Te.id===L||Te.name===L)&&Te.type===Q);K&&(me=(0,v.jsxs)("div",{className:"p-2 text-xs",children:[(0,v.jsx)("strong",{className:"font-semibold",children:K.name})," ",Q!=="ACH"&&Q!=="TRAIT"?`(${K.type})`:"",(0,v.jsx)("br",{}),K.description]}))}me&&S({content:me,x:se.left+se.width/2,y:se.top,width:se.width})},[t,k]),cr=(0,j.useCallback)(()=>{I.current=setTimeout(()=>{S(null)},200)},[]),_l=(0,j.useCallback)((A,L,Q)=>{ao(A,L,Q)},[ao]),Nl=(0,j.useCallback)(()=>{cr()},[cr]),ks=j.default.memo(({keyword:A,id:L,type:Q,children:ne,textColorClass:se,focusRingClass:me})=>(0,v.jsx)("span",{className:`keyword-tooltip-trigger font-semibold cursor-pointer ${se} hover:underline focus:outline-none focus:ring-1 ${me} rounded-sm px-0.5 -mx-0.5`,onMouseEnter:K=>ao(K,L,Q),onMouseLeave:cr,onFocus:K=>_l(K,L,Q),onBlur:Nl,tabIndex:0,role:"button","aria-describedby":"keyword-tooltip",children:ne})),wl=(0,j.useCallback)(A=>{let L=[];t.encyclopedia.forEach(_=>{_.name&&L.push({name:_.name,id:_.id,type:_.type})}),Object.values(k).forEach(_=>{_.name&&L.push({name:_.name,id:_.id,type:"STAT"})}),t.characterSkills.forEach(_=>{_.name&&L.push({name:_.name,id:_.id,type:"SKILL"})}),t.unlockedAchievements.forEach(_=>{_.name&&L.push({name:_.name,id:_.id,type:"ACH"})}),t.setup.character.traits.forEach(_=>{_.name&&L.push({name:_.name,id:_.id,type:"TRAIT"})});let Q=Array.from(new Set(L.map(_=>_.name))).filter(_=>_.trim().length>1).sort((_,B)=>B.length-_.length);if(Q.length===0)return[A];let ne=_=>_.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),se=Q.map(_=>ne(_)).join("|"),me=new RegExp(`(?<=\\W|^)(${se})(?=\\W|$)`,"giu"),K=[],Te=0,X;for(;(X=me.exec(A))!==null;){let _=X[1],B=L.filter(w=>w.name.toLowerCase()===_.toLowerCase()).sort((w,M)=>M.name.length-w.name.length)[0];if(X.index>Te&&K.push(A.substring(Te,X.index)),B){let w=sv[B.type]||sv.DEFAULT;K.push((0,v.jsx)(ks,{keyword:B.name,id:B.id,type:B.type,textColorClass:w.base,focusRingClass:w.focusRing,children:X[0]},`${X.index}-${B.name}`))}else K.push(X[0]);Te=me.lastIndex}return Te<A.length&&K.push(A.substring(Te)),K.length>0?K:[A]},[t,k,ks]),dr=[{id:"actions",label:"H\xE0nh \u0110\u1ED9ng",icon:"fas fa-hand-pointer"},{id:"stats",label:"Ch\u1EC9 S\u1ED1",icon:"fas fa-chart-line",component:(0,v.jsx)(cA,{baseStats:t.characterStats,equippedItems:t.equippedItems,inventory:t.inventory,characterName:t.setup.character.name})},{id:"inventory",label:"Ba L\xF4",icon:"fas fa-briefcase",component:(0,v.jsx)(dA,{items:t.inventory,equippedItems:t.equippedItems,onUseItem:W,onEquipItem:he,isLoadingAI:c,currency:t.currency,currencyEnabled:a.currencyEnabled})},{id:"equipment",label:"Trang B\u1ECB",icon:"fas fa-user-shield",component:(0,v.jsx)(fA,{equippedItems:t.equippedItems,inventory:t.inventory,onUnequipItem:Ze})},{id:"cultivation",label:"Tu Luy\u1EC7n",icon:"fas fa-hat-wizard",component:(0,v.jsx)(yA,{progressionStat:k.progression_level,qiStat:k.spiritual_qi,onAdvance:Se,onCultivate:rt,isLoadingAI:c})},{id:"skills",label:"K\u1EF9 N\u0103ng",icon:"fas fa-book-sparkles",component:(0,v.jsx)(hA,{skills:t.characterSkills,isLoadingAI:c})},{id:"achievements",label:"Th\xE0nh T\u1EF1u",icon:"fas fa-trophy",component:(0,v.jsx)(mA,{achievements:t.unlockedAchievements})},{id:"relationships",label:"Quan H\u1EC7",icon:"fas fa-users",component:(0,v.jsx)(pA,{relationships:t.npcRelationships})},{id:"objectives",label:"M\u1EE5c Ti\xEAu",icon:"fas fa-tasks",component:(0,v.jsx)(gA,{objectives:t.objectives,characterGoal:t.setup.character.goal})}],Il=dr.filter(A=>A.id!=="actions");if(!t)return(0,v.jsx)("div",{className:"flex items-center justify-center h-screen",children:"\u0110ang t\u1EA3i d\u1EEF li\u1EC7u game..."});let lo=[{id:9,icon:"fas fa-book-open",title:"B\xE1ch Khoa To\xE0n Th\u01B0",mobileHidden:!1},{id:8,icon:"fas fa-scroll",title:"T\xF3m T\u1EAFt C\u1ED1t Truy\u1EC7n",mobileHidden:!0},{id:7,icon:"fas fa-meteor",title:"T\u1EA1o S\u1EF1 Ki\u1EC7n Th\u1EBF Gi\u1EDBi",mobileHidden:!0},{id:"undo",icon:"fas fa-undo",title:"Ho\xE0n T\xE1c",action:Ts,disabled:t.history.length===0,mobileHidden:!0}],Ss=g?lo.filter(A=>!A.mobileHidden):lo,uo=g?lo.filter(A=>A.mobileHidden):[];return!t.isInitialStoryGenerated&&g&&uo.push({id:"reroll",icon:"fas fa-dice-d6",title:"T\u1EA1o L\u1EA1i M\u1EDF \u0110\u1EA7u",action:Cs,disabled:c||t.history.length>0,mobileHidden:!1}),(0,v.jsxs)("div",{className:`flex flex-col h-screen bg-gradient-to-br from-slate-100 via-gray-100 to-slate-200 dark:from-slate-900 dark:via-background-dark dark:to-slate-800 text-text-light dark:text-text-dark overflow-hidden transition-colors duration-300 ${g&&h==="actions"?"mobile-action-sheet-body-padding":""}`,children:[(0,v.jsx)("header",{className:"flex-shrink-0 bg-white/80 dark:bg-slate-800/80 backdrop-blur-md shadow-lg p-2.5 border-b border-border-light dark:border-border-dark z-20",children:(0,v.jsxs)("div",{className:"container mx-auto flex items-center justify-between gap-2",children:[(0,v.jsxs)("div",{className:"flex-grow min-w-0",children:[(0,v.jsx)("h1",{className:"text-base sm:text-lg md:text-xl font-bold text-primary dark:text-primary-light truncate sm:max-w-xs md:max-w-sm lg:max-w-md xl:max-w-lg",title:t.setup.name||"Cu\u1ED9c Phi\xEAu L\u01B0u Ch\u01B0a \u0110\u1EB7t T\xEAn",children:t.setup.name||"Cu\u1ED9c Phi\xEAu L\u01B0u Ch\u01B0a \u0110\u1EB7t T\xEAn"}),a.timeSystemEnabled&&t.currentTime&&(0,v.jsxs)("div",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center mt-0.5",children:[(0,v.jsx)("i",{className:"fas fa-clock mr-1.5 opacity-80"}),(0,v.jsx)("span",{title:`Th\u1EDDi gian trong game: ${t.currentTime}`,children:t.currentTime})]})]}),(0,v.jsxs)("div",{className:"flex-shrink-0 flex items-center space-x-1 sm:space-x-1.5",children:[(0,v.jsxs)(U,{size:"xs",variant:"ghost",onClick:()=>n(11),title:"L\u01B0u Game",children:[(0,v.jsx)("i",{className:"fas fa-save"}),(0,v.jsx)("span",{className:"hidden sm:inline ml-1.5",children:"L\u01B0u"})]}),!g&&!t.isInitialStoryGenerated&&(0,v.jsxs)(U,{size:"xs",variant:"ghost",onClick:Cs,disabled:c||t.history.length>0,title:"T\u1EA1o L\u1EA1i M\u1EDF \u0110\u1EA7u",className:"text-orange-600 dark:text-orange-400 hover:bg-orange-100 dark:hover:bg-orange-700/50",children:[(0,v.jsx)("i",{className:"fas fa-dice-d6"}),(0,v.jsx)("span",{className:"hidden sm:inline ml-1.5",children:"T\u1EA1o L\u1EA1i M\u1EDF \u0110\u1EA7u"})]}),!g&&(0,v.jsxs)("div",{className:"relative",ref:D,children:[(0,v.jsxs)(U,{size:"xs",variant:"ghost",onClick:()=>b(A=>!A),title:"M\u1EDF B\u1EA3ng \u0110i\u1EC1u Khi\u1EC3n",children:[(0,v.jsx)("i",{className:"fas fa-th-large"}),(0,v.jsx)("span",{className:"hidden sm:inline ml-1.5",children:"B\u1EA3ng \u0110i\u1EC1u Khi\u1EC3n"})]}),N&&(0,v.jsx)("div",{className:"absolute right-0 sm:left-0 mt-2 w-56 bg-white dark:bg-slate-700 rounded-md shadow-lg py-1 z-50 border border-border-light dark:border-border-dark",children:Il.map(A=>(0,v.jsxs)("button",{onClick:()=>{m(A.id),b(!1)},className:"w-full text-left px-4 py-2 text-xs text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-600 flex items-center",title:A.label,children:[(0,v.jsx)("i",{className:`${A.icon} mr-2.5 w-4 text-center`}),A.label]},A.id))})]}),Ss.map(A=>(0,v.jsx)(U,{size:"xs",variant:"ghost",onClick:()=>A.action?A.action():n(A.id),disabled:A.disabled,title:A.title,children:(0,v.jsx)("i",{className:A.icon})},A.title)),g&&uo.length>0&&(0,v.jsxs)("div",{className:"relative",ref:C,children:[(0,v.jsx)(U,{size:"xs",variant:"ghost",onClick:()=>R(A=>!A),title:"Th\xEAm t\xF9y ch\u1ECDn",children:(0,v.jsx)("i",{className:"fas fa-ellipsis-v"})}),T&&(0,v.jsx)("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-slate-700 rounded-md shadow-lg py-1 z-50 border border-border-light dark:border-border-dark",children:uo.map(A=>(0,v.jsxs)("button",{onClick:()=>{A.action?A.action():n(A.id),R(!1)},disabled:A.disabled,className:"w-full text-left px-4 py-2 text-xs text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-600 disabled:opacity-50 flex items-center",title:A.title,children:[(0,v.jsx)("i",{className:`${A.icon} mr-2.5 w-4 text-center`}),A.title]},A.title))})]}),(0,v.jsxs)(U,{size:"xs",variant:"danger",onClick:i,title:"Tho\xE1t Game",children:[(0,v.jsx)("i",{className:"fas fa-door-open"}),(0,v.jsx)("span",{className:"hidden sm:inline ml-1.5",children:"Tho\xE1t"})]})]})]})}),(0,v.jsxs)("main",{className:`flex-grow flex flex-col sm:flex-row overflow-hidden p-2 sm:p-3 gap-2 sm:gap-3 ${g?"pb-[60px]":""}`,children:[" ",(0,v.jsxs)("div",{ref:f,className:"flex-grow w-full sm:w-3/5 xl:w-2/3 bg-white/70 dark:bg-slate-800/70 backdrop-blur-sm rounded-xl shadow-lg p-3 sm:p-4 overflow-y-auto custom-scrollbar relative flex flex-col",children:[t.storyLog.length>y&&(0,v.jsxs)(U,{onClick:()=>p(A=>A+uA),variant:"outline",size:"sm",className:"mx-auto mb-3 text-xs",children:[(0,v.jsx)("i",{className:"fas fa-history mr-2"}),"T\u1EA3i Th\xEAm Tin Nh\u1EAFn C\u0169"]}),(0,v.jsx)("div",{className:"space-y-3 sm:space-y-4 flex-grow",children:t.storyLog.slice(Math.max(0,t.storyLog.length-y)).map(A=>{let L="bg-slate-100 dark:bg-slate-700/80 text-slate-800 dark:text-slate-100",Q="self-start",ne=null;switch(A.type){case"narration":L="bg-white dark:bg-slate-700/60 text-slate-700 dark:text-slate-200 shadow-sm border border-slate-200 dark:border-slate-600/50",ne=(0,v.jsx)("i",{className:"fas fa-feather-alt mr-2 sm:mr-2.5 text-slate-400 dark:text-slate-500 opacity-80"});break;case"dialogue":L="bg-primary-light/30 dark:bg-primary-dark/40 text-primary-dark dark:text-primary-light border border-primary/40 dark:border-primary-dark/50 shadow-sm",ne=(0,v.jsx)("i",{className:"fas fa-comments mr-2 sm:mr-2.5 text-primary dark:text-primary-light opacity-90"});break;case"system":L="bg-amber-50 dark:bg-amber-900/60 text-amber-700 dark:text-amber-200 border border-amber-300 dark:border-amber-600/70 text-xs italic shadow-sm",Q="self-center w-full sm:w-auto max-w-xl text-center",ne=(0,v.jsx)("i",{className:"fas fa-info-circle mr-1.5 sm:mr-2 text-amber-500 dark:text-amber-400"});break;case"event":L="bg-gradient-to-r from-purple-500 to-pink-500 text-white dark:from-purple-600 dark:to-pink-600 dark:text-white p-3 sm:p-3.5 shadow-md border-purple-300 dark:border-pink-400",ne=(0,v.jsx)("i",{className:"fas fa-star-of-life mr-2 sm:mr-2.5 opacity-90"});break;case"author":L="bg-red-100 dark:bg-red-800/70 text-red-700 dark:text-red-200 border border-red-300 dark:border-red-600/70 shadow-sm",ne=(0,v.jsx)("i",{className:"fas fa-crown mr-2 sm:mr-2.5 text-red-500 dark:text-red-400 opacity-90"});break;case"loading":return(0,v.jsxs)("div",{className:"p-3 rounded-lg bg-slate-200 dark:bg-slate-700 animate-pulse text-center",children:[(0,v.jsx)("i",{className:"fas fa-spinner fa-spin mr-2"}),A.content]},A.id)}return(0,v.jsx)("div",{id:A.id,className:`p-2.5 sm:p-3 rounded-xl text-sm leading-relaxed ${L} ${Q} transition-opacity duration-500 animate-fadeInUp`,children:(0,v.jsxs)("div",{className:"flex items-start",children:[ne,(0,v.jsxs)("div",{className:"flex-grow min-w-0",children:[A.characterName&&(0,v.jsxs)("strong",{className:"block mb-0.5",children:[A.characterName,":"]}),(0,v.jsx)("div",{className:"whitespace-pre-wrap break-words",children:wl(A.content)})]})]})},A.id)})}),c&&!t.isInitialStoryGenerated&&(0,v.jsxs)("div",{className:"sticky bottom-0 left-0 right-0 p-3 bg-slate-200/80 dark:bg-slate-700/80 backdrop-blur-sm rounded-b-xl text-center text-sm font-semibold",children:[(0,v.jsx)("i",{className:"fas fa-brain fa-spin mr-2"}),"AI \u0111ang kh\u1EDFi t\u1EA1o th\u1EBF gi\u1EDBi... Xin ch\u1EDD trong gi\xE2y l\xE1t..."]})]}),!g&&(0,v.jsxs)("div",{className:"flex-shrink-0 w-full sm:w-2/5 xl:w-1/3 p-3 sm:p-4 bg-white/70 dark:bg-slate-800/70 backdrop-blur-sm rounded-xl shadow-lg flex flex-col overflow-y-auto custom-scrollbar",children:[(0,v.jsx)(av,{choices:t.currentChoices,onChooseAction:ae,isLoadingAI:c,isRoleplayModeActive:t.isRoleplayModeActive,isAuthorInterventionModeActive:t.isAuthorInterventionModeActive,toggleRoleplayMode:zn,toggleAuthorInterventionMode:ur,isMobile:!1}),c&&t.isInitialStoryGenerated&&(0,v.jsxs)("div",{className:"flex-shrink-0 p-2.5 bg-slate-200/80 dark:bg-slate-700/80 backdrop-blur-sm text-center text-xs font-semibold border-t border-border-light dark:border-border-dark mt-auto",children:[(0,v.jsx)("i",{className:"fas fa-spinner fa-spin mr-2"}),"AI \u0111ang x\u1EED l\xFD..."]})]})]}),g&&(0,v.jsx)("footer",{className:"fixed bottom-0 left-0 right-0 flex-shrink-0 bg-white/90 dark:bg-slate-800/90 backdrop-blur-md shadow-top-strong p-1 border-t border-border-light dark:border-border-dark z-30",children:(0,v.jsx)("div",{className:"mx-auto flex justify-around items-center flex-nowrap overflow-x-auto no-scrollbar",children:dr.map(A=>(0,v.jsxs)(U,{onClick:()=>m(A.id),variant:h===A.id?"primary":"ghost",size:"sm",className:"!px-1.5 !py-2 !text-xs whitespace-nowrap flex flex-col items-center h-14 min-w-[55px] flex-1 relative",title:A.label,children:[(0,v.jsx)("i",{className:`${A.icon} text-lg mb-0.5`}),(0,v.jsx)("span",{className:"text-[10px]",children:A.label})]},A.id))})}),h&&h!=="actions"&&(0,v.jsx)(Pe,{isOpen:!!h,onClose:()=>m(null),title:dr.find(A=>A.id===h)?.label||"B\u1EA3ng Th\xF4ng Tin",size:g?"full":"xl",children:(0,v.jsxs)("div",{className:`${g?"pb-16":""}`,children:[" ",dr.find(A=>A.id===h)?.component]})}),g&&(0,v.jsxs)(ov,{isOpen:h==="actions",onClose:()=>m(null),title:"H\xE0nh \u0110\u1ED9ng C\u1EE7a B\u1EA1n",children:[(0,v.jsx)(av,{choices:t.currentChoices,onChooseAction:A=>{ae(A),m(null)},isLoadingAI:c,isRoleplayModeActive:t.isRoleplayModeActive,isAuthorInterventionModeActive:t.isAuthorInterventionModeActive,toggleRoleplayMode:zn,toggleAuthorInterventionMode:ur,isMobile:!0}),c&&t.isInitialStoryGenerated&&(0,v.jsxs)("div",{className:"flex-shrink-0 p-2 bg-slate-200/80 dark:bg-slate-700/80 text-center text-xs font-semibold mt-2 rounded",children:[(0,v.jsx)("i",{className:"fas fa-spinner fa-spin mr-2"}),"AI \u0111ang x\u1EED l\xFD..."]})]}),x&&(0,v.jsxs)("div",{ref:V,id:"keyword-tooltip",role:"tooltip",className:"fixed z-[250] p-2 text-xs text-white bg-slate-800/90 dark:bg-slate-900/95 rounded-md shadow-xl max-w-xs transition-opacity duration-100 backdrop-blur-sm animate-tooltipFadeIn",style:{left:`${x.x}px`,top:`${x.y}px`,transform:"translate(-50%, -100%) translateY(-8px)",opacity:1},onMouseEnter:()=>{I.current&&clearTimeout(I.current)},onMouseLeave:cr,children:[x.content,(0,v.jsx)("div",{className:"absolute left-1/2 bottom-0 w-2 h-2 bg-slate-800/90 dark:bg-slate-900/95 transform -translate-x-1/2 translate-y-1/2 rotate-45"})]})]})};var oo=H(ke(),1);var cv=H(ke(),1),Bn=H(ee(),1),xA=cv.default.memo(({label:t,id:e,error:n,className:i="",wrapperClass:r="",leftIcon:o,rightIcon:a,...u})=>{let c=`block w-full px-3 py-2.5 border rounded-lg shadow-sm focus:outline-none sm:text-sm 
                     transition-colors duration-200 ease-in-out bg-transparent`,d=`border-gray-300 dark:border-gray-600 
                       text-gray-900 dark:text-gray-100 
                       focus:ring-2 focus:ring-primary/60 focus:border-primary 
                       dark:focus:ring-primary-light/60 dark:focus:border-primary-light 
                       placeholder-gray-400 dark:placeholder-gray-500`,f=`border-red-500 text-red-600 focus:ring-2 focus:ring-red-500/50 focus:border-red-500
                      placeholder-red-400 dark:placeholder-red-500`,h=!!o,m=!!a;return(0,Bn.jsxs)("div",{className:`mb-4 ${r}`,children:[t&&(0,Bn.jsx)("label",{htmlFor:e,className:"block text-sm font-medium text-text-light dark:text-text-dark mb-1.5",children:t}),(0,Bn.jsxs)("div",{className:"relative",children:[h&&(0,Bn.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400 dark:text-gray-500",children:o}),(0,Bn.jsx)("input",{id:e,className:`${c} ${n?f:d} ${h?"pl-10":""} ${m?"pr-10":""} ${i}`,...u}),m&&(0,Bn.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 dark:text-gray-500",children:a})]}),n&&(0,Bn.jsx)("p",{className:"mt-1.5 text-xs text-red-500 dark:text-red-400",children:n})]})}),Ye=xA;var dv=H(ke(),1),qn=H(ee(),1),TA=dv.default.memo(({label:t,id:e,checked:n,onChange:i,className:r="",wrapperClass:o="",description:a,...u})=>(0,qn.jsx)("div",{className:`mb-3 ${o}`,children:(0,qn.jsxs)("div",{className:"flex items-start",children:[(0,qn.jsx)("div",{className:"flex items-center h-5 mt-0.5",children:(0,qn.jsx)("input",{id:e,type:"checkbox",checked:n,onChange:i,className:`h-5 w-5 text-primary dark:text-primary-light border-gray-300 dark:border-gray-600 rounded 
                        focus:ring-2 focus:ring-offset-0 focus:ring-primary dark:focus:ring-primary-light 
                        transition duration-150 ease-in-out cursor-pointer ${r}`,...u})}),(0,qn.jsxs)("div",{className:"ml-2.5 text-sm",children:[(0,qn.jsx)("label",{htmlFor:e,className:"font-medium text-text-light dark:text-text-dark cursor-pointer",children:t}),a&&(0,qn.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:a})]})]})})),Si=TA;var Le=H(ee(),1),CA=({onClose:t})=>{let{settings:e,setSettings:n,userApiKey:i,setUserApiKey:r,validateAndSaveApiKey:o}=tt(),[a,u]=(0,oo.useState)(i),[c,d]=(0,oo.useState)(!1),[f,h]=(0,oo.useState)("idle");(0,oo.useEffect)(()=>{u(i)},[i]);let m=async()=>{if(e.useDefaultAPI){t();return}if(!a.trim()){h("error"),n(T=>({...T,apiKeyStatus:"invalid"}));return}d(!0),h("idle"),await tv(a)?(await o(a),h("success"),setTimeout(t,1200)):(h("error"),n(T=>({...T,apiKeyStatus:"invalid"}))),d(!1)},y=p=>{n(T=>({...T,useDefaultAPI:p,apiKeyStatus:p?"default":i?T.apiKeyStatus:"unknown"})),p&&(h("idle"),u(""))};return(0,Le.jsxs)(Pe,{isOpen:!0,onClose:t,title:"Thi\u1EBFt L\u1EADp API Key Gemini",children:[(0,Le.jsxs)("div",{className:"space-y-5",children:[(0,Le.jsx)("div",{className:`p-4 rounded-lg border transition-all duration-200 ease-in-out ${e.useDefaultAPI?"bg-primary/10 border-primary/50 dark:bg-primary-dark/20 dark:border-primary-dark/60":"bg-slate-50 dark:bg-slate-800/30 border-border-light dark:border-border-dark"}`,children:(0,Le.jsx)(Si,{label:"S\u1EED d\u1EE5ng API Key m\u1EB7c \u0111\u1ECBnh c\u1EE7a \u1EE9ng d\u1EE5ng",description:"Gemini Flash, kh\xF4ng gi\u1EDBi h\u1EA1n. Khuy\u1EBFn ngh\u1ECB cho ng\u01B0\u1EDDi m\u1EDBi.",checked:e.useDefaultAPI,onChange:p=>y(p.target.checked)})}),(0,Le.jsxs)("div",{className:`transition-all duration-300 ease-in-out ${e.useDefaultAPI?"opacity-50 max-h-0 overflow-hidden pointer-events-none":"opacity-100 max-h-[500px]"}`,children:[(0,Le.jsx)("h4",{className:"text-sm font-medium text-text-light dark:text-text-dark mb-2",children:"Ho\u1EB7c s\u1EED d\u1EE5ng API Key Gemini c\u1EE7a ri\xEAng b\u1EA1n:"}),(0,Le.jsx)(Ye,{label:"API Key Gemini:",type:"password",value:a,onChange:p=>{u(p.target.value),h("idle"),e.apiKeyStatus!=="unknown"&&e.apiKeyStatus!=="default"&&n(T=>({...T,apiKeyStatus:"unknown"}))},placeholder:"D\xE1n API Key c\u1EE7a b\u1EA1n t\u1EA1i \u0111\xE2y (v\xED d\u1EE5: AIza...)",disabled:c||e.useDefaultAPI,leftIcon:(0,Le.jsx)("i",{className:"fas fa-key text-gray-400"})}),f==="success"&&(0,Le.jsxs)("p",{className:"text-sm text-green-600 dark:text-green-400 mt-1",children:[(0,Le.jsx)("i",{className:"fas fa-check-circle mr-1"}),"Key h\u1EE3p l\u1EC7 v\xE0 \u0111\xE3 \u0111\u01B0\u1EE3c l\u01B0u!"]}),f==="error"&&(0,Le.jsxs)("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:[(0,Le.jsx)("i",{className:"fas fa-times-circle mr-1"}),"Key kh\xF4ng h\u1EE3p l\u1EC7 ho\u1EB7c c\xF3 l\u1ED7i. Vui l\xF2ng ki\u1EC3m tra l\u1EA1i."]}),e.apiKeyStatus==="valid"&&!a&&!e.useDefaultAPI&&f==="idle"&&(0,Le.jsxs)("p",{className:"text-sm text-yellow-600 dark:text-yellow-400 mt-1",children:[(0,Le.jsx)("i",{className:"fas fa-exclamation-triangle mr-1"}),"B\u1EA1n \u0111\xE3 x\xF3a API key \u0111\xE3 l\u01B0u. Nh\u1EADp key m\u1EDBi ho\u1EB7c ch\u1ECDn s\u1EED d\u1EE5ng key m\u1EB7c \u0111\u1ECBnh."]}),(0,Le.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:["L\u1EA5y API Key c\u1EE7a b\u1EA1n t\u1EA1i: ",(0,Le.jsx)("a",{href:rs,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline font-medium",children:rs})]})]}),e.useDefaultAPI&&(0,Le.jsx)("div",{className:"p-3 bg-green-50 dark:bg-green-900/40 border border-green-200 dark:border-green-700/60 rounded-lg",children:(0,Le.jsxs)("p",{className:"text-sm text-green-700 dark:text-green-200",children:[(0,Le.jsx)("i",{className:"fas fa-info-circle mr-1.5"}),"API Key m\u1EB7c \u0111\u1ECBnh \u0111ang \u0111\u01B0\u1EE3c s\u1EED d\u1EE5ng. B\u1EA1n kh\xF4ng c\u1EA7n nh\u1EADp key ri\xEAng."]})})]}),(0,Le.jsxs)("div",{className:"mt-8 flex justify-end space-x-3",children:[(0,Le.jsx)(U,{variant:"outline",onClick:t,size:"md",children:"H\u1EE7y"}),(0,Le.jsx)(U,{onClick:m,isLoading:c,disabled:c||!e.useDefaultAPI&&!a.trim(),size:"md",variant:"primary",children:e.useDefaultAPI?"L\u01B0u & \u0110\xF3ng":c?"\u0110ang ki\u1EC3m tra...":"Ki\u1EC3m tra & L\u01B0u Key"})]})]})},fv=CA;var Xd=H(ke(),1);var hv=H(ke(),1),un=H(ee(),1),kA=hv.default.memo(({name:t,options:e,selectedValue:n,onChange:i,label:r,inline:o=!1,wrapperClass:a=""})=>(0,un.jsxs)("div",{className:`mb-4 ${a}`,children:[r&&(0,un.jsx)("legend",{className:"block text-sm font-medium text-text-light dark:text-text-dark mb-1.5",children:r}),(0,un.jsx)("div",{className:`${o?"flex flex-wrap items-center gap-x-4 gap-y-2":"space-y-2"}`,children:e.map(u=>(0,un.jsxs)("div",{className:"flex items-start ",children:[(0,un.jsx)("div",{className:"flex items-center h-5 mt-0.5",children:(0,un.jsx)("input",{id:`${t}-${u.value}`,name:t,type:"radio",value:u.value,checked:n===u.value,onChange:c=>i(c.target.value),className:`h-5 w-5 text-primary dark:text-primary-light border-gray-300 dark:border-gray-600 
                            focus:ring-2 focus:ring-offset-0 focus:ring-primary dark:focus:ring-primary-light 
                            transition duration-150 ease-in-out cursor-pointer`})}),(0,un.jsxs)("div",{className:"ml-2.5 text-sm",children:[(0,un.jsx)("label",{htmlFor:`${t}-${u.value}`,className:"font-medium text-text-light dark:text-text-dark cursor-pointer",children:u.label}),u.description&&(0,un.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:u.description})]})]},u.value))})]})),Sl=kA;var Ie=H(ee(),1),SA=({onClose:t})=>{let{nsfwSettings:e,setNsfwSettings:n}=tt(),[i,r]=(0,Xd.useState)(!e.enabled),[o,a]=(0,Xd.useState)({...e,customPrompt:e.customPrompt||""}),u=()=>{n(o),t()},c=()=>{r(!1),o.enabled||a(f=>({...f,enabled:!0,eroticaLevel:f.eroticaLevel==="none"?"medium":f.eroticaLevel,violenceLevel:f.violenceLevel==="none"?"medium":f.violenceLevel,darkContentLevel:f.darkContentLevel==="none"?"medium":f.darkContentLevel,customPrompt:f.customPrompt||""}))},d=[{value:"none",label:"T\u1EAFt Ho\xE0n To\xE0n",description:"Kh\xF4ng c\xF3 n\u1ED9i dung nh\u1EA1y c\u1EA3m."},{value:"medium",label:"Trung B\xECnh",description:"M\xF4 t\u1EA3 g\u1EE3i \xFD, kh\xF4ng \u0111i s\xE2u chi ti\u1EBFt."},{value:"high",label:"Cao",description:"M\xF4 t\u1EA3 chi ti\u1EBFt h\u01A1n, c\xF3 th\u1EC3 bao g\u1ED3m h\xE0nh \u0111\u1ED9ng."},{value:"extreme",label:"C\u1EF1c \u0110oan",description:"M\xF4 t\u1EA3 r\u1EA5t chi ti\u1EBFt, kh\xF4ng gi\u1EDBi h\u1EA1n (c\u1EA9n tr\u1ECDng khi s\u1EED d\u1EE5ng)."}];return i&&!e.enabled?(0,Ie.jsxs)(Pe,{isOpen:!0,onClose:t,title:"C\u1EA3nh B\xE1o N\u1ED9i Dung Nh\u1EA1y C\u1EA3m",size:"lg",children:[(0,Ie.jsxs)("div",{className:"text-center p-4",children:[(0,Ie.jsx)("i",{className:"fas fa-exclamation-triangle text-5xl text-yellow-500 dark:text-yellow-400 mb-5"}),(0,Ie.jsx)("p",{className:"text-lg font-semibold mb-3 text-text-light dark:text-text-dark",children:"N\u1ED9i dung b\u1EA1n s\u1EAFp t\xF9y ch\u1EC9nh c\xF3 th\u1EC3 kh\xF4ng ph\xF9 h\u1EE3p v\u1EDBi m\u1ECDi l\u1EE9a tu\u1ED5i ho\u1EB7c ch\u1EE9a c\xE1c y\u1EBFu t\u1ED1 nh\u1EA1y c\u1EA3m, g\xE2y kh\xF3 ch\u1ECBu."}),(0,Ie.jsx)("p",{className:"mb-6 text-slate-600 dark:text-slate-300",children:"B\u1EA1n c\xF3 ch\u1EAFc ch\u1EAFn mu\u1ED1n ti\u1EBFp t\u1EE5c v\xE0 c\u1EA5u h\xECnh c\xE1c t\xF9y ch\u1ECDn n\u1ED9i dung ng\u01B0\u1EDDi l\u1EDBn (NSFW) kh\xF4ng? H\xE3y c\xE2n nh\u1EAFc k\u1EF9 tr\u01B0\u1EDBc khi quy\u1EBFt \u0111\u1ECBnh."})]}),(0,Ie.jsxs)("div",{className:"mt-6 flex justify-center space-x-4",children:[(0,Ie.jsx)(U,{variant:"outline",onClick:t,size:"lg",children:"H\u1EE7y B\u1ECF"}),(0,Ie.jsx)(U,{variant:"danger",onClick:c,size:"lg",children:"T\xF4i Hi\u1EC3u & \u0110\u1ED3ng \xDD Ti\u1EBFp T\u1EE5c"})]})]}):(0,Ie.jsxs)(Pe,{isOpen:!0,onClose:t,title:"Thi\u1EBFt L\u1EADp Ch\u1EBF \u0110\u1ED9 N\u1ED9i Dung Ng\u01B0\u1EDDi L\u1EDBn (NSFW)",size:"xl",children:[(0,Ie.jsxs)("div",{className:"space-y-6",children:[(0,Ie.jsx)("div",{className:`p-4 rounded-lg border transition-all duration-200 ease-in-out ${o.enabled?"bg-red-50 dark:bg-red-900/30 border-red-300 dark:border-red-600":"bg-slate-50 dark:bg-slate-800/30 border-border-light dark:border-border-dark"}`,children:(0,Ie.jsx)(Si,{label:"B\u1EADt Ch\u1EBF \u0110\u1ED9 NSFW T\u1ED5ng Th\u1EC3",description:"Cho ph\xE9p AI t\u1EA1o ra n\u1ED9i dung nh\u1EA1y c\u1EA3m khi ph\xF9 h\u1EE3p v\u1EDBi di\u1EC5n bi\u1EBFn truy\u1EC7n.",checked:o.enabled,onChange:f=>a(h=>({...h,enabled:f.target.checked}))})}),o.enabled&&(0,Ie.jsxs)("div",{className:"space-y-5 pl-2 border-l-2 border-red-300 dark:border-red-600 ml-2",children:[(0,Ie.jsx)(Sl,{label:"M\u1EE9c \u0111\u1ED9 Khi\xEAu D\xE2m:",name:"eroticaLevel",options:d,selectedValue:o.eroticaLevel,onChange:f=>a(h=>({...h,eroticaLevel:f})),wrapperClass:"p-3 bg-slate-50 dark:bg-slate-800/40 rounded-md"}),(0,Ie.jsx)(Sl,{label:"M\u1EE9c \u0111\u1ED9 B\u1EA1o L\u1EF1c:",name:"violenceLevel",options:d,selectedValue:o.violenceLevel,onChange:f=>a(h=>({...h,violenceLevel:f})),wrapperClass:"p-3 bg-slate-50 dark:bg-slate-800/40 rounded-md"}),(0,Ie.jsx)(Sl,{label:"M\u1EE9c \u0111\u1ED9 N\u1ED9i Dung \u0110en T\u1ED1i (Ch\u1EE7 \u0111\u1EC1 nh\u1EA1y c\u1EA3m, t\xE2m l\xFD n\u1EB7ng n\u1EC1):",name:"darkContentLevel",options:d,selectedValue:o.darkContentLevel,onChange:f=>a(h=>({...h,darkContentLevel:f})),wrapperClass:"p-3 bg-slate-50 dark:bg-slate-800/40 rounded-md"}),(0,Ie.jsx)(Nt,{label:"Phong c\xE1ch NSFW t\xF9y ch\u1EC9nh (T\xF9y ch\u1ECDn):",value:o.customPrompt||"",onChange:f=>a(h=>({...h,customPrompt:f.target.value})),placeholder:"V\xED d\u1EE5: T\u1EADp trung v\xE0o m\xF4 t\u1EA3 chi ti\u1EBFt c\u1EA3m x\xFAc v\xE0 b\u1EA7u kh\xF4ng kh\xED c\u0103ng th\u1EB3ng, s\u1EED d\u1EE5ng ng\xF4n ng\u1EEF g\u1EE3i h\xECnh nh\u01B0ng kh\xF4ng dung t\u1EE5c...",rows:3,wrapperClass:"mt-4 p-3 bg-slate-50 dark:bg-slate-800/40 rounded-md"})]}),(0,Ie.jsx)("div",{className:"mt-5 p-3 bg-yellow-50 dark:bg-yellow-900/50 border border-yellow-300 dark:border-yellow-700 rounded-lg text-yellow-700 dark:text-yellow-200",children:(0,Ie.jsxs)("p",{className:"text-xs",children:[(0,Ie.jsxs)("strong",{className:"font-semibold",children:[(0,Ie.jsx)("i",{className:"fas fa-exclamation-circle mr-1"}),"L\u01B0u \xFD quan tr\u1ECDng:"]})," Vi\u1EC7c b\u1EADt c\xE1c t\xF9y ch\u1ECDn n\xE0y cho ph\xE9p AI t\u1EA1o ra n\u1ED9i dung li\xEAn quan KHI PH\xD9 H\u1EE2P v\u1EDBi di\u1EC5n bi\u1EBFn truy\u1EC7n. AI s\u1EBD kh\xF4ng c\u1ED1 t\xECnh l\xE1i truy\u1EC7n theo h\u01B0\u1EDBng NSFW m\u1ED9t c\xE1ch g\u01B0\u1EE3ng \xE9p. Ch\u1EA5t l\u01B0\u1EE3ng v\xE0 s\u1EF1 ph\xF9 h\u1EE3p c\u1EE7a n\u1ED9i dung NSFW ph\u1EE5 thu\u1ED9c v\xE0o kh\u1EA3 n\u0103ng c\u1EE7a m\xF4 h\xECnh AI v\xE0 c\xF3 th\u1EC3 kh\xF4ng ph\u1EA3i l\xFAc n\xE0o c\u0169ng nh\u01B0 mong \u0111\u1EE3i. S\u1EED d\u1EE5ng c\xF3 tr\xE1ch nhi\u1EC7m."]})})]}),(0,Ie.jsxs)("div",{className:"mt-8 flex justify-end space-x-3",children:[(0,Ie.jsx)(U,{variant:"outline",onClick:t,size:"lg",children:"H\u1EE7y"}),(0,Ie.jsx)(U,{onClick:u,size:"lg",variant:"primary",children:"L\u01B0u Thi\u1EBFt L\u1EADp NSFW"})]})]})},mv=SA;var gv=H(ke(),1);var pv=H(ke(),1),_i=H(ee(),1),_A=pv.default.memo(({label:t,id:e,options:n,error:i,className:r="",wrapperClass:o="",...a})=>(0,_i.jsxs)("div",{className:`mb-4 ${o}`,children:[t&&(0,_i.jsx)("label",{htmlFor:e,className:"block text-sm font-medium text-text-light dark:text-text-dark mb-1.5",children:t}),(0,_i.jsxs)("select",{id:e,className:`block w-full px-3 py-2.5 border rounded-lg shadow-sm focus:outline-none sm:text-sm 
                     appearance-none bg-no-repeat bg-right 
                     transition-colors duration-200 ease-in-out bg-transparent bg-[url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2020%2020%22%20fill%3D%22currentColor%22%3E%3Cpath%20fill-rule%3D%22evenodd%22%20d%3D%22M10%2012.586l-4.293-4.293a1%201%200%2010-1.414%201.414l5%205a1%201%200%20001.414%200l5-5a1%201%200%2000-1.414-1.414L10%2012.586z%22%20clip-rule%3D%22evenodd%22%2F%3E%3C%2Fsvg%3E')] dark:bg-[url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2020%2020%22%20fill%3D%22%23f3f4f6%22%3E%3Cpath%20fill-rule%3D%22evenodd%22%20d%3D%22M10%2012.586l-4.293-4.293a1%201%200%2010-1.414%201.414l5%205a1%201%200%20001.414%200l5-5a1%201%200%2000-1.414-1.414L10%2012.586z%22%20clip-rule%3D%22evenodd%22%2F%3E%3C%2Fsvg%3E')] bg-[length:1.25em_1.25em] bg-[center_right_0.75rem] pr-8 ${i?`border-red-500 text-red-600 focus:ring-2 focus:ring-red-500/50 focus:border-red-500
                      placeholder-red-400 dark:placeholder-red-500`:`border-gray-300 dark:border-gray-600 
                       text-gray-900 dark:text-gray-100 
                       focus:ring-2 focus:ring-primary/60 focus:border-primary 
                       dark:focus:ring-primary-light/60 dark:focus:border-primary-light
                       placeholder-gray-400 dark:placeholder-gray-500`} ${r}`,...a,children:[a.placeholder&&(0,_i.jsx)("option",{value:"",disabled:!0,className:"text-gray-400 dark:text-gray-500",children:a.placeholder}),n.map(h=>(0,_i.jsx)("option",{value:h.value,className:"text-text-light dark:text-text-dark bg-card-light dark:bg-card-dark",children:h.label},h.value))]}),i&&(0,_i.jsx)("p",{className:"mt-1.5 text-xs text-red-500 dark:text-red-400",children:i})]})),Wt=_A;var ft=H(ee(),1),NA=({onClose:t})=>{let{settings:e,setSettings:n}=tt(),[i,r]=(0,gv.useState)(e),o=()=>{n(i),t()},a=[{value:"light",label:"S\xE1ng (Light Mode)"},{value:"dark",label:"T\u1ED1i (Dark Mode)"}],u=[{value:"vi",label:"Ti\u1EBFng Vi\u1EC7t (M\u1EB7c \u0111\u1ECBnh)"}],c=[{value:12,label:"Nh\u1ECF (12px)"},{value:14,label:"V\u1EEBa (14px)"},{value:16,label:"M\u1EB7c \u0111\u1ECBnh (16px)"},{value:18,label:"L\u1EDBn (18px)"},{value:20,label:"R\u1EA5t L\u1EDBn (20px)"}];return(0,ft.jsxs)(Pe,{isOpen:!0,onClose:t,title:"C\xE0i \u0110\u1EB7t Chung",size:"lg",children:[(0,ft.jsxs)("div",{className:"space-y-6 pt-2",children:[(0,ft.jsx)(Wt,{label:"Ch\u1EE7 \u0111\u1EC1 giao di\u1EC7n (Theme):",options:a,value:i.theme,onChange:d=>r(f=>({...f,theme:d.target.value})),wrapperClass:"mb-5"}),(0,ft.jsx)(Wt,{label:"Ng\xF4n ng\u1EEF (Language):",options:u,value:i.language,onChange:d=>r(f=>({...f,language:d.target.value})),disabled:!0,wrapperClass:"mb-5 opacity-70"}),(0,ft.jsx)(Wt,{label:"K\xEDch th\u01B0\u1EDBc font ch\u1EEF m\u1EB7c \u0111\u1ECBnh:",options:c,value:i.fontSize.toString(),onChange:d=>r(f=>({...f,fontSize:parseInt(d.target.value,10)})),wrapperClass:"mb-2"}),(0,ft.jsx)("p",{className:"text-xs text-slate-500 dark:text-slate-400 px-1",children:"Thay \u0111\u1ED5i k\xEDch th\u01B0\u1EDBc font s\u1EBD \u1EA3nh h\u01B0\u1EDFng \u0111\u1EBFn to\xE0n b\u1ED9 \u1EE9ng d\u1EE5ng. M\u1ED9t s\u1ED1 thay \u0111\u1ED5i c\xF3 th\u1EC3 c\u1EA7n t\u1EA3i l\u1EA1i trang \u0111\u1EC3 \xE1p d\u1EE5ng ho\xE0n to\xE0n."}),(0,ft.jsx)("hr",{className:"my-5 border-border-light dark:border-border-dark"}),(0,ft.jsx)("h4",{className:"text-md font-semibold text-text-light dark:text-text-dark -mb-3",children:"H\u1EC7 Th\u1ED1ng Gameplay T\xF9y Ch\u1ECDn:"}),(0,ft.jsx)(Si,{label:"B\u1EADt H\u1EC7 Th\u1ED1ng Ti\u1EC1n T\u1EC7",description:"Qu\u1EA3n l\xFD ti\u1EC1n t\u1EC7 trong game (v\xED d\u1EE5: v\xE0ng, linh th\u1EA1ch). AI s\u1EBD t\u1EA1o v\xE0 theo d\xF5i.",checked:i.currencyEnabled,onChange:d=>r(f=>({...f,currencyEnabled:d.target.checked})),wrapperClass:"py-2.5"}),(0,ft.jsx)(Si,{label:"B\u1EADt H\u1EC7 Th\u1ED1ng Th\u1EDDi Gian",description:"Theo d\xF5i th\u1EDDi gian trong game (ng\xE0y, gi\u1EDD, bu\u1ED5i). AI s\u1EBD c\u1EADp nh\u1EADt d\u1EF1a tr\xEAn h\xE0nh \u0111\u1ED9ng.",checked:i.timeSystemEnabled,onChange:d=>r(f=>({...f,timeSystemEnabled:d.target.checked})),wrapperClass:"py-2.5"}),(0,ft.jsx)(Si,{label:"B\u1EADt H\u1EC7 Th\u1ED1ng Danh Ti\u1EBFng (Ng\u1EA7m)",description:"AI s\u1EBD ng\u1EA7m theo d\xF5i danh ti\u1EBFng c\u1EE7a b\u1EA1n, \u1EA3nh h\u01B0\u1EDFng \u0111\u1EBFn c\xE1ch NPC ph\u1EA3n \u1EE9ng v\xE0 di\u1EC5n bi\u1EBFn truy\u1EC7n.",checked:i.reputationSystemEnabled,onChange:d=>r(f=>({...f,reputationSystemEnabled:d.target.checked})),wrapperClass:"py-2.5"})]}),(0,ft.jsxs)("div",{className:"mt-8 flex justify-end space-x-3",children:[(0,ft.jsx)(U,{variant:"outline",onClick:t,size:"lg",children:"H\u1EE7y"}),(0,ft.jsx)(U,{onClick:o,size:"lg",variant:"primary",children:"L\u01B0u C\xE0i \u0110\u1EB7t"})]})]})},yv=NA;var E=H(ee(),1),ys=({title:t,icon:e,children:n})=>(0,E.jsxs)("section",{className:"py-3",children:[(0,E.jsxs)("h4",{className:"font-semibold text-xl lg:text-2xl border-b border-border-light dark:border-border-dark pb-2 mb-4 text-primary dark:text-primary-light flex items-center",children:[(0,E.jsx)("i",{className:`${e} mr-3 text-2xl opacity-80`}),t]}),(0,E.jsx)("div",{className:"space-y-3 prose prose-sm sm:prose-base dark:prose-invert max-w-none text-text-light dark:text-text-dark leading-relaxed",children:n})]}),wA=({onClose:t})=>(0,E.jsxs)(Pe,{isOpen:!0,onClose:t,title:"H\u01B0\u1EDBng D\u1EABn S\u1EED D\u1EE5ng Nh\u1EADp Vai A.I Simulator",size:"2xl",containerClass:"custom-scrollbar",children:[(0,E.jsxs)("div",{className:"space-y-6",children:[(0,E.jsxs)("p",{className:"text-lg text-center text-slate-700 dark:text-slate-300",children:["Ch\xE0o m\u1EEBng b\u1EA1n \u0111\u1EBFn v\u1EDBi ",(0,E.jsx)("strong",{children:"Nh\u1EADp Vai A.I Simulator"}),"! H\xE3y c\xF9ng kh\xE1m ph\xE1 c\xE1ch t\u1EA1o n\xEAn nh\u1EEFng cu\u1ED9c phi\xEAu l\u01B0u k\u1EF3 th\xFA kh\xF4ng gi\u1EDBi h\u1EA1n:"]}),(0,E.jsxs)(ys,{title:"1. Chu\u1EA9n B\u1ECB API Key (R\u1EA5t Quan Tr\u1ECDng!)",icon:"fas fa-key",children:[(0,E.jsx)("p",{children:'\u0110\u1EC3 AI c\xF3 th\u1EC3 "th\u1ED5i h\u1ED3n" v\xE0o c\xE2u chuy\u1EC7n, b\u1EA1n c\u1EA7n m\u1ED9t API Key t\u1EEB Google Gemini.'}),(0,E.jsxs)("ul",{className:"list-disc list-inside ml-2 space-y-2",children:[(0,E.jsxs)("li",{children:["Tr\xEAn trang ch\u1EE7, ch\u1ECDn ",(0,E.jsx)("strong",{className:"text-secondary dark:text-secondary-light",children:'"Thi\u1EBFt L\u1EADp API Key"'}),"."]}),(0,E.jsxs)("li",{children:[(0,E.jsx)("strong",{children:"L\u1EF1a ch\u1ECDn t\u1ED1t nh\u1EA5t cho ng\u01B0\u1EDDi m\u1EDBi:"})," \u0110\xE1nh d\u1EA5u v\xE0o \xF4 ",(0,E.jsx)("strong",{className:"text-green-600 dark:text-green-400",children:'"S\u1EED d\u1EE5ng API Key m\u1EB7c \u0111\u1ECBnh c\u1EE7a \u1EE9ng d\u1EE5ng"'}),'. T\xF9y ch\u1ECDn n\xE0y s\u1EED d\u1EE5ng m\xF4 h\xECnh Gemini Flash m\u1EA1nh m\u1EBD v\xE0 kh\xF4ng gi\u1EDBi h\u1EA1n, do \u1EE9ng d\u1EE5ng cung c\u1EA5p. Nh\u1EA5n "L\u01B0u & \u0110\xF3ng".']}),(0,E.jsxs)("li",{children:[(0,E.jsx)("strong",{children:"N\u1EBFu b\u1EA1n c\xF3 API Key ri\xEAng:"})," B\u1ECF ch\u1ECDn \xF4 m\u1EB7c \u0111\u1ECBnh, d\xE1n Key c\u1EE7a b\u1EA1n v\xE0o \xF4 nh\u1EADp li\u1EC7u v\xE0 nh\u1EA5n ",(0,E.jsx)("strong",{className:"text-blue-600 dark:text-blue-400",children:'"Ki\u1EC3m tra & L\u01B0u Key"'}),". B\u1EA1n c\xF3 th\u1EC3 l\u1EA5y Key t\u1EA1i ",(0,E.jsx)("a",{href:rs,target:"_blank",rel:"noopener noreferrer",className:"text-secondary dark:text-secondary-light hover:underline font-medium",children:"Google AI Studio"}),"."]}),(0,E.jsx)("li",{children:"Key h\u1EE3p l\u1EC7 s\u1EBD \u0111\u01B0\u1EE3c l\u01B0u, v\xE0 b\u1EA1n \u0111\xE3 s\u1EB5n s\xE0ng!"})]})]}),(0,E.jsxs)(ys,{title:"2. Kh\u1EDFi T\u1EA1o Cu\u1ED9c Phi\xEAu L\u01B0u M\u1EDBi",icon:"fas fa-feather-alt",children:[(0,E.jsxs)("p",{children:["Ch\u1ECDn ",(0,E.jsx)("strong",{className:"text-secondary dark:text-secondary-light",children:'"B\u1EAFt \u0110\u1EA7u Kh\u1EDFi T\u1EA1o M\u1EDBi"'})," tr\xEAn trang ch\u1EE7. B\u1EA1n s\u1EBD th\u1EA5y 3 c\xE1ch ch\xEDnh \u0111\u1EC3 b\u1EAFt \u0111\u1EA7u:"]}),(0,E.jsxs)("div",{className:"space-y-4 pl-2",children:[(0,E.jsxs)("div",{children:[(0,E.jsxs)("h5",{className:"font-semibold text-lg text-purple-600 dark:text-purple-400 flex items-center",children:[(0,E.jsx)("i",{className:"fas fa-dice-d20 mr-2 opacity-80"}),"A.I Kh\u1EDFi T\u1EA1o Ng\u1EABu Nhi\xEAn (Nhanh & \u0110\u1ED3 S\u1ED9)"]}),(0,E.jsxs)("ul",{className:"list-disc list-inside ml-5 space-y-1.5 mt-1",children:[(0,E.jsxs)("li",{children:["Nh\u1EADp m\u1ED9t ",(0,E.jsx)("code",{className:"font-mono bg-slate-200 dark:bg-slate-700 px-1.5 py-0.5 rounded-md text-sm",children:"Ch\u1EE7 \u0111\u1EC1 g\u1EE3i \xFD"}),' (v\xED d\u1EE5: "Ti\xEAn hi\u1EC7p b\xE1o th\xF9", "V\xF5ng du d\u1ECB gi\u1EDBi").']}),(0,E.jsxs)("li",{children:["Th\xEAm m\u1ED9t ",(0,E.jsx)("code",{className:"font-mono bg-slate-200 dark:bg-slate-700 px-1.5 py-0.5 rounded-md text-sm",children:"M\xF4 t\u1EA3 ng\u1EAFn"})," v\u1EC1 \xFD t\u01B0\u1EDFng ch\xEDnh c\u1EE7a b\u1EA1n (t\xF9y ch\u1ECDn)."]}),(0,E.jsxs)("li",{children:["Ch\u1ECDn ",(0,E.jsx)("code",{className:"font-mono bg-slate-200 dark:bg-slate-700 px-1.5 py-0.5 rounded-md text-sm",children:"S\u1ED1 l\u01B0\u1EE3ng th\u1EF1c th\u1EC3"})," AI c\u1EA7n t\u1EA1o (NPC, \u0111\u1ECBa \u0111i\u1EC3m, v\u1EADt ph\u1EA9m...)."]}),(0,E.jsxs)("li",{children:["Nh\u1EA5n ",(0,E.jsx)("strong",{className:"text-blue-600 dark:text-blue-400",children:'"\u0110\u1EC3 AI Kh\u1EDFi T\u1EA1o To\xE0n B\u1ED9 Th\u1EBF Gi\u1EDBi"'}),". AI s\u1EBD t\u1EA1o ra m\u1ED9t thi\u1EBFt l\u1EADp truy\u1EC7n C\u1EF0C K\u1EF2 chi ti\u1EBFt, \u0111\u1ED3 s\u1ED9 v\u1EDBi th\u1EBF gi\u1EDBi quan r\u1ED9ng l\u1EDBn."]}),(0,E.jsx)("li",{children:'Sau khi AI ho\xE0n t\u1EA5t, h\u1EC7 th\u1ED1ng s\u1EBD t\u1EF1 chuy\u1EC3n b\u1EA1n sang tab "Thi\u1EBFt L\u1EADp Th\u1EE7 C\xF4ng & Tinh Ch\u1EC9nh" \u0111\u1EC3 b\u1EA1n xem l\u1EA1i v\xE0 s\u1EEDa \u0111\u1ED5i n\u1EBFu mu\u1ED1n.'})]})]}),(0,E.jsxs)("div",{children:[(0,E.jsxs)("h5",{className:"font-semibold text-lg text-orange-600 dark:text-orange-400 flex items-center",children:[(0,E.jsx)("i",{className:"fas fa-wand-magic-sparkles mr-2 opacity-80"}),"AI Tr\xEDch Xu\u1EA5t T\u1EEB V\u0103n B\u1EA3n (Linh Ho\u1EA1t)"]}),(0,E.jsxs)("ul",{className:"list-disc list-inside ml-5 space-y-1.5 mt-1",children:[(0,E.jsx)("li",{children:"D\xE1n ho\u1EB7c vi\u1EBFt m\u1ED9t \u0111o\u1EA1n v\u0103n m\xF4 t\u1EA3 \xFD t\u01B0\u1EDFng t\u1ED5ng th\u1EC3 v\u1EC1 th\u1EBF gi\u1EDBi, nh\xE2n v\u1EADt, v\xE0 c\xE1c y\u1EBFu t\u1ED1 ban \u0111\u1EA7u v\xE0o \xF4 l\u1EDBn."}),(0,E.jsxs)("li",{children:["Nh\u1EA5n n\xFAt ",(0,E.jsx)("strong",{className:"text-blue-600 dark:text-blue-400",children:'"\u0110\u1EC3 AI Tr\xEDch Xu\u1EA5t Thi\u1EBFt L\u1EADp T\u1EEB M\xF4 T\u1EA3 Tr\xEAn"'}),'. AI s\u1EBD c\u1ED1 g\u1EAFng \u0111i\u1EC1n c\xE1c m\u1EE5c trong tab "Thi\u1EBFt L\u1EADp Th\u1EE7 C\xF4ng & Tinh Ch\u1EC9nh".']}),(0,E.jsx)("li",{children:'Ki\u1EC3m tra v\xE0 ch\u1EC9nh s\u1EEDa l\u1EA1i theo \xFD b\u1EA1n trong tab "Thi\u1EBFt L\u1EADp Th\u1EE7 C\xF4ng & Tinh Ch\u1EC9nh".'})]})]}),(0,E.jsxs)("div",{children:[(0,E.jsxs)("h5",{className:"font-semibold text-lg text-teal-600 dark:text-teal-400 flex items-center",children:[(0,E.jsx)("i",{className:"fas fa-tools mr-2 opacity-80"}),"Thi\u1EBFt L\u1EADp Th\u1EE7 C\xF4ng & Tinh Ch\u1EC9nh (To\xE0n Quy\u1EC1n Ki\u1EC3m So\xE1t)"]}),(0,E.jsxs)("ul",{className:"list-disc list-inside ml-5 space-y-1.5 mt-1",children:[(0,E.jsx)("li",{children:"\u0110\xE2y l\xE0 n\u01A1i b\u1EA1n c\xF3 th\u1EC3 t\u1EF1 tay x\xE2y d\u1EF1ng t\u1EEBng chi ti\u1EBFt ho\u1EB7c tinh ch\u1EC9nh nh\u1EEFng g\xEC AI \u0111\xE3 t\u1EA1o."}),(0,E.jsxs)("li",{children:[(0,E.jsx)("strong",{children:"B\u01B0\u1EDBc 1: Thi\u1EBFt L\u1EADp Th\u1EBF Gi\u1EDBi:"})," Nh\u1EADp ",(0,E.jsx)("em",{children:"Ch\u1EE7 \u0111\u1EC1, B\u1ED1i c\u1EA3nh, Phong c\xE1ch"}),". S\u1EED d\u1EE5ng n\xFAt ",(0,E.jsx)("strong",{className:"text-blue-500",children:"AI"})," b\xEAn c\u1EA1nh m\u1ED7i tr\u01B0\u1EDDng \u0111\u1EC3 AI g\u1EE3i \xFD n\u1EBFu b\u1EA1n b\xED \xFD t\u01B0\u1EDFng. ",(0,E.jsx)("em",{children:"Prompt N\xE2ng Cao"})," cho ph\xE9p b\u1EA1n th\xEAm c\xE1c quy t\u1EAFc, l\u1ECBch s\u1EED, ho\u1EB7c \u0111\u1EB7c \u0111i\u1EC3m ri\xEAng c\u1EE7a th\u1EBF gi\u1EDBi."]}),(0,E.jsxs)("li",{children:[(0,E.jsx)("strong",{children:"B\u01B0\u1EDBc 2: Thi\u1EBFt L\u1EADp Nh\xE2n V\u1EADt Ch\xEDnh:"})," T\u01B0\u01A1ng t\u1EF1, nh\u1EADp ",(0,E.jsx)("em",{children:"T\xEAn, Gi\u1EDBi t\xEDnh, S\u01A1 l\u01B0\u1EE3c, \u0110\u1EB7c \u0111i\u1EC3m, M\u1EE5c ti\xEAu"}),". N\xFAt ",(0,E.jsx)("strong",{className:"text-blue-500",children:"AI"})," c\u0169ng c\xF3 s\u1EB5n."]}),(0,E.jsxs)("li",{children:[(0,E.jsx)("strong",{children:"B\u01B0\u1EDBc 3: Th\u1EF1c Th\u1EC3 & K\u1EF9 N\u0103ng Ban \u0110\u1EA7u (T\xF9y ch\u1ECDn):"})," Th\xEAm NPC, v\u1EADt ph\u1EA9m, \u0111\u1ECBa \u0111i\u1EC3m, ho\u1EB7c k\u1EF9 n\u0103ng kh\u1EDFi \u0111\u1EA7u \u0111\u1EC3 l\xE0m phong ph\xFA th\xEAm cho c\xE2u chuy\u1EC7n. B\u1EA1n c\xF3 th\u1EC3 th\xEAm th\u1EE7 c\xF4ng ho\u1EB7c d\xF9ng AI g\u1EE3i \xFD."]})]})]})]}),(0,E.jsxs)("p",{className:"mt-3 pl-2",children:["Sau khi ho\xE0n t\u1EA5t thi\u1EBFt l\u1EADp (d\xF9 b\u1EB1ng c\xE1ch n\xE0o), \u0111\u1EB7t ",(0,E.jsx)("strong",{children:"T\xEAn Cu\u1ED9c Phi\xEAu L\u01B0u"}),' (v\xED d\u1EE5: "H\xE0nh Tr\xECnh Tu Ti\xEAn C\u1EE7a A") v\xE0 nh\u1EA5n ',(0,E.jsx)("strong",{className:"text-green-600 dark:text-green-400",children:'"Kh\u1EDFi T\u1EA1o Cu\u1ED9c Phi\xEAu L\u01B0u"'}),". AI s\u1EBD c\u1EA7n m\u1ED9t ch\xFAt th\u1EDDi gian \u0111\u1EC3 t\u1EA1o ra nh\u1EEFng d\xF2ng truy\u1EC7n \u0111\u1EA7u ti\xEAn."]})]}),(0,E.jsxs)(ys,{title:"3. Trong Game - Kh\xE1m Ph\xE1 & T\u01B0\u01A1ng T\xE1c",icon:"fas fa-gamepad",children:[(0,E.jsxs)("div",{className:"grid md:grid-cols-2 gap-x-8 gap-y-4",children:[(0,E.jsxs)("div",{children:[(0,E.jsxs)("h5",{className:"font-semibold text-lg mb-1.5 flex items-center",children:[(0,E.jsx)("i",{className:"fas fa-scroll mr-2 opacity-70"}),"Khu V\u1EF1c Ch\xEDnh (B\xEAn Tr\xE1i):"]}),(0,E.jsxs)("ul",{className:"list-disc list-inside ml-2 space-y-1.5",children:[(0,E.jsxs)("li",{children:[(0,E.jsx)("strong",{children:"N\u1ED9i Dung Truy\u1EC7n:"})," AI s\u1EBD k\u1EC3 chuy\u1EC7n, m\xF4 t\u1EA3 b\u1ED1i c\u1EA3nh, h\xE0nh \u0111\u1ED9ng NPC t\u1EA1i \u0111\xE2y. C\xE1c lo\u1EA1i tin nh\u1EAFn (h\u1EC7 th\u1ED1ng, l\u1EDDi tho\u1EA1i, t\u01B0\u1EDDng thu\u1EADt) s\u1EBD c\xF3 m\xE0u s\u1EAFc v\xE0 \u0111\u1ECBnh d\u1EA1ng kh\xE1c nhau \u0111\u1EC3 d\u1EC5 ph\xE2n bi\u1EC7t."]}),(0,E.jsxs)("li",{children:[(0,E.jsx)("strong",{children:"T\u01B0\u01A1ng t\xE1c v\u1EDBi t\u1EEB kh\xF3a (Tooltips):"})," Di chu\u1ED9t (ho\u1EB7c ch\u1EA1m v\xE0 gi\u1EEF tr\xEAn di \u0111\u1ED9ng, ho\u1EB7c d\xF9ng ph\xEDm ",(0,E.jsx)("kbd",{children:"Tab"})," \u0111\u1EC3 focus v\xE0 ",(0,E.jsx)("kbd",{children:"Enter"}),"/",(0,E.jsx)("kbd",{children:"Space"}),") v\xE0o c\xE1c t\u1EEB \u0111\u01B0\u1EE3c ",(0,E.jsx)("strong",{className:"text-primary dark:text-primary-light",children:"\u0111\xE1nh d\u1EA5u m\xE0u"})," (v\xED d\u1EE5: ",(0,E.jsx)("span",{className:"text-teal-600 dark:text-teal-400 font-semibold",children:"[NPC:T\xEAn NPC]"}),", ",(0,E.jsx)("span",{className:"text-orange-600 dark:text-orange-400 font-semibold",children:"[ITEM:T\xEAn V\u1EADt Ph\u1EA9m]"}),") \u0111\u1EC3 xem th\xF4ng tin chi ti\u1EBFt nhanh ch\xF3ng. Tooltip s\u1EBD t\u1EF1 \u0111\u1ED9ng \u1EA9n khi b\u1EA1n cu\u1ED9n ho\u1EB7c di chu\u1ED9t ra ngo\xE0i."]})]})]}),(0,E.jsxs)("div",{children:[(0,E.jsxs)("h5",{className:"font-semibold text-lg mb-1.5 flex items-center",children:[(0,E.jsx)("i",{className:"fas fa-columns mr-2 opacity-70"}),"B\u1EA3ng \u0110i\u1EC1u Khi\u1EC3n (B\xEAn Ph\u1EA3i):"]}),(0,E.jsxs)("ul",{className:"list-disc list-inside ml-2 space-y-1.5",children:[(0,E.jsxs)("li",{children:[(0,E.jsx)("strong",{children:'Tab "H\xE0nh \u0110\u1ED9ng":'}),(0,E.jsxs)("ul",{className:"list-disc list-inside ml-4 space-y-1 mt-1",children:[(0,E.jsxs)("li",{children:["Ch\u1ECDn m\u1ED9t trong c\xE1c ",(0,E.jsx)("em",{children:"L\u1EF1a Ch\u1ECDn Do AI T\u1EA1o"})," (n\xFAt b\u1EA5m). Di chu\u1ED9t qua \u0111\u1EC3 xem gi\u1EA3i th\xEDch th\xEAm n\u1EBFu c\xF3."]}),(0,E.jsxs)("li",{children:["Ho\u1EB7c, ",(0,E.jsx)("em",{children:"Nh\u1EADp H\xE0nh \u0110\u1ED9ng T\xF9y Ch\u1EC9nh"}),' c\u1EE7a b\u1EA1n v\xE0o \xF4 v\u0103n b\u1EA3n v\xE0 nh\u1EA5n "G\u1EEDi" (ho\u1EB7c Enter).']})]})]}),(0,E.jsxs)("li",{children:[(0,E.jsx)("strong",{children:"C\xE1c Tab Kh\xE1c:"})," ",(0,E.jsx)("em",{children:"Ch\u1EC9 S\u1ED1, Trang B\u1ECB, Ba L\xF4, Tu Luy\u1EC7n, K\u1EF9 N\u0103ng, Th\xE0nh T\u1EF1u, Quan H\u1EC7"})," gi\xFAp b\u1EA1n theo d\xF5i v\xE0 qu\u1EA3n l\xFD nh\xE2n v\u1EADt. N\u1ED9i dung \u1EDF \u0111\xE2y s\u1EBD t\u1EF1 \u0111\u1ED9ng c\u1EADp nh\u1EADt d\u1EF1a tr\xEAn di\u1EC5n bi\u1EBFn truy\u1EC7n v\xE0 h\xE0nh \u0111\u1ED9ng c\u1EE7a b\u1EA1n."]})]})]})]}),(0,E.jsxs)("h5",{className:"font-semibold text-lg mb-1.5 mt-4 flex items-center",children:[(0,E.jsx)("i",{className:"fas fa-bars mr-2 opacity-70"}),"Thanh Menu \u0110i\u1EC1u Khi\u1EC3n (Ph\xEDa tr\xEAn c\xF9ng):"]}),(0,E.jsxs)("ul",{className:"list-disc list-inside ml-2 space-y-1.5",children:[(0,E.jsxs)("li",{children:[(0,E.jsxs)("strong",{children:["N\xFAt Ch\u1EBF \u0111\u1ED9 ",(0,E.jsx)("i",{className:"fas fa-theater-masks"})," Nh\u1EADp Vai/",(0,E.jsx)("i",{className:"fas fa-brain"})," AI H\u1ED7 Tr\u1EE3:"]})," Chuy\u1EC3n \u0111\u1ED5i gi\u1EEFa vi\u1EC7c b\u1EA1n t\u1EF1 do nh\u1EADp h\xE0nh \u0111\u1ED9ng ho\u1EB7c AI \u0111\u01B0a ra l\u1EF1a ch\u1ECDn. Trong ch\u1EBF \u0111\u1ED9 Nh\u1EADp Vai, AI s\u1EBD kh\xF4ng t\u1EA1o l\u1EF1a ch\u1ECDn."]}),(0,E.jsxs)("li",{children:[(0,E.jsxs)("strong",{children:[(0,E.jsx)("i",{className:"fas fa-save"})," L\u01B0u:"]})," L\u01B0u ti\u1EBFn tr\xECnh game hi\u1EC7n t\u1EA1i ra file JSON tr\xEAn m\xE1y c\u1EE7a b\u1EA1n."]}),(0,E.jsxs)("li",{children:[(0,E.jsxs)("strong",{children:[(0,E.jsx)("i",{className:"fas fa-book-open"})," B.Khoa:"]})," M\u1EDF B\xE1ch Khoa To\xE0n Th\u01B0, n\u01A1i l\u01B0u tr\u1EEF th\xF4ng tin v\u1EC1 c\xE1c NPC, v\u1EADt ph\u1EA9m, \u0111\u1ECBa \u0111i\u1EC3m... b\u1EA1n \u0111\xE3 kh\xE1m ph\xE1. Th\xF4ng tin n\xE0y \u0111\u01B0\u1EE3c AI t\u1EF1 \u0111\u1ED9ng c\u1EADp nh\u1EADt."]}),(0,E.jsxs)("li",{children:[(0,E.jsxs)("strong",{children:[(0,E.jsx)("i",{className:"fas fa-scroll"})," T.T\u1EAFt:"]})," Xem l\u1EA1i t\xF3m t\u1EAFt c\u1ED1t truy\u1EC7n do AI t\u1EA1o. B\u1EA1n c\xF3 th\u1EC3 y\xEAu c\u1EA7u AI l\xE0m m\u1EDBi t\xF3m t\u1EAFt."]}),(0,E.jsxs)("li",{children:[(0,E.jsxs)("strong",{children:[(0,E.jsx)("i",{className:"fas fa-meteor"})," S.Ki\u1EC7n:"]})," T\u1EF1 t\u1EA1o ho\u1EB7c \u0111\u1EC3 AI t\u1EA1o m\u1ED9t s\u1EF1 ki\u1EC7n th\u1EBF gi\u1EDBi m\u1EDBi (v\xED d\u1EE5: k\u1EF3 ng\u1ED9, tai h\u1ECDa) \u0111\u1EC3 l\xE0m phong ph\xFA th\xEAm c\xE2u chuy\u1EC7n."]}),(0,E.jsxs)("li",{children:[(0,E.jsxs)("strong",{children:[(0,E.jsx)("i",{className:"fas fa-undo"})," H.T\xE1c:"]})," Quay l\u1EA1i h\xE0nh \u0111\u1ED9ng tr\u01B0\u1EDBc \u0111\xF3 (gi\u1EDBi h\u1EA1n 10 l\u1EA7n, h\u1EEFu \xEDch khi ch\u1ECDn nh\u1EA7m ho\u1EB7c mu\u1ED1n th\u1EED h\u01B0\u1EDBng kh\xE1c)."]}),(0,E.jsxs)("li",{children:[(0,E.jsxs)("strong",{children:[(0,E.jsx)("i",{className:"fas fa-door-open"})," Tho\xE1t:"]})," K\u1EBFt th\xFAc phi\xEAn ch\u01A1i hi\u1EC7n t\u1EA1i v\xE0 quay v\u1EC1 trang ch\u1EE7."]})]})]}),(0,E.jsx)(ys,{title:"4. C\xE1c Ch\u1EE9c N\u0103ng Kh\xE1c Tr\xEAn Trang Ch\u1EE7",icon:"fas fa-home",children:(0,E.jsxs)("ul",{className:"list-disc list-inside ml-2 space-y-1.5",children:[(0,E.jsxs)("li",{children:[(0,E.jsxs)("strong",{children:[(0,E.jsx)("i",{className:"fas fa-upload mr-1"})," T\u1EA3i Truy\u1EC7n \u0110\xE3 L\u01B0u:"]})," Ti\u1EBFp t\u1EE5c c\xE1c cu\u1ED9c phi\xEAu l\u01B0u t\u1EEB file .json \u0111\xE3 l\u01B0u."]}),(0,E.jsxs)("li",{children:[(0,E.jsxs)("strong",{children:[(0,E.jsx)("i",{className:"fas fa-fire-alt mr-1"})," Ch\u1EBF \u0110\u1ED9 NSFW:"]})," T\xF9y ch\u1EC9nh m\u1EE9c \u0111\u1ED9 n\u1ED9i dung ng\u01B0\u1EDDi l\u1EDBn (s\u1EED d\u1EE5ng c\xF3 tr\xE1ch nhi\u1EC7m v\xE0 theo quy \u0111\u1ECBnh c\u1EE7a Google Gemini)."]}),(0,E.jsxs)("li",{children:[(0,E.jsxs)("strong",{children:[(0,E.jsx)("i",{className:"fas fa-cogs mr-1"})," C\xE0i \u0110\u1EB7t Chung:"]})," Thay \u0111\u1ED5i giao di\u1EC7n S\xE1ng/T\u1ED1i, k\xEDch th\u01B0\u1EDBc ch\u1EEF."]})]})}),(0,E.jsx)(ys,{title:"M\u1EB9o Nh\u1ECF Cho \u0110\u1EA1i Hi\u1EC7p",icon:"fas fa-lightbulb",children:(0,E.jsxs)("ul",{className:"list-disc list-inside ml-2 space-y-1.5",children:[(0,E.jsxs)("li",{children:[(0,E.jsx)("strong",{children:"S\xE1ng t\u1EA1o kh\xF4ng gi\u1EDBi h\u1EA1n:"}),' \u0110\u1EEBng ng\u1EA1i th\u1EED nh\u1EEFng h\xE0nh \u0111\u1ED9ng "\u0111i\xEAn r\u1ED3" ho\u1EB7c kh\xE1c bi\u1EC7t. AI r\u1EA5t gi\u1ECFi trong vi\u1EC7c \u1EE9ng bi\u1EBFn!']}),(0,E.jsxs)("li",{children:[(0,E.jsx)("strong",{children:"M\xF4 t\u1EA3 chi ti\u1EBFt:"})," Khi nh\u1EADp h\xE0nh \u0111\u1ED9ng t\xF9y ch\u1EC9nh, c\xE0ng chi ti\u1EBFt, AI c\xE0ng d\u1EC5 hi\u1EC3u v\xE0 ph\u1EA3n h\u1ED3i t\u1ED1t h\u01A1n."]}),(0,E.jsxs)("li",{children:[(0,E.jsx)("strong",{children:'N\u1EBFu AI "b\xED" ho\u1EB7c l\u1EB7p l\u1EA1i:'}),' Th\u1EED m\u1ED9t h\xE0nh \u0111\u1ED9ng kh\xE1c, \u0111\u01A1n gi\u1EA3n h\u01A1n, ho\u1EB7c d\xF9ng ch\u1EE9c n\u0103ng "Ho\xE0n T\xE1c" v\xE0 ch\u1ECDn m\u1ED9t l\u1EF1a ch\u1ECDn kh\xE1c. \u0110\xF4i khi, vi\u1EC7c t\u1EA1o m\u1ED9t "S\u1EF1 Ki\u1EC7n Th\u1EBF Gi\u1EDBi" m\u1EDBi c\u0169ng c\xF3 th\u1EC3 gi\xFAp thay \u0111\u1ED5i m\u1EA1ch truy\u1EC7n.']}),(0,E.jsxs)("li",{children:[(0,E.jsx)("strong",{children:"Kh\xE1m ph\xE1 c\xE1c tab:"})," Th\u01B0\u1EDDng xuy\xEAn ki\u1EC3m tra ch\u1EC9 s\u1ED1, v\u1EADt ph\u1EA9m, k\u1EF9 n\u0103ng \u0111\u1EC3 \u0111\u01B0a ra quy\u1EBFt \u0111\u1ECBnh t\u1ED1t nh\u1EA5t. C\xE1c ch\u1EC9 s\u1ED1 n\xE0y th\u1EF1c s\u1EF1 \u1EA3nh h\u01B0\u1EDFng \u0111\u1EBFn c\xE1ch AI x\xE2y d\u1EF1ng c\xE2u chuy\u1EC7n v\xE0 k\u1EBFt qu\u1EA3 h\xE0nh \u0111\u1ED9ng c\u1EE7a b\u1EA1n."]}),(0,E.jsxs)("li",{children:[(0,E.jsx)("strong",{children:"L\u01B0u game th\u01B0\u1EDDng xuy\xEAn:"})," \u0110\u1EB7c bi\u1EC7t l\xE0 tr\u01B0\u1EDBc nh\u1EEFng quy\u1EBFt \u0111\u1ECBnh quan tr\u1ECDng!"]})]})}),(0,E.jsx)("p",{className:"mt-8 text-center text-lg font-semibold text-primary dark:text-primary-light",children:"Ch\xFAc b\u1EA1n c\xF3 nh\u1EEFng cu\u1ED9c phi\xEAu l\u01B0u nh\u1EADp vai \u0111\u1EA7y k\u1EF3 th\xFA v\xE0 s\u1EA3ng v\u0103n!"})]}),(0,E.jsx)("div",{className:"mt-8 flex justify-end",children:(0,E.jsxs)(U,{onClick:t,size:"lg",variant:"primary",className:"px-8 py-3",children:[(0,E.jsx)("i",{className:"fas fa-play-circle mr-2"}),"\u0110\xE3 Hi\u1EC3u, B\u1EAFt \u0110\u1EA7u Th\xF4i!"]})})]}),vv=wA;var Qe=H(ke(),1);var P=H(ee(),1),_n=(t,e)=>{let n=Math.random().toString(36).substring(2,7);if(e){let i=e.toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"").substring(0,15);return`${t}-${i}-${n}`}return`${t}-${Date.now()}-${n}`},IA=({onClose:t,onStartStory:e})=>{let{settings:n}=tt(),{addToast:i}=vn(),[r,o]=(0,Qe.useState)(!1),[a,u]=(0,Qe.useState)("manualTabs"),[c,d]=(0,Qe.useState)(1),[f,h]=(0,Qe.useState)(`Thi\u1EBFt l\u1EADp ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}`),[m,y]=(0,Qe.useState)({theme:"",context:"",tone:"K\u1EF3 \u1EA3o",advancedPrompt:""}),[p,T]=(0,Qe.useState)({name:"",gender:"AI quy\u1EBFt \u0111\u1ECBnh",summary:"",traits:[],goal:"",initialSkills:[]}),[R,C]=(0,Qe.useState)([]),[g,x]=(0,Qe.useState)({type:"NPC",name:"",description:""}),[S,I]=(0,Qe.useState)({name:"",description:"",category:"kh\xE1c",proficiency:"S\u01A1 Nh\u1EADp M\xF4n",xp:0,xpToNextLevel:100}),[V,k]=(0,Qe.useState)([]),[N,b]=(0,Qe.useState)(null),[D,te]=(0,Qe.useState)(""),[re,O]=(0,Qe.useState)(null),[ae,W]=(0,Qe.useState)(""),[he,Ze]=(0,Qe.useState)({userTheme:"",userDescription:"",numEntities:5}),rt=(0,Qe.useCallback)(()=>n.useDefaultAPI?process.env.API_KEY||"":localStorage.getItem(sn)||"",[n.useDefaultAPI]),Se=async(_,B)=>{o(!0),b(_),k([]);try{let w=rt(),M=await gs(w,n.useDefaultAPI,_,B);if(_==="traitSuggestion"){let F=M;if(Array.isArray(F)){let J=F.map(Ue=>Ue.name?`${Ue.name} - ${Ue.description}`:JSON.stringify(Ue));k(J)}}else if(_==="skillSuggestion"){let F=M;F&&F.name&&(I(J=>({...J,name:F.name||"",description:F.description||"",category:F.category||"kh\xE1c",icon:F.icon||J.icon,id:F.id||J.id||_n("skill",F.name)})),i({message:`AI g\u1EE3i \xFD k\u1EF9 n\u0103ng: ${F.name}`,type:"info"}))}else if(Array.isArray(M))k(M);else if(typeof M=="string")if(_==="charSummary")T(F=>({...F,summary:M}));else if(_==="entitySuggestion")try{let F=JSON.parse(M);x(J=>({...J,name:F.name,description:F.description}))}catch(F){console.error("Error parsing entity suggestion",F),i({message:"L\u1ED7i khi ph\xE2n t\xEDch g\u1EE3i \xFD th\u1EF1c th\u1EC3 t\u1EEB AI.",type:"error"})}else k([M])}catch(w){console.error(`Error generating ${_}:`,w),i({message:`L\u1ED7i t\u1EA1o g\u1EE3i \xFD cho ${_}: ${w instanceof Error?w.message:"Kh\xF4ng th\u1EC3 t\u1EA1o g\u1EE3i \xFD"}`,type:"error"}),k([`L\u1ED7i: ${w instanceof Error?w.message:"Kh\xF4ng th\u1EC3 t\u1EA1o g\u1EE3i \xFD"}`])}finally{o(!1)}},zn=(_,B)=>{if(B){switch(B){case"theme":y(w=>({...w,theme:_}));break;case"context":y(w=>({...w,context:_}));break;case"tone":y(w=>({...w,tone:_}));break;case"charName":T(w=>({...w,name:_}));break;case"charGoal":T(w=>({...w,goal:_}));break}k([]),b(null)}},ur=()=>{T(_=>({..._,traits:[..._.traits,{id:_n("trait"),name:"",description:""}]}))},Ts=(_,B,w)=>{T(M=>({...M,traits:M.traits.map((F,J)=>J===_?{...F,[B]:w}:F)}))},Cs=_=>{T(B=>({...B,traits:B.traits.filter((w,M)=>M!==_)}))},ao=async()=>{o(!0),b("traitSuggestion");try{let _=rt(),w=await gs(_,n.useDefaultAPI,"traitSuggestion",{charName:p.name,charSummary:p.summary,worldTheme:m.theme});if(Array.isArray(w)&&w.length>0){let M=w[0];M&&typeof M=="object"&&M.name&&M.description?(T(F=>({...F,traits:[...F.traits,{id:_n("trait",M.name),name:M.name,description:M.description}]})),i({message:`\u0110\xE3 th\xEAm g\u1EE3i \xFD \u0111\u1EB7c \u0111i\u1EC3m: ${M.name}`,type:"success"})):(console.warn("Suggested trait format incorrect:",M),i({message:"\u0110\u1ECBnh d\u1EA1ng \u0111\u1EB7c \u0111i\u1EC3m g\u1EE3i \xFD kh\xF4ng \u0111\xFAng.",type:"warning"}))}else i({message:"AI kh\xF4ng t\xECm th\u1EA5y g\u1EE3i \xFD \u0111\u1EB7c \u0111i\u1EC3m n\xE0o.",type:"info"})}catch(_){console.error("Error generating trait:",_),i({message:`L\u1ED7i t\u1EA1o \u0111\u1EB7c \u0111i\u1EC3m: ${_ instanceof Error?_.message:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"}`,type:"error"})}finally{o(!1),b(null)}},cr=()=>{g.name&&g.description&&g.type?(C(_=>[..._,{...g,id:_n("entity",g.name)}]),x({type:"NPC",name:"",description:""}),i({message:`\u0110\xE3 th\xEAm th\u1EF1c th\u1EC3: ${g.name}`,type:"success"})):i({message:"Vui l\xF2ng nh\u1EADp \u0111\u1EE7 T\xEAn, M\xF4 t\u1EA3 v\xE0 Lo\u1EA1i cho th\u1EF1c th\u1EC3.",type:"warning"})},_l=_=>{let B=R.find(w=>w.id===_);C(w=>w.filter(M=>M.id!==_)),re?.id===_&&O(null),B&&i({message:`\u0110\xE3 x\xF3a th\u1EF1c th\u1EC3: ${B.name}`,type:"info"})},Nl=async()=>{if(!D.trim()){i({message:"Vui l\xF2ng nh\u1EADp v\u0103n b\u1EA3n \u0111\u1EC3 AI ph\xE2n t\xEDch.",type:"warning"});return}o(!0),b("bulkEntities");try{let _=rt(),B=await jy(_,n.useDefaultAPI,D,m.theme);if(B&&B.length>0){let w=B.map(M=>({...M,id:_n("entity",M.name)}));C(M=>[...M,...w]),te(""),i({message:`${w.length} th\u1EF1c th\u1EC3 \u0111\xE3 \u0111\u01B0\u1EE3c th\xEAm t\u1EEB v\u0103n b\u1EA3n.`,type:"success"})}else i({message:"Kh\xF4ng t\xECm th\u1EA5y th\u1EF1c th\u1EC3 n\xE0o trong v\u0103n b\u1EA3n ho\u1EB7c c\xF3 l\u1ED7i x\u1EA3y ra.",type:"info"})}catch(_){console.error("Error processing bulk entities:",_),i({message:`L\u1ED7i khi x\u1EED l\xFD th\u1EF1c th\u1EC3 t\u1EEB v\u0103n b\u1EA3n: ${_ instanceof Error?_.message:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"}`,type:"error"})}finally{o(!1),b(null)}},ks=()=>{if(S.name&&S.description){let _={id:S.id||_n("skill",S.name),name:S.name,description:S.description,icon:S.icon||"fas fa-star",category:S.category||"kh\xE1c",proficiency:S.proficiency||"S\u01A1 Nh\u1EADp M\xF4n",xp:S.xp||0,xpToNextLevel:S.xpToNextLevel||100,effects:S.effects||[]};T(B=>({...B,initialSkills:[...B.initialSkills||[],_]})),I({name:"",description:"",category:"kh\xE1c",proficiency:"S\u01A1 Nh\u1EADp M\xF4n",xp:0,xpToNextLevel:100}),i({message:`\u0110\xE3 th\xEAm k\u1EF9 n\u0103ng: ${_.name}`,type:"success"})}else i({message:"Vui l\xF2ng nh\u1EADp T\xEAn v\xE0 M\xF4 t\u1EA3 cho k\u1EF9 n\u0103ng.",type:"warning"})},wl=_=>{let B=p.initialSkills?.find(w=>w.id===_);T(w=>({...w,initialSkills:(w.initialSkills||[]).filter(M=>M.id!==_)})),B&&i({message:`\u0110\xE3 x\xF3a k\u1EF9 n\u0103ng: ${B.name}`,type:"info"})},dr=_=>_?_.map(B=>{let w=B.split(/: (.+)/s),M=w[0]?.trim(),F=w[1]?.trim();return{id:_n("trait",M),name:M||"\u0110\u1EB7c \u0111i\u1EC3m kh\xF4ng t\xEAn",description:F||"Ch\u01B0a c\xF3 m\xF4 t\u1EA3"}}).filter(B=>B.name!=="\u0110\u1EB7c \u0111i\u1EC3m kh\xF4ng t\xEAn"):[],Il=_=>_?_.map(B=>{let w=B.split(/: (.+)/s),M=w[0]?.trim(),F=w[1]?.trim()||"",J=F,Ue="kh\xE1c",vt="fas fa-book-sparkles",Nn=F.match(/\(([^)]+)\)$/);if(Nn&&Nn[1]){let jd=Nn[1];J=F.substring(0,Nn.index).trim();let El=jd.match(/Loại:\s*([^,)]+)/i);if(El&&El[1]){let ef=El[1].trim().toLowerCase();["chi\u1EBFn \u0111\u1EA5u","ch\u1EBF t\u1EA1o","sinh t\u1ED3n","ph\xE9p thu\u1EADt","h\u1ED7 tr\u1EE3","kh\xE1c"].includes(ef)&&(Ue=ef)}let Al=jd.match(/Icon:\s*([^,)]+)/i);Al&&Al[1]&&(vt=Al[1].trim())}return{id:_n("skill",M),name:M||"K\u1EF9 n\u0103ng kh\xF4ng t\xEAn",description:J||"Ch\u01B0a c\xF3 m\xF4 t\u1EA3 chi ti\u1EBFt.",category:Ue,icon:vt,proficiency:"S\u01A1 Nh\u1EADp M\xF4n",xp:0,xpToNextLevel:100,effects:[]}}).filter(B=>B.name!=="K\u1EF9 n\u0103ng kh\xF4ng t\xEAn"):[],lo=_=>_?_.map(B=>{let w=B.type||"Kh\xE1c",M=Object.values(Ht).find(F=>F.toLowerCase()===w.toLowerCase())||"Kh\xE1c";return{id:_n("entity",B.name),name:B.name||"Th\u1EF1c th\u1EC3 kh\xF4ng t\xEAn",type:M,description:B.description||"Ch\u01B0a c\xF3 m\xF4 t\u1EA3."}}).filter(B=>B.name!=="Th\u1EF1c th\u1EC3 kh\xF4ng t\xEAn"):[],Ss=(_,B)=>{let w=[];_.story_setup_name&&(h(_.story_setup_name),w.push("T\xEAn thi\u1EBFt l\u1EADp"));let M=B?B.trim():m.advancedPrompt;if(_.world_setup){let F=_.world_setup;y(J=>({...J,theme:F.theme||J.theme,context:F.context||J.context,tone:Object.values(za).find(Ue=>Ue.toLowerCase()===F.tone?.toLowerCase())||F.tone||J.tone,advancedPrompt:B?M:F.advanced_prompt||J.advancedPrompt})),w.push("Th\xF4ng tin th\u1EBF gi\u1EDBi")}else B&&M&&(y(F=>({...F,advancedPrompt:M})),w.push("Prompt n\xE2ng cao (t\u1EEB m\xF4 t\u1EA3)"));if(_.character_setup){let F=_.character_setup,J=dr(F.traits_raw),Ue=Il(F.initial_skills_raw);T(vt=>({...vt,name:F.name||vt.name,gender:Object.values(Wa).find(Nn=>Nn.toLowerCase()===F.gender?.toLowerCase())||F.gender||vt.gender,summary:F.summary||vt.summary,goal:F.goal||vt.goal,traits:J.length>0?J:vt.traits,initialSkills:Ue.length>0?Ue:vt.initialSkills})),w.push("Th\xF4ng tin nh\xE2n v\u1EADt"+(J.length>0?", \u0111\u1EB7c \u0111i\u1EC3m":"")+(Ue.length>0?", k\u1EF9 n\u0103ng ban \u0111\u1EA7u":""))}if(_.entities_raw){let F=lo(_.entities_raw);F.length>0&&(C(F),w.push(`${F.length} th\u1EF1c th\u1EC3 ban \u0111\u1EA7u`))}w.length>0?(i({message:`AI \u0111\xE3 tr\xEDch xu\u1EA5t: ${w.join(", ")}. H\xE3y ki\u1EC3m tra v\xE0 ch\u1EC9nh s\u1EEDa n\u1EBFu c\u1EA7n.`,type:"success",duration:1e4}),u("manualTabs"),d(1)):i({message:"AI kh\xF4ng tr\xEDch xu\u1EA5t \u0111\u01B0\u1EE3c nhi\u1EC1u th\xF4ng tin t\u1EEB m\xF4 t\u1EA3. Vui l\xF2ng th\u1EED m\xF4 t\u1EA3 chi ti\u1EBFt h\u01A1n ho\u1EB7c \u0111i\u1EC1n th\u1EE7 c\xF4ng.",type:"info",duration:8e3})},uo=async()=>{if(!ae.trim()){i({message:"Vui l\xF2ng nh\u1EADp m\xF4 t\u1EA3 v\xE0o \xF4 b\xEAn tr\xEAn \u0111\u1EC3 AI tr\xEDch xu\u1EA5t.",type:"warning"});return}o(!0),b("extractAll");try{let _=rt(),B=await nv(_,n.useDefaultAPI,ae);Ss(B,ae)}catch(_){console.error("Error extracting all settings from AI:",_),i({message:`L\u1ED7i khi AI tr\xEDch xu\u1EA5t thi\u1EBFt l\u1EADp: ${_ instanceof Error?_.message:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"}`,type:"error"})}finally{o(!1),b(null)}},A=async()=>{if(!he.userTheme&&!he.userDescription){i({message:"Vui l\xF2ng nh\u1EADp \xEDt nh\u1EA5t Ch\u1EE7 \u0111\u1EC1 ho\u1EB7c M\xF4 t\u1EA3 ng\u1EAFn \u0111\u1EC3 AI c\xF3 c\u01A1 s\u1EDF t\u1EA1o ng\u1EABu nhi\xEAn.",type:"warning",duration:7e3});return}if(he.numEntities<=0||he.numEntities>500){i({message:"S\u1ED1 l\u01B0\u1EE3ng th\u1EF1c th\u1EC3 ph\u1EA3i t\u1EEB 1 \u0111\u1EBFn 500.",type:"warning"});return}o(!0),b("randomCreateAll");try{let _=rt(),B=await iv(_,n.useDefaultAPI,he);Ss(B),i({message:"AI \u0111\xE3 ho\xE0n t\u1EA5t kh\u1EDFi t\u1EA1o ng\u1EABu nhi\xEAn! H\xE3y chuy\u1EC3n qua tab 'Thi\u1EBFt L\u1EADp Th\u1EE7 C\xF4ng & Tinh Ch\u1EC9nh' \u0111\u1EC3 xem v\xE0 s\u1EEDa \u0111\u1ED5i.",type:"success",duration:12e3})}catch(_){console.error("Error with AI random full generation:",_),i({message:`L\u1ED7i khi AI kh\u1EDFi t\u1EA1o ng\u1EABu nhi\xEAn: ${_ instanceof Error?_.message:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"}`,type:"error"})}finally{o(!1),b(null)}},L=()=>{if(!m.theme||!m.context||!p.name||!p.summary||!p.goal){i({message:"Vui l\xF2ng \u0111i\u1EC1n \u0111\u1EA7y \u0111\u1EE7 c\xE1c tr\u01B0\u1EDDng th\xF4ng tin b\u1EAFt bu\u1ED9c cho Th\u1EBF Gi\u1EDBi v\xE0 Nh\xE2n V\u1EADt trong tab 'Thi\u1EBFt L\u1EADp Th\u1EE7 C\xF4ng & Tinh Ch\u1EC9nh'.",type:"warning",duration:7e3}),u("manualTabs"),!m.theme||!m.context?d(1):(!p.name||!p.summary||!p.goal)&&d(2);return}let _={id:_n("setup"),name:f.trim()||`Cu\u1ED9c phi\xEAu l\u01B0u c\u1EE7a ${p.name||"Nh\xE2n v\u1EADt kh\xF4ng t\xEAn"}`,world:m,character:p,entities:R,createdAt:new Date().toISOString(),initialSkills:p.initialSkills};e(_)},Q=Object.values(za).map(_=>({value:_,label:_})),ne=Object.values(Wa).map(_=>({value:_,label:_})),se=Object.values(Ht).map(_=>({value:_,label:_})),me=["chi\u1EBFn \u0111\u1EA5u","ch\u1EBF t\u1EA1o","sinh t\u1ED3n","ph\xE9p thu\u1EADt","h\u1ED7 tr\u1EE3","kh\xE1c"].map(_=>({value:_,label:_.charAt(0).toUpperCase()+_.slice(1)})),K=()=>V.length===0||!N?null:(0,P.jsxs)("div",{className:"mt-2 p-3 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow",children:[(0,P.jsxs)("h4",{className:"text-sm font-semibold mb-1",children:['G\u1EE3i \xFD t\u1EEB AI cho "',N,'":']}),(0,P.jsx)("ul",{className:"list-disc list-inside max-h-32 overflow-y-auto",children:V.map((_,B)=>(0,P.jsx)("li",{className:"text-xs p-1 hover:bg-primary-light hover:text-white dark:hover:bg-primary-dark rounded cursor-pointer",onClick:()=>zn(_,N),children:_},B))}),(0,P.jsx)(U,{size:"sm",variant:"ghost",onClick:()=>{k([]),b(null)},className:"mt-1 text-xs",children:"\u0110\xF3ng g\u1EE3i \xFD"})]}),Te=3,X=_=>`px-4 py-2.5 text-sm font-medium rounded-t-md focus:outline-none focus:ring-2 focus:ring-offset-0 focus:ring-primary dark:focus:ring-primary-light transition-colors duration-150
            ${a===_?"bg-card-light dark:bg-card-dark border-t border-x border-border-light dark:border-border-dark text-primary dark:text-primary-light shadow-sm":"bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 border-b border-border-light dark:border-border-dark"}`;return(0,P.jsxs)(Pe,{isOpen:!0,onClose:t,title:`Kh\u1EDFi T\u1EA1o M\u1EDBi - ${f||"Ch\u01B0a \u0111\u1EB7t t\xEAn"}`,size:"xl",children:[(0,P.jsxs)("div",{className:"flex mb-0 -mx-6 px-2 border-b border-border-light dark:border-border-dark",children:[(0,P.jsxs)("button",{className:X("aiRandomCreate"),onClick:()=>u("aiRandomCreate"),children:[(0,P.jsx)("i",{className:"fas fa-random mr-2"}),"A.I Kh\u1EDFi T\u1EA1o Ng\u1EABu Nhi\xEAn"]}),(0,P.jsxs)("button",{className:X("aiFullExtract"),onClick:()=>u("aiFullExtract"),children:[(0,P.jsx)("i",{className:"fas fa-magic-sparkles mr-2"}),"AI Tr\xEDch Xu\u1EA5t T\u1EEB V\u0103n B\u1EA3n"]}),(0,P.jsxs)("button",{className:X("manualTabs"),onClick:()=>u("manualTabs"),children:[(0,P.jsx)("i",{className:"fas fa-tools mr-2"}),"Thi\u1EBFt L\u1EADp Th\u1EE7 C\xF4ng & Tinh Ch\u1EC9nh ",a==="manualTabs"&&`(${c}/${Te})`]})]}),(0,P.jsxs)("div",{className:"pt-5",children:[" ",a==="aiFullExtract"&&(0,P.jsxs)("div",{className:"p-3 border-dashed border-primary/50 dark:border-primary-light/50 rounded-lg bg-primary/5 dark:bg-primary-dark/10",children:[(0,P.jsxs)("h3",{className:"text-md font-semibold text-primary dark:text-primary-light mb-2",children:[(0,P.jsx)("i",{className:"fas fa-file-alt mr-2"}),"Tr\xEDch Xu\u1EA5t To\xE0n B\u1ED9 Thi\u1EBFt L\u1EADp T\u1EEB V\u0103n B\u1EA3n"]}),(0,P.jsx)(Nt,{label:"D\xE1n ho\u1EB7c vi\u1EBFt m\xF4 t\u1EA3 to\xE0n b\u1ED9 thi\u1EBFt l\u1EADp mong mu\u1ED1n c\u1EE7a b\u1EA1n t\u1EA1i \u0111\xE2y (th\u1EBF gi\u1EDBi, nh\xE2n v\u1EADt, th\u1EF1c th\u1EC3 ban \u0111\u1EA7u, k\u1EF9 n\u0103ng ban \u0111\u1EA7u...):",value:ae,onChange:_=>W(_.target.value),rows:8,placeholder:"V\xED d\u1EE5: T\u1EA1o m\u1ED9t th\u1EBF gi\u1EDBi ti\xEAn hi\u1EC7p t\xEAn 'C\u1EEDu Ch\xE2u L\u1EE5c'. Nh\xE2n v\u1EADt ch\xEDnh t\xEAn L\xFD Phi D\u01B0\u01A1ng, nam, m\u1ED9t thi\u1EBFu ni\xEAn b\xECnh th\u01B0\u1EDDng t\xECnh c\u1EDD nh\u1EB7t \u0111\u01B0\u1EE3c b\xED k\xEDp v\xF5 c\xF4ng 'H\u1ED7n Nguy\xEAn C\xF4ng'. M\u1EE5c ti\xEAu c\u1EE7a c\u1EADu l\xE0 tr\u1EDF th\xE0nh c\u01B0\u1EDDng gi\u1EA3 m\u1EA1nh nh\u1EA5t. \u0110\u1EB7c \u0111i\u1EC3m: 'Thi\xEAn Sinh Th\u1EA7n L\u1EF1c: S\u1EE9c m\u1EA1nh h\u01A1n ng\u01B0\u1EDDi th\u01B0\u1EDDng'. K\u1EF9 n\u0103ng ban \u0111\u1EA7u: 'H\u1ED7n Nguy\xEAn C\xF4ng: C\xF4ng ph\xE1p tu luy\u1EC7n n\u1ED9i l\u1EF1c c\u01A1 b\u1EA3n (Lo\u1EA1i: Ph\xE9p thu\u1EADt, Icon: fas fa-fire)'. NPC ban \u0111\u1EA7u: 'L\xE3o \u0102n M\xE0y: m\u1ED9t ng\u01B0\u1EDDi b\xED \u1EA9n, hay gi\xFAp \u0111\u1EE1 L\xFD Phi D\u01B0\u01A1ng (NPC)'. ...",wrapperClass:"mb-2"}),(0,P.jsxs)(U,{onClick:uo,isLoading:r&&N==="extractAll",disabled:r||!ae.trim(),className:"w-full",variant:"secondary",children:[(0,P.jsx)("i",{className:"fas fa-wand-magic-sparkles mr-2"}),"\u0110\u1EC3 AI Tr\xEDch Xu\u1EA5t Thi\u1EBFt L\u1EADp T\u1EEB M\xF4 T\u1EA3 Tr\xEAn"]}),(0,P.jsx)("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"AI s\u1EBD c\u1ED1 g\u1EAFng \u0111i\u1EC1n c\xE1c th\xF4ng tin v\xE0o tab 'Thi\u1EBFt L\u1EADp Th\u1EE7 C\xF4ng & Tinh Ch\u1EC9nh'. B\u1EA1n c\xF3 th\u1EC3 ki\u1EC3m tra v\xE0 ch\u1EC9nh s\u1EEDa sau."})]}),a==="aiRandomCreate"&&(0,P.jsxs)("div",{className:"p-3 border-dashed border-blue-500/50 dark:border-blue-400/50 rounded-lg bg-blue-500/5 dark:bg-blue-400/10 space-y-4",children:[(0,P.jsxs)("h3",{className:"text-md font-semibold text-blue-600 dark:text-blue-300 mb-2",children:[(0,P.jsx)("i",{className:"fas fa-dice-d20 mr-2"}),"\u0110\u1EC3 AI S\xE1ng T\u1EA1o To\xE0n B\u1ED9 Th\u1EBF Gi\u1EDBi Ng\u1EABu Nhi\xEAn"]}),(0,P.jsx)(Ye,{label:"Ch\u1EE7 \u0111\u1EC1 g\u1EE3i \xFD cho AI (T\xF9y ch\u1ECDn):",value:he.userTheme,onChange:_=>Ze(B=>({...B,userTheme:_.target.value})),placeholder:"V\xED d\u1EE5: Ti\xEAn hi\u1EC7p b\xE1o th\xF9, \u0110\xF4 th\u1ECB d\u1ECB n\u0103ng, C\u1ED5 \u0111\u1EA1i cung \u0111\u1EA5u..."}),(0,P.jsx)(Nt,{label:"M\xF4 t\u1EA3 ng\u1EAFn g\u1ECDn v\u1EC1 \xFD t\u01B0\u1EDFng ch\xEDnh (T\xF9y ch\u1ECDn):",value:he.userDescription,onChange:_=>Ze(B=>({...B,userDescription:_.target.value})),rows:3,placeholder:"V\xED d\u1EE5: M\u1ED9t th\u1EBF gi\u1EDBi tu ti\xEAn n\u01A1i k\u1EBB y\u1EBFu b\u1ECB ch\xE0 \u0111\u1EA1p, nh\xE2n v\u1EADt ch\xEDnh t\u1EEB \u0111\xE1y v\u1EF1c v\u01B0\u01A1n l\xEAn. Ho\u1EB7c m\u1ED9t c\xE2u chuy\u1EC7n t\xECnh y\xEAu v\u01B0\u1EE3t th\u1EDDi gian..."}),(0,P.jsx)(Ye,{label:"S\u1ED1 l\u01B0\u1EE3ng th\u1EF1c th\u1EC3 AI c\u1EA7n t\u1EA1o (NPC, \u0111\u1ECBa \u0111i\u1EC3m, v\u1EADt ph\u1EA9m...):",type:"number",value:he.numEntities.toString(),min:"1",max:"500",onChange:_=>Ze(B=>({...B,numEntities:parseInt(_.target.value,10)||5}))}),(0,P.jsxs)(U,{onClick:A,isLoading:r&&N==="randomCreateAll",disabled:r||!he.userTheme.trim()&&!he.userDescription.trim(),className:"w-full",variant:"primary",children:[(0,P.jsx)("i",{className:"fas fa-brain mr-2"}),"\u0110\u1EC3 AI Kh\u1EDFi T\u1EA1o To\xE0n B\u1ED9 Th\u1EBF Gi\u1EDBi"]}),(0,P.jsx)("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"AI s\u1EBD t\u1EA1o ra m\u1ED9t thi\u1EBFt l\u1EADp \u0111\u1ED3 s\u1ED9, chi ti\u1EBFt d\u1EF1a tr\xEAn g\u1EE3i \xFD c\u1EE7a b\u1EA1n (n\u1EBFu c\xF3). Sau \u0111\xF3, b\u1EA1n c\xF3 th\u1EC3 xem v\xE0 tinh ch\u1EC9nh trong tab 'Thi\u1EBFt L\u1EADp Th\u1EE7 C\xF4ng & Tinh Ch\u1EC9nh'."})]}),a==="manualTabs"&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Ye,{label:"T\xEAn Cu\u1ED9c Phi\xEAu L\u01B0u / C\u1EA5u H\xECnh:",value:f,onChange:_=>h(_.target.value),placeholder:"V\xED d\u1EE5: Th\u1EBF gi\u1EDBi Ti\xEAn hi\u1EC7p c\u1EE7a t\xF4i"}),(0,P.jsx)("hr",{className:"my-4"}),c===1&&(0,P.jsxs)("div",{className:"space-y-3",children:[(0,P.jsxs)("h3",{className:"text-lg font-semibold mb-2 text-primary dark:text-primary-light",children:["1. Thi\u1EBFt L\u1EADp Th\u1EBF Gi\u1EDBi ",(0,P.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,P.jsxs)("div",{className:"flex items-end gap-2",children:[(0,P.jsx)(Ye,{wrapperClass:"flex-grow",label:"Ch\u1EE7 \u0111\u1EC1 (*):",value:m.theme,onChange:_=>y({...m,theme:_.target.value})}),(0,P.jsx)(U,{size:"sm",onClick:()=>Se("theme"),isLoading:r&&N==="theme",children:"AI"})]}),N==="theme"&&K(),(0,P.jsxs)("div",{className:"flex items-end gap-2",children:[(0,P.jsx)(Nt,{wrapperClass:"flex-grow",label:"B\u1ED1i c\u1EA3nh (*):",value:m.context,onChange:_=>y({...m,context:_.target.value})}),(0,P.jsx)(U,{size:"sm",onClick:()=>Se("context",{theme:m.theme}),isLoading:r&&N==="context",children:"AI"})]}),N==="context"&&K(),(0,P.jsxs)("div",{className:"flex items-end gap-2",children:[(0,P.jsx)(Wt,{wrapperClass:"flex-grow",label:"Phong c\xE1ch/Gi\u1ECDng v\u0103n (*):",options:Q,value:m.tone,onChange:_=>y({...m,tone:_.target.value})}),(0,P.jsx)(U,{size:"sm",onClick:()=>Se("tone",{theme:m.theme}),isLoading:r&&N==="tone",children:"AI"})]}),N==="tone"&&K(),(0,P.jsx)(Nt,{label:"Prompt N\xE2ng Cao (T\xF9y ch\u1ECDn):",value:m.advancedPrompt||"",onChange:_=>y({...m,advancedPrompt:_.target.value}),placeholder:"Lu\u1EADt l\u1EC7 th\u1EBF gi\u1EDBi, phe ph\xE1i, l\u1ECBch s\u1EED t\xF3m t\u1EAFt...",rows:4}),(0,P.jsx)(U,{size:"sm",variant:"ghost",onClick:()=>i({message:`V\xED d\u1EE5 Prompt n\xE2ng cao:
- Th\u1EBF gi\u1EDBi n\xE0y c\xF3 3 m\u1EB7t tr\u0103ng, m\u1ED7i m\u1EB7t tr\u0103ng mang m\u1ED9t lo\u1EA1i n\u0103ng l\u01B0\u1EE3ng kh\xE1c nhau.
- C\xE1c tu s\u0129 h\u1EA5p th\u1EE5 n\u0103ng l\u01B0\u1EE3ng m\u1EB7t tr\u0103ng \u0111\u1EC3 tu luy\u1EC7n, chia th\xE0nh 3 tr\u01B0\u1EDDng ph\xE1i ch\xEDnh.
- C\xF3 m\u1ED9t l\u1EDDi ti\xEAn tri c\u1ED5 v\u1EC1 ng\xE0y 3 m\u1EB7t tr\u0103ng th\u1EB3ng h\xE0ng...`,type:"info",duration:1e4}),children:"Xem g\u1EE3i \xFD prompt"})]}),c===2&&(0,P.jsxs)("div",{className:"space-y-3",children:[(0,P.jsxs)("h3",{className:"text-lg font-semibold mb-2 text-primary dark:text-primary-light",children:["2. Thi\u1EBFt L\u1EADp Nh\xE2n V\u1EADt Ch\xEDnh ",(0,P.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,P.jsxs)("div",{className:"flex items-end gap-2",children:[(0,P.jsx)(Ye,{wrapperClass:"flex-grow",label:"T\xEAn nh\xE2n v\u1EADt (*):",value:p.name,onChange:_=>T({...p,name:_.target.value})}),(0,P.jsx)(U,{size:"sm",onClick:()=>Se("charName",{worldTheme:m.theme,worldContext:m.context}),isLoading:r&&N==="charName",children:"AI"})]}),N==="charName"&&K(),(0,P.jsx)(Wt,{label:"Gi\u1EDBi t\xEDnh (*):",options:ne,value:p.gender,onChange:_=>T({...p,gender:_.target.value})}),(0,P.jsxs)("div",{className:"flex items-end gap-2",children:[(0,P.jsx)(Nt,{wrapperClass:"flex-grow",label:"S\u01A1 l\u01B0\u1EE3c (Ngo\u1EA1i h\xECnh, T\xEDnh c\xE1ch, Ngu\u1ED3n g\u1ED1c) (*):",value:p.summary,onChange:_=>T({...p,summary:_.target.value})}),(0,P.jsx)(U,{size:"sm",onClick:()=>Se("charSummary",{charName:p.name,charGender:p.gender,worldTheme:m.theme}),isLoading:r&&N==="charSummary",children:"AI T\u1EA1o S\u01A1 L\u01B0\u1EE3c"})]}),(0,P.jsxs)("div",{className:"flex items-end gap-2",children:[(0,P.jsx)(Ye,{wrapperClass:"flex-grow",label:"M\u1EE5c ti\xEAu/\u0110\u1ED9ng l\u1EF1c c\u1EE7a nh\xE2n v\u1EADt (*):",value:p.goal,onChange:_=>T({...p,goal:_.target.value})}),(0,P.jsx)(U,{size:"sm",onClick:()=>Se("charGoal",{charName:p.name,charSummary:p.summary}),isLoading:r&&N==="charGoal",children:"AI"})]}),N==="charGoal"&&K(),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"block text-sm font-medium text-text-light dark:text-text-dark mb-1",children:"\u0110\u1EB7c \u0111i\u1EC3m (Thi\xEAn ph\xFA/K\u1EF9 n\u0103ng \u0111\u1EB7c bi\u1EC7t/V\u1EADt ph\u1EA9m kh\u1EDFi \u0111\u1EA7u...):"}),p.traits.map((_,B)=>(0,P.jsxs)("div",{className:"flex gap-2 mb-2 items-center p-2 border rounded-md border-border-light dark:border-border-dark",children:[(0,P.jsx)(Ye,{wrapperClass:"flex-grow !mb-0",placeholder:"T\xEAn \u0111\u1EB7c \u0111i\u1EC3m",value:_.name,onChange:w=>Ts(B,"name",w.target.value)}),(0,P.jsx)(Nt,{wrapperClass:"flex-grow !mb-0",placeholder:"M\xF4 t\u1EA3 ng\u1EAFn",value:_.description,rows:1,onChange:w=>Ts(B,"description",w.target.value)}),(0,P.jsx)(U,{size:"sm",variant:"danger",onClick:()=>Cs(B),children:(0,P.jsx)("i",{className:"fas fa-trash"})})]},_.id)),(0,P.jsxs)("div",{className:"flex gap-2 mt-1",children:[(0,P.jsx)(U,{size:"sm",variant:"outline",onClick:ur,children:"Th\xEAm \u0110\u1EB7c \u0110i\u1EC3m"}),(0,P.jsx)(U,{size:"sm",variant:"outline",onClick:ao,isLoading:r&&N==="traitSuggestion",children:"AI G\u1EE3i \xDD \u0110\u1EB7c \u0110i\u1EC3m"})]})]})]}),c===3&&(0,P.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,P.jsxs)("div",{className:"space-y-3",children:[(0,P.jsx)("h3",{className:"text-lg font-semibold mb-2 text-primary dark:text-primary-light",children:"3a. Th\xEAm Th\u1EF1c Th\u1EC3/\u0110\u1ED1i T\u01B0\u1EE3ng (T\xF9y ch\u1ECDn)"}),(0,P.jsxs)("div",{className:"p-3 border rounded-md border-border-light dark:border-border-dark space-y-2",children:[(0,P.jsx)("h4",{className:"text-md font-medium",children:"Th\xEAm m\u1EDBi th\u1EE7 c\xF4ng:"}),(0,P.jsx)(Wt,{label:"Lo\u1EA1i th\u1EF1c th\u1EC3:",options:se,value:g.type||"NPC",onChange:_=>x({...g,type:_.target.value})}),(0,P.jsxs)("div",{className:"flex items-end gap-2",children:[(0,P.jsx)(Ye,{wrapperClass:"flex-grow",label:"T\u1EEB kh\xF3a/T\xEAn th\u1EF1c th\u1EC3:",value:g.name||"",onChange:_=>x({...g,name:_.target.value})}),(0,P.jsx)(U,{size:"sm",onClick:()=>Se("entitySuggestion",{worldTheme:m.theme,entityType:g.type}),isLoading:r&&N==="entitySuggestion",children:"AI"})]}),(0,P.jsx)(Nt,{label:"M\xF4 t\u1EA3 chi ti\u1EBFt:",value:g.description||"",onChange:_=>x({...g,description:_.target.value})}),(0,P.jsx)(U,{onClick:cr,disabled:!g.name||!g.description,children:"Th\xEAm Th\u1EF1c Th\u1EC3 Th\u1EE7 C\xF4ng"})]}),(0,P.jsxs)("div",{className:"mt-4 pt-3 border-t border-border-light dark:border-border-dark",children:[(0,P.jsx)("h4",{className:"text-md font-medium mb-2",children:"Ho\u1EB7c Th\xEAm Nhi\u1EC1u Th\u1EF1c Th\u1EC3 T\u1EEB V\u0103n B\u1EA3n:"}),(0,P.jsx)(Nt,{label:"Nh\u1EADp \u0111o\u1EA1n v\u0103n b\u1EA3n m\xF4 t\u1EA3 c\xE1c th\u1EF1c th\u1EC3:",value:D,onChange:_=>te(_.target.value),rows:4,placeholder:"V\xED d\u1EE5: L\xE3o Tr\u01B0\u01A1ng l\xE0 m\u1ED9t th\u1EE3 r\xE8n gi\xE0 \u1EDF l\xE0ng Ho\xE0 B\xECnh, \xF4ng ta gi\u1EEF m\u1ED9t thanh b\u1EA3o ki\u1EBFm t\xEAn l\xE0 H\u1ECFa Long. Ng\u1ECDn n\xFAi ph\xEDa b\u1EAFc l\xE0ng, T\u1EED Vong S\u01A1n, l\xE0 n\u01A1i \u1EDF c\u1EE7a H\u1EAFc Phong H\u1ED9i..."}),(0,P.jsx)(U,{onClick:Nl,isLoading:r&&N==="bulkEntities",disabled:r||!D.trim(),className:"w-full mt-2",children:"AI Tr\xEDch Xu\u1EA5t Th\u1EF1c Th\u1EC3 T\u1EEB V\u0103n B\u1EA3n"})]}),R.length>0&&(0,P.jsxs)("div",{className:"mt-4",children:[(0,P.jsxs)("h4",{className:"text-md font-medium mb-1",children:["Danh s\xE1ch th\u1EF1c th\u1EC3 \u0111\xE3 th\xEAm (",R.length,"):"]}),(0,P.jsx)("ul",{className:"max-h-32 overflow-y-auto space-y-1.5 pr-1",children:R.map(_=>(0,P.jsxs)("li",{className:`p-2 border rounded-md cursor-pointer flex justify-between items-center ${re?.id===_.id?"bg-primary-light/20 dark:bg-primary-dark/30 ring-1 ring-primary":"bg-gray-50 dark:bg-gray-800 hover:bg-slate-100 dark:hover:bg-slate-700"}`,onClick:()=>O(_),title:"Nh\u1EA5n \u0111\u1EC3 xem chi ti\u1EBFt",children:[(0,P.jsxs)("div",{className:"flex-grow",children:[(0,P.jsx)("strong",{className:"text-sm",children:_.name})," ",(0,P.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",_.type,")"]}),(0,P.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-300 truncate",children:_.description})]}),(0,P.jsx)(U,{size:"sm",variant:"danger",onClick:B=>{B.stopPropagation(),_l(_.id)},className:"ml-2 flex-shrink-0",children:(0,P.jsx)("i",{className:"fas fa-trash"})})]},_.id))}),re&&(0,P.jsxs)("div",{className:"mt-3 p-3 border rounded-md bg-white dark:bg-gray-900 shadow-lg",children:[(0,P.jsxs)("div",{className:"flex justify-between items-start",children:[(0,P.jsxs)("h5",{className:"font-semibold text-primary dark:text-primary-light",children:[re.name," ",(0,P.jsxs)("span",{className:"text-xs font-normal text-gray-500 dark:text-gray-400",children:["(",re.type,")"]})]}),(0,P.jsx)(U,{size:"sm",variant:"ghost",onClick:()=>O(null),className:"text-xs -mt-1 -mr-1",children:"\xD7 \u0110\xF3ng"})]}),(0,P.jsx)("p",{className:"text-sm whitespace-pre-wrap mt-1 max-h-24 overflow-y-auto",children:re.description})]})]})]}),(0,P.jsxs)("div",{className:"space-y-3",children:[(0,P.jsx)("h3",{className:"text-lg font-semibold mb-2 text-primary dark:text-primary-light",children:"3b. K\u1EF9 N\u0103ng Kh\u1EDFi \u0110\u1EA7u (T\xF9y ch\u1ECDn)"}),(0,P.jsxs)("div",{className:"p-3 border rounded-md border-border-light dark:border-border-dark space-y-2",children:[(0,P.jsxs)("div",{className:"flex items-end gap-2",children:[(0,P.jsx)(Ye,{wrapperClass:"flex-grow",label:"T\xEAn K\u1EF9 N\u0103ng:",value:S.name||"",onChange:_=>I({...S,name:_.target.value})}),(0,P.jsx)(U,{size:"sm",onClick:()=>Se("skillSuggestion",{worldTheme:m.theme,charName:p.name}),isLoading:r&&N==="skillSuggestion",children:"AI"})]}),(0,P.jsx)(Nt,{label:"M\xF4 T\u1EA3 K\u1EF9 N\u0103ng:",value:S.description||"",rows:2,onChange:_=>I({...S,description:_.target.value})}),(0,P.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,P.jsx)(Wt,{label:"Lo\u1EA1i K\u1EF9 N\u0103ng:",options:me,value:S.category,onChange:_=>I({...S,category:_.target.value})}),(0,P.jsx)(Ye,{label:"Icon (Font Awesome):",value:S.icon||"",onChange:_=>I({...S,icon:_.target.value}),placeholder:"fas fa-sword"})]}),(0,P.jsx)(U,{onClick:ks,disabled:!S.name||!S.description,children:"Th\xEAm K\u1EF9 N\u0103ng"})]}),p.initialSkills&&p.initialSkills.length>0&&(0,P.jsxs)("div",{className:"mt-4",children:[(0,P.jsxs)("h4",{className:"text-md font-medium mb-1",children:["K\u1EF9 n\u0103ng \u0111\xE3 th\xEAm (",p.initialSkills.length,"):"]}),(0,P.jsx)("ul",{className:"max-h-32 overflow-y-auto space-y-1.5 pr-1",children:p.initialSkills.map(_=>(0,P.jsxs)("li",{className:"p-2 border rounded-md bg-gray-50 dark:bg-gray-800 flex justify-between items-center",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("strong",{className:"text-sm",children:_.name})," ",(0,P.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",_.category,")"]}),(0,P.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-300 truncate",children:_.description})]}),(0,P.jsx)(U,{size:"sm",variant:"danger",onClick:()=>wl(_.id),className:"ml-2 flex-shrink-0",children:(0,P.jsx)("i",{className:"fas fa-trash"})})]},_.id))})]})]})]})]})]}),(0,P.jsxs)("div",{className:"mt-8 pt-4 border-t border-border-light dark:border-border-dark flex justify-between items-center",children:[(0,P.jsx)("div",{children:a==="manualTabs"&&c>1&&(0,P.jsx)(U,{variant:"outline",onClick:()=>d(_=>_-1),children:"Quay L\u1EA1i"})}),(0,P.jsxs)("div",{className:"flex gap-3 items-center",children:[a==="manualTabs"&&c<Te&&(0,P.jsx)(U,{onClick:()=>d(_=>_+1),children:"Ti\u1EBFp Theo"}),(0,P.jsxs)(U,{variant:"primary",onClick:L,isLoading:r&&N!=="bulkEntities"&&N!=="skillSuggestion"&&N!=="entitySuggestion"&&N!=="extractAll"&&N!=="randomCreateAll",children:[(0,P.jsx)("i",{className:"fas fa-wand-sparkles mr-2"}),"Kh\u1EDFi T\u1EA1o Cu\u1ED9c Phi\xEAu L\u01B0u"]})]})]}),(0,P.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:'L\u01B0u \xFD: \u0110\u1EC3 kh\u1EDFi t\u1EA1o, c\xE1c tr\u01B0\u1EDDng c\xF3 d\u1EA5u (*) trong tab "Thi\u1EBFt L\u1EADp Th\u1EE7 C\xF4ng" ph\u1EA3i \u0111\u01B0\u1EE3c \u0111i\u1EC1n \u0111\u1EA7y \u0111\u1EE7.'})]})},xv=IA;var cn=H(ke(),1);var ie=H(ee(),1),EA=()=>{let t=[];for(let e=0;e<localStorage.length;e++){let n=localStorage.key(e);if(n&&n.startsWith(_t))try{let i=localStorage.getItem(n);if(i){let r=JSON.parse(i);if(r.gameState&&r.savedAt){let o=n.substring(_t.length);t.push({key:n,displayName:r.gameState.setup?.name||o.replace(/_/g," "),savedAt:r.savedAt})}}}catch(i){console.warn(`Could not parse autosave slot ${n}:`,i)}}return t.sort((e,n)=>new Date(n.savedAt).getTime()-new Date(e.savedAt).getTime())},AA=({isOpen:t,onClose:e,onLoadStoryFromFile:n,onLoadStoryFromSlot:i,onLoadStoryFromDrive:r})=>{let[o,a]=(0,cn.useState)(null),[u,c]=(0,cn.useState)(!1),[d,f]=(0,cn.useState)([]),{addToast:h}=vn(),{isGoogleLoggedIn:m,accessToken:y,requestDriveScopes:p,isGapiLoaded:T,driveContext:R,setDriveContext:C}=mi(),[g,x]=(0,cn.useState)([]),[S,I]=(0,cn.useState)(!1),V=(0,cn.useCallback)(()=>{f(EA())},[]),k=(0,cn.useCallback)(async()=>{if(!m||!y||!T){m&&T&&!y&&h({message:"C\u1EA7n c\u1EA5p quy\u1EC1n truy c\u1EADp Google Drive \u0111\u1EC3 t\u1EA3i game t\u1EEB Drive.",type:"warning"});return}I(!0);try{let O=R.appFolderId;O||(O=await as(y),C(W=>({...W,appFolderId:O})));let ae=await Qa(y,O);x(ae),ae.length===0&&h({message:"Kh\xF4ng t\xECm th\u1EA5y file l\u01B0u n\xE0o tr\xEAn Google Drive.",type:"info",duration:3e3})}catch(O){h({message:`L\u1ED7i khi t\u1EA3i danh s\xE1ch t\u1EEB Drive: ${O.message}`,type:"error"}),(O.message.toLowerCase().includes("token")||O.message.toLowerCase().includes("auth"))&&await p()}finally{I(!1)}},[m,y,h,R.appFolderId,C,T,p]);(0,cn.useEffect)(()=>{t&&(V(),m&&T?k():x([]))},[t,V,m,k,T]);let N=O=>{if(O.target.files&&O.target.files[0]){let ae=O.target.files[0];ae.type==="application/json"?a(ae):(h({message:"Vui l\xF2ng ch\u1ECDn m\u1ED9t file .json h\u1EE3p l\u1EC7.",type:"error"}),a(null),O.target.value="")}else a(null)},b=()=>{if(!o){h({message:"Vui l\xF2ng ch\u1ECDn m\u1ED9t file \u0111\u1EC3 t\u1EA3i.",type:"warning"});return}c(!0);let O=new FileReader;O.onload=ae=>{try{let W=ae.target?.result;if(typeof W=="string"){let he=JSON.parse(W);if(he&&he.setup&&he.storyLog)n(he);else throw new Error("C\u1EA5u tr\xFAc file save kh\xF4ng h\u1EE3p l\u1EC7.")}else throw new Error("Kh\xF4ng th\u1EC3 \u0111\u1ECDc n\u1ED9i dung file.")}catch(W){console.error("Error loading or parsing game file:",W),h({message:`L\u1ED7i khi t\u1EA3i file: ${W instanceof Error?W.message:"N\u1ED9i dung file kh\xF4ng h\u1EE3p l\u1EC7."}`,type:"error",duration:7e3})}finally{c(!1)}},O.onerror=()=>{h({message:"L\u1ED7i khi \u0111\u1ECDc file.",type:"error"}),c(!1)},O.readAsText(o)},D=(O,ae)=>{localStorage.removeItem(O),V(),h({message:`\u0110\xE3 x\xF3a slot l\u01B0u tr\u1EEF: "${ae}"`,type:"info",icon:"fas fa-trash-alt"})},te=async(O,ae)=>{if(!m||!y||!T){h({message:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp Google v\xE0 c\u1EA5p quy\u1EC1n Drive.",type:"error"});return}I(!0);try{let W=await Kp(y,O);r(W),h({message:`\u0110\xE3 t\u1EA3i game "${ae}" t\u1EEB Google Drive.`,type:"success"})}catch(W){h({message:`L\u1ED7i khi t\u1EA3i game t\u1EEB Drive: ${W.message}`,type:"error"})}finally{I(!1)}},re=async(O,ae)=>{if(!m||!y||!T){h({message:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp Google v\xE0 c\u1EA5p quy\u1EC1n Drive.",type:"error"});return}if(window.confirm(`B\u1EA1n c\xF3 ch\u1EAFc mu\u1ED1n x\xF3a v\u0129nh vi\u1EC5n file "${ae}" t\u1EEB Google Drive kh\xF4ng? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c.`)){I(!0);try{await zp(y,O),h({message:`\u0110\xE3 x\xF3a file "${ae}" kh\u1ECFi Google Drive.`,type:"success"}),k()}catch(W){h({message:`L\u1ED7i khi x\xF3a file t\u1EEB Drive: ${W.message}`,type:"error"})}finally{I(!1)}}};return(0,ie.jsxs)(Pe,{isOpen:t,onClose:e,title:"T\u1EA3i Game \u0110\xE3 L\u01B0u",size:"xl",children:[(0,ie.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-6",children:[(0,ie.jsxs)("div",{className:"p-4 border rounded-lg bg-primary/5 dark:bg-primary-dark/10 border-primary/30 dark:border-primary-dark/40",children:[(0,ie.jsxs)("h3",{className:"text-lg font-semibold text-primary dark:text-primary-light mb-2 flex items-center",children:[(0,ie.jsx)("i",{className:"fas fa-hdd mr-2"}),"T\u1EA3i T\u1EEB Slot Tr\xECnh Duy\u1EC7t"]}),d.length>0?(0,ie.jsx)("div",{className:"max-h-60 overflow-y-auto space-y-2 custom-scrollbar pr-2",children:d.map(O=>(0,ie.jsxs)("div",{className:"p-3 border rounded-md bg-white dark:bg-slate-700/60 border-slate-200 dark:border-slate-600 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[(0,ie.jsxs)("div",{children:[(0,ie.jsx)("strong",{className:"block text-sm text-slate-800 dark:text-slate-100",children:O.displayName}),(0,ie.jsxs)("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:["L\u01B0u l\xFAc: ",new Date(O.savedAt).toLocaleString("vi-VN",{dateStyle:"short",timeStyle:"short"})]})]}),(0,ie.jsxs)("div",{className:"flex gap-2 mt-2 sm:mt-0",children:[(0,ie.jsx)(U,{onClick:()=>{i(O.key)},variant:"primary",size:"xs",className:"!px-2.5 !py-1",leftIcon:(0,ie.jsx)("i",{className:"fas fa-play-circle"}),children:"T\u1EA3i"}),(0,ie.jsx)(U,{onClick:()=>D(O.key,O.displayName),variant:"danger",size:"xs",className:"!px-2 !py-1",title:`X\xF3a slot: ${O.displayName}`,children:(0,ie.jsx)("i",{className:"fas fa-trash-alt"})})]})]},O.key))}):(0,ie.jsx)("p",{className:"text-sm text-slate-500 dark:text-slate-400 italic",children:"Kh\xF4ng t\xECm th\u1EA5y slot n\xE0o \u0111\u01B0\u1EE3c l\u01B0u trong tr\xECnh duy\u1EC7t."}),(0,ie.jsx)("hr",{className:"border-border-light dark:border-border-dark my-4"}),(0,ie.jsxs)("div",{children:[(0,ie.jsxs)("h3",{className:"text-md font-semibold text-text-light dark:text-text-dark mb-2 flex items-center",children:[(0,ie.jsx)("i",{className:"fas fa-file-upload mr-2"}),"Ho\u1EB7c T\u1EA3i Game T\u1EEB File JSON"]}),(0,ie.jsx)("div",{children:(0,ie.jsx)("input",{id:"file-upload-load",type:"file",accept:".json",onChange:N,className:"block w-full text-sm text-slate-500 dark:text-slate-400 file:mr-4 file:py-2 file:px-3 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary-light/20 file:text-primary dark:file:bg-primary-dark/30 dark:file:text-primary-light hover:file:bg-primary-light/30 dark:hover:file:bg-primary-dark/40 focus:outline-none focus:ring-1 focus:ring-offset-1 focus:ring-primary dark:focus:ring-primary-dark"})}),o&&(0,ie.jsxs)("p",{className:"text-xs text-gray-600 dark:text-gray-300 mt-1.5",children:["\u0110\xE3 ch\u1ECDn: ",(0,ie.jsx)("span",{className:"font-medium",children:o.name})]}),(0,ie.jsx)(U,{onClick:b,disabled:!o||u,isLoading:u,className:"mt-3 w-full sm:w-auto",variant:"outline",leftIcon:(0,ie.jsx)("i",{className:"fas fa-upload"}),children:u?"\u0110ang T\u1EA3i...":"T\u1EA3i T\u1EEB File"})]})]}),(0,ie.jsxs)("div",{className:"p-4 border rounded-lg bg-blue-50 dark:bg-blue-800/60 border-blue-200 dark:border-blue-700/60",children:[(0,ie.jsxs)("h3",{className:"text-lg font-semibold text-blue-600 dark:text-blue-300 mb-2 flex items-center",children:[(0,ie.jsx)("i",{className:"fab fa-google-drive mr-2"}),"T\u1EA3i T\u1EEB Google Drive"]}),m?S?(0,ie.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,ie.jsxs)("svg",{className:"animate-spin h-5 w-5 mr-2 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,ie.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,ie.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})," \u0110ang t\u1EA3i danh s\xE1ch..."]}):g.length>0?(0,ie.jsx)("div",{className:"max-h-80 overflow-y-auto space-y-2 custom-scrollbar pr-2",children:g.map(O=>(0,ie.jsxs)("div",{className:"p-3 border rounded-md bg-white dark:bg-slate-700/60 border-slate-200 dark:border-slate-600 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[(0,ie.jsxs)("div",{children:[(0,ie.jsx)("strong",{className:"block text-sm text-slate-800 dark:text-slate-100",children:O.name}),(0,ie.jsxs)("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:["L\u01B0u l\xFAc: ",new Date(O.modifiedTime).toLocaleString("vi-VN",{dateStyle:"short",timeStyle:"short"})]}),O.size&&(0,ie.jsxs)("span",{className:"text-xs text-slate-500 dark:text-slate-400 ml-2",children:["(",(parseInt(O.size)/1024).toFixed(1)," KB)"]})]}),(0,ie.jsxs)("div",{className:"flex gap-2 mt-2 sm:mt-0",children:[(0,ie.jsx)(U,{onClick:()=>te(O.id,O.name),variant:"primary",size:"xs",className:"!px-2.5 !py-1 bg-blue-500 hover:bg-blue-600 border-blue-500 hover:border-blue-600",leftIcon:(0,ie.jsx)("i",{className:"fas fa-cloud-download-alt"}),children:"T\u1EA3i"}),(0,ie.jsx)(U,{onClick:()=>re(O.id,O.name),variant:"danger",size:"xs",className:"!px-2 !py-1",title:`X\xF3a file: ${O.name} kh\u1ECFi Drive`,children:(0,ie.jsx)("i",{className:"fas fa-trash-alt"})})]})]},O.id))}):(0,ie.jsxs)("div",{className:"text-center py-3",children:[(0,ie.jsx)("p",{className:"text-sm text-slate-500 dark:text-slate-400 italic mb-2",children:"Kh\xF4ng t\xECm th\u1EA5y file l\u01B0u n\xE0o tr\xEAn Google Drive ho\u1EB7c ch\u01B0a c\u1EA5p quy\u1EC1n."}),(0,ie.jsxs)(U,{onClick:k,variant:"ghost",size:"sm",isLoading:S,disabled:!T,children:[(0,ie.jsx)("i",{className:"fas fa-sync-alt mr-1"})," Th\u1EED L\u1EA1i / Xin Quy\u1EC1n"]})]}):(0,ie.jsx)("p",{className:"text-sm text-slate-500 dark:text-slate-400 italic",children:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp Google \u0111\u1EC3 t\u1EA3i game t\u1EEB Drive."})]})]}),(0,ie.jsx)("div",{className:"mt-8 flex justify-end",children:(0,ie.jsx)(U,{variant:"outline",onClick:e,disabled:u||S,size:"lg",children:"\u0110\xF3ng"})})]})},Tv=AA;var Ni=H(ke(),1);var Re=H(ee(),1),bA=({onClose:t,gameState:e,setGameState:n})=>{let{settings:i}=tt(),[r,o]=(0,Ni.useState)("Ng\u1EABu Nhi\xEAn"),[a,u]=(0,Ni.useState)("Khu V\u1EF1c"),[c,d]=(0,Ni.useState)(""),[f,h]=(0,Ni.useState)(!1),[m,y]=(0,Ni.useState)(null),p=(0,Ni.useCallback)(()=>i.useDefaultAPI?process.env.API_KEY||"":localStorage.getItem(sn)||"",[i.useDefaultAPI]),T=async()=>{h(!0),y(null);try{let x=p(),S={worldTheme:e.setup.world.theme,characterName:e.setup.character.name,recentStory:e.storyLog.slice(-5).map(V=>V.content).join(" ")},I=await gs(x,i.useDefaultAPI,"worldEvent",{storyContext:S,eventType:r,eventScope:a,keywords:c});if(typeof I=="string"){let V=JSON.parse(I);y({name:V.name,description:V.description,keyElements:V.keyElements,type:r,scope:a,status:"active"})}}catch(x){console.error("Error generating world event:",x),alert(`L\u1ED7i t\u1EA1o s\u1EF1 ki\u1EC7n: ${x instanceof Error?x.message:"Kh\xF4ng th\u1EC3 t\u1EA1o s\u1EF1 ki\u1EC7n"}`)}finally{h(!1)}},R=()=>{if(!m||!m.name||!m.description){alert("S\u1EF1 ki\u1EC7n kh\xF4ng h\u1EE3p l\u1EC7 \u0111\u1EC3 th\xEAm v\xE0o truy\u1EC7n.");return}let x={id:`event-${Date.now()}`,name:m.name,type:m.type||r,scope:m.scope||a,description:m.description,keyElements:m.keyElements||[],status:"active",timestamp:new Date().toISOString()},S={id:`msg-event-${Date.now()}`,type:"event",content:`S\u1EF0 KI\u1EC6N TH\u1EBE GI\u1EDAI M\u1EDAI: ${x.name}
${x.description}`,timestamp:new Date().toISOString()};n(I=>I?{...I,currentWorldEvent:x,storyLog:[...I.storyLog,S]}:null),t()},C=Object.values(Qc).map(x=>({value:x,label:x})),g=Object.values(Zc).map(x=>({value:x,label:x}));return(0,Re.jsxs)(Pe,{isOpen:!0,onClose:t,title:"T\u1EA1o S\u1EF1 Ki\u1EC7n Th\u1EBF Gi\u1EDBi",size:"lg",children:[(0,Re.jsxs)("div",{className:"space-y-4",children:[(0,Re.jsx)(Wt,{label:"Lo\u1EA1i S\u1EF1 Ki\u1EC7n:",options:C,value:r,onChange:x=>o(x.target.value)}),(0,Re.jsx)(Wt,{label:"Ph\u1EA1m Vi \u1EA2nh H\u01B0\u1EDFng:",options:g,value:a,onChange:x=>u(x.target.value)}),(0,Re.jsx)(Ye,{label:"T\u1EEB Kh\xF3a G\u1EE3i \xDD (T\xF9y ch\u1ECDn):",value:c,onChange:x=>d(x.target.value),placeholder:"V\xED d\u1EE5: ma t\u1ED9c, c\u1ED5 ki\u1EBFm, huy\u1EBFt th\xF9..."}),(0,Re.jsx)(U,{onClick:T,isLoading:f,className:"w-full",children:f?"AI \u0110ang T\u1EA1o...":"Kh\u1EDFi T\u1EA1o S\u1EF1 Ki\u1EC7n B\u1EB1ng AI"}),m&&(0,Re.jsxs)("div",{className:"mt-4 p-4 border rounded-md bg-gray-50 dark:bg-gray-700",children:[(0,Re.jsx)("h4",{className:"font-semibold text-lg mb-2",children:"Xem Tr\u01B0\u1EDBc S\u1EF1 Ki\u1EC7n:"}),(0,Re.jsxs)("p",{children:[(0,Re.jsx)("strong",{children:"T\xEAn:"})," ",m.name]}),(0,Re.jsxs)("p",{children:[(0,Re.jsx)("strong",{children:"M\xF4 t\u1EA3:"})," ",m.description]}),m.keyElements&&m.keyElements.length>0&&(0,Re.jsxs)("p",{children:[(0,Re.jsx)("strong",{children:"Y\u1EBFu t\u1ED1 ch\xEDnh:"})," ",m.keyElements.join(", ")]}),(0,Re.jsxs)("p",{children:[(0,Re.jsx)("strong",{children:"Lo\u1EA1i:"})," ",m.type,", ",(0,Re.jsx)("strong",{children:"Ph\u1EA1m vi:"})," ",m.scope]}),(0,Re.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,Re.jsx)(U,{onClick:R,variant:"primary",children:"Ch\u1EA5p Nh\u1EADn v\xE0 \u0110\u01B0a V\xE0o Truy\u1EC7n"}),(0,Re.jsx)(U,{onClick:T,variant:"outline",isLoading:f,children:"T\u1EA1o L\u1EA1i"})]})]})]}),(0,Re.jsx)("div",{className:"mt-6 flex justify-end",children:(0,Re.jsx)(U,{variant:"ghost",onClick:t,children:"\u0110\xF3ng"})})]})},Cv=bA;var ar=H(ke(),1);var Jt=H(ee(),1),PA=({onClose:t,storyLog:e,currentSummary:n,setGameState:i,apiKey:r,useDefaultAPI:o})=>{let[a,u]=(0,ar.useState)(n),[c,d]=(0,ar.useState)(!1),f=(0,ar.useCallback)(async()=>{if(e.length<5){u("C\xE2u chuy\u1EC7n c\xF2n qu\xE1 ng\u1EAFn \u0111\u1EC3 AI t\xF3m t\u1EAFt hi\u1EC7u qu\u1EA3. H\xE3y ti\u1EBFp t\u1EE5c phi\xEAu l\u01B0u!");return}d(!0);try{let h=await ev(r,o,e);u(h),i(m=>m?{...m,currentSummary:h}:null)}catch(h){console.error("Error generating summary:",h),u(`L\u1ED7i khi t\u1EA1o t\xF3m t\u1EAFt: ${h instanceof Error?h.message:"Kh\xF4ng th\u1EC3 k\u1EBFt n\u1ED1i v\u1EDBi AI."}`)}finally{d(!1)}},[r,o,e]);return(0,ar.useEffect)(()=>{!n&&e.length>0?f():u(n||"Ch\u01B0a c\xF3 t\xF3m t\u1EAFt n\xE0o \u0111\u01B0\u1EE3c t\u1EA1o.")},[n,e,f]),(0,Jt.jsxs)(Pe,{isOpen:!0,onClose:t,title:"T\xF3m T\u1EAFt C\u1ED1t Truy\u1EC7n",size:"lg",children:[(0,Jt.jsx)("div",{className:"max-h-[60vh] overflow-y-auto p-1 mb-4 prose prose-sm sm:prose dark:prose-invert max-w-none text-text-light dark:text-text-dark",children:c?(0,Jt.jsxs)("div",{className:"flex items-center justify-center",children:[(0,Jt.jsxs)("svg",{className:"animate-spin h-5 w-5 mr-3",viewBox:"0 0 24 24",children:[(0,Jt.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,Jt.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"AI \u0111ang t\xF3m t\u1EAFt..."]}):(0,Jt.jsx)("p",{className:"whitespace-pre-wrap",children:a})}),(0,Jt.jsxs)("div",{className:"mt-6 flex justify-between items-center",children:[(0,Jt.jsx)(U,{onClick:f,isLoading:c,variant:"outline",children:c?"\u0110ang T\u1EA3i L\u1EA1i...":"T\u1EA1o/L\xE0m M\u1EDBi T\xF3m T\u1EAFt"}),(0,Jt.jsx)(U,{onClick:t,children:"\u0110\xF3ng"})]})]})},kv=PA;var vs=H(ke(),1);var $e=H(ee(),1),MA=({onClose:t,entries:e})=>{let[n,i]=(0,vs.useState)("NPC"),[r,o]=(0,vs.useState)(null),a=["NPC","V\u1EADt ph\u1EA9m","\u0110\u1ECBa \u0111i\u1EC3m","T\u1ED5 ch\u1EE9c","Kh\xE1c"];(0,vs.useEffect)(()=>{let d=e.filter(f=>f.type===n);d.length>0?(!r||r.type!==n)&&o(d[0]):o(null)},[n,e,r]);let u=e.filter(d=>d.type===n),c=d=>{let f="px-4 py-1.5 text-xs rounded-full whitespace-nowrap transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-offset-card-light dark:focus:ring-offset-card-dark";return n===d?`${f} bg-primary text-white dark:bg-primary-dark dark:text-card-dark shadow-md focus:ring-primary`:`${f} bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-200 focus:ring-primary/50`};return(0,$e.jsxs)(Pe,{isOpen:!0,onClose:t,title:"B\xE1ch Khoa To\xE0n Th\u01B0",size:"xl",children:[(0,$e.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 md:gap-x-6 max-h-[70vh]",children:[(0,$e.jsxs)("div",{className:"w-full md:w-2/5 lg:w-1/3 flex flex-col md:border-r md:border-border-light md:dark:border-border-dark md:pr-4",children:[(0,$e.jsx)("div",{className:"flex flex-nowrap overflow-x-auto items-center gap-2 mb-3 pb-3 border-b border-border-light dark:border-border-dark",children:a.map(d=>(0,$e.jsxs)("button",{onClick:()=>i(d),className:c(d),children:[d," (",e.filter(f=>f.type===d).length,")"]},d))}),(0,$e.jsxs)("div",{className:"overflow-y-auto space-y-1.5 flex-grow pr-0.5",children:[" ",u.length>0?u.map(d=>(0,$e.jsx)("div",{className:`p-2.5 rounded-md cursor-pointer text-sm transition-colors duration-150 break-words
                    ${r?.id===d.id?"bg-primary dark:bg-primary-dark text-white dark:text-card-dark font-semibold shadow-md":"bg-slate-50 dark:bg-slate-800/60 hover:bg-slate-100 dark:hover:bg-slate-700/60"}`,onClick:()=>o(d),children:d.name},d.id)):(0,$e.jsxs)("p",{className:"text-sm text-slate-500 dark:text-slate-400 p-3 italic text-center",children:['Kh\xF4ng c\xF3 m\u1EE5c n\xE0o trong danh m\u1EE5c "',n,'".']})]})]}),(0,$e.jsx)("div",{className:"w-full md:w-3/5 lg:w-2/3 flex flex-col pt-4 md:pt-0",children:r?(0,$e.jsxs)("div",{className:"overflow-y-auto h-full p-1 pr-0 text-text-light dark:text-text-dark space-y-2",children:[(0,$e.jsx)("h3",{className:"text-xl sm:text-2xl font-bold text-primary dark:text-primary-light",children:r.name}),(0,$e.jsxs)("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1 mb-2 pb-2 border-b border-border-light dark:border-border-dark",children:["Lo\u1EA1i: ",(0,$e.jsx)("span",{className:"font-medium",children:r.type})]}),(0,$e.jsx)("div",{className:"prose prose-sm sm:prose-base dark:prose-invert max-w-none leading-relaxed text-text-light dark:text-text-dark whitespace-pre-wrap",children:r.description||(0,$e.jsx)("span",{className:"italic",children:"Kh\xF4ng c\xF3 m\xF4 t\u1EA3 chi ti\u1EBFt."})})]}):(0,$e.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center p-4 md:p-6 text-slate-500 dark:text-slate-400",children:[(0,$e.jsx)("i",{className:"fas fa-book-reader fa-3x mb-4 opacity-60"}),(0,$e.jsx)("p",{className:"text-lg mb-1",children:e.length>0?"Ch\u1ECDn m\u1ED9t m\u1EE5c \u0111\u1EC3 xem chi ti\u1EBFt":"B\xE1ch khoa to\xE0n th\u01B0 hi\u1EC7n \u0111ang tr\u1ED1ng."}),(0,$e.jsx)("p",{className:"text-sm",children:e.length>0?"C\xE1c m\u1EE5c s\u1EBD \u0111\u01B0\u1EE3c li\u1EC7t k\xEA \u1EDF b\u1EA3ng b\xEAn tr\xE1i.":"C\xE1c th\u1EF1c th\u1EC3 s\u1EBD xu\u1EA5t hi\u1EC7n \u1EDF \u0111\xE2y khi \u0111\u01B0\u1EE3c t\u1EA1o trong truy\u1EC7n."})]})})]}),(0,$e.jsx)("div",{className:"mt-6 flex justify-end border-t border-border-light dark:border-border-dark pt-4",children:(0,$e.jsx)(U,{onClick:t,children:"\u0110\xF3ng"})})]})},Sv=MA;var so=H(ke(),1),Kn=H(ee(),1),LA=so.default.memo(({toast:t,onClose:e})=>{let[n,i]=(0,so.useState)(!1);(0,so.useEffect)(()=>{let f=setTimeout(()=>i(!0),50);return()=>clearTimeout(f)},[]);let r=()=>{i(!1),setTimeout(e,350)},o="bg-info-bgLight dark:bg-info-bgDark",a="text-info-textLight dark:text-info-textDark",u="border-info-borderLight dark:border-info-borderDark",c="text-info-DEFAULT dark:text-info-light";switch(t.type){case"success":o="bg-success-bgLight dark:bg-success-bgDark",a="text-success-textLight dark:text-success-textDark",u="border-success-borderLight dark:border-success-borderDark",c="text-success-DEFAULT dark:text-success-light";break;case"error":o="bg-error-bgLight dark:bg-error-bgDark",a="text-error-textLight dark:text-error-textDark",u="border-error-borderLight dark:border-error-borderDark",c="text-error-DEFAULT dark:text-error-light";break;case"warning":o="bg-warning-bgLight dark:bg-warning-bgDark",a="text-warning-textLight dark:text-warning-textDark",u="border-warning-borderLight dark:border-warning-borderDark",c="text-warning-DEFAULT dark:text-warning-light";break}let d=t.type==="success"?"fas fa-check-circle":t.type==="error"?"fas fa-times-circle":t.type==="warning"?"fas fa-exclamation-triangle":t.type==="info"?"fas fa-info-circle":"fas fa-bell";return(0,Kn.jsxs)("div",{className:`
        p-4 rounded-xl shadow-2xl border-l-4 
        ${o} ${a} ${u}
        flex items-start space-x-3
        transform transition-all duration-300 ease-out
        ${n?"opacity-100 translate-x-0":"opacity-0 translate-x-[110%]"}
      `,role:"alert","aria-live":t.type==="error"?"assertive":"polite",children:[(0,Kn.jsx)("div",{className:`flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full ${c} ${o==="bg-info-bgLight dark:bg-info-bgDark"?"":"bg-opacity-20"} mt-0.5`,children:(0,Kn.jsx)("i",{className:`${t.icon||d} ${c} text-sm fa-fw`})}),(0,Kn.jsx)("div",{className:"flex-1 text-sm",children:(0,Kn.jsx)("p",{className:`font-semibold ${a}`,children:t.message})}),(0,Kn.jsx)("button",{onClick:r,className:`ml-auto -mr-1 -mt-1 rounded-full p-1.5 hover:bg-black/10 dark:hover:bg-white/10
                   focus:outline-none focus-visible:ring-2 focus-visible:ring-current
                   transition-colors duration-150`,"aria-label":"\u0110\xF3ng th\xF4ng b\xE1o",children:(0,Kn.jsx)("i",{className:`fas fa-times text-sm ${a} opacity-70 hover:opacity-100`})})]})}),_v=LA;var xs=H(ee(),1),RA=()=>{let{toasts:t,removeToast:e}=ad();return t.length===0?null:(0,xs.jsx)("div",{className:"fixed top-5 right-5 z-[200] w-full max-w-sm sm:max-w-md space-y-3 pointer-events-none",children:t.map(n=>(0,xs.jsxs)("div",{className:"pointer-events-auto",children:[" ",(0,xs.jsx)(_v,{toast:n,onClose:()=>e(n.id)})]},n.id))})},Nv=RA;var Yt=H(ee(),1),DA=({onClose:t,onReincarnate:e})=>(0,Yt.jsxs)(Pe,{isOpen:!0,onClose:t,title:"Th\xE2n T\u1EED \u0110\u1EA1o Ti\xEAu",size:"md",children:[(0,Yt.jsxs)("div",{className:"text-center py-4",children:[(0,Yt.jsx)("i",{className:"fas fa-skull-crossbones text-6xl text-red-500 dark:text-red-400 mb-6 animate-pulse"}),(0,Yt.jsx)("h4",{className:"text-2xl font-bold text-text-light dark:text-text-dark mb-3",children:"Ng\u01B0\u01A1i \u0111\xE3 k\u1EBFt th\xFAc h\xE0nh tr\xECnh t\u1EA1i \u0111\xE2y."}),(0,Yt.jsx)("p",{className:"text-md text-slate-600 dark:text-slate-300 mb-8 leading-relaxed",children:"Th\xE2n x\xE1c tan bi\u1EBFn, h\u1ED3n ph\xE1ch phi\xEAu t\xE1n n\u01A1i c\u1EEDu tuy\u1EC1n. Li\u1EC7u c\xF3 mu\u1ED1n n\u1EAFm b\u1EAFt m\u1ED9t tia hy v\u1ECDng, b\u1EAFt \u0111\u1EA7u m\u1ED9t ki\u1EBFp lu\xE2n h\u1ED3i m\u1EDBi, vi\u1EBFt n\xEAn m\u1ED9t trang s\u1EED kh\xE1c kh\xF4ng?"})]}),(0,Yt.jsxs)("div",{className:"mt-6 flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4",children:[(0,Yt.jsxs)(U,{variant:"outline",onClick:t,size:"lg",className:"w-full sm:w-auto border-slate-400 text-slate-600 hover:bg-slate-100 dark:border-slate-500 dark:text-slate-300 dark:hover:bg-slate-700",children:[(0,Yt.jsx)("i",{className:"fas fa-bed mr-2"}),"An Ngh\u1EC9 C\xF5i \xC2m Ty"]}),(0,Yt.jsxs)(U,{variant:"primary",onClick:e,size:"lg",className:"w-full sm:w-auto bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700",children:[(0,Yt.jsx)("i",{className:"fas fa-sync-alt mr-2"}),"B\u1EAFt \u0110\u1EA7u Lu\xE2n H\u1ED3i"]})]})]}),wv=DA;var Qt=H(ke(),1);var ce=H(ee(),1),FA=()=>{let t=[];for(let e=0;e<localStorage.length;e++){let n=localStorage.key(e);if(n&&n.startsWith(_t))try{let i=localStorage.getItem(n);if(i){let r=JSON.parse(i);if(r.gameState&&r.savedAt){let o=n.substring(_t.length);t.push({key:n,displayName:r.gameState.setup?.name||o.replace(/_/g," "),savedAt:r.savedAt})}}}catch(i){console.warn(`Could not parse autosave slot ${n}:`,i)}}return t.sort((e,n)=>new Date(n.savedAt).getTime()-new Date(e.savedAt).getTime())},VA=({isOpen:t,onClose:e,gameState:n,onSaveToJsonFile:i,onSaveToLocalStorageSlot:r})=>{let{addToast:o}=vn(),{isGoogleLoggedIn:a,accessToken:u,requestDriveScopes:c,isGapiLoaded:d,driveContext:f,setDriveContext:h}=mi(),[m,y]=(0,Qt.useState)(""),[p,T]=(0,Qt.useState)(""),[R,C]=(0,Qt.useState)([]),[g,x]=(0,Qt.useState)([]),[S,I]=(0,Qt.useState)(!1),[V,k]=(0,Qt.useState)(null),N=(0,Qt.useCallback)(()=>{C(FA())},[]),b=(0,Qt.useCallback)(async(W,he)=>{let Ze=W===void 0?u:W,rt=he===void 0?d:he;if(!a||!Ze||!rt){a&&rt&&!Ze&&o({message:"C\u1EA7n c\u1EA5p quy\u1EC1n truy c\u1EADp Google Drive \u0111\u1EC3 thao t\xE1c v\u1EDBi Drive.",type:"warning"});return}I(!0);try{let Se=f.appFolderId;Se||(Se=await as(Ze),h(ur=>({...ur,appFolderId:Se})));let zn=await Qa(Ze,Se);x(zn)}catch(Se){o({message:`L\u1ED7i khi t\u1EA3i danh s\xE1ch t\u1EEB Drive: ${Se.message}`,type:"error"}),(Se.message.toLowerCase().includes("token")||Se.message.toLowerCase().includes("auth"))&&await c()}finally{I(!1)}},[a,u,d,o,f.appFolderId,h,c]);(0,Qt.useEffect)(()=>{if(t){N();let W=n?.setup.name||`Game_${new Date().toISOString().slice(0,10)}`;if(n&&n.setup.name)y(n.setup.name),T(n.setup.name+".json");else if(n&&n.setup.id){let he=n.setup.id.startsWith(_t)?n.setup.id.substring(_t.length):n.setup.id;y(he.replace(/_/g," ")),T(he.replace(/_/g," ")+".json")}else y(W),T(W+".json");k(null),a&&d?b():x([])}},[t,n,N,a,b,d]);let D=()=>{if(!n){o({message:"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u game \u0111\u1EC3 l\u01B0u.",type:"error"});return}let W=m.trim();if(!W){o({message:"Vui l\xF2ng nh\u1EADp t\xEAn cho slot l\u01B0u tr\u1EEF.",type:"warning"});return}let he=W.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_.-]/g,""),Ze=_t+he,rt=R.some(Se=>Se.key===Ze);r(n,he),o(rt?{message:`\u0110\xE3 ghi \u0111\xE8 slot: "${W}"`,type:"success",icon:"fas fa-hdd"}:{message:`Game \u0111\xE3 \u0111\u01B0\u1EE3c l\u01B0u v\xE0o slot m\u1EDBi: "${W}"`,type:"success",icon:"fas fa-save"}),N()},te=(W,he)=>{localStorage.removeItem(W),N(),o({message:`\u0110\xE3 x\xF3a slot l\u01B0u tr\u1EEF: "${he}"`,type:"info",icon:"fas fa-trash-alt"})},re=W=>{y(W.displayName),o({message:`T\xEAn slot "${W.displayName}" \u0111\xE3 \u0111\u01B0\u1EE3c \u0111i\u1EC1n. Nh\u1EA5n "L\u01B0u V\xE0o Slot N\xE0y" \u0111\u1EC3 ghi \u0111\xE8.`,type:"info",icon:"fas fa-edit"})},O=async()=>{if(!n){o({message:"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u game \u0111\u1EC3 l\u01B0u.",type:"error"});return}if(!a||!u||!d){o({message:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp Google v\xE0 c\u1EA5p quy\u1EC1n Drive.",type:"error"});return}let W=p.trim();if(!W){o({message:"Vui l\xF2ng nh\u1EADp t\xEAn file cho Google Drive.",type:"warning"});return}I(!0);try{let he=f.appFolderId;he||(he=await as(u),h(Se=>({...Se,appFolderId:he})));let Ze=W.endsWith(".json")?W:`${W}.json`,rt=V?.id;if(!rt){let Se=g.find(zn=>zn.name===Ze);if(Se){if(!window.confirm(`File "${Ze}" \u0111\xE3 t\u1ED3n t\u1EA1i tr\xEAn Google Drive. B\u1EA1n c\xF3 mu\u1ED1n ghi \u0111\xE8 kh\xF4ng?`)){I(!1);return}rt=Se.id}}await qp(u,he,n,Ze,rt),o({message:`\u0110\xE3 l\u01B0u game "${Ze}" l\xEAn Google Drive.`,type:"success",icon:"fab fa-google-drive"}),b(),k(null),T(n.setup.name?n.setup.name+".json":`GameLuu_${Date.now()}.json`)}catch(he){o({message:`L\u1ED7i khi l\u01B0u game l\xEAn Drive: ${he.message}`,type:"error"})}finally{I(!1)}},ae=W=>{T(W.name),k(W),o({message:`File "${W.name}" \u0111\xE3 \u0111\u01B0\u1EE3c ch\u1ECDn \u0111\u1EC3 ghi \u0111\xE8. Nh\u1EA5n "L\u01B0u V\xE0o Google Drive" \u0111\u1EC3 x\xE1c nh\u1EADn.`,type:"info",icon:"fas fa-edit"})};return n?(0,ce.jsxs)(Pe,{isOpen:t,onClose:e,title:"L\u01B0u Ti\u1EBFn Tr\xECnh Game",size:"xl",children:[(0,ce.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-6",children:[(0,ce.jsxs)("div",{className:"p-4 border rounded-lg bg-slate-50 dark:bg-slate-800/60 border-slate-200 dark:border-slate-700",children:[(0,ce.jsxs)("h3",{className:"text-md font-semibold text-text-light dark:text-text-dark mb-3",children:[(0,ce.jsx)("i",{className:"fas fa-file-download mr-2 text-primary dark:text-primary-light"}),"L\u01B0u D\u01B0\u1EDBi D\u1EA1ng File (.json)"]}),(0,ce.jsx)(U,{onClick:()=>i(n),variant:"primary",className:"w-full",leftIcon:(0,ce.jsx)("i",{className:"fas fa-download"}),children:"T\u1EA3i File JSON Xu\u1ED1ng"}),(0,ce.jsx)("hr",{className:"my-4 border-border-light dark:border-border-dark"}),(0,ce.jsxs)("h3",{className:"text-md font-semibold text-text-light dark:text-text-dark mb-2",children:[(0,ce.jsx)("i",{className:"fas fa-hdd mr-2 text-primary dark:text-primary-light"}),"L\u01B0u V\xE0o Slot Tr\xECnh Duy\u1EC7t"]}),(0,ce.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 items-end mb-3",children:[(0,ce.jsx)(Ye,{label:"T\xEAn Slot L\u01B0u Tr\u1EEF:",value:m,onChange:W=>y(W.target.value),placeholder:"T\xEAn cu\u1ED9c phi\xEAu l\u01B0u",wrapperClass:"flex-grow !mb-0"}),(0,ce.jsx)(U,{onClick:D,variant:"secondary",className:"w-full sm:w-auto mt-2 sm:mt-0",disabled:!m.trim(),leftIcon:(0,ce.jsx)("i",{className:"fas fa-save"}),children:"L\u01B0u V\xE0o Slot N\xE0y"})]}),R.length>0&&(0,ce.jsxs)("div",{children:[(0,ce.jsx)("h4",{className:"text-xs font-medium text-slate-700 dark:text-slate-200 mb-1",children:"Slot \u0111\xE3 l\u01B0u (nh\u1EA5n \u0111\u1EC3 \u0111i\u1EC1n t\xEAn v\xE0 ghi \u0111\xE8):"}),(0,ce.jsx)("div",{className:"max-h-32 overflow-y-auto space-y-1 custom-scrollbar pr-1",children:R.map(W=>(0,ce.jsxs)("div",{className:"p-1.5 border rounded-md bg-white dark:bg-slate-700/50 border-slate-200 dark:border-slate-600 flex justify-between items-center text-xs hover:bg-slate-100 dark:hover:bg-slate-600/50 transition-colors",children:[(0,ce.jsxs)("div",{className:"cursor-pointer flex-grow mr-1",onClick:()=>re(W),title:`Ch\u1ECDn \u0111\u1EC3 ghi \u0111\xE8 slot: ${W.displayName}`,children:[(0,ce.jsx)("strong",{className:"block text-slate-800 dark:text-slate-100",children:W.displayName}),(0,ce.jsxs)("span",{className:"text-slate-500 dark:text-slate-400",children:["L\xFAc: ",new Date(W.savedAt).toLocaleTimeString("vi-VN")]})]}),(0,ce.jsx)(U,{size:"xs",variant:"danger",onClick:()=>te(W.key,W.displayName),className:"!p-1 flex-shrink-0",title:`X\xF3a slot: ${W.displayName}`,children:(0,ce.jsx)("i",{className:"fas fa-trash-alt"})})]},W.key))})]})]}),(0,ce.jsxs)("div",{className:"p-4 border rounded-lg bg-blue-50 dark:bg-blue-900/60 border-blue-200 dark:border-blue-700",children:[(0,ce.jsxs)("h3",{className:"text-md font-semibold text-text-light dark:text-text-dark mb-2",children:[(0,ce.jsx)("i",{className:"fab fa-google-drive mr-2 text-blue-500 dark:text-blue-400"}),"L\u01B0u V\xE0o Google Drive"]}),a?(0,ce.jsxs)(ce.Fragment,{children:[(0,ce.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 items-end mb-3",children:[(0,ce.jsx)(Ye,{label:"T\xEAn File tr\xEAn Drive:",value:p,onChange:W=>{T(W.target.value),k(null)},placeholder:"V\xED d\u1EE5: PhieuLuuCuaToi.json",wrapperClass:"flex-grow !mb-0"}),(0,ce.jsx)(U,{onClick:O,variant:"success",className:"w-full sm:w-auto mt-2 sm:mt-0 bg-blue-500 hover:bg-blue-600 border-blue-500 hover:border-blue-600",disabled:!p.trim()||S,isLoading:S,leftIcon:(0,ce.jsx)("i",{className:"fas fa-cloud-upload-alt"}),children:"L\u01B0u L\xEAn Drive"})]}),S&&!g.length&&(0,ce.jsxs)("div",{className:"text-xs text-blue-500 dark:text-blue-400",children:[(0,ce.jsx)("i",{className:"fas fa-spinner fa-spin mr-1"}),"\u0110ang t\u1EA3i danh s\xE1ch file..."]}),g.length>0&&(0,ce.jsxs)("div",{children:[(0,ce.jsx)("h4",{className:"text-xs font-medium text-slate-700 dark:text-slate-200 mb-1",children:"File tr\xEAn Drive (nh\u1EA5n \u0111\u1EC3 \u0111i\u1EC1n t\xEAn v\xE0 ghi \u0111\xE8):"}),(0,ce.jsx)("div",{className:"max-h-32 overflow-y-auto space-y-1 custom-scrollbar pr-1",children:g.map(W=>(0,ce.jsx)("div",{className:`p-1.5 border rounded-md flex justify-between items-center text-xs transition-colors ${V?.id===W.id?"bg-blue-100 dark:bg-blue-700 ring-1 ring-blue-500":"bg-white dark:bg-slate-700/50 border-slate-200 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-600/50"}`,children:(0,ce.jsxs)("div",{className:"cursor-pointer flex-grow mr-1",onClick:()=>ae(W),title:`Ch\u1ECDn \u0111\u1EC3 ghi \u0111\xE8 file: ${W.name}`,children:[(0,ce.jsx)("strong",{className:"block text-slate-800 dark:text-slate-100",children:W.name}),(0,ce.jsxs)("span",{className:"text-slate-500 dark:text-slate-400",children:["S\u1EEDa \u0111\u1ED5i: ",new Date(W.modifiedTime).toLocaleTimeString("vi-VN")]})]})},W.id))})]})]}):(0,ce.jsx)("p",{className:"text-sm text-slate-500 dark:text-slate-400 italic",children:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp Google \u0111\u1EC3 l\u01B0u game l\xEAn Drive."})]})]}),(0,ce.jsx)("div",{className:"mt-8 flex justify-end",children:(0,ce.jsx)(U,{variant:"outline",onClick:e,size:"lg",disabled:S,children:"\u0110\xF3ng"})})]}):null},Iv=VA;var Ge=H(ee(),1),$A=()=>{let{settings:t,nsfwSettings:e,userApiKey:n}=tt(),{addToast:i}=vn(),{isLoadingAuth:r,isGapiLoaded:o,isGisLoaded:a}=mi(),[u,c]=(0,it.useState)(0),[d,f]=(0,it.useState)(null),[h,m]=(0,it.useState)(!0),y=(0,it.useCallback)((k,N)=>{if(k&&N){let b=N.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_.-]/g,"");if(!b){i({message:"T\xEAn slot kh\xF4ng h\u1EE3p l\u1EC7 sau khi chu\u1EA9n h\xF3a.",type:"error"});return}let D={gameState:k,savedAt:new Date().toISOString()},te=_t+b;try{localStorage.setItem(te,JSON.stringify(D)),console.log(`Game saved to slot "${b}" (key: "${te}") at:`,D.savedAt)}catch(re){console.error(`Error saving game to localStorage slot "${b}":`,re),i({message:`L\u1ED7i khi l\u01B0u v\xE0o slot "${N}". C\xF3 th\u1EC3 b\u1ED9 nh\u1EDB \u0111\u1EA7y.`,type:"error"})}}},[i]),p=(0,it.useCallback)(k=>{k.setup?.id&&y(k,k.setup.id)},[y]),T=(0,it.useCallback)(()=>({hp:{id:"hp",name:"HP",value:100,maxValue:100,description:"Sinh l\u1EF1c c\u1EE7a b\u1EA1n. Khi v\u1EC1 0, b\u1EA1n s\u1EBD t\u1EED vong.",icon:"fas fa-heartbeat"},mp:{id:"mp",name:"MP",value:50,maxValue:50,description:"N\u0103ng l\u01B0\u1EE3ng/Linh l\u1EF1c/N\u1ED9i n\u0103ng \u0111\u1EC3 s\u1EED d\u1EE5ng k\u1EF9 n\u0103ng.",icon:"fas fa-bolt"},progression_level:{id:"progression_level",name:"C\u1EA5p \u0110\u1ED9/C\u1EA3nh Gi\u1EDBi",value:"T\xE2n Th\u1EE7",isProgressionStat:!0,description:"C\u1EA5p b\u1EADc hi\u1EC7n t\u1EA1i c\u1EE7a b\u1EA1n trong h\u1EC7 th\u1ED1ng tu luy\u1EC7n/ph\xE1t tri\u1EC3n.",icon:"fas fa-star"},spiritual_qi:{id:"spiritual_qi",name:"\u0110i\u1EC3m Kinh Nghi\u1EC7m/Linh Kh\xED",value:0,maxValue:100,description:"T\xE0i nguy\xEAn c\u1EA7n \u0111\u1EC3 th\u0103ng c\u1EA5p ho\u1EB7c n\xE2ng cao c\u1EA3nh gi\u1EDBi.",icon:"fas fa-arrow-up"},intelligence:{id:"intelligence",name:"Tr\xED L\u1EF1c",value:10,description:"\u1EA2nh h\u01B0\u1EDFng \u0111\u1EBFn kh\u1EA3 n\u0103ng h\u1ECDc h\u1ECFi, t\u1ED1c \u0111\u1ED9 l\u0129nh ng\u1ED9, v\xE0 s\u1EE9c m\u1EA1nh c\u1EE7a m\u1ED9t s\u1ED1 k\u1EF9 n\u0103ng ph\xE9p thu\u1EADt.",icon:"fas fa-brain"},constitution:{id:"constitution",name:"Th\u1EC3 Ch\u1EA5t",value:7,description:"\u1EA2nh h\u01B0\u1EDFng \u0111\u1EBFn HP t\u1ED1i \u0111a, kh\u1EA3 n\u0103ng ch\u1ECBu \u0111\u1EF1ng, v\xE0 kh\xE1ng c\xE1c hi\u1EC7u \u1EE9ng ti\xEAu c\u1EF1c.",icon:"fas fa-heart-circle-bolt"},agility:{id:"agility",name:"Nhanh Nh\u1EB9n",value:7,description:"\u1EA2nh h\u01B0\u1EDFng \u0111\u1EBFn t\u1ED1c \u0111\u1ED9 h\xE0nh \u0111\u1ED9ng, kh\u1EA3 n\u0103ng n\xE9 tr\xE1nh, v\xE0 th\u1EE9 t\u1EF1 ra \u0111\xF2n trong chi\u1EBFn \u0111\u1EA5u.",icon:"fas fa-shoe-prints"},luck:{id:"luck",name:"May M\u1EAFn",value:5,description:"\u1EA2nh h\u01B0\u1EDFng \u0111\u1EBFn t\u1EC9 l\u1EC7 r\u01A1i v\u1EADt ph\u1EA9m qu\xFD hi\u1EBFm, x\xE1c su\u1EA5t th\xE0nh c\xF4ng c\u1EE7a m\u1ED9t s\u1ED1 h\xE0nh \u0111\u1ED9ng, v\xE0 t\u1EA7n su\u1EA5t g\u1EB7p k\u1EF3 ng\u1ED9.",icon:"fas fa-dice-five"},damage_output:{id:"damage_output",name:"S\xE1t Th\u01B0\u01A1ng C\u01A1 B\u1EA3n",value:10,description:"S\u1EE9c m\u1EA1nh \u0111\xF2n \u0111\xE1nh v\u1EADt l\xFD/ph\xE9p thu\u1EADt c\u01A1 b\u1EA3n c\u1EE7a b\u1EA1n.",icon:"fas fa-fist-raised"},attack_speed:{id:"attack_speed",name:"T\u1ED1c \u0110\u1ED9 \u0110\xE1nh",value:1,description:"T\u1EA7n su\u1EA5t ra \u0111\xF2n ho\u1EB7c s\u1ED1 h\xE0nh \u0111\u1ED9ng c\xF3 th\u1EC3 th\u1EF1c hi\u1EC7n trong m\u1ED9t l\u01B0\u1EE3t/kho\u1EA3ng th\u1EDDi gian.",icon:"fas fa-wind"},crit_chance:{id:"crit_chance",name:"T\u1EF7 L\u1EC7 Ch\xED M\u1EA1ng",value:5,maxValue:100,description:"% c\u01A1 h\u1ED9i g\xE2y s\xE1t th\u01B0\u01A1ng ch\xED m\u1EA1ng (g\u1EA5p b\u1ED9i).",icon:"fas fa-bullseye"},crit_damage_bonus:{id:"crit_damage_bonus",name:"Th\u01B0\u1EDFng S\xE1t Th\u01B0\u01A1ng Ch\xED M\u1EA1ng",value:50,description:"% s\xE1t th\u01B0\u01A1ng \u0111\u01B0\u1EE3c c\u1ED9ng th\xEAm khi g\xE2y ch\xED m\u1EA1ng (VD: 50% ngh\u0129a l\xE0 ST x1.5).",icon:"fas fa-percentage"},defense_value:{id:"defense_value",name:"Ph\xF2ng Th\u1EE7",value:5,description:"Gi\u1EA3m s\xE1t th\u01B0\u01A1ng nh\u1EADn v\xE0o t\u1EEB c\xE1c \u0111\xF2n t\u1EA5n c\xF4ng.",icon:"fas fa-shield-alt"},evasion_chance:{id:"evasion_chance",name:"T\u1EF7 L\u1EC7 N\xE9 Tr\xE1nh",value:5,maxValue:100,description:"% c\u01A1 h\u1ED9i n\xE9 ho\xE0n to\xE0n m\u1ED9t \u0111\xF2n t\u1EA5n c\xF4ng c\u1EE7a \u0111\u1ED1i th\u1EE7.",icon:"fas fa-running"}}),[]);(0,it.useEffect)(()=>{document.documentElement.classList.toggle("dark",t.theme==="dark"),document.body.style.fontSize=`${t.fontSize}px`},[t.theme,t.fontSize]),(0,it.useEffect)(()=>{if(!r&&o&&a){let k=setTimeout(()=>{m(!1)},300);return()=>clearTimeout(k)}else m(!0)},[r,o,a]);let R=(0,it.useCallback)(k=>{let N=k.initialCharacterStats||T();N.progression_level||(N.progression_level=T().progression_level),N.spiritual_qi||(N.spiritual_qi=T().spiritual_qi),N.intelligence||(N.intelligence=T().intelligence),N.constitution||(N.constitution=T().constitution),N.agility||(N.agility=T().agility),N.luck||(N.luck=T().luck);let b=T();for(let O in b)["hp","mp","progression_level","spiritual_qi","intelligence","constitution","agility","luck"].includes(O)||N[O]||(N[O]=b[O]);let D=k.initialInventory||[],te={};if(D)for(let O of D)O.equippable&&O.slot&&Object.values(Or).includes(O.slot)&&!te[O.slot]&&(te[O.slot]=O.id);let re={setup:k,storyLog:[],currentChoices:[],currentSummary:"",currentWorldEvent:null,history:[],encyclopedia:[...k.entities],characterStats:N,inventory:D,equippedItems:te,unlockedAchievements:[],characterSkills:k.initialSkills||[],isInitialStoryGenerated:!1,isRoleplayModeActive:!1,isAuthorInterventionModeActive:!1,npcRelationships:{},objectives:[],activeSidebarTab:"stats",currency:t.currencyEnabled?{name:"\u0110\u1ED3ng",amount:100,icon:"fas fa-coins"}:void 0,currentTime:t.timeSystemEnabled?"08:00 Ng\xE0y 1, Th\xE1ng 1, N\u0103m 1 (S\xE1ng s\u1EDBm)":void 0};f(re),c(0),i({message:`B\u1EAFt \u0111\u1EA7u cu\u1ED9c phi\xEAu l\u01B0u m\u1EDBi: "${k.name||"Kh\xF4ng t\xEAn"}"!`,type:"success",icon:"fas fa-play-circle"})},[i,T,t.currencyEnabled,t.timeSystemEnabled]),C=(0,it.useCallback)(k=>{let N=T(),b={...k,setup:k.setup||{id:`loaded-${Date.now()}`,world:{theme:"Unknown",context:"Unknown",tone:"Unknown"},character:{name:"Unknown",gender:"Unknown",summary:"",traits:[],goal:""},entities:[],createdAt:new Date().toISOString()},storyLog:k.storyLog||[],currentChoices:k.currentChoices||[],currentSummary:k.currentSummary||"",currentWorldEvent:k.currentWorldEvent||null,history:k.history||[],encyclopedia:k.encyclopedia||k.setup?.entities||[],characterStats:k.characterStats||N,inventory:k.inventory||[],equippedItems:k.equippedItems||{},unlockedAchievements:k.unlockedAchievements||[],characterSkills:k.characterSkills||[],isInitialStoryGenerated:k.isInitialStoryGenerated!==void 0?k.isInitialStoryGenerated:k.storyLog&&k.storyLog.length>0,isRoleplayModeActive:k.isRoleplayModeActive||!1,isAuthorInterventionModeActive:k.isAuthorInterventionModeActive||!1,npcRelationships:k.npcRelationships||{},objectives:k.objectives||[],activeSidebarTab:k.activeSidebarTab&&k.activeSidebarTab!=="actions"?k.activeSidebarTab:"stats",currency:t.currencyEnabled&&k.currency?k.currency:t.currencyEnabled?{name:"\u0110\u1ED3ng",amount:0,icon:"fas fa-coins"}:void 0,currentTime:t.timeSystemEnabled&&k.currentTime?k.currentTime:t.timeSystemEnabled?"Th\u1EDDi gian kh\xF4ng x\xE1c \u0111\u1ECBnh":void 0};return b.characterStats.progression_level||(b.characterStats.progression_level=N.progression_level),b.characterStats.spiritual_qi||(b.characterStats.spiritual_qi=N.spiritual_qi),b.characterStats.intelligence||(b.characterStats.intelligence=N.intelligence),b.characterStats.constitution||(b.characterStats.constitution=N.constitution),b.characterStats.agility||(b.characterStats.agility=N.agility),b.characterStats.luck||(b.characterStats.luck=N.luck),["damage_output","attack_speed","crit_chance","crit_damage_bonus","defense_value","evasion_chance"].forEach(te=>{if(!b.characterStats[te]){let re=N[te];re&&(b.characterStats[te]=re)}}),b},[T,t.currencyEnabled,t.timeSystemEnabled]),g=(0,it.useCallback)((k,N="file")=>{let b=C(k);f(b),c(0);let D="t\u1EEB file";N==="autosave_slot"?D="t\u1EEB slot l\u01B0u tr\u1EEF":N==="drive"&&(D="t\u1EEB Google Drive"),i({message:`\u0110\xE3 t\u1EA3i game "${b.setup.name||"Game \u0111\xE3 l\u01B0u"}" ${D}!`,type:"success",icon:"fas fa-upload"})},[i,C]),x=(0,it.useCallback)(k=>{let N=localStorage.getItem(k);if(N)try{let b=JSON.parse(N);b&&b.gameState?g(b.gameState,"autosave_slot"):i({message:`D\u1EEF li\u1EC7u trong slot "${k.substring(_t.length).replace(/_/g," ")}" kh\xF4ng h\u1EE3p l\u1EC7.`,type:"error"})}catch(b){i({message:`L\u1ED7i khi \u0111\u1ECDc slot "${k.substring(_t.length).replace(/_/g," ")}".`,type:"error"}),console.error(`Error parsing slot ${k}:`,b)}else i({message:`Kh\xF4ng t\xECm th\u1EA5y slot "${k.substring(_t.length).replace(/_/g," ")}".`,type:"warning"})},[g,i]),S=(0,it.useCallback)(()=>{d&&d.setup.id?(y(d,d.setup.id),i({message:`\u0110\xE3 t\u1EF1 \u0111\u1ED9ng l\u01B0u ti\u1EBFn tr\xECnh game "${d.setup.name||d.setup.id}". H\u1EB9n g\u1EB7p l\u1EA1i!`,type:"info",icon:"fas fa-save"})):i({message:"\u0110\xE3 tho\xE1t game. H\u1EB9n g\u1EB7p l\u1EA1i!",type:"info",icon:"fas fa-door-open"}),f(null),c(0)},[d,y,i]),I=(0,it.useCallback)(k=>{if(!k){i({message:"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u game \u0111\u1EC3 l\u01B0u.",type:"error"});return}try{let N=JSON.stringify(k,null,2),b=new Blob([N],{type:"application/json"}),D=URL.createObjectURL(b),te=document.createElement("a"),re=k.setup.name?.replace(/[^a-z0-9]/gi,"_").toLowerCase()||"aisim_save",O=new Date().toISOString().slice(0,19).replace(/:/g,"-");te.href=D,te.download=`${re}_${O}.json`,document.body.appendChild(te),te.click(),document.body.removeChild(te),URL.revokeObjectURL(D),i({message:"Game \u0111\xE3 b\u1EAFt \u0111\u1EA7u t\u1EA3i xu\u1ED1ng d\u01B0\u1EDBi d\u1EA1ng file JSON!",type:"success",icon:"fas fa-file-download"})}catch(N){console.error("Error saving game to JSON:",N),i({message:"L\u1ED7i khi l\u01B0u game ra file JSON.",type:"error"})}},[i]);if(h)return(0,Ge.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen text-xl text-primary dark:text-primary-light bg-background-light dark:bg-background-dark p-4",children:[(0,Ge.jsxs)("svg",{className:"animate-spin h-12 w-12 text-primary dark:text-primary-light mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,Ge.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,Ge.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,Ge.jsx)("p",{className:"font-semibold",children:"\u0110ang t\u1EA3i \u1EE9ng d\u1EE5ng v\xE0 d\u1ECBch v\u1EE5 Google..."}),(0,Ge.jsx)("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Chu\u1EA9n b\u1ECB b\u01B0\u1EDBc v\xE0o th\u1EBF gi\u1EDBi huy\u1EC1n \u1EA3o!"})]});let V=()=>{switch(u){case 1:return(0,Ge.jsx)(fv,{onClose:()=>c(0)});case 2:return(0,Ge.jsx)(mv,{onClose:()=>c(0)});case 3:return(0,Ge.jsx)(yv,{onClose:()=>c(0)});case 4:return(0,Ge.jsx)(vv,{onClose:()=>c(0)});case 5:return(0,Ge.jsx)(xv,{onClose:()=>c(0),onStartStory:R});case 6:return(0,Ge.jsx)(Tv,{isOpen:u===6,onClose:()=>c(0),onLoadStoryFromFile:k=>g(k,"file"),onLoadStoryFromSlot:x,onLoadStoryFromDrive:k=>g(k,"drive")});case 7:return d?(0,Ge.jsx)(Cv,{onClose:()=>c(0),gameState:d,setGameState:f}):null;case 8:return d?(0,Ge.jsx)(kv,{onClose:()=>c(0),storyLog:d.storyLog,currentSummary:d.currentSummary,setGameState:f,apiKey:n,useDefaultAPI:t.useDefaultAPI}):null;case 9:return d?(0,Ge.jsx)(Sv,{onClose:()=>c(0),entries:d.encyclopedia}):null;case 10:return(0,Ge.jsx)(wv,{onClose:()=>c(0),onReincarnate:S});case 11:return(0,Ge.jsx)(Iv,{isOpen:u===11,onClose:()=>c(0),gameState:d,onSaveToJsonFile:I,onSaveToLocalStorageSlot:y});default:return null}};return(0,Ge.jsxs)("div",{className:`min-h-screen flex flex-col transition-colors duration-300 ease-in-out ${t.theme==="dark"?"dark bg-background-dark text-text-dark":"bg-background-light text-text-light"}`,children:[(0,Ge.jsx)(Nv,{}),V(),d?(0,Ge.jsx)(uv,{gameState:d,setGameState:f,openModal:c,quitGame:S,nsfwSettings:e,autosaveCurrentStory:p}):(0,Ge.jsx)(jp,{openModal:c})]})},Ev=$A;var lr=H(ee(),1),Pv=document.getElementById("root");if(!Pv)throw new Error("Could not find root element to mount to");var GA=bv.default.createRoot(Pv);GA.render((0,lr.jsx)(Av.default.StrictMode,{children:(0,lr.jsx)(Op,{children:(0,lr.jsx)(ng,{children:(0,lr.jsxs)(Yp,{children:[" ",(0,lr.jsx)(Ev,{})]})})})}));
/*! Bundled license information:

react/cjs/react.production.min.js:
  (**
   * @license React
   * react.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

scheduler/cjs/scheduler.production.min.js:
  (**
   * @license React
   * scheduler.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

react-dom/cjs/react-dom.production.min.js:
  (**
   * @license React
   * react-dom.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

react/cjs/react-jsx-runtime.production.min.js:
  (**
   * @license React
   * react-jsx-runtime.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)
*/
